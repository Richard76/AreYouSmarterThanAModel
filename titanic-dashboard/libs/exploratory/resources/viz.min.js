var VizUtil=function(){var res={};var Column={};Column.OperationType={NONE:"none",SUM:"sum",GROUPBY:"groupby",GROUPBY_SUM:"gbysum",GROUPBY_SORT:"gbysort",DISTINCT:"distinct",COUNT:"count",COUNT_PCT:"count_pct",COUNT_DISTINCT:"countd",COUNT_DISTINCT_PCT:"countd_pct",AVERAGE:"ave",MEDIAN:"median",MIN:"min",MAX:"max",FIRST:"first",FIRST_EXCLUDE_NA:"first_narm",LAST:"last",LAST_EXCLUDE_NA:"last_narm",QUANTILE:"quantile",NTH:"nth",DATE_AVERAGE:"dateave",DATE_MEDIAN:"datemedian",DATE_MIN:"datemin",DATE_MAX:"datemax",DATE_FIRST:"datefirst",DATE_FIRST_EXCLUDE_NA:"datefirst_narm",DATE_LAST:"datelast",DATE_LAST_EXCLUDE_NA:"datelast_narm",DATE_MODE:"datemode",VAR:"var",SD1:"sd",SD2:"sd2",SD3:"sd3",IQR:"iqr",MAD:"mad",LOG10:"log10",LOG2:"log2",LOG:"log",MODE:"mode",ABS:"abs",NORMALIZE:"normalize",UPPERCASE:"uppercase",LOWERCASE:"lowercase",TITLECASE:"titlecase",EXTRACT_ALPHABETS:"extract_alphabets",EXTRACT_NUMBERS:"extract_numbers",EXTRACT_FIRST_WORD:"extract_first_word",EXTRACT_RANGE:"extract_range",REMOVE_SPACES:"remove_spaces",REMOVE_REPEAETD_SPACES:"remove_repeated_spaces",REMOVE_ALPHABETS:"remove_alphabets",REMOVE_NUMBERS:"remove_numbers",CONSTANT:"constant",CUSTOM_GROUPBY_FUNCTION:"custom_gby",CUSTOM_SUMMARIZE_FUNCTION:"custom_sum",DATE_CONSTANT:"dateconstant",POSIXCT_CONSTANT:"posixctconstant",NA_COUNT:"nacount",NA_PCT:"napct",NON_NA_COUNT:"nnacount",NON_NA_PCT:"nnapct",ALL:"all",ANY:"any",ALL_PIVOT_TOTAL:"all_pivot_total",ANY_PIVOT_TOTAL:"any_pivot_total",TRUE_COUNT:"truecount",FALSE_COUNT:"falsecount",TRUE_PCT:"truepct",FALSE_PCT:"falsepct",ODDS:"odds",LM_FIT:"lmfit",LOESS_FIT:"loessfit",GAM_FIT:"gamfit",LOGISTIC_FIT:"logistic-fit",POISSON_FIT:"poisson-fit",BUCKET:"bucket",BOXPLOT:"boxplot",DENSITYPLOT:"densityplot",AS_CHAR:"aschar",AS_FACTOR:"asfactor",AS_LOGICAL_FACTOR:"aslfactor",STDERR:"stderr",CONF_INTV_95:"confint",CONF_INTV_99:"confint99",STDERR_PCT_WF:"stderrpct",CONF_INTV_PCT_95_WF:"confintpct",CONF_INTV_PCT_99_WF:"confintpct99",SD1_PCT_WF:"sdpct",SD2_PCT_WF:"sd2pct",SD3_PCT_WF:"sd3pct",IQR_PCT_WF:"iqrpct",STDERR_PCT:"stderrpct_agg",CONF_INTV_PCT_95:"confintpct_agg",CONF_INTV_PCT_99:"confintpct99_agg",SD1_PCT:"sdpct_agg",SD2_PCT:"sd2pct_agg",SD3_PCT:"sd3pct_agg",IQR_PCT:"iqrpct_agg",IN_PCT:"inpct",ROUND_TO_YEAR:"rtoyear",FLOOR_TO_YEAR:"fltoyear",ROUND_TO_HALF_YEAR:"rtohalfyear",FLOOR_TO_HALF_YEAR:"fltohalfyear",ROUND_TO_QUARTER:"rtoq",FLOOR_TO_QUARTER:"fltoquarter",ROUND_TO_BI_MONTH:"rtobimon",FLOOR_TO_BI_MONTH:"fltobimonth",ROUND_TO_MONTH:"rtomon",FLOOR_TO_MONTH:"fltomonth",ROUND_TO_WEEK:"rtoweek",FLOOR_TO_WEEK:"fltoweek",ROUND_TO_DAY:"rtoday",FLOOR_TO_DAY:"fltoday",ROUND_TO_HOUR:"rtohour",FLOOR_TO_HOUR:"fltohour",ROUND_TO_MINUTE:"rtomin",FLOOR_TO_MINUTE:"fltominute",ROUND_TO_SECOND:"rtosec",FLOOR_TO_SECOND:"fltosecond",YEAR:"year",HALF_YEAR:"halfyear",QUARTER:"quarter",BI_MONTH:"bimon",BI_MONTH_2:"bimonth",MONTH:"mon",MONTH_2:"month",MONTH_NAME:"monname",MONTH_NAME_2:"monthname",MONTH_NAME_LONG:"monnamelong",WEEK:"week",WEEK_SUNDAY_START:"epiweek",WEEK_MONDAY_START:"isoweek",WEEK_OF_QUARTER:"week_of_quarter",WEEK_OF_MONTH:"week_of_month",DAY:"day",DAY_OF_YEAR:"dayofyear",DAY_OF_QUARTER:"dayofquarter",DAY_OF_WEEK:"dayofweek",WEEKDAY:"wday",WEEKEND:"weekend",WEEKDAY_LONG:"wdaylong",HOUR:"hour",MINUTE:"minute",SECOND:"second",HOUR_NUMERIC:"hour_num",MINUTE_NUMERIC:"minute_num",SECOND_NUMERIC:"second_num",AS_NUM:"asnum",AS_DISCRETE_VALUES:"asdisc",AS_INTEGER:"asint",AS_INTEGER_BY10:"asintby10",AS_CATEGORY:"ascategory",RECODE:"recode",RECODE_EMPTY_STRING:"recode_empty_str",CONVERT_NA:"convertna",COMPLETE:"complete",COMPLETE_EACH:"complete_each",CONVERT_US_STATE_NAME:"convstate",CONVERT_COUNTRY_NAME:"convcountry",CONVERT_ISO2C:"conviso2c",CONVERT_ISO3N:"conviso3n",UNGROUP:"ungrp",CUT:"cut",BUCKET_OUTLIER:"bucket_outlier",BUCKET_OUTLIER_IQR:"bucket_outlier_iqr",BUCKET_OUTLIER_PERCENTILE:"bucket_outlier_pct",BUCKET_OUTLIER_SD:"bucket_outlier_sd",BUCKET_EQUAL_WIDTH:"bucket_equal_width",BUCKET_EQUAL_FREQ:"bucket_equal_freq",BUCKET_CUSTOM:"bucket_custom",BUCKET_KMEANS:"bucket_kmeans",BUCKET_LOGICALIZE:"bucket_logicalize",GATHER:"gather",CUMSUM:"cumsum",PCT_CUMSUM:"pcumsum",PCT_CUMSUM_REV:"pcumsum_rev",CUMMEAN:"cummean",CUMMIN:"cummin",CUMMAX:"cummax",CUMPROD:"cumprod",DIFF_FROM_PREV:"dfprev",DIFF_FROM_NEXT:"dfnext",DIFF_FROM_FIRST:"dfirst",DIFF_FROM_LAST:"dflast",DIFF_FROM_MIN:"dfmin",DIFF_FROM_MAX:"dfmax",DIFF_FROM_MEAN:"dfmean",DIFF_FROM_MEDIAN:"dfmed",DIFF_FROM_MODE:"dfmode",DIFF_FROM_CONST:"dfconst",PCT_DIFF_FROM_PREV:"pdfprev",PCT_DIFF_FROM_NEXT:"pdfnext",PCT_DIFF_FROM_FIRST:"pdfirst",PCT_DIFF_FROM_LAST:"pdflast",PCT_DIFF_FROM_MIN:"pdfmin",PCT_DIFF_FROM_MAX:"pdfmax",PCT_DIFF_FROM_MEAN:"pdfmean",PCT_DIFF_FROM_MEDIAN:"pdfmed",PCT_DIFF_FROM_MODE:"pdfmode",PCT_DIFF_FROM_CONST:"pdfconst",PCT_OF_TOTAL:"ptotal",PCT_OF_FIRST:"poffirst",PCT_OF_LAST:"poflast",PCT_OF_PREV:"pofprev",PCT_OF_NEXT:"pofnext",PCT_OF_MIN:"pofmin",PCT_OF_MAX:"pofmax",PCT_OF_MEAN:"pofmean",PCT_OF_MEDIAN:"pofmedian",PCT_OF_MODE:"pofmode",MIN_RANK:"mrank",DENSE_RANK:"drank",PCT_RANK:"prank",MIN_RANK_DESC:"mrankdesc",DENSE_RANK_DESC:"drankdesc",PCT_RANK_DESC:"prankdesc",ROLL_MIN:"rollmin",ROLL_MAX:"rollmax",ROLL_MEAN:"rollmean",ROLL_MEDIAN:"rollmed",ROLL_SD:"rollsd",ROLL_VAR:"rollvar",ROLL_SUM:"rollsum",ROLL_PROD:"rollprod",SORT_ASC:"sortasc",SORT_DESC:"sortdesc",FCT_CREATE:"fctcreate",FCT_REORDER_ASC:"fctreorderasc",FCT_REORDER_DESC:"fctreorderdesc",FCT_REV:"fctrev",FCT_DROP:"fct_drop",FCT_INFREQ:"infreq",FCT_INFREQ_ASC:"sortfreqasc",FCT_INFREQ_DESC:"sortfreqdesc",FCT_LUMP_INFREQ:"fctlump_infreq",FCT_LUMP:"fctlump",FCT_OTHER:"fctother",REF_LINE:"refline",REF_LINE_WITH_CONF_INT:"refline_confint",DIAGONAL:"diagonal",OUTLIERS_GROUPBY:"outliers_groupby",REMOVE_OUTLIERS_IQR:"remove_outliers_iqr",ROUND:"round",POST_FILTER:"postfilter"};Column.Attribute={CUSTOM_FUNCTION_COLUMN:"customFuncCol",CUSTOM_FUNCTION_EXPRESSION:"customFuncExpr",REFLINE_RANGE_SCOPE:"reflineRangeScope",REFLINE_RANGE_TYPE:"reflineRangeType",BUCKET_GROUP_BY_COLUMN:"bucketGroupByColumn",BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES:"bucketGroupByColumnOriginalNames",BUCKET_AFTER_SUMMARIZE:"bucketAfterSummarize",BUCKET_PRIORITY:"bucketPriority",BUCKET_CONVERT_NA:"bucketConvertNa",VALUE_PREFIX:"valuePrefix",VALUE_SUFFIX:"valueSuffix"};res.MAX_SAFE_INTEGER=9007199254740992;res.PIXEL_PER_CHAR=7;res.MIN_MARGIN=60;res.MAX_MARGIN=100;res.DEFAULT_MIN_CIRCLE_DIAMETER={scatter:6,bubble:10,map:3,scattermatrix:7};res.DEFAULT_MIN_CIRCLE_DIAMETER.easymap=res.DEFAULT_MIN_CIRCLE_DIAMETER.map;res.DEFAULT_MAX_CIRCLE_DIAMETER={scatter:30,bubble:40,map:40};res.DEFAULT_MAX_CIRCLE_DIAMETER.easymap=res.DEFAULT_MAX_CIRCLE_DIAMETER.map;res.DEFAULT_VIOLIN_POINT_OPACITY=.6;res.DEFAULT_DENSITYPLOT_NUM_DECIMAL_DIGITS=4;res.ZERO_LINE_COLOR="#cfcfcf";res.FREQ_COL_LABEL="(Number of Rows)";res.AGGREGATION_FUNCTION_OPTIONS_HASH={};res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SUM]="Sum";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.AVERAGE]="Mean";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MIN]="Min";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MAX]="Max";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MIN]="Min";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.DATE_MAX]="Max";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FIRST]="First";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.LAST]="Last";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT]="Count";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.COUNT_DISTINCT]="Uniq.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MEDIAN]="Med.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD1]="SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD2]="2SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.SD3]="3SD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.VAR]="Var.";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.IQR]="IQR";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MAD]="MAD";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.MODE]="Mode (Most Frequent)";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NTH]="Nth";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.QUANTILE]="Qtile";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NA_COUNT]="#NA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NA_PCT]="%NA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NON_NA_COUNT]="#NNA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.NON_NA_PCT]="%NNA";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.TRUE_COUNT]="#True";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FALSE_COUNT]="#False";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.TRUE_PCT]="%True";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.FALSE_PCT]="%False";res.AGGREGATION_FUNCTION_OPTIONS_HASH[Column.OperationType.ODDS]="Odds";res.NUMROW_FUNCTION_LABEL_HASH={};res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.COUNT]="(Number of Rows)";res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.NA_COUNT]="(Number of NA)";res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.NON_NA_COUNT]="(Number of Not NA)";res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.TRUE_COUNT]="(Number of TRUE)";res.NUMROW_FUNCTION_LABEL_HASH[Column.OperationType.FALSE_COUNT]="(Number of FALSE)";res.DEFAULT_FACET_SIZE=3;res.MAX_FACET_WIDTH=300;res.MIN_FACET_HEIGHT=300;res.ORIGINAL_ORDER_COL_NAME=".oo";res.TYPE_NUMROWS="numrows";res.NUMROWS_COL_NAME=".dummy.column.name.for.count.column";res.NUMROWS_COL_LABEL="(Number of Rows)";res.NUMROWS_COL_TEMPLATE={name:res.NUMROWS_COL_NAME,validName:res.NUMROWS_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_NUMROWS,func:Column.OperationType.COUNT,label:null,validLabel:null};res.NUMERIC_COLS_NAME=".dummy.column.name.for.numeric.columns";res.NUMERIC_COLS_LABEL="(Numeric Columns)";res.TYPE_CUSTOM="custom";res.CUSTOM_COL_NAME=".dummy.column.name.for.custom.column";res.CUSTOM_COL_LABEL="(Custom)";res.CUSTOM_COL_TEMPLATE={name:res.CUSTOM_COL_NAME,validName:res.CUSTOM_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_CUSTOM,func:Column.OperationType.COUNT,label:null,validLabel:null};res.TYPE_ROWID="rowid";res.ROWID_COL_NAME=".rowid.column";res.ROWID_COL_LABEL="(Row ID)";res.ROWID_COL_TEMPLATE={name:res.ROWID_COL_NAME,validName:res.ROWID_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_ROWID,func:Column.OperationType.NONE,label:null,validLabel:null};res.TYPE_KEYPROP="keyprop";res.KEYPROP_COL_NAME=".keyprop.column";res.KEYPROP_COL_LABEL="(Key)";res.KEYPROP_COL_TEMPLATE={name:res.KEYPROP_COL_NAME,validName:res.KEYPROP_COL_NAME,isNumeric:true,isDate:false,type:res.TYPE_KEYPROP,func:Column.OperationType.CUSTOM_GROUPBY_FUNCTION,label:null,validLabel:null};res.TYPE_GROUP_BY_MEASURES="group-by-measure";res.GRUOP_BY_MEASURES_COL_NAME=".group.by.measure.column";res.GRUOP_BY_MEASURES_COL_LABEL="(Each Y Axis)";res.GRUOP_BY_MEASURES_COL_TEMPLATE={name:res.GRUOP_BY_MEASURES_COL_NAME,validName:res.GRUOP_BY_MEASURES_COL_NAME,isNumeric:false,isDate:false,type:res.TYPE_GROUP_BY_MEASURES,func:Column.OperationType.GATHER,label:res.GRUOP_BY_MEASURES_COL_LABEL,validLabel:res.GRUOP_BY_MEASURES_COL_LABEL};res.LONGITUDE_COL_NAME="longitude";res.LONGITUDE_COL_LABEL="Longitude";res.LATITUDE_COL_NAME="latitude";res.LATITUDE_COL_LABEL="Latitude";res.NROW_INTERNAL_COL_NAME="..nrow";res.ERRBAR_NUMERATOR_INTERNAL_COL_NAME="..ebn";var _createHash=function(definitionArr,valueProp){var obj={};definitionArr.forEach(function(item){obj[item.value]=item[valueProp||"label"]});return obj};res.POST_FILTER_OPTIONS=[{label:"None",value:""},{label:"Condition",value:"condition"},{label:"Top N",value:"top"},{label:"Bottom N",value:"bottom"}];res.POST_FILTER_OPTIONS_HASH=_createHash(res.POST_FILTER_OPTIONS);res.BUCKET_OPTIONS=[{label:"Automatic",value:0},{label:"5",value:5},{label:"10",value:10},{label:"15",value:15},{label:"20",value:20},{label:"25",value:25},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200},{label:"500",value:500},{label:"1,000",value:1e3}];res.BUCKET_OPTIONS_HASH=_createHash(res.BUCKET_OPTIONS);res.PCT_TOTAL_DIRECTION_OPTIONS=[{value:"color",label:"X Axis"},{value:"x",label:"Color"},{value:"all",label:"All"}];res.PCT_TOTAL_DIRECTION_OPTIONS_HASH=_createHash(res.PCT_TOTAL_DIRECTION_OPTIONS);res.ORDER_OPTIONS=[{value:"asc",label:"Ascending"},{value:"desc",label:"Descending"}];res.ORDER_OPTIONS_HASH=_createHash(res.ORDER_OPTIONS);res.MARKER_SHAPE_OPTIONS=[{value:"default",label:"(Default)"},{value:"circle",label:"Circle"},{value:"bar",label:"Bar"},{value:"line",label:"Line"},{value:"line+circle",label:"Line + Circle"}];res.MARKER_SHAPE_OPTIONS_HASH=_createHash(res.MARKER_SHAPE_OPTIONS);res.ERRBAR_MARKER_SHAPE_OPTIONS=[{value:"bar",label:"Bar"},{value:"circle",label:"Marker"}];res.ERRBAR_MARKER_SHAPE_OPTIONS_HASH=_createHash(res.ERRBAR_MARKER_SHAPE_OPTIONS);res.PIVOT_COLOR_OPTIONS=[{label:"None",value:"none"},{label:"All (Down then Across)",value:"table_down_across"},{label:"Row (Across)",value:"table_across"},{label:"Column (Down then Across within Group)",value:"pane_down_across"},{label:"Column (Down)",value:"table_down"},{label:"Column (Down within Group)",value:"pane_down"}];res.PIVOT_COLOR_OPTIONS_HASH=_createHash(res.PIVOT_COLOR_OPTIONS);res.PIVOT_COLOR_OPTIONS_HASH.table5="All";res.PIVOT_COLOR_OPTIONS_HASH.row5="Row";res.PIVOT_WINDOW_FUNC_DIRECTIONS=[{label:"All (Down then Across)",value:"table_down_across"},{label:"Row (Across)",value:"table_across"},{label:"Column (Down then Across within Group)",value:"pane_down_across"},{label:"Column (Down)",value:"table_down"},{label:"Column (Down within Group)",value:"pane_down"}];res.PIVOT_WINDOW_FUNC_DIRECTIONS_HASH=_createHash(res.PIVOT_WINDOW_FUNC_DIRECTIONS);res.PIVOT_DIRECTIONS_BACKWARD_COMPATIBILITY_MAP={all:"table_down_across",row:"table_across",row_group:"pane_down_across",column:"table_down"};res.TABLE_MAX_NUMROW_OPTIONS=[{label:"20",value:20},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200},{label:"500",value:500},{label:"1,000",value:1e3}];res.TABLE_MAX_NUMROW_OPTIONS_HASH=_createHash(res.TABLE_MAX_NUMROW_OPTIONS);res.TABLE_MAX_NUMCOL_OPTIONS=[{label:"300",value:300},{label:"1,000",value:1e3},{label:"10,000",value:1e4}];res.TABLE_MAX_NUMCOL_OPTIONS_HASH=_createHash(res.TABLE_MAX_NUMCOL_OPTIONS);res.MODEL_DATA_TYPE_OPTIONS=[{label:"Coefficients",value:"tidy"},{label:"Model Quality Stats",value:"glance"},{label:"Scored Data",value:"augment"}];res.MODEL_DATA_TYPE_OPTIONS_HASH=_createHash(res.MODEL_DATA_TYPE_OPTIONS);res.ERROR_BAR_TYPE_OPTIONS=[{label:"Standard Error",hint:"Standard Error",value:Column.OperationType.STDERR},{label:"95% Conf. Interval",hint:"95% Confidence Interval",value:Column.OperationType.CONF_INTV_95},{label:"99% Conf. Interval",hint:"99% Confidence Interval",value:Column.OperationType.CONF_INTV_99},{label:"1 Standard Deviation",hint:"1 Standard Deviation",value:Column.OperationType.SD1},{label:"2 Standard Deviation",hint:"2 Standard Deviation",value:Column.OperationType.SD2},{label:"3 Standard Deviation",hint:"3 Standard Deviation",value:Column.OperationType.SD3},{label:"1.5 IQR",hint:"1.5 Interquartile Range (IQR)",value:Column.OperationType.IQR}];res.ERROR_BAR_TYPE_OPTIONS_HASH=_createHash(res.ERROR_BAR_TYPE_OPTIONS);res.REFERENCE_LINE_RANGE_TYPE_OPTIONS=[{label:"Standard Error",hint:"Standard Error",value:Column.OperationType.STDERR},{label:"95% Conf. Interval",hint:"95% Confidence Interval",value:Column.OperationType.CONF_INTV_95},{label:"99% Conf. Interval",hint:"99% Confidence Interval",value:Column.OperationType.CONF_INTV_99},{label:"1 Standard Deviation",hint:"1 Standard Deviation",value:Column.OperationType.SD1},{label:"2 Standard Deviation",hint:"2 Standard Deviation",value:Column.OperationType.SD2},{label:"3 Standard Deviation",hint:"3 Standard Deviation",value:Column.OperationType.SD3},{label:"1.5 IQR",hint:"1.5 Interquartile Range (IQR)",value:Column.OperationType.IQR}];res.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH=_createHash(res.REFERENCE_LINE_RANGE_TYPE_OPTIONS);res.EASYMAP_TYPE_OPTIONS=[{label:"Circle",value:"circle"},{label:"Area",value:"area"}];res.EASYMAP_TYPE_OPTIONS_HASH=_createHash(res.EASYMAP_TYPE_OPTIONS);res.ERROR_BAR_GRAPH_OPTIONS=[{label:"Bar",value:"bar"},{label:"Circle",value:"marker"}];res.ERROR_BAR_GRAPH_OPTIONS_HASH=_createHash(res.ERROR_BAR_GRAPH_OPTIONS);res.ERROR_BAR_CALC_TYPE_OPTIONS=[{label:"Mean",value:"mean"},{label:"Ratio (%)",value:"ratio"}];res.ERROR_BAR_CALC_TYPE_OPTIONS_HASH=_createHash(res.ERROR_BAR_CALC_TYPE_OPTIONS);res.ERROR_BAR_RATIO_DIRECTION_OPTIONS=[{value:"color",label:"X Axis"},{value:"x",label:"Color"},{value:"all",label:"All"}];res.ERROR_BAR_RATIO_DIRECTION_OPTIONS_HASH=_createHash(res.ERROR_BAR_RATIO_DIRECTION_OPTIONS);res.WINDOW_FUNCTION_CALC_TYPES=[{label:"(none)",value:"none",items:[{label:"(none)",hint:"none",value:Column.OperationType.NONE}]},{label:"Cumulative",value:"cum",itemLabel:"Summarize Values Using",items:[{label:"Sum",hint:"Cumulative Sum",value:Column.OperationType.CUMSUM},{label:"Sum Ratio",hint:"Cumulative Sum Ratio",value:Column.OperationType.PCT_CUMSUM},{label:"Mean (Average)",hint:"Cumulative Mean",value:Column.OperationType.CUMMEAN},{label:"Min Value",hint:"Cumulative Min",value:Column.OperationType.CUMMIN},{label:"Max Value",hint:"Cumulative Max",value:Column.OperationType.CUMMAX},{label:"Product",hint:"Cumulative Product",value:Column.OperationType.CUMPROD}]},{label:"% of",value:"total",itemLabel:"Summarize Values Using",items:[{label:"Sum (Total)",hint:"Sum (Total)",value:Column.OperationType.PCT_OF_TOTAL},{label:"Mean (Average)",hint:"Mean (Average)",value:Column.OperationType.PCT_OF_MEAN},{label:"Median",hint:"Median",value:Column.OperationType.PCT_OF_MEDIAN},{label:"Mode (Most Frequent)",hint:"Mode (Most Frequent)",value:Column.OperationType.PCT_OF_MODE},{label:"Min Value",hint:"Min",value:Column.OperationType.PCT_OF_MIN},{label:"Max Value",hint:"Max",value:Column.OperationType.PCT_OF_MAX},{label:"First Value",hint:"First",value:Column.OperationType.PCT_OF_FIRST},{label:"Last Value",hint:"Last",value:Column.OperationType.PCT_OF_LAST},{label:"Previous Value",hint:"Previous",value:Column.OperationType.PCT_OF_PREV},{label:"Next Value",hint:"Next",value:Column.OperationType.PCT_OF_NEXT}]},{label:"Difference From",value:"diff",itemLabel:"Difference from",items:[{label:"Mean (Average)",hint:"Difference from Mean",value:Column.OperationType.DIFF_FROM_MEAN},{label:"Median",hint:"Difference from Median",value:Column.OperationType.DIFF_FROM_MEDIAN},{label:"Mode (Most Frequent)",hint:"Difference from Mode",value:Column.OperationType.DIFF_FROM_MODE},{label:"Min Value",hint:"Difference from Min",value:Column.OperationType.DIFF_FROM_MIN},{label:"Max Value",hint:"Difference from Max",value:Column.OperationType.DIFF_FROM_MAX},{label:"First Value",hint:"Difference from First",value:Column.OperationType.DIFF_FROM_FIRST},{label:"Last Value",hint:"Difference from Last",value:Column.OperationType.DIFF_FROM_LAST},{label:"Previous Value",hint:"Difference from Previous",value:Column.OperationType.DIFF_FROM_PREV},{label:"Next Value",hint:"Difference from Next",value:Column.OperationType.DIFF_FROM_NEXT},{label:"Specific Value",hint:"Difference from Specific Value",value:Column.OperationType.DIFF_FROM_CONST}]},{label:"% Difference From",value:"pdiff",itemLabel:"% Difference from",items:[{label:"Mean (Average)",hint:"% Difference from Mean",value:Column.OperationType.PCT_DIFF_FROM_MEAN},{label:"Median",hint:"% Difference from Median",value:Column.OperationType.PCT_DIFF_FROM_MEDIAN},{label:"Mode (Most Frequent)",hint:"% Difference from Mode",value:Column.OperationType.PCT_DIFF_FROM_MODE},{label:"Min Value",hint:"% Difference from Min",value:Column.OperationType.PCT_DIFF_FROM_MIN},{label:"Max Value",hint:"% Difference from Max",value:Column.OperationType.PCT_DIFF_FROM_MAX},{label:"First Value",hint:"% Difference from First",value:Column.OperationType.PCT_DIFF_FROM_FIRST},{label:"Last Value",hint:"% Difference from Last",value:Column.OperationType.PCT_DIFF_FROM_LAST},{label:"Previous Value",hint:"% Difference from Previous",value:Column.OperationType.PCT_DIFF_FROM_PREV},{label:"Next Value",hint:"% Difference from Next",value:Column.OperationType.PCT_DIFF_FROM_NEXT},{label:"Specific Value",hint:"% Difference from Specific Value",value:Column.OperationType.PCT_DIFF_FROM_CONST}]},{label:"Moving Calculation",value:"roll",itemLabel:"Summarize Values Using",items:[{label:"Sum",hint:"Moving Sum",value:Column.OperationType.ROLL_SUM},{label:"Mean (Average)",hint:"Moving Average",value:Column.OperationType.ROLL_MEAN},{label:"Median",hint:"Moving Median",value:Column.OperationType.ROLL_MEDIAN},{label:"Min Value",hint:"Moving Min",value:Column.OperationType.ROLL_MIN},{label:"Max Value",hint:"Moving Max",value:Column.OperationType.ROLL_MAX},{label:"Standard Deviation",hint:"Moving Standard Deviation",value:Column.OperationType.ROLL_SD},{label:"Variance",hint:"Moving Variance",value:Column.OperationType.ROLL_VAR},{label:"Product",hint:"Moving Product",value:Column.OperationType.ROLL_PROD}]},{label:"Rank",value:"rank",itemLabel:"Rank Type",items:[{label:"Min Rank (1,2,2,4)",hint:"Min Rank",value:Column.OperationType.MIN_RANK},{label:"Dense Rank (1,2,2,3)",hint:"Dense Rank",value:Column.OperationType.DENSE_RANK},{label:"Percent Rank (10,20,20,30)",hint:"Percent Rank",value:Column.OperationType.PCT_RANK}]}];res.OTHER_GROUP_OPTION_TYPE={NONE:"off",FCT_LUMP:"on",FCT_OTHER_KEEP_VALUES:"keep_values",FCT_OTHER_DROP_VALUES:"drop_values"};res.OTHER_GROUP_OPTIONS=[{label:"(None)",value:res.OTHER_GROUP_OPTION_TYPE.NONE},{label:"Based on Frequency",value:res.OTHER_GROUP_OPTION_TYPE.FCT_LUMP},{label:"Manually Select to Keep",value:res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES},{label:"Manually Select to Drop",value:res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES}];res.WINDOW_FUNCTION_CALC_TYPES_HIST=[res.WINDOW_FUNCTION_CALC_TYPES[0],res.WINDOW_FUNCTION_CALC_TYPES[2]];res.WINDOW_FUNCTION_CALC_TYPES_ERRBAR=[res.WINDOW_FUNCTION_CALC_TYPES[0],res.WINDOW_FUNCTION_CALC_TYPES[2]];res.WINDOW_FUNCTION_CALC_TYPES_PIVOT=[res.WINDOW_FUNCTION_CALC_TYPES[0],res.WINDOW_FUNCTION_CALC_TYPES[1],res.WINDOW_FUNCTION_CALC_TYPES[2],res.WINDOW_FUNCTION_CALC_TYPES[3],res.WINDOW_FUNCTION_CALC_TYPES[4],res.WINDOW_FUNCTION_CALC_TYPES[5],res.WINDOW_FUNCTION_CALC_TYPES[6]];res.DEFAULT_CATEG_COLOR_NUM_GROUPS_TO_PRESERVE=20;res.DEFAULT_FACET_NUM_GROUPS_TO_PRESERVE=20;res.DEFAULT_GROUP_BY_NUM_GROUPS_TO_PRESERVE=1e3;res.DEFAULT_PIVOT_NUM_GROUPS_TO_PRESERVE=100;res.DEFAULT_SCATTER_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_SCATTER_Y_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_HEATMAP_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_HEATMAP_Y_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_BUBBLE_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_BUBBLE_Y_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_BAR_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_LINE_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_AREA_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_ERRBAR_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_BOXPLOT_X_NUM_GROUPS_TO_PRESERVE=200;res.DEFAULT_VIOLIN_X_NUM_GROUPS_TO_PRESERVE=200;res.getDefaultNumberOfGroups=function(marker,option){if(/^(color|categColor)$/.test(option)){return res.DEFAULT_CATEG_COLOR_NUM_GROUPS_TO_PRESERVE}else if(option==="facet"){return res.DEFAULT_FACET_NUM_GROUPS_TO_PRESERVE}else if(option==="groupby"){return res.DEFAULT_GROUP_BY_NUM_GROUPS_TO_PRESERVE}else if(/^(rowh|colh)/.test(option)){return res.DEFAULT_PIVOT_NUM_GROUPS_TO_PRESERVE}else if(/^(x)/.test(option)){switch(marker){case"heatmap":return res.DEFAULT_HEATMAP_X_NUM_GROUPS_TO_PRESERVE;case"bubble":return res.DEFAULT_BUBBLE_X_NUM_GROUPS_TO_PRESERVE;case"scatter":return res.DEFAULT_SCATTER_X_NUM_GROUPS_TO_PRESERVE;case"bar":return res.DEFAULT_BAR_X_NUM_GROUPS_TO_PRESERVE;case"line":return res.DEFAULT_LINE_X_NUM_GROUPS_TO_PRESERVE;case"area":return res.DEFAULT_AREA_X_NUM_GROUPS_TO_PRESERVE;case"errbar":return res.DEFAULT_ERRBAR_X_NUM_GROUPS_TO_PRESERVE;case"boxplot":return res.DEFAULT_BOXPLOT_X_NUM_GROUPS_TO_PRESERVE;case"violin":return res.DEFAULT_VIOLIN_X_NUM_GROUPS_TO_PRESERVE}}else if(/^(y)/.test(option)){switch(marker){case"heatmap":return res.DEFAULT_HEATMAP_Y_NUM_GROUPS_TO_PRESERVE;case"bubble":return res.DEFAULT_BUBBLE_Y_NUM_GROUPS_TO_PRESERVE;case"scatter":return res.DEFAULT_SCATTER_Y_NUM_GROUPS_TO_PRESERVE}}return res.DEFAULT_CATEG_COLOR_NUM_GROUPS_TO_PRESERVE};res.DEFAULT_LIMIT_NUMBER_OF_GROUPS=20;res.getDefaultLimitNumberOfGroups=function(){return res.DEFAULT_LIMIT_NUMBER_OF_GROUPS};var _createCalcTypesHash=function(definitionArr){var obj={};definitionArr.forEach(function(item){obj[item.value]=item});return obj};res.WINDOW_FUNCTION_CALC_TYPES_HASH=_createCalcTypesHash(res.WINDOW_FUNCTION_CALC_TYPES);var _createCalcDetailTypesHash=function(definitionArr){var ht={};definitionArr.forEach(function(item){var detailHt={};item.items.forEach(function(x){detailHt[_getAggFuncNameFromWinFuncName(x.value)]=x.value});ht[item.value]=detailHt});return ht};var _getAggFuncNameFromWinFuncName=function(windowFuncValue){var aggFuncName=windowFuncValue==="ptotal"?"sum":windowFuncValue==="dfirst"?"first":windowFuncValue==="pdfirst"?"first":windowFuncValue==="pofmedian"?"med":/^roll/.test(windowFuncValue)?windowFuncValue.replace(/^roll/,""):/^pof/.test(windowFuncValue)?windowFuncValue.replace(/^pof/,""):/^df/.test(windowFuncValue)?windowFuncValue.replace(/^df/,""):/^pdf/.test(windowFuncValue)?windowFuncValue.replace(/^pdf/,""):/^cum/.test(windowFuncValue)?windowFuncValue.replace(/^cum/,""):windowFuncValue;return aggFuncName};res.getAggFuncNameFromWinFuncName=_getAggFuncNameFromWinFuncName;res.WINDOW_FUNCTION_CALC_DETAIL_TYPES_HASH=_createCalcDetailTypesHash(res.WINDOW_FUNCTION_CALC_TYPES);res.WINDOW_FUNCTION_OPTIONS=[{label:"(none)",value:Column.OperationType.NONE},{label:"Cumulative Sum",value:Column.OperationType.CUMSUM},{label:"Cumulative Sum Ratio",value:Column.OperationType.PCT_CUMSUM},{label:"Cumulative Mean",value:Column.OperationType.CUMMEAN},{label:"Cumulative Min",value:Column.OperationType.CUMMIN},{label:"Cumulative Max",value:Column.OperationType.CUMMAX},{label:"Cumulative Prod",value:Column.OperationType.CUMPROD},{label:"% of Total",value:Column.OperationType.PCT_OF_TOTAL},{label:"% of First",value:Column.OperationType.PCT_OF_FIRST},{label:"% of Last",value:Column.OperationType.PCT_OF_LAST},{label:"% of Previous",value:Column.OperationType.PCT_OF_PREV},{label:"% of Next",value:Column.OperationType.PCT_OF_NEXT},{label:"% of Min",value:Column.OperationType.PCT_OF_MIN},{label:"% of Max",value:Column.OperationType.PCT_OF_MAX},{label:"% of Mean",value:Column.OperationType.PCT_OF_MEAN},{label:"% of Median",value:Column.OperationType.PCT_OF_MEDIAN},{label:"% of Mode",value:Column.OperationType.PCT_OF_MODE},{label:"Difference from Previous",value:Column.OperationType.DIFF_FROM_PREV},{label:"Difference from Next",value:Column.OperationType.DIFF_FROM_NEXT},{label:"Difference from First",value:Column.OperationType.DIFF_FROM_FIRST},{label:"Difference from Last",value:Column.OperationType.DIFF_FROM_LAST},{label:"Difference from Min",value:Column.OperationType.DIFF_FROM_MIN},{label:"Difference from Max",value:Column.OperationType.DIFF_FROM_MAX},{label:"Difference from Mean",value:Column.OperationType.DIFF_FROM_MEAN},{label:"Difference from Median",value:Column.OperationType.DIFF_FROM_MEDIAN},{label:"Difference from Mode",value:Column.OperationType.DIFF_FROM_MODE},{label:"Difference from Constant",value:Column.OperationType.DIFF_FROM_CONST},{label:"% Difference from Previous",value:Column.OperationType.PCT_DIFF_FROM_PREV},{label:"% Difference from Next",value:Column.OperationType.PCT_DIFF_FROM_NEXT},{label:"% Difference from First",value:Column.OperationType.PCT_DIFF_FROM_FIRST},{label:"% Difference from Last",value:Column.OperationType.PCT_DIFF_FROM_LAST},{label:"% Difference from Min",value:Column.OperationType.PCT_DIFF_FROM_MIN},{label:"% Difference from Max",value:Column.OperationType.PCT_DIFF_FROM_MAX},{label:"% Difference from Mean",value:Column.OperationType.PCT_DIFF_FROM_MEAN},{label:"% Difference from Median",value:Column.OperationType.PCT_DIFF_FROM_MEDIAN},{label:"% Difference from Mode",value:Column.OperationType.PCT_DIFF_FROM_MODE},{label:"% Difference from Constant",value:Column.OperationType.PCT_DIFF_FROM_CONST},{label:"Moving Average",value:Column.OperationType.ROLL_MEAN},{label:"Moving Min",value:Column.OperationType.ROLL_MIN},{label:"Moving Max",value:Column.OperationType.ROLL_MAX},{label:"Moving Median",value:Column.OperationType.ROLL_MEDIAN},{label:"Moving Standard Deviation",value:Column.OperationType.ROLL_SD},{label:"Moving Variance",value:Column.OperationType.ROLL_VAR},{label:"Moving Sum",value:Column.OperationType.ROLL_SUM},{label:"Moving Prod",value:Column.OperationType.ROLL_PROD},{label:"Min Rank",value:Column.OperationType.MIN_RANK},{label:"Dense Rank",value:Column.OperationType.DENSE_RANK},{label:"Percent Rank",value:Column.OperationType.PCT_RANK}];res.WINDOW_FUNCTION_OPTIONS_HASH=_createHash(res.WINDOW_FUNCTION_OPTIONS);res.REFERENCE_LINE_OPTIONS=[{label:"Sum",value:Column.OperationType.SUM},{label:"Mean",value:Column.OperationType.AVERAGE},{label:"Med.",value:Column.OperationType.MEDIAN},{label:"Mode (Most Frequent)",value:Column.OperationType.MODE},{label:"Min",value:Column.OperationType.MIN},{label:"Max",value:Column.OperationType.MAX},{label:"First",value:Column.OperationType.FIRST_EXCLUDE_NA},{label:"Last",value:Column.OperationType.LAST_EXCLUDE_NA},{label:"First",value:Column.OperationType.FIRST},{label:"Last",value:Column.OperationType.LAST},{label:"Diagonal",value:Column.OperationType.DIAGONAL},{label:"Specific Value",value:Column.OperationType.CONSTANT}];res.REFERENCE_LINE_OPTIONS_HASH=_createHash(res.REFERENCE_LINE_OPTIONS);res.PIVOT_TOTAL_AGGREGATION_OPTIONS=[{value:"",label:"AUTO",shortLabel:"AUTO"},{value:Column.OperationType.SUM,label:"Sum",shortLabel:"SUM"},{value:Column.OperationType.AVERAGE,label:"Mean (Average)",shortLabel:"MEAN"},{value:Column.OperationType.MEDIAN,label:"Median",shortLabel:"MED"},{value:Column.OperationType.MODE,label:"Mode (Most Frequent)",shortLabel:"MODE"},{value:Column.OperationType.MIN,label:"Min Value",shortLabel:"MIN"},{value:Column.OperationType.MAX,label:"Max Value",shortLabel:"MAX"}];res.PIVOT_TOTAL_AGGREGATION_OPTIONS_SHORT_NAME_HASH=_createHash(res.PIVOT_TOTAL_AGGREGATION_OPTIONS,"shortLabel");res.PIVOT_TOTAL_AGGREGATION_OPTIONS_HASH=_createHash(res.PIVOT_TOTAL_AGGREGATION_OPTIONS);res.POST_FILTER_AGGREGATION_MAP={};res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.SUM]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.AVERAGE]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MEDIAN]=Column.OperationType.MEDIAN;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.COUNT_DISTINCT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MIN]=Column.OperationType.MIN;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MAX]=Column.OperationType.MAX;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.DATE_MIN]=Column.OperationType.DATE_MIN;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.DATE_MAX]=Column.OperationType.DATE_MAX;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FIRST]=Column.OperationType.FIRST;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FIRST_EXCLUDE_NA]=Column.OperationType.FIRST_EXCLUDE_NA;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.LAST]=Column.OperationType.LAST;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.LAST_EXCLUDE_NA]=Column.OperationType.LAST_EXCLUDE_NA;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.SD1]=Column.OperationType.AVERAGE
;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.SD2]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.SD3]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.VAR]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.IQR]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MAD]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.MODE]=Column.OperationType.MODE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NA_COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NA_PCT]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NON_NA_COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.NON_NA_PCT]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.TRUE_COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FALSE_COUNT]=Column.OperationType.SUM;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.TRUE_PCT]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.FALSE_PCT]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_MAP[Column.OperationType.ODDS]=Column.OperationType.AVERAGE;res.POST_FILTER_AGGREGATION_OPTIONS=[{value:Column.OperationType.FIRST_EXCLUDE_NA,label:"First Value",shortLabel:"1ST"},{value:Column.OperationType.LAST_EXCLUDE_NA,label:"Last Value",shortLabel:"LAST"}];res.getDefaultPostFilterAggregationFunction=function(){return Column.OperationType.LAST_EXCLUDE_NA};var MAX_NUMBER_OF_CONTROLS={rowh:10,colh:1,meas:30,y:30,tcol:300,scattermatrix:50};res.MAX_NUMBER_OF_CONTROLS=MAX_NUMBER_OF_CONTROLS;res.AXIS_DIRECTION_OPTIONS=[{label:"Normal",value:"normal"},{label:"Reversed",value:"reversed"},{label:"Default",value:""}];res.BUCKET_TYPE_OPTIONS_NO_LOGICALIZE=[{value:Column.OperationType.BUCKET_EQUAL_WIDTH,label:"Equal Width"},{value:Column.OperationType.BUCKET_EQUAL_FREQ,label:"Equal Frequency"},{value:Column.OperationType.BUCKET_CUSTOM,label:"Manual"},{value:Column.OperationType.BUCKET_OUTLIER,label:"Outliers"}];res.BUCKET_TYPE_OPTIONS_NO_LOGICALIZE_WITH_NONE=[{value:Column.OperationType.NONE,label:"None"},{value:Column.OperationType.BUCKET_EQUAL_WIDTH,label:"Equal Width"},{value:Column.OperationType.BUCKET_EQUAL_FREQ,label:"Equal Frequency"},{value:Column.OperationType.BUCKET_CUSTOM,label:"Manual"},{value:Column.OperationType.BUCKET_OUTLIER,label:"Outliers"}];res.BUCKET_TYPE_OPTIONS=[{value:Column.OperationType.BUCKET_EQUAL_WIDTH,label:"Equal Width"},{value:Column.OperationType.BUCKET_EQUAL_FREQ,label:"Equal Frequency"},{value:Column.OperationType.BUCKET_CUSTOM,label:"Manual"},{value:Column.OperationType.BUCKET_OUTLIER,label:"Outliers"},{value:Column.OperationType.BUCKET_LOGICALIZE,label:"Logical Condition"}];res.BUCKET_TYPE_OPTIONS_HASH=_createHash(res.BUCKET_TYPE_OPTIONS);res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_IQR]="1.5 IQR";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_PERCENTILE]="Percentile";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.BUCKET_OUTLIER_SD]="Standard Deviation";res.BUCKET_TYPE_OPTIONS_HASH[Column.OperationType.NONE]="None";res.BUCKET_TYPE_OPTIONS_CATEGORY=[{value:Column.OperationType.NONE,label:"None"},{value:Column.OperationType.BUCKET_LOGICALIZE,label:"Logical Condition"}];res.BUCKET_TYPE_OPTIONS_CATEGORY_HASH=_createHash(res.BUCKET_TYPE_OPTIONS_CATEGORY);res.BUCKET_OUTLIER_OPTIONS=[{value:Column.OperationType.BUCKET_OUTLIER_IQR,label:"1.5 IQR"},{value:Column.OperationType.BUCKET_OUTLIER_PERCENTILE,label:"Percentile"},{value:Column.OperationType.BUCKET_OUTLIER_SD,label:"Standard Deviation"}];res.BUCKET_OUTLIER_OPTIONS_HASH=_createHash(res.BUCKET_OUTLIER_OPTIONS);res.LOGICALIZE_OPERATOR={EQUAL_TO:"equalTo",NOT_EQUAL_TO:"notEqualTo",IS_IN:"in",IS_NOT_IN:"notIn",LESS_THAN:"lessThan",LESS_THAN_OR_EQUAL_TO:"lessThanOrEqualTo",GREATER_THAN:"greaterThan",GREATER_THAN_OR_EQUAL_TO:"greaterThanOrEqualTo",BETWEEN:"between",NOT_BETWEEN:"notBetween",IS_NA:"isNA",IS_NOT_NA:"isNotNA",IS_OUTLIER:"isOutlier",IS_OUTLIER_SD:"isOutlier_sd",IS_OUTLIER_PERCENTILE:"isOutlier_pct",IS_OUTLIER_IQR:"isOutlier_iqr",IS_NOT_OUTLIER:"isNotOutlier",IS_NOT_OUTLIER_SD:"isNotOutlier_sd",IS_NOT_OUTLIER_PERCENTILE:"isNotOutlier_pct",IS_NOT_OUTLIER_IQR:"isNotOutlier_iqr",START_WITH:"startsWith",NOT_START_WITH:"notStartWith",END_WITH:"endsWith",NOT_END_WITH:"notEndWith",CONTAIN:"contains",NOT_CONTAIN:"notContain",IS_EMPTY:"isEmpty",IS_NOT_EMPTY:"isNotEmpty",IS_STOPWORD:"isStopword",IS_NOT_STOPWORD:"isNotStopword",IS_ALPHABET:"isAlphabet",IS_NOT_ALPHABET:"isNotAlphabet",RELATIVE_DATES:"relativeDates",IS_TRUE:"isTRUE",IS_FALSE:"isFALSE"};res.BUCKET_LOGICAL_OPTIONS_FOR_NUMERIC=[{label:"Equal To",value:res.LOGICALIZE_OPERATOR.EQUAL_TO},{label:"Not Equal To",value:res.LOGICALIZE_OPERATOR.NOT_EQUAL_TO},{label:"Is In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_IN},{label:"Is Not In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_NOT_IN},{label:"Less Than",value:res.LOGICALIZE_OPERATOR.LESS_THAN},{label:"Less Than or Equal To",value:res.LOGICALIZE_OPERATOR.LESS_THAN_OR_EQUAL_TO},{label:"Greater Than",value:res.LOGICALIZE_OPERATOR.GREATER_THAN},{label:"Greater Than or Equal To",value:res.LOGICALIZE_OPERATOR.GREATER_THAN_OR_EQUAL_TO},{label:"Between",value:res.LOGICALIZE_OPERATOR.BETWEEN},{label:"Not Between",value:res.LOGICALIZE_OPERATOR.NOT_BETWEEN},{label:"Not NA",value:res.LOGICALIZE_OPERATOR.IS_NOT_NA},{label:"Is NA",value:res.LOGICALIZE_OPERATOR.IS_NA},{label:"Not Outliers",value:res.LOGICALIZE_OPERATOR.IS_NOT_OUTLIER},{label:"Is Outliers",value:res.LOGICALIZE_OPERATOR.IS_OUTLIER}];res.BUCKET_LOGICAL_OPTIONS_FOR_NUMERIC_HASH=_createHash(res.BUCKET_LOGICAL_OPTIONS_FOR_NUMERIC);res.BUCKET_LOGICAL_OPTIONS_FOR_CHARACTER=[{label:"Equal To",value:res.LOGICALIZE_OPERATOR.EQUAL_TO},{label:"Not Equal To",value:res.LOGICALIZE_OPERATOR.NOT_EQUAL_TO},{label:"Is In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_IN},{label:"Is Not In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_NOT_IN},{label:"Starts With",value:res.LOGICALIZE_OPERATOR.START_WITH},{label:"Not Start With",value:res.LOGICALIZE_OPERATOR.NOT_START_WITH},{label:"Ends With",value:res.LOGICALIZE_OPERATOR.END_WITH},{label:"Not End With",value:res.LOGICALIZE_OPERATOR.NOT_END_WITH},{label:"Contains",value:res.LOGICALIZE_OPERATOR.CONTAIN},{label:"Not Contain",value:res.LOGICALIZE_OPERATOR.NOT_CONTAIN},{label:"Is NA",value:res.LOGICALIZE_OPERATOR.IS_NA},{label:"Not NA",value:res.LOGICALIZE_OPERATOR.IS_NOT_NA},{label:"Keep Only Empty",value:res.LOGICALIZE_OPERATOR.IS_EMPTY},{label:"Remove Empty",value:res.LOGICALIZE_OPERATOR.IS_NOT_EMPTY},{label:"Keep Only Stopword",value:res.LOGICALIZE_OPERATOR.IS_STOPWORD},{label:"Remove Stopword",value:res.LOGICALIZE_OPERATOR.IS_NOT_STOPWORD},{label:"Keep Only Alphabet",value:res.LOGICALIZE_OPERATOR.IS_ALPHABET},{label:"Remove Alphabet",value:res.LOGICALIZE_OPERATOR.IS_NOT_ALPHABET}];res.BUCKET_LOGICAL_OPTIONS_FOR_CHARACTER_HASH=_createHash(res.BUCKET_LOGICAL_OPTIONS_FOR_CHARACTER);res.BUCKET_LOGICAL_OPTIONS_FOR_DATE=[{label:"<Relative Dates>",value:res.LOGICALIZE_OPERATOR.RELATIVE_DATES},{label:"Equal To",value:res.LOGICALIZE_OPERATOR.EQUAL_TO},{label:"Not Equal To",value:res.LOGICALIZE_OPERATOR.NOT_EQUAL_TO},{label:"Is In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_IN},{label:"Is Not In (Multiple Values)",value:res.LOGICALIZE_OPERATOR.IS_NOT_IN},{label:"Earlier Than",value:res.LOGICALIZE_OPERATOR.LESS_THAN},{label:"Earlier Than or Equal To",value:res.LOGICALIZE_OPERATOR.LESS_THAN_OR_EQUAL_TO},{label:"Later Than",value:res.LOGICALIZE_OPERATOR.GREATER_THAN},{label:"Later Than or Equal To",value:res.LOGICALIZE_OPERATOR.GREATER_THAN_OR_EQUAL_TO},{label:"Between",value:res.LOGICALIZE_OPERATOR.BETWEEN},{label:"Not Between",value:res.LOGICALIZE_OPERATOR.NOT_BETWEEN},{label:"Is NA",value:res.LOGICALIZE_OPERATOR.IS_NA},{label:"Not NA",value:res.LOGICALIZE_OPERATOR.IS_NOT_NA}];res.BUCKET_LOGICAL_OPTIONS_FOR_DATE_HASH=_createHash(res.BUCKET_LOGICAL_OPTIONS_FOR_DATE);res.BUCKET_LOGICAL_OPTIONS_FOR_LOGICAL=[{label:"Is TRUE",value:res.LOGICALIZE_OPERATOR.IS_TRUE},{label:"Is FALSE",value:res.LOGICALIZE_OPERATOR.IS_FALSE},{label:"Not NA",value:res.LOGICALIZE_OPERATOR.IS_NOT_NA},{label:"Is NA",value:res.LOGICALIZE_OPERATOR.IS_NA}];res.BUCKET_LOGICAL_OPTIONS_FOR_LOGICAL_HASH=_createHash(res.BUCKET_LOGICAL_OPTIONS_FOR_LOGICAL);res.STOPWORD_LANG_LIST=[{label:"English",value:"english"},{label:"Arabic",value:"arabic"},{label:"Catalan",value:"catalan"},{label:"Czech",value:"czech"},{label:"Chinese",value:"chinese"},{label:"Danish",value:"danish"},{label:"Dutch",value:"dutch"},{label:"Estonian",value:"estonian"},{label:"Finnish",value:"finnish"},{label:"French",value:"french"},{label:"German",value:"german"},{label:"Greek",value:"greek"},{label:"Hebrew",value:"hebrew"},{label:"Hindi",value:"hindi"},{label:"Hungarian",value:"hungarian"},{label:"Indonesian",value:"indonesian"},{label:"Italian",value:"italian"},{label:"Japanese",value:"japanese"},{label:"Korean",value:"korean"},{label:"Latvian",value:"latvian"},{label:"Norwegian",value:"norwegian"},{label:"Polish",value:"polish"},{label:"Portuguese",value:"portuguese"},{label:"Romanian",value:"romanian"},{label:"Russian",value:"russian"},{label:"Slovak",value:"slovak"},{label:"Slovenian",value:"slovenian"},{label:"Spanish",value:"spanish"},{label:"Swedish",value:"swedish"},{label:"Tamil",value:"tamil"},{label:"Turkish",value:"turkish"},{label:"Ukrainian",value:"ukrainian"},{label:"Vietnamese",value:"vietnamese"}];res.STOPWORD_LANG_LIST_HT=_createHash(res.STOPWORD_LANG_LIST);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_YEAR=[{label:"Previous Year",value:"previous"},{label:"This Year",value:"this"},{label:"Next Year",value:"next"},{label:"Last N Years",value:"last_n"},{label:"Last N Years (Exclude This Year)",value:"last_n_exclude_this_year"},{label:"Last N Years (Exclude This Quarter)",value:"last_n_exclude_this_quarter"},{label:"Last N Years (Exclude This Month)",value:"last_n_exclude_this_month"},{label:"Last N Years (Exclude This Week)",value:"last_n_exclude_this_week"},{label:"Last N Years (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Years",value:"next_n"},{label:"Year To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_YEAR_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_YEAR);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_QUARTER=[{label:"Previous Quarter",value:"previous"},{label:"This Quarter",value:"this"},{label:"Next Quarter",value:"next"},{label:"Last N Quarters",value:"last_n"},{label:"Last N Quarters (Exclude This Quarter)",value:"last_n_exclude_this_quarter"},{label:"Last N Quarters (Exclude This Month)",value:"last_n_exclude_this_month"},{label:"Last N Quarters (Exclude This Week)",value:"last_n_exclude_this_week"},{label:"Last N Quarters (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Quarters",value:"next_n"},{label:"Quarter To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_QUARTER_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_QUARTER);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MONTH=[{label:"Previous Month",value:"previous"},{label:"This Month",value:"this"},{label:"Next Month",value:"next"},{label:"Last N Months",value:"last_n"},{label:"Last N Months (Exclude This Month)",value:"last_n_exclude_this_month"},{label:"Last N Months (Exclude This Week)",value:"last_n_exclude_this_week"},{label:"Last N Months (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Months",value:"next_n"},{label:"Month To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MONTH_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MONTH);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_WEEK=[{label:"Previous Week",value:"previous"},{label:"This Week",value:"this"},{label:"Next Week",value:"next"},{label:"Last N Weeks",value:"last_n"},{label:"Last N Weeks (Exclude This Week)",value:"last_n_exclude_this_week"},{label:"Last N Weeks (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Weeks",value:"next_n"},{label:"Week To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_WEEK_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_WEEK);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_DAY=[{label:"Yesterday",value:"previous"},{label:"Today",value:"this"},{label:"Tomorrow",value:"next"},{label:"Last N Days",value:"last_n"},{label:"Last N Days (Exclude Today)",value:"last_n_exclude_today"},{label:"Next N Days",value:"next_n"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_DAY_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_DAY);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_HOUR=[{label:"Previous Hour",value:"previous"},{label:"This Hour",value:"this"},{label:"Next Hour",value:"next"},{label:"Last N Hours",value:"last_n"},{label:"Next N Hours",value:"next_n"},{label:"Hour To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_HOUR_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_HOUR);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MINUTE=[{label:"Previous Minute",value:"previous"},{label:"This Minute",value:"this"},{label:"Next Minute",value:"next"},{label:"Last N Minutes",value:"last_n"},{label:"Next N Minutes",value:"next_n"},{label:"Minute To Date",value:"x_to_date"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MINUTE_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_RELATIVE_MINUTE);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_DATE=[{label:"Date (e.g. 2020-10-15)",value:"specificDate"},{label:"Year (e.g. 2020)",value:"specificYear"},{label:"Half Year (1-2)",value:"specificHalfYear"},{label:"Quarter (1-4)",value:"specificQuarter"},{label:"Bi-Month (1-6)",value:"specificBiMonth"},{label:"Month - Number (1-12)",value:"specificMonth"},{label:"Month Name - Short (Jan-Dec)",value:"specificMonthName"},{label:"Week of Year (1-52) - 1st Day Start",value:"specificWeek"},{label:"Week of Year (1-52) - Sunday Start",value:"specificWeekSundayStart"},{label:"Week of Year (1-52) - Monday Start",value:"specificWeekMondayStart"},{label:"Day of Year (1-365)",value:"specificYearDay"},{label:"Day of Quarter (1-92)",value:"specificQuarterDay"},{label:"Day of Month (1-31)",value:"specificDay"},{label:"Day of Week - Number (1-7)",value:"specificDayNumber"},{label:"Day of Week - Short Name (Mon-Sun)",value:"specificDayName"},{label:"Year / Month",value:"specificYearMonth"},{label:"This Year",value:"currentYear"},{label:"This Quarter",value:"currentQuarter"},{label:"This Month",value:"currentMonth"},{label:"This Week",value:"currentWeek"},{label:"Today",value:"today"},{label:"Days Ago",value:"nDaysAgo"},{label:"Weeks Ago",value:"nWeeksAgo"},{label:"Months Ago",value:"nMonthsAgo"},{label:"Years Ago",value:"nYearsAgo"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_DATE_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_DATE);res.LOGICALIZE_VALUE_TYPE_LIST_FOR_POSIXCT=[{label:"Date (e.g. 2020-10-15)",value:"specificDate"},{label:"Year (e.g. 2020)",value:"specificYear"},{label:"Half Year (1-2)",value:"specificHalfYear"},{label:"Quarter (1-4)",value:"specificQuarter"},{label:"Bi-Month (1-6)",value:"specificBiMonth"},{label:"Month - Number (1-12)",value:"specificMonth"},{label:"Month Name - Short (Jan-Dec)",value:"specificMonthName"},{label:"Week of Year (1-52) - 1st Day Start",value:"specificWeek"},{label:"Week of Year (1-52) - Sunday Start",value:"specificWeekSundayStart"},{label:"Week of Year (1-52) - Monday Start",value:"specificWeekMondayStart"},{label:"Day of Year (1-365)",value:"specificYearDay"},{label:"Day of Quarter (1-92)",value:"specificQuarterDay"},{label:"Day of Month (1-31)",value:"specificDay"},{label:"Day of Week - Number (1-7)",value:"specificDayNumber"},{label:"Day of Week - Short Name (Mon-Sun)",value:"specificDayName"},{label:"Hour",value:"specificHour"},{label:"Minute",value:"specificMinute"},{label:"Second",value:"specificSecond"},{label:"Year / Month",value:"specificYearMonth"},{label:"This Year",value:"currentYear"},{label:"This Quarter",value:"currentQuarter"},{label:"This Month",value:"currentMonth"},{label:"This Week",value:"currentWeek"},{label:"Today",value:"today"},{label:"Current Hour",value:"currentHour"},{label:"Current Minute",value:"currentMinute"},{label:"Previous Period",value:"previousPeriod"},{label:"Days Ago",value:"nDaysAgo"},{label:"Weeks Ago",value:"nWeeksAgo"},{label:"Months Ago",value:"nMonthsAgo"},{label:"Years Ago",value:"nYearsAgo"}];res.LOGICALIZE_VALUE_TYPE_LIST_FOR_POSIXCT_HT=_createHash(res.LOGICALIZE_VALUE_TYPE_LIST_FOR_POSIXCT);res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_DATE=[{label:"Year (e.g. 2020)",value:"years"},{label:"Quarter (1-4)",value:"quarters"},{label:"Bi-Month (1-6)",value:"bi_months"},{label:"Month - Number (1-12)",value:"months"},{label:"Month - Short Name (Jan-Dec)",value:"month_names"},{label:"Week of Year (1-52) - 1st Day Start",value:"weeks"},{label:"Week of Year (1-52) - Sunday Start",value:"specificWeekSundayStart"},{label:"Week of Year (1-52) - Monday Start",value:"specificWeekMondayStart"},{label:"Day of Year (1-365)",value:"year_days"},{label:"Day of Quarter (1-92)",value:"quarter_days"},{label:"Day of Month (1-31)",value:"days"},{label:"Day of Week - Number (1-7)",value:"day_numbers"},{label:"Day of Week - Short Name (Mon-Sun)",value:"weekdays"},{label:"Year / Month",value:"month_year"},{label:"Dates",value:"individual_days"}];res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_DATE_HT=_createHash(res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_DATE);res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_POSIXCT=[{label:"Year (e.g. 2020)",value:"years"},{label:"Quarter (1-4)",value:"quarters"},{label:"Bi-Month (1-6)",value:"bi_months"},{label:"Month - Number (1-12)",value:"months"},{label:"Month - Short Name (Jan-Dec)",value:"month_names"},{label:"Week of Year (1-52) - 1st Day Start",value:"weeks"},{label:"Week of Year (1-52) - Sunday Start",value:"specificWeekSundayStart"},{label:"Week of Year (1-52) - Monday Start",value:"specificWeekMondayStart"},{label:"Day of Year (1-365)",value:"year_days"},{label:"Day of Quarter (1-92)",value:"quarter_days"},{label:"Day of Month (1-31)",value:"days"},{label:"Day of Week - Number (1-7)",value:"day_numbers"},{label:"Day of Week - Short Name (Mon-Sun)",value:"weekdays"},{label:"Year / Month",value:"month_year"},{label:"Hour",value:"hours"},{label:"Minute",value:"minutes"},{label:"Second",value:"seconds"},{label:"Dates",value:"individual_days"}];res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_POSIXCT_HT=_createHash(res.LOGICALIZE_DATE_TYPE_LIST_FOR_MULTI_POSIXCT);res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_DATE=[{label:"Year",value:"year"},{label:"Quarter",value:"quarter"},{label:"Month",value:"month"},{label:"Week",value:"week"},{label:"Day",value:"day"}];res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_DATE_HT=_createHash(res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_DATE);res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_POSIXCT=[{label:"Year",value:"year"},{label:"Quarter",value:"quarter"},{label:"Month",value:"month"},{label:"Week",value:"week"},{label:"Day",value:"day"},{label:"Hour",value:"hour"},{label:"Minute",value:"minute"}];res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_POSIXCT_HT=_createHash(res.LOGICALIZE_DATE_TYPE_LIST_FOR_RELATIVE_POSIXCT);res.getBucketType=function(opId,options){var bucketType=options[opId+"BucketType"];var col=options[opId];if(!bucketType){if(!opId){bucketType=Column.OperationType.BUCKET_EQUAL_WIDTH}else{if(!col){bucketType=Column.OperationType.NONE}else{if(VizUtil.returnsNumericValue(col)&&col.func===Column.OperationType.AS_CATEGORY){bucketType=Column.OperationType.BUCKET_EQUAL_WIDTH}else if(VizUtil.returnsNumericValue(col)&&options.colorbucket){bucketType=Column.OperationType.BUCKET_EQUAL_WIDTH}else{bucketType=Column.OperationType.NONE}}}}else{if(opId&&col){if(VizUtil.returnsNumericValue(col)&&col.func===Column.OperationType.AS_CATEGORY||VizUtil.returnsNumericValue(col)&&options.colorbucket){}else{switch(bucketType){case Column.OperationType.BUCKET_EQUAL_WIDTH:case Column.OperationType.BUCKET_EQUAL_FREQ:case Column.OperationType.BUCKET_CUSTOM:case Column.OperationType.BUCKET_OUTLIER:case Column.OperationType.BUCKET_KMEANS:bucketType=Column.OperationType.NONE;break;case Column.OperationType.BUCKET_LOGICALIZE:default:break}}}}if(bucketType===Column.OperationType.BUCKET_OUTLIER){bucketType=options[opId+"BucketOutlierType"]||Column.OperationType.BUCKET_OUTLIER_IQR}return bucketType};res.getOptions=function(vizOptionsJson,option){var i=0,res=[],max=MAX_NUMBER_OF_CONTROLS[option];if(option==="tcol"){max=vizOptionsJson.tableMaxNumCol?parseInt(vizOptionsJson.tableMaxNumCol):MAX_NUMBER_OF_CONTROLS.tcol}if(vizOptionsJson.marker==="scattermatrix"&&option==="y"){max=MAX_NUMBER_OF_CONTROLS["scattermatrix"]}if(max===undefined){throw new Error("not supported case")}else{for(i=0;i<max;i++){if(i===0&&option==="y"){res.push(vizOptionsJson[option])}else{res.push(vizOptionsJson[option+i])}}while(res.length>0&&!res[res.length-1]){res.pop()}return res}};var _createNameHash=function(arr){var obj={};arr.forEach(function(item){obj[item.value]=item});return obj};res.QUANT_COLOR_PALETTES_BASE=[{value:"Blues",label:"Blue",color:["#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],textColor:["","","","#fff","#fff"],sampleColor:["#c6dbef","#afd0e7","#98c5e1","#82badb","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"]},{value:"Greens",label:"Green",color:["#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],textColor:["","","","#fff","#fff"],sampleColor:["#c7e9c0","#b2e0ac","#9ed799","#89ce87","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"]},{value:"Oranges",label:"Orange",color:["#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],textColor:["","","","#fff","#fff"],sampleColor:["#fdd0a2","#fec088","#feb06f","#fe9f56","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"]},{value:"Purples",label:"Purple",color:["#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],textColor:["","","","#fff","#fff"],sampleColor:["#dadaeb","#cacae3","#bbbada","#acaad1","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"]},{value:"Reds",label:"Red",color:["#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],textColor:["","","","#fff","#fff"],sampleColor:["#fcbba1","#fda88b","#fd9575","#fc8060","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"]},{value:"Viridis",label:"Viridis",color:["#FDE725","#5DC863","#21908C","#3B528B","#440154"],textColor:["","","#fff","#fff","#fff"],sampleColor:["#FDE725","#B4DE2C","#6DCD59","#35B779","#1F9E89","#26828E","#31688E","#3E4A89","#482878","#440154"]},{value:"YlGn",label:"Yellow-Green",color:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#005a32","#004529"]},{value:"YlGnBu",label:"Yellow-Green-Blue",color:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#0c2c84","#081d58"]},{value:"YlOrBr",label:"Yellow-Orange-Brown",color:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#8c2d04","#662506"]},{value:"YlOrRd",label:"Yellow-Orange-Red",color:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],textColor:["","","","#fff","#fff"],sampleColor:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#b10026","#800026"]},{value:"RdBu",label:"Red-Blue",color:["rgb(5,10,172)","rgb(106,137,247)","rgb(190,190,190)","rgb(230,145,90)","rgb(178,10,28)"],textColor:["#fff","","","","#fff"]},{value:"RdLb",label:"Red-Light Blue",color:["#4A90E2","#b3cae4","rgba(225,225,225,1)","rgba(222,145,158,1)","rgba(231,66,12,1)"],textColor:["#fff","","","","#fff"]},{value:"RdYlBu",label:"Red-Yellow-Blue Diverging",color:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],textColor:["#fff","","","","#fff"]},{value:"RdYlGn",label:"Red-Yellow Green Diverging",color:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],textColor:["#fff","","","","#fff"]}];res.CATEG_COLOR_PALETTES_BASE=[{value:"default",label:"Palette 1",color:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Paired",label:"Palette 2",color:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Pastel1",label:"Palette 3",color:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Pastel2",label:"Palette 4",color:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Set1",label:"Palette 5",color:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#000","#fff","#fff"]},{value:"Set2",label:"Palette 6",color:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Set3",label:"Palette 7",color:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],textColor:["#000","#000","#000","#000","#000","#000","#000","#000","#000"]},{value:"Accent",label:"Palette 8",color:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],textColor:["","","","","#fff","#fff","#fff","#fff"]},{value:"Dark2",label:"Palette 9",color:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Milano",label:"Palette 10",color:["#F1632C","#FAA234","#AB9A84","#6B6258","#B2B148","#507B52","#91C699","#718BA3","#CEC58B","#3E556E"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat10",label:"Palette 11",color:["#3C6398","#EF7B13","#DA3E44","#63AAA3","#47953A","#E9C12C","#A06291","#FC8795","#8A624B","#ACA09C"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat25",label:"Palette 12",color:["#3C6398","#8EBFE4","#EF7B13","#FEB165","#47953A","#7ACC66","#A88A17","#EEC748","#398882","#73B0A7","#7ACC66","#A88A17","#EEC748","#398882","#73B0A7","#DA3E44","#FD8886","#665D5B","#ACA09C","#C95983","#F9AEC8","#A06291","#CA91BD","#8C634C","#CEA694"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Cat12",label:"Palette 13",color:["#3E923C","#75CC69","#EB7807","#FCBC53","#2D98AF","#86D1DF","#82970D","#B7C921","#8F7303","#F5CF0A","#1C786B","#7AB497"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"B1",label:"Palette 14 (Color Blind)",color:["#0B5A9C","#FB6708","#929BAB","#454D58","#4C8FC5","#BC3D05","#68707D","#92C0E5","#FDAF61","#BCC5D1"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Logi1",label:"Palette 15 (Logical)",color:["rgba(98,165,21,1)","rgba(231,66,12,1)","#cccccc"],textColor:["#fff","#fff","#fff"]},{value:"Logi2",label:"Palette 16 (Logical)",color:["#1f77b4","#DCDEE0","#DCDFE0"],textColor:["#fff","#000","#000"]},{value:"Outlier1",label:"Palette 17 (Outlier)",color:["rgba(231,66,12,1)","rgba(225,225,225,1)","rgba(231,66,12,1)","rgba(225,225,225,1)"],textColor:["#fff","#000","#fff","#000"]},{value:"Outlier2",label:"Palette 18 (Outlier)",color:["rgba(231,66,12,1)","rgba(225,225,225,1)","rgba(98,165,21,1)","rgba(225,225,225,1)"],textColor:["#fff","#000","#fff","#000"]},{value:"Analytics1",label:"Palette 19 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)","rgba(225,225,225,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics1r",label:"Palette 20 (Analytics)",color:["rgba(231,66,12,1)","#4A90E2","rgba(225,225,225,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics2",label:"Palette 21 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)"],textColor:["#fff","#fff"]},{value:"Analytics3",label:"Palette 22 (Analytics)",color:["rgba(40,110,175,1)","rgba(225,225,225,1)"],textColor:["#fff","#fff"]},{value:"Analytics4",label:"Palette 23 (Analytics)",color:["#4A90E2","rgba(98,165,21,1)","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics4r",label:"Palette 24 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)","rgba(98,165,21,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics5",label:"Palette 25 (Analytics)",color:["#4A90E2","#dcdee0","rgba(98,165,21,1)","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics5r",label:"Palette 26 (Analytics)",color:["#4A90E2","#dcdee0","rgba(231,66,12,1)","rgba(98,165,21,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics6",label:"Palette 27 (Analytics)",color:["#dcdee0","#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics6r",label:"Palette 28 (Analytics)",color:["#dcdee0","#17becf","#bcbd22","#7f7f7f","#e377c2","#8c564b","#9467bd","#d62728","#2ca02c","#ff7f0e","#1f77b4"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics7",label:"Palette 29 (Analytics)",color:["#1f77b4","#ff7f0e","#2ca02c"],textColor:["#fff","#fff"]},{value:"Analytics8",label:"Palette 30 (Analytics)",color:["rgba(225,225,225,1)"],textColor:["#fff"]},{value:"Analytics9",label:"Palette 31 (Analytics)",color:["#1f77b4","rgba(225,225,225,1)"],textColor:["#fff","#fff"]},{value:"Analytics10",label:"Palette 32 (Analytics)",color:["#1f77b4","#51A7F9","#ff7f0e","#2ca02c"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]},{value:"Analytics11",label:"Palette 33 (Analytics)",color:["#84BC54","#F0D351","rgba(225,225,225,1)"],textColor:["#fff"]},{value:"Analytics12",label:"Palette 34 (Analytics)",color:["#4A90E2","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff"]},{value:"Analytics13",label:"Palette 35 (Analytics)",color:["#4A90E2","#dcdee0","rgba(231,66,12,1)"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics14",label:"Palette 36 (Analytics)",color:["#DCDEE0","#1f77b4"],textColor:["#fff","#fff","#fff","#fff"]},{value:"Analytics15",label:"Palette 37 (Analytics)",color:["#1f77b4","#33a02c","#d62728"],textColor:["#fff","#fff","#fff"]},{value:"Analytics16",label:"Palette 38 (Analytics)",color:["#1f77b4","#51A7F9","#33a02c","#d62728"],textColor:["#fff","#fff","#fff"]},{value:"Analytics17",label:"Palette 39 (Analytics)",color:["#dddddd","#b2df8a","#1f77b4","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]}];res.CATEG_COLOR_PALETTES=res.CATEG_COLOR_PALETTES_BASE.concat(res.QUANT_COLOR_PALETTES_BASE);res.CATEG_COLOR_PALETTES_NO_CUSTOM=res.CATEG_COLOR_PALETTES_BASE.concat(res.QUANT_COLOR_PALETTES_BASE);res.QUANT_COLOR_PALETTES=res.QUANT_COLOR_PALETTES_BASE.concat(res.CATEG_COLOR_PALETTES_BASE);res.CATEG_COLOR_PALETTES.push({value:"custom",label:"Custom",color:["#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]});res.QUANT_COLOR_PALETTES.push({value:"custom",label:"Custom",
color:["#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc","#cccccc"],textColor:["#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff","#fff"]});res.QUANT_COLOR_PALETTES_BASE_HASH=_createNameHash(res.QUANT_COLOR_PALETTES_BASE);res.QUANT_COLOR_PALETTES_HASH=_createNameHash(res.QUANT_COLOR_PALETTES);res.CATEG_COLOR_PALETTES_HASH=_createNameHash(res.CATEG_COLOR_PALETTES);res.CATEG_COLOR_PALETTES_NO_ANALYTICS=res.CATEG_COLOR_PALETTES.filter(function(c){return!/^Analytics/.test(c.value)});res.QUANT_COLOR_PALETTES_NO_ANALYTICS=res.QUANT_COLOR_PALETTES.filter(function(c){return!/^Analytics/.test(c.value)});var hexToRgb=function(hex){var result,base;if(/^rgb/.test(hex.trim())){result=/([\d]+)[, ]*([\d]+)[, ]*([\d]+)/.exec(hex.trim());base=10}else{result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex.trim());base=16}return result?{r:parseInt(result[1],base),g:parseInt(result[2],base),b:parseInt(result[3],base)}:null};var hexToRgba=function(hex,opacity){var rgb=hexToRgb(hex);if(rgb===null){rgb={r:204,g:204,b:204}}return"rgba("+rgb.r+","+rgb.g+","+rgb.b+","+opacity+")"};var rgbaToHex=function(orig){var a,isPercent,rgb=orig.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i),alpha=(rgb&&rgb[4]||"").trim(),hex=rgb?(rgb[1]|1<<8).toString(16).slice(1)+(rgb[2]|1<<8).toString(16).slice(1)+(rgb[3]|1<<8).toString(16).slice(1):orig;if(alpha!==""){a=alpha}else{a=parseInt("01",8)}a=(a*255|1<<8).toString(16).slice(1);hex=hex+a;return"#"+hex};var rgbToHex=function(color){color=""+color;if(!color||color.indexOf("rgb")<0){return}if(color.charAt(0)=="#"){return color}var nums=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(color),r=parseInt(nums[2],10).toString(16),g=parseInt(nums[3],10).toString(16),b=parseInt(nums[4],10).toString(16);return"#"+((r.length==1?"0"+r:r)+(g.length==1?"0"+g:g)+(b.length==1?"0"+b:b))};res.hexToRgb=hexToRgb;res.hexToRgba=hexToRgba;res.rgbaToHex=rgbaToHex;res.rgbToHex=rgbToHex;res.isNumericAsDiscreteValueOnColor=function(options){return options.color&&options.color.isNumeric&&options.color.func==="none"};res.getDefaultColorPalette=function(bucketType){switch(bucketType){case Column.OperationType.BUCKET_EQUAL_FREQ:case Column.OperationType.BUCKET_EQUAL_WIDTH:return"Blues";case Column.OperationType.BUCKET_OUTLIER_IQR:case Column.OperationType.BUCKET_OUTLIER_PERCENTILE:case Column.OperationType.BUCKET_OUTLIER_SD:return"Outlier2";case Column.OperationType.BUCKET_KMEANS:case Column.OperationType.NONE:return"default";case Column.OperationType.BUCKET_CUSTOM:return"Blues";case Column.OperationType.BUCKET_LOGICALIZE:return"Logi2"}return null};res.getDefaultOpacity=function(options){switch(options.marker){case"scatter":case"scattermatrix":case"bubble":case"area":return.8;case"hist":return!options.color&&(options.histType==="ratio"||!options.histCumDistType)?.9:.6;case"densityplot":return.2;case"map":return.3;case"geojson":return.65;case"easymap":return options.easymapType==="area"?.65:.3;default:return null}};res.getDefaultColorStackDirection=function(options){if(options.colorbucket&&options.colorBucketType==="bucket_outlier"){return"reversed"}else{return"normal"}};res.getDefaultAxisIncludeZero=function(marker){return/^(scatter|bubble)$/.test(marker)?"off":"on"};res.isCategoricalColorPalette=function(paletteName){return!res.QUANT_COLOR_PALETTES_BASE_HASH[paletteName]};res.getDefaultSingleValueValue=function(col){if(col&&/^(count|countd|sum|distinct|nacount|nnacount|truecount|falsecount)$/.test(col.func)){return"0"}else{return"<NA>"}};res.isNumeric=function(type){return/numeric|integer|double/.test(type)};res.isDate=function(type){return/Date|POSIX/.test(type)};res.getPivotTotalAggregationFunc=function(columnFunc,pivotAggFunc,isNumeric){if(!pivotAggFunc){switch(columnFunc){case Column.OperationType.SUM:case Column.OperationType.AVERAGE:case Column.OperationType.MEDIAN:case Column.OperationType.MIN:case Column.OperationType.MAX:case Column.OperationType.DATE_MIN:case Column.OperationType.DATE_MAX:return columnFunc;case Column.OperationType.ALL:return Column.OperationType.ALL_PIVOT_TOTAL;case Column.OperationType.ANY:return Column.OperationType.ANY_PIVOT_TOTAL;case Column.OperationType.FIRST:case Column.OperationType.LAST:case Column.OperationType.MODE:return isNumeric?Column.OperationType.AVERAGE:columnFunc;case Column.OperationType.COUNT:case Column.OperationType.COUNT_DISTINCT:return Column.OperationType.SUM;default:return Column.OperationType.AVERAGE}}else{return pivotAggFunc}};res.getDefaultHoverMode=function(marker){switch(marker){case"boxplot":return"x";default:return"closest"}};res.getDefaultAxisDirection=function(marker,option){return"normal"};res.isAxisDirectionEnabled=function(marker){return res.isPlotly(marker)&&!/^(pie|hist|densityplot)$/.test(marker)};res.isColorStackDirectionEnabled=function(marker,barStyle,barOrientation){return marker==="area"||marker==="bar"&&barStyle!=="group"&&barOrientation!=="horizontal"};res.isColorHighlightSupported=function(marker){return res.isPlotly(marker)&&!/^(heatmap|contour)$/.test(marker)||/^(geojson|map|easymap)$/.test(marker)};res.isGroupHandlingControlSupported=function(option,vizOptions){switch(vizOptions.marker){case"bar":case"line":case"area":case"boxplot":case"violin":case"errbar":return/^(x|color)$/.test(option);case"densityplot":case"hist":case"pie":return/^(color)$/.test(option);case"map":return/^(color)$/.test(option)}return false};res.isShowHideUnusedLevelsSupported=function(option,vizOptions){if(!res.isGroupHandlingControlSupported(option,vizOptions)){return false}var col=vizOptions[option];if(!col){return false}if(col.func===Column.OperationType.AS_CATEGORY){return false}if(res.returnsCharacterValue(col)&&/(factor|Date|POSIXct)/.test(col.type)){return true}return false};res.isCustomFunctionSupported=function(marker,option){switch(marker){case"pivot":case"singlevalue":case"summarytable":return/^meas/.test(option);case"bar":case"line":case"area":return/^y/.test(option);case"bubble":case"map":return/^(x|y|color$|size$)/.test(option);case"geojson":case"easymap":return/^(color|size)$/.test(option);case"pie":return option==="y";case"heatmap":case"contour":return option==="color";default:return false}};res.isRecodeSupported=function(marker,option){if(marker==="geojson"&&option==="x"){return false}return true};res.isRecodeEnabled=function(marker,option,vizOptions){return res.isRecodeSupported(marker,option)&&vizOptions[option]&&!VizUtil.isContinuousValue(vizOptions[option],marker,option)&&VizUtil.returnsCharacterValue(vizOptions[option])&&!(option==="facet"&&vizOptions[option].type===res.TYPE_GROUP_BY_MEASURES)};res.getBucketInfo=function(data,bucketProp){var hash={};data.forEach(function(d){if(!!d[bucketProp]&&!hash[d[bucketProp]]){hash[d[bucketProp]]=1}});var exts=Object.keys(hash).map(function(key){var ext=key.replace(/[\[\(\]]/g,"").split(",");ext=ext.map(function(m){return parseFloat(m)});return{key:key,extent:ext}});exts=exts.sort(function(a,b){return a.extent[0]-b.extent[0]});exts=exts.map(function(m,idx){m.id=idx+1;return m});var h={};exts.forEach(function(m){h[m.key]=m.id});var isNew=true;Object.keys(hash).forEach(function(key){isNew=isNew&&/\]/.test(key)});return{legend:isNew?exts:null,map:h}};res.formatColorBucketData=function(data,colorBucketCol,formatter){var v;data.forEach(function(d){v=d[colorBucketCol];if(typeof v==="number"){return}else if(v){v=v.trim();if(/^[\[\(].*[\)\]]$/.test(v)){v=v.replace(/[\[\]\(\)]/g,"");v=v.split(",");v=formatter(v[0])+" - "+formatter(v[1]);d[colorBucketCol]=v}}else{d[colorBucketCol]=null}})};var escapeForQuotedStringInR=function(exp){return exp.replace(/\\/g,"\\\\").replace(/"/g,'\\"')};res.addBucketInfo=function(vizOptions,opId,attrs,ops){var bucketType=res.getBucketType(opId,vizOptions);var bucketAttrs=res.constructBucketAttributes(opId,vizOptions,bucketType);if(bucketAttrs){var type=vizOptions[opId+"BucketType"];if(type===Column.OperationType.BUCKET_OUTLIER||type===Column.OperationType.BUCKET_EQUAL_WIDTH||type===Column.OperationType.BUCKET_EQUAL_FREQ){var x=vizOptions["x"],facet=vizOptions["facet"];switch(vizOptions[opId+"BucketGroup"]){case"facet":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=facet?facet.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=facet?facet.validName:null;break;case"xaxis":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=x?x.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=x?x.validName:null;break;case"xaxis+facet":bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN]=x&&facet?facet.validLabel+","+x.validLabel:null;bucketAttrs[Column.Attribute.BUCKET_GROUP_BY_COLUMN_ORIGINAL_NAMES]=x&&facet?facet.validName+","+x.validName:null;break;case"all":default:break}}Object.keys(bucketAttrs).forEach(function(key){attrs[key]=bucketAttrs[key]});ops.push(Column.OperationType.CUT);ops.push(bucketType)}};res.addCategoryHandlingInfo=function(vizOptions,opId,attrs,ops){if(res.isShowHideUnusedLevelsSupported(opId,vizOptions)){var showUnusedLevels=vizOptions[opId+"ShowUnusedFactorLevels"]||"on";attrs.dropUnusedFactorLevels=showUnusedLevels==="off"?"TRUE":"FALSE"}};res.constructBucketAttributes=function(opId,vizOptions,bucketType){var attrs={};switch(bucketType){case Column.OperationType.NONE:return null;case Column.OperationType.BUCKET_EQUAL_FREQ:case Column.OperationType.BUCKET_EQUAL_WIDTH:var useIndexForDefaultLabels=vizOptions[opId+"BucketGroup"]&&vizOptions[opId+"BucketGroup"]!=="all";attrs.numOfBuckets=vizOptions[opId+"BucketNumOfBuckets"]||5;attrs.numDecimalDigits=vizOptions["numDecimalDigits"]||2;attrs.cutZeroToCenter=vizOptions[opId+"SetZeroToCenter"]==="on"?"TRUE":"FALSE";attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketLabels"],attrs.numOfBuckets,useIndexForDefaultLabels);break;case Column.OperationType.BUCKET_OUTLIER_IQR:attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_OUTLIER_PERCENTILE:var pctThreshold=vizOptions[opId+"BucketPctThreshold"];var isPctInvalid=pctThreshold&&(pctThreshold<=0||pctThreshold>=1);attrs.outlierPctThreshold=isPctInvalid?.95:pctThreshold;attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_OUTLIER_SD:var sdThreshold=vizOptions[opId+"BucketSdThreshold"];var isSdInvalid=sdThreshold&&sdThreshold<=0;attrs.outlierSdThreshold=isSdInvalid?2:sdThreshold;attrs.labelsExp=res.constructBucketLabels(vizOptions[opId+"BucketOutlierLabels"],3,false);break;case Column.OperationType.BUCKET_KMEANS:attrs.kmeansNumOfBuckets=vizOptions[opId+"BucketKmeansNumOfBuckets"]||3;break;case Column.OperationType.BUCKET_CUSTOM:var cpValue=vizOptions[opId+"BucketCuttingPoints"];var isCpInvalid=!VizUtil.isCuttingPointValuesValid(cpValue);attrs=res.constructCustomBucketAttributes(isCpInvalid?"":cpValue,vizOptions[opId+"BucketLabels"],vizOptions[opId+"BucketIncludeOutsideRange"]!=="off",vizOptions[opId+"BucketIncludeRightEdge"]!=="off",vizOptions[opId+"BucketIncludeLowest"]!=="off",10);break}var color=vizOptions["color"],marker=vizOptions["marker"];attrs[Column.Attribute.BUCKET_PRIORITY]=opId==="x"||opId==="y"?1:2;if(color&&opId==="color"){var valuePrefix=res.getValuePrefix(vizOptions["colorNumberFormatting"],vizOptions["colorCurrencySymbol"],marker);attrs[Column.Attribute.VALUE_PREFIX]=valuePrefix;var valueSuffix=res.getValueSuffix(vizOptions["colorWindowFunc"],color.func,vizOptions["colorNumberFormatting"],marker);attrs[Column.Attribute.VALUE_SUFFIX]=valueSuffix}return attrs};res.isCuttingPointValuesValid=function(val){if(!val){return true}var arr=val.split(",").map(function(v){return parseFloat(v)});var res=arr.filter(function(v,idx){if(isNaN(v)){return false}if(idx>0&&arr[idx-1]>=v){return false}return true});return res.length===arr.length};res.isReferenceLineConstantValuesValid=function(val){if(!val){return true}var arr=val.split(",").map(function(x){return x.trim()});var res=arr.filter(function(v,idx){if(/[^0-9,\. \-]/.test(v)){return false}if(isNaN(parseFloat(v))){return false}return idx===arr.indexOf(v)});return res.length===arr.length};res.constructCustomBucketAttributes=function(breaksTxt,labelsTxt,includeOutsideRange,includeRightEdge,includeLowest,digLab){var breaksExp,labelsExp,breaks,labels;if(!breaksTxt){breaks=["-Inf","Inf"];breaksExp="c("+breaks.join(",")+")"}else{breaksTxt=breaksTxt.trim().replace(/^,/,"").replace(/,$/,"");breaks=breaksTxt.split(",");if(includeOutsideRange){breaks.push("Inf");breaks.unshift("-Inf")}}breaksExp="c("+breaks.map(function(x){return x.endsWith("Inf")?x:parseFloat(x)}).join(",")+")";labelsExp=res.constructBucketLabels(labelsTxt,breaks.length-1,false);return{breaksExp:breaksExp,expectedNumberOfLabels:breaks.length-1,labelsExp:labelsExp,includeLowest:includeLowest?"TRUE":"FALSE",includeRightEdge:includeRightEdge?"TRUE":"FALSE",digLab:digLab}};res.constructBucketLabels=function(labelsTxt,numOfLabels,useIndexForDefaultLabels){if(!labelsTxt&&!useIndexForDefaultLabels){return"NULL"}var labels=[],i;if(labelsTxt){labels=labelsTxt.trim().replace(/^,/,"").replace(/,$/,"").split(",");labels=labels.map(function(x){return x.trim()}).filter(function(x){return!!x})}if(labels.length<numOfLabels){for(i=labels.length;i<numOfLabels;i++){labels.push(String(i+1))}}else if(labels.length>numOfLabels){labels=labels.slice(0,numOfLabels)}return"c("+labels.map(function(x){return'"'+escapeForQuotedStringInR(x.trim())+'"'}).join(",")+")"};res.getOtherGroupType=function(op,viz){return viz[op+"EnableOtherGroup"]||res.getDefaultOtherGroupType(op,viz)};res.getDefaultOtherGroupType=function(op,viz){if(op==="x"&&/^(bar|line|area|errbar|boxplot|violin)$/.test(viz.marker)){return VizUtil.OTHER_GROUP_OPTION_TYPE.NONE}return VizUtil.OTHER_GROUP_OPTION_TYPE.FCT_LUMP};res.addOtherGroupInfo=function(vizOptions,opId,attrs,ops){attrs.removeOtherGroup=!vizOptions[opId+"ShowOtherGroup"]&&!!vizOptions[opId+"HideOtherGroup"]?vizOptions[opId+"HideOtherGroup"]==="on":vizOptions[opId+"ShowOtherGroup"]==="off";attrs.labelForOtherGroup=vizOptions[opId+"OtherGroupLabel"]||"Others";var type=res.getOtherGroupType(opId,vizOptions);switch(type){case res.OTHER_GROUP_OPTION_TYPE.FCT_LUMP:default:ops.push(Column.OperationType.FCT_LUMP);attrs.numGroupsToPreserve=vizOptions[opId+"NumGroupsToPreserve"];if(!attrs.numGroupsToPreserve){attrs.numGroupsToPreserve=res.getDefaultNumberOfGroups(vizOptions.marker,opId)}break;case res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES:case res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES:ops.push(Column.OperationType.FCT_OTHER);var otherGroupValues=vizOptions[opId+"OtherGroupValues"]||[];attrs.otherGroupValues="c("+otherGroupValues.map(function(col){return'"'+col.value+'"'}).join(",")+")";attrs.otherGroupValuesHandling=type===res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES?"drop":"keep";break}};res.getDefaultRecodeOthersLabel=function(){return"Others"};res.getDefaultRecodeNaLabel=function(){return"(NA)"};res.getNaLabel=function(vizOptions,opId){var naLabel=res.getDefaultRecodeNaLabel();if(res.isRecodeEnabled(vizOptions.marker,opId,vizOptions)&&vizOptions[opId+"Recode"]&&Object.keys(vizOptions[opId+"Recode"]).indexOf(naLabel)>-1&&!!vizOptions[opId+"Recode"][naLabel]){naLabel=vizOptions[opId+"Recode"][naLabel]}return naLabel};res.escapeForQuotedStringInR=function(exp){return exp.replace(/\\/g,"\\\\").replace(/"/g,'\\"')};res.addRecodeInfo=function(vizOptions,opId,attrs,ops){if(res.isRecodeEnabled(vizOptions.marker,opId,vizOptions)&&vizOptions[opId+"Recode"]&&Object.keys(vizOptions[opId+"Recode"]).length>0){ops.push(Column.OperationType.RECODE);var values=vizOptions[opId+"Recode"];attrs.recodeValues=Object.keys(values).map(function(key){return"`"+key+'` = "'+res.escapeForQuotedStringInR(values[key])+'"'}).join(", ");var enableCreateOthers=vizOptions[opId+"RecodeEnableCreateOthers"]==="on";attrs.recodeOthersLabel=enableCreateOthers?"'"+(vizOptions[opId+"RecodeOthersLabel"]||res.getDefaultRecodeOthersLabel())+"'":"NULL";var enableReplaceNa=vizOptions[opId+"RecodeEnableReplaceNa"]==="on";attrs.recodeNaLabel=enableReplaceNa?"'"+(vizOptions[opId+"RecodeNaLabel"]||res.getDefaultRecodeNaLabel())+"'":"NULL"}};res.distinct=function(arr){var u={},a=[];for(var i=0,l=arr.length;i<l;++i){if(Object.prototype.hasOwnProperty.call(u,arr[i])){continue}a.push(arr[i]);u[arr[i]]=1}return a};res.isLeaflet=function(marker){return/^(geojson|map|maphmap|easymap)$/.test(marker)};res.isPivot=function(marker){return/^(pivot|table|singlevalue|summarytable)$/.test(marker)};res.isROutput=function(marker){return/^r-/.test(marker)};res.isPlotly=function(marker){return!(res.isLeaflet(marker)||res.isPivot(marker)||res.isROutput(marker))};res.isWindowFunctionSupported=function(marker,op){if(op==="x"){return marker==="hist"}else{return/^(bar|line|area|pivot)$/.test(marker)}};res.isMultiYSupported=function(marker){return/^(bar|line|scatter|scattermatrix)$/.test(marker)};res.isSyncAxisSupported=function(marker){return!/^(pie|ring|heatmap)$/.test(marker)};res.isHoverModeSupported=function(marker){return/^(bar|line|area|hist|densityplot|scatter|bubble|errbar)$/.test(marker)};res.isNumberOfRowsInPopupSupported=function(marker){return/^(bar|line|area|bubble|pie|map|geojson|easymap|heatmap|contour)$/.test(marker)};res.isColorBucketSupported=function(marker){return/^(bar|line|area|hist|densityplot|violin|boxplot|scatter|bubble|errbar|map|geojson|easymap)$/.test(marker)};res.isOtherGroupSupported=function(opId,vizOptions){var marker=vizOptions.marker;var isColorContinuous=vizOptions.color&&res.isContinuousValue(vizOptions.color,marker,"color");switch(opId){case"categColor":return!isColorContinuous&&/^(bar|line|area|pie|hist|densityplot|scatter|bubble|boxplot|violin|errbar|map|geojson|easymap)$/.test(marker);case"facet":return/^(bar|line|area|pie|hist|densityplot|scatter|bubble|boxplot|violin|errbar|heatmap)$/.test(marker)&&!(vizOptions.facet&&vizOptions.facet.type===res.TYPE_GROUP_BY_MEASURES);case"x":switch(marker){case"scatter":case"bar":case"line":case"area":case"errbar":case"boxplot":case"violin":case"bubble":return res.returnsCharacterValue(vizOptions[opId]);case"heatmap":return true;default:return false}case"groupby":switch(marker){case"bubble":return true;case"map":return vizOptions.groupby.type!==res.TYPE_ROWID;default:return false}default:if(/^y/.test(opId)){switch(marker){case"scatter":case"bubble":return res.returnsCharacterValue(vizOptions[opId]);case"heatmap":return true;default:return false}}else if(/^colh/.test(opId)){return true}else if(/^rowh/.test(opId)){return true}else{return false}}};res.isOtherGroupEnabled=function(opId,vizOptions){if(res.getOtherGroupType(opId,vizOptions)===res.OTHER_GROUP_OPTION_TYPE.NONE){return false}return res.isOtherGroupSupported(opId,vizOptions)};res.isManualSelectOtherGroupEnabled=function(opId,vizOptions){return res.isOtherGroupEnabled(opId,vizOptions)&&(vizOptions[opId+"EnableOtherGroup"]===VizUtil.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_KEEP_VALUES||vizOptions[opId+"EnableOtherGroup"]===VizUtil.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES)};res.isLogicalizeSupported=function(marker,opId){return opId==="color"&&/^(bar|line|area)$/.test(marker)};res.isLogicalizeEnabled=function(vizOptions,opId){if(!res.isLogicalizeSupported(vizOptions.marker,opId)){return false}if(vizOptions[opId+"BucketType"]!=="bucket_logicalize"){return false}var cmd=vizOptions[opId+"BucketLogicalizeCommand"];return cmd&&cmd.conditions&&cmd.conditions.length>0};res.getBucketOptions=function(marker,opId){if(res.isLogicalizeSupported(marker,opId)){return VizUtil.BUCKET_TYPE_OPTIONS}else if(opId==="color"&&/^(geojson|bubble|easymap|map)$/.test(marker)){return VizUtil.BUCKET_TYPE_OPTIONS_NO_LOGICALIZE_WITH_NONE}else{return VizUtil.BUCKET_TYPE_OPTIONS_NO_LOGICALIZE}};res.applyColorBucketAfterSummarize=function(marker){return/^(scatter|bubble|map|geojson|easymap)$/.test(marker)};res.isIncludeOutlierEnabled=function(marker,includeOutlierPropValue){if(!includeOutlierPropValue){return!/^(violin|boxplot)$/.test(marker)}return includeOutlierPropValue==="on"};res.POST_FILTER_COLUMN_NAME=".postfilter";res.getDefaultPostFilterTargetColumn=function(vizOptions,option){switch(vizOptions.marker){case"geojson":return"colorbucket";case"violin":case"boxplot":case"errbar":case"bar":case"line":case"area":return"y";case"bubble":if(option==="y"){return"x"}else{return"y"}default:return null}};res.getPostFilterDefaultTargetColumn=function(vizOptions,option){var defaultTarget=res.getDefaultPostFilterTargetColumn(vizOptions,option);return defaultTarget&&vizOptions[defaultTarget]&&res.returnsNumericValue(vizOptions[defaultTarget])?vizOptions[defaultTarget]:null};res.isPostFilterSupported=function(vizOptions,option){option=option==="categColor"?"color":option;if(option==="facet"&&vizOptions[option]&&vizOptions[option].type===res.TYPE_GROUP_BY_MEASURES){return false}switch(vizOptions.marker){case"geojson":return option==="x";case"bar":case"errbar":case"violin":case"boxplot":return/^(x|color|facet)$/.test(option);case"line":case"area":case"hist":case"densityplot":return/^(color|facet)$/.test(option);case"bubble":return/^(x|y|color|facet|groupby)$/.test(option);default:return false}};res.isPostFilterEnabled=function(vizOptions,option){option=option==="categColor"?"color":option;if(!vizOptions[option]){return false}switch(vizOptions.marker){case"geojson":return option==="x"&&!res.returnsNumericValue(vizOptions[option]);case"bar":case"errbar":case"violin":case"boxplot":return/^(x|color|facet)$/.test(option)&&!res.returnsNumericValue(vizOptions[option]);case"line":case"area":case"hist":case"densityplot":return/^(color|facet)$/.test(option)&&!res.returnsNumericValue(vizOptions[option]);case"bubble":return/^(x|y|color|facet|groupby)$/.test(option)&&!res.returnsNumericValue(vizOptions[option]);default:return false}};res.POST_FILTER_PRIORITY_HASH={x:2,y:2,groupby:3,color:4,facet:1};res.POST_FILTER_TARGET_OPTIONS=Object.keys(res.POST_FILTER_PRIORITY_HASH).sort(function(a,b){return res.POST_FILTER_PRIORITY_HASH[b]-res.POST_FILTER_PRIORITY_HASH[a]});res.getPostFilterPriority=function(opId){return res.POST_FILTER_PRIORITY_HASH[opId]||999};res.isDualYSupported=function(marker,barstyle){return/^(bar|scatter|line|bubble)$/.test(marker)};res.getValueSuffix=function(winfunc,colfunc,numberFormatting,marker,errbarCalcType,errbarDirection){if(numberFormatting==="percentage"&&/^(bar|line|area|scatter|bubble|pivot|singlevalue|table|summarytable|errbar)$/.test(marker)){return"%"}if(colfunc&&/^(truepct|falsepct|napct|nnapct)$/.test(colfunc)){return"%"}if(marker==="errbar"&&errbarCalcType==="ratio"&&errbarDirection==="color"&&colfunc&&/^(truecount|falsecount|nacount|nnacount|countd|count)$/.test(colfunc)){return"%"}if(!winfunc){return""}else{return/(^ptotal$|^pdf|^pof|^pcumsum$|^prank$)/.test(winfunc)?"%":""}};res.getValuePrefix=function(numberFormatting,prefix,marker){if(numberFormatting==="currency"&&/^(bar|line|area|scatter|bubble|pivot|singlevalue|table|summarytable|errbar)$/.test(marker)){return prefix||"$"}return""};res.isColumnObject=function(col){return col&&col.name&&col.func},res.returnsNumericValue=function(col){if(!res.isColumnObject(col)){throw new Error("Invalid argument was passed to returnsNumericValue: "+JSON.stringify(col||"col is empty."))}return col.isNumeric&&col.func!=="aschar"||/^(sum|count|countd|ave|median|min|max|var|sd|iqr|mad|nacount|nnacount|napct|nnapct|truecount|falsecount|truepct|falsepct|odds|asint|asintby10|ascategory|asnum)/.test(col.func)||col.isDate&&/^(year|halfyear|quarter|bimon|mon|day|hour|minute|second|week|week_of_quarter|week_of_month|dayofyear|dayofquarter|dayofweek|hour_num|minute_num|second_num)$/.test(col.func)};var HANDLE_OUTPUT_AS_CATEGORICAL=[Column.OperationType.AS_INTEGER,Column.OperationType.AS_INTEGER_BY10,Column.OperationType.ABS,Column.OperationType.LOG,Column.OperationType.LOG2,Column.OperationType.LOG10,Column.OperationType.YEAR,Column.OperationType.HALF_YEAR,Column.OperationType.QUARTER,Column.OperationType.BI_MONTH,Column.OperationType.MONTH,Column.OperationType.WEEK,Column.OperationType.DAY,Column.OperationType.DAY_OF_YEAR,Column.OperationType.DAY_OF_QUARTER,Column.OperationType.DAY_OF_WEEK,Column.OperationType.HOUR,Column.OperationType.MINUTE,Column.OperationType.SECOND,Column.OperationType.AS_CHAR,Column.OperationType.AS_LOGICAL_FACTOR,Column.OperationType.AS_DISCRETE_VALUES];var HANDLE_OUTPUT_AS_CATEGORICAL_AT_COLOR=[Column.OperationType.NONE,Column.OperationType.YEAR,Column.OperationType.HALF_YEAR,Column.OperationType.QUARTER,Column.OperationType.BI_MONTH,Column.OperationType.MONTH,Column.OperationType.WEEK,Column.OperationType.DAY,Column.OperationType.DAY_OF_YEAR,Column.OperationType.DAY_OF_QUARTER,Column.OperationType.DAY_OF_WEEK,Column.OperationType.HOUR,Column.OperationType.MINUTE,Column.OperationType.SECOND,Column.OperationType.AS_CHAR,Column.OperationType.AS_LOGICAL_FACTOR,Column.OperationType.AS_DISCRETE_VALUES];res.isContinuousValue=function(col,marker,option){if(option==="color"){if(marker==="bubble"){return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL.indexOf(col.func)===-1&&col.func!==Column.OperationType.AS_NUM}else if(marker==="maphmap"){return res.returnsNumericValue(col)}else{return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL_AT_COLOR.indexOf(col.func)===-1}}else{return res.returnsNumericValue(col)&&HANDLE_OUTPUT_AS_CATEGORICAL.indexOf(col.func)===-1}};res.returnsDateValue=function(col){if(!res.isColumnObject(col)){throw new Error("Invalid argument was passed to returnsDateValue.")}return col.isDate&&(!col.func||/^(rto|none$)/.test(col.func))};res.returnsCharacterValue=function(col){if(!res.isColumnObject(col)){throw new Error("Invalid argument was passed to returnsCharacterValue.")}return!res.returnsNumericValue(col)&&!res.returnsDateValue(col)};res.isEmpty=function(val,handleEmptyStringAsEmpty){if(handleEmptyStringAsEmpty){return typeof val==="undefined"||val===null||val===""}else{return typeof val==="undefined"||val===null}};res.isUndefined=function(val){return typeof val==="undefined"};res.shouldRenderNoData=function(data,options){if(options._lastQueryErrorMessage){return true}switch(options.marker){case"geojson":return!options.geojson;case"easymap":return!options.easymapMap;case"singlevalue":return false;case"pivot":return!data||data.length<3;default:if(/^r-/.test(options.marker)){return!data||!data.outputFile}else{return!data||data.length===0}}};var BalloonItemList=function(){this.top=[];this.main=[];this.bottom=[];this.indexed=[]};BalloonItemList.prototype.toArray=function(){if(this.indexed.length>0){return this.indexed.sort(function(a,b){return a.index-b.index}).map(function(x){return x.item})}else{return this.top.concat(this.main).concat(this.bottom)}};BalloonItemList.prototype.add=function(item,marker,option,isNumeric,section,index,addBrackets,invisible){if(invisible){return}if(typeof item==="string"&&addBrackets){item="("+item+")"}if(typeof index==="number"){this.indexed.push({index:index,item:item});return}if(typeof item==="string"){var _idx=this.top.indexOf(item);if(_idx>-1){return}_idx=this.bottom.indexOf(item);if(_idx>-1){return}_idx=this.main.indexOf(item);if(_idx>-1){this.main.splice(_idx,1)}}if(section==="bottom"){this.bottom.unshift(item);return}if(/^label/.test(option)||section==="top"){this.top.push(item);return}switch(marker){case"bar":case"errbar":case"line":case"area":case"boxplot":case"violin":if(/^(x)$/.test(option)){this.top.push(item)}else{this.main.push(item)}break;case"heatmap":case"contour":if(/^(x|y)$/.test(option)){this.top.push(item)}else{this.main.push(item)}break;case"hist":case"densityplot":this.main.push(item);break;default:if(/^(x$|y|z|groupby)/.test(option)&&!isNumeric){this.top.push(item)}else{this.main.push(item)}break}};res.BalloonItemList=BalloonItemList;res.generateHighlightColorScale=function(defaultColor,highlightValues){var hash={};var ohash={};var ovhash={};highlightValues.forEach(function(v,idx,arr){hash[v.value]=v.color;ohash[v.color]=arr.length-idx;ovhash[v.value]=arr.length-idx});var scaleFunc=function(val){return!hash[val]?defaultColor:hash[val]};scaleFunc.domain=function(){};scaleFunc.getOrderByColor=function(val){return!ohash[val]?0:ohash[val]};scaleFunc.getOrderByValue=function(val){return!ovhash[val]?0:ovhash[val]};scaleFunc.isHighlightColorScale=true;return scaleFunc};res.renderNoData=function(div,msg,borderCss,hintText){if(!div){return}var h="100%";if(div.clientHeight&&div.clientHeight>0){h=div.clientHeight+"px"}div.innerHTML='<div style="width:100%; height:'+h+'; display:table;" class="viz-rendering-error">'+'<div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; padding:0 40px; '+(borderCss?"border:"+borderCss:"")+'">'+"<div>"+(msg?msg:"There is no data to display.")+"</div>"+(hintText?'<div style="width:360px; margin:auto; margin-top:15px">'+hintText+"</div>":"")+"</div>"+"</div>"};res.COLOR_PALETTE_REGEX=/((rgb[a]*\([0-9 \,\.]*\))|\#[0-9a-fA-F]+)/g;res.isInColumnarFormat=function(data){return Object.prototype.toString.call(data)!=="[object Array]"};res.convertColumnarData=function(data){if(!data||!res.isInColumnarFormat(data)){return data}var cols=Object.keys(data),rows=[],idx=0,row=null;if(cols.length===0){return rows}while(idx<data[cols[0]].length){row={};cols.forEach(function(col){row[col]=data[col][idx]});rows.push(row);idx++}return rows};res.translateColumnData=function(data,viz,lang,enableRegexTranslation){if(!data||!viz||viz.translate!=="on"){return data}var cols=viz.translateTargetColumns;if(viz.translateTargetColumnsString){cols=viz.translateTargetColumnsString.split(",")}if(!cols){return data}var idxs;if(viz.marker==="table"&&data.length>1){idxs=[];var tcols=res.getOptions(viz,"tcol");tcols.forEach(function(col,idx){if(col&&cols.indexOf(col.name)>-1){idxs.push(idx)}});if(idxs.length===0){return data}data[0].forEach(function(row){idxs.forEach(function(idx){row[idx]=VizUtil.getMessage(lang,row[idx],enableRegexTranslation)})})}else if(/^(pivot|summarytable)$/.test(viz.marker)&&data.length>1){idxs=[];var rowhs=res.getOptions(viz,"rowh").filter(function(col){return!!col}).forEach(function(col,idx){if(cols.indexOf(col.name)>-1){idxs.push(idx)}});if(idxs.length===0){return data}data[0].forEach(function(row){idxs.forEach(function(idx){row[idx]=VizUtil.getMessage(lang,row[idx],enableRegexTranslation)})})}else if(res.isPlotly(viz.marker)){var labels=[];Object.keys(viz).forEach(function(key){if(viz[key]&&viz[key].name&&viz[key].func&&cols.indexOf(viz[key].name)>-1){labels.push(viz[key].label)}});if(labels.length===0){return data}data.forEach(function(row){labels.forEach(function(label){if(row&&label&&row[label]){row[label]=VizUtil.getMessage(lang,row[label],enableRegexTranslation)}})})}return data};var decimalAdjust=function(type,value,exp){if(typeof exp==="undefined"||+exp===0){return Math[type](value)}value=+value;exp=+exp;if(value===null||isNaN(value)||!(typeof exp==="number"&&exp%1===0)){return NaN}if(value<0){return-decimalAdjust(type,-value,exp)}value=value.toString().split("e");value=Math[type](+(value[0]+"e"+(value[1]?+value[1]-exp:-exp)));value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]+exp:exp))};res.round10=function(value,exp){return decimalAdjust("round",value,-exp)};res.floor10=function(value,exp){return decimalAdjust("floor",value,-exp)};res.ceil10=function(value,exp){return decimalAdjust("ceil",value,-exp)};res.isInSameCategory=function(dataType,targetDataType){dataType=/^(integer|double)/.test(dataType)?"numeric":/^(POSIX)/.test(dataType)?"Date":dataType;targetDataType=/^(integer|double)/.test(targetDataType)?"numeric":/^(POSIX)/.test(targetDataType)?"Date":targetDataType;return dataType===targetDataType};res.valueFormatterGenerator=function(numDecimalDigits,useThousandSeparator,truncateTrailingZeros){var fmtstr=useThousandSeparator===false?"":","
;if(!res.isEmpty(numDecimalDigits,true)){fmtstr+="."+numDecimalDigits+"f"}var fmtr=d3.format(fmtstr);return function(v){if(v===undefined||v===null)return"";var s=fmtr(v);if(s!=="NaN"){if(truncateTrailingZeros&&s.indexOf(".")!==-1&&s.indexOf("e")===-1){s=s.replace(/[0]+$/,"");s=s.replace(/[\.]$/,"")}return s}else{s=v.toString();return s.length>60?s.substr(0,60)+"...":s}}};res.addOpacity=function(str,opacity){var p=typeof ratio==="string"?parseFloat(opacity):opacity;var code=res.getRGBACode(str);return"rgba("+code.r+","+code.g+","+code.b+","+p+")"};res.getRGBACode=function(str){var s,r,g,b,a;if(/rgb/.test(str)){s=str.replace(/(rgb\(|rgba\(|\))/g,"");s=s.split(",");r=parseInt(s[0]);g=parseInt(s[1]);b=parseInt(s[2]);a=s.length>3?s[3]:1}else{s=str.replace("#","");r=parseInt(s.substring(0,2),16);g=parseInt(s.substring(2,4),16);b=parseInt(s.substring(4,6),16);a=1}return{r:r,g:g,b:b,a:a}};res.isSortable=function(options,sortTarget,sortByTarget){return!(!options||!sortTarget||!sortByTarget||!options[sortTarget]||!options[sortByTarget]||!res.returnsCharacterValue(options[sortTarget])||!res.returnsNumericValue(options[sortByTarget]))};res.isSortSupported=function(marker){return/^(bar|errbar|bubble|boxplot|violin)$/.test(marker)};res.getDefaultSyncXAxis=function(marker){return"on"};res.getDefaultSyncYAxis=function(marker,isGroupByMeasuresEnabled){return marker==="densityplot"||isGroupByMeasuresEnabled?"off":"on"};res.analyticify=function(viz,columns){var options=viz.options?viz.options:viz;if(!options.facetEnableOtherGroup){options.facetEnableOtherGroup=res.OTHER_GROUP_OPTION_TYPE.NONE}if(!options.categColorEnableOtherGroup){options.categColorEnableOtherGroup=res.OTHER_GROUP_OPTION_TYPE.NONE}if(!options.showFacetLayoutTool){options.showFacetLayoutTool="on"}if(options.marker==="table"&&!options.disableDecimalFormatting){options.disableDecimalFormatting=true}if(options.marker==="table"&&!options.tableShowAllColumn){options.tableShowAllColumn="on"}if(options.marker==="table"&&options.tableShowAllColumn==="on"){if(!options.tableMaxNumCol){options.tableMaxNumCol=1e4}if(!options.tableMaxNumRow){options.tableMaxNumRow=-1}options.tableMaxNumColToShow=200;options.tableMaxNumRowToShow=1e3}if(options.marker==="heatmap"){options.yAxisDirection="reversed"}if(options["x"]){options["xReflineColor"]=options["xReflineColor"]||"#53585F";options["xReflineWidth"]=options["xReflineWidth"]||"2";options["xReflineStyle"]=options["xReflineStyle"]||"dot"}for(var i=0;i<MAX_NUMBER_OF_CONTROLS.y;i++){var op="y"+(i===0?"":i);if(options[op]){options[op+"ReflineColor"]=options[op+"ReflineColor"]||"#53585F";options[op+"ReflineWidth"]=options[op+"ReflineWidth"]||"2";options[op+"ReflineStyle"]=options[op+"ReflineStyle"]||"dot"}}if(options.densityBwNumber){options.densityBw="custom"}if(VizUtil.isNumericAsDiscreteValueOnColor(options)&&!options.categColorPalette){options.categColorPalette="default"}return viz};res.convertAnalyticsGroupByColumnToVizObject=function(obj){var res={};Object.keys(obj).forEach(function(key){var newkey=key;if(!/^(isNumeric|isDate|name|func|type)$/.test(key)){newkey=key.charAt(0).toUpperCase()+key.slice(1)}newkey=newkey.replace(/^OtherGroupType$/,"EnableOtherGroup");res[newkey]=obj[key]});return res};res.constructFilterConditions=function(cdatalist,vizOptions,addLogicalizeInfoCb){var filterConditions=[];cdatalist.forEach(function(cdata){var filterc=[];var v;var histRange=cdata&&cdata.length>0?cdata[0].histRange:null;cdata.forEach(function(d){if(d.filter){if(d.histRange){filterc.push({name:d.validName||d.name,func:"between",columnFunc:d.func,includeEdge:d.includeEdge||"end",val1:d.rawValue-d.histRange,val2:d.rawValue+d.histRange,value:d.value})}else{v={name:d.validName||d.name,value:d.rawValue,func:d.func};if(!VizUtil.isEmpty(d.numDecimalDigits)&&d.func==="round"){try{v.value=parseFloat(d.value.toString().replace(/,/g,""));v.rawValue=d.rawValue}catch(e){}if(isNaN(v.value)){v.value=d.rawValue}v.digit=d.numDecimalDigits}var isColorBucketing=d.type==="color"&&vizOptions.colorbucket&&!VizUtil.applyColorBucketAfterSummarize(vizOptions.marker);var attrs;if(d.func===Column.OperationType.AS_CATEGORY||isColorBucketing){attrs={};res.addBucketInfo(vizOptions,d.type,attrs,[]);if(Object.keys(attrs).length>0){attrs.bucketType=res.getBucketType(d.type,vizOptions);v.attrs=attrs}}else{var opId=d.type==="color"?"categColor":d.type;if(res.isOtherGroupEnabled(opId,vizOptions)){attrs={};res.addOtherGroupInfo(vizOptions,opId,attrs,[]);if(res.isManualSelectOtherGroupEnabled(opId,vizOptions)){var type=VizUtil.getOtherGroupType(opId,vizOptions);attrs.otherGroupType=Column.OperationType.FCT_OTHER;attrs.otherGroupValuesHandling=type===res.OTHER_GROUP_OPTION_TYPE.FCT_OTHER_DROP_VALUES?"drop":"keep"}else{attrs.otherGroupType=Column.OperationType.FCT_LUMP}v.attrs=attrs}}if(addLogicalizeInfoCb&&d.type==="color"&&VizUtil.isLogicalizeEnabled(vizOptions,"color")){v.attrs={};v.attrs.bucketType=res.getBucketType(d.type,vizOptions);addLogicalizeInfoCb("color",vizOptions,v.attrs)}if(res.isRecodeEnabled(vizOptions.marker,d.type,vizOptions)){if(!v.attrs){v.attrs={}}res.addRecodeInfo(vizOptions,d.type,v.attrs,[]);if(v.attrs.recodeValues){v.attrs.recodeType=Column.OperationType.RECODE}}filterc.push(v)}}});filterConditions.push(filterc)});if(filterConditions.length===1&&Array.isArray(filterConditions[0])&&filterConditions[0].length===1){filterConditions=filterConditions[0]}return filterConditions};res.extractNumberOfRowsFromChartCustomData=function(cdatalist){var nrowTypeData=null,nrowData=null;cdatalist[0].forEach(function(d){if(d.type==="nrow"){nrowTypeData=d}else if(d.validName===res.NUMROWS_COL_NAME){nrowData=d}});var data=nrowTypeData||nrowData;return data?data.value:null};res.isReferenceLineSupported=function(marker){return/^(line|bar|scatter|bubble|hist|densityplot|errbar)$/.test(marker)};res.isHorizontalReferenceLineSupported=function(marker){return/^(scatter|line|bubble|bar|errbar)$/.test(marker)};res.isVerticalReferenceLineSupported=function(marker){return/^(bar|scatter|line|bubble|hist|densityplot)$/.test(marker)};res.isGroupByMeasuresColumnSupported=function(marker){return/^(bar|line)$/.test(marker)};res.isReferenceLineRangeSupported=function(marker,opId,reflineType){if(reflineType!==Column.OperationType.AVERAGE&&reflineType!==Column.OperationType.MEDIAN){return false}switch(marker){case"line":case"bar":case"scatter":case"errbar":return/^y/.test(opId);case"hist":case"densityplot":return opId==="x";default:return false}};res._messages={en:{"pivot.metrics.rows.of":" of ","pivot.metrics.total.rows":" rows","pivot.metrics.rows":" rows","pivot.metrics.cols.of":" of ","pivot.metrics.total.cols":" columns","pivot.metrics.cols":" columns","pivot.metrics.prefix":"Showing ","pivot.metrics.suffix":"","Total Number":"Total","# of Rows":"Rows","# of Columns.short":"Columns","All Rows":"All","table.toolbar.section1":"Showing","table.toolbar.section2":"","table.toolbar.section3":"of","table.toolbar.section4":"","table.toolbar.section5":"Rows,","table.toolbar.section6":"","table.toolbar.section7":"of","table.toolbar.section8":"","table.toolbar.section9":"Columns.","table.toolbar.section10":"","POSITIVE.ANOMALIES.SHORT":"Positive","NEGATIVE.ANOMALIES.SHORT":"Negative"},ja:{"Number of Rows":"","# of Rows":"","All Rows":"",Group:"","Repeat By Group":"","Number of Columns":"","# of Columns":"","# of Columns.short":"",Longitude:"",Latitude:"","Fit in View Area":"",Fit:"","Sync X Axis":"X","Sync Y Axis":"Y","Show Range":"","Confidence Interval (95%)":" (95%)",Auto:"",row:"",rows:"",Color:"",Size:"","Show Values":"","Show Label Values on Chart":"","Autoscale Y Axis":"Y",Sum:"",Total:"",Subtotal:"",Mean:"",Min:"",Max:"",First:"",Last:"",Count:"","Uniq.":"","Med.":"",SD:"","2SD":"","3SD":"","Var.":"",IQR:"IQR",MAD:"MAD",Mode:"","#NA":"","%NA":"","#NNA":"","%NNA":"","#True":"TRUE","#False":"FALSE","%True":"TRUE","%False":"FALSE","Specific Value":"",Diagonal:"",Exclude:"","Keep Only":"","Show Detail":"","items selected":"",Correlation:"","R Squared":"R2",Coefficient:"","P-Value":"P","Deviance Explained":"",GCV:"GCV","Scale Est.":"","Equivalent Number of Parameters":"","Residual Standard Error":"","Trace of Smoother Matrix":"","Odds Ratio":"","Range Type":"",Range:"","Standard Error":"","95% Conf. Interval":"95%","99% Conf. Interval":"99%","1 Standard Deviation":"1","2 Standard Deviation":"2","3 Standard Deviation":"3","Ratio by":"",Ratio:"","X Axis":"X",All:"","Total Number":"","(Number of Rows)":"()","(Number of TRUE)":"(TRUE)","(Number of FALSE)":"(FALSE)","(Number of NA)":"()","(Number of Not NA)":"()","(Row ID)":"()","True Positive Rate":"","False Positive Rate":"","Baseline AUC: 0.5":"AUC: 0.5",Cumulative:"","Difference From":"","% Difference From":"","Moving Calculation":"",Rank:"","% of Total":"","% of First":"","% of Last":"","% of Min":"","% of Max":"","% of Mean":"","% of Median":"","% of Mode":"","Cumulative Sum":"","Cumulative Sum Ratio":"","Cumulative Sum Ratio (%)":" (%)","Cumulative Mean":"","Cumulative Min":"","Cumulative Max":"","Cumulative Median":"","Cumulative Prod":"","Difference from Previous":"","Difference from Next":"","Difference from First":"","Difference from Last":"","Difference from Min":"","Difference from Max":"","Difference from Mean":"","Difference from Median":"","Difference from Mode":"","Difference from Constant":"","Difference from Constant Value":"","Difference from Specific Value":"","Difference from X":"{0}","% Difference from Constant":"","% Difference from Constant Value":"","% Difference from Specific Value":"","% Difference from X":"{0}","% Difference from Mode":"","% Difference from Previous":"","% Difference from Next":"","% Difference from First":"","% Difference from Last":"","% Difference from Min":"","% Difference from Max":"","% Difference from Mean":"","% Difference from Median":"","Moving Average":"","Moving Min":"","Moving Max":"","Moving Median":"","Moving Standard Deviation":"","Moving Variance":"","Moving Sum":"","Moving Prod":"","Min Rank":"Min","Dense Rank":"Dense","Percent Rank":"","pivot.metrics.rows.of":"","pivot.metrics.total.rows":"","pivot.metrics.rows":"","pivot.metrics.cols.of":"","pivot.metrics.total.cols":"","pivot.metrics.cols":"","pivot.metrics.prefix":"","pivot.metrics.suffix":"","table.toolbar.section1":"","table.toolbar.section2":"","table.toolbar.section3":",","table.toolbar.section4":"","table.toolbar.section5":"","table.toolbar.section6":"","table.toolbar.section7":"","table.toolbar.section8":"","table.toolbar.section9":"","table.toolbar.section10":"","X-Axis":"X","Y-Axis":"Y",Distance:"",Positive:"",Negative:"","More Likely to Occur":"","Less Likely to Occur":"",Actual:"","Actual (Mean)":" ()","Actual (Ratio)":" ()",Prediction:"","Base Level":"",Influence:"","Conf Low":"","Conf High":"","P Value":"P",Term:"","Predicted (X)":" (X)","Actual (Y)":" (Y)",Predicted:"","Predicted Values":"","Actual Values":"",Variables:"","Coefficient Estimates":"","Predicted Probability":"",Density:"",Percentage:"","Perfect Fit":"",Importance:"",Significance:"",Residual:"",Residuals:"",Type:"","Average Marginal Effect":"","Incidence Rate Ratio":"","Prediction Outcome":"","Prediction Probability":"","Data Type":"",Confirmed:"",Tentative:"",Rejected:"",Iterations:"",Validation:"",Time:"",Period:"",Observations:"",Cohort:"",Case:"",Value:"",Events:"",Censored:"","Survival Rate":"","Hazard Ratio":"","t Value":"t","t Value from This Test":"t","Degree of Freedom":"","Chi-Square":"","Chi-Square from This Test":"",Expected:"","Contribution (%)":" (%)","% Difference":"",Difference:"","Standardized Difference":"","F Value":"F","F Value from This Test":"F","Degree of Freedom 1":"1","Degree of Freedom 2":"2",count:"","count (y1)":" (y1)","Forecasted Value":"","Forecasted Value (y1)":" (y1)","Forecasted Value High":"","Forecasted Value Low":"",Trend:"","Trend (y1)":" (y1)","Trend Change":"","Trend Change (y2)":" (y2)","Trend High":"","Trend Low":"",Training:"","Training (y1)":" (y1)",Test:"","Test (y1)":" (y1)",Yearly:"","Yearly Seasonality":"","Yearly Seasonality (y2)":" (y2)",Quarterly:"","Quarterly Seasonality":"","Quarterly Seasonality (y2)":" (y2)",Monthly:"","Monthly Seasonality":"","Monthly Seasonality (y2)":" (y2)",Weekly:"","Weekly Seasonality":"","Weekly Seasonality (y2)":" (y2)",Daily:"","Daily Seasonality":"","Daily Seasonality (y2)":" (y2)",Holidays:"","Holiday Effect":"","Holiday Effect (y2)":" (y2)","Predictor 1":"1","Predictor 1 (y2)":"1 (y2)","Predictor 2":"2","Predictor 2 (y2)":"2 (y2)","Predictor 3":"3","Predictor 3 (y2)":"3 (y2)","Predictor 4":"4","Predictor 4 (y2)":"4 (y2)","Predictor 5":"5","Predictor 5 (y2)":"5 (y2)","Day of Year":"","Day of Quarter":"","Day of Month":"","Day of Week":"",Hour:"","Multiplicative Effect":"",Stationary:"",Lag:"",ACF:"",PACF:"","Change Point":"","Order of Differencing":"","Order of Seasonal Differencing":"","Period of Seasonal Differencing":"",PC1:"1",PC2:"2",Components:"","% Variance":" (%)","% Variance (y1)":" (%) (y1)","Cummulated % Variance":" (%)","Cummulated % Variance (y2)":" (%) (y2)",Weight:"",Component:"",Variable:"","Cluster (Color)":" ()",Cluster:"","Variable (X)":" (X)","Value (Y)":" (Y)","Number of Clusters":"","Total Within-Cluster Sum of Squares":"","% Decrease in Total Within-Cluster Sum of Squares":" (%)","Normalized Value":"","Normalized Mean":"","Ratio (%)":" (%)","Negative Anomaly":"","Negative Anomalies":"","Positive Anomaly":"","Positive Anomalies":"","POSITIVE.ANOMALIES.SHORT":"","NEGATIVE.ANOMALIES.SHORT":"","Expected Value":"",Rule:"","Lift (Size)":" ()",Support:"","Support (X)":" (X)",Confidence:"","Confidence (Y)":" (Y)","Improvement Rate (%)":" (%)","Chance of Being Better":"","Probability (%)":" (%)","Conversion Rate (%)":" (%)","A/B Identifier":"A/B","Probability Density":"","A is better":"A","A is not better":"A","Performance Improvement Rate (A - B) / B (%)":" (A - B) / B (%)","Theoretical Quantile (X)":" (Quantile) (X)","Actual Value (Y)":" (Y)",Normality:"",Normal:"","Not Normal":"","Value (X)":" (X)","Reference Line":""}};res._regexMessages={ja:{"$1 ()":/^(.*) \(Probability\)$/,"P >= $1":/^P Value >\= (.*)$/,"P < $1":/^P Value < (.*)$/," $1":/^Cluster (.*)$/,"1 $1":/^PC1 \((.*)\)$/,"2 $1":/^PC2 \((.*)\)$/},en:{}};res.getMessage=function(lang,key,enableRegexTrans){lang=lang&&lang.startsWith("ja")?"ja":"en";return res._messages[lang]&&res._messages[lang][key]!==undefined?res._messages[lang][key]:enableRegexTrans?res.doRegexTranslation(lang,key):key};res.doRegexTranslation=function(lang,key){if(!key){return key}var val=key;Object.keys(res._regexMessages[lang]).some(function(replacement){val=key.replace(res._regexMessages[lang][replacement],replacement);return val!==key});return val};res.compareVersionStr=function(v1,v2,options){var lexicographical=options&&options.lexicographical,zeroExtend=options&&options.zeroExtend,v1parts=v1.split("."),v2parts=v2.split(".");function isValidPart(x){return(lexicographical?/^\d+[A-Za-z]*$/:/^\d+$/).test(x)}if(!v1parts.every(isValidPart)||!v2parts.every(isValidPart)){return NaN}if(zeroExtend){while(v1parts.length<v2parts.length)v1parts.push("0");while(v2parts.length<v1parts.length)v2parts.push("0")}if(!lexicographical){v1parts=v1parts.map(Number);v2parts=v2parts.map(Number)}for(var i=0;i<v1parts.length;++i){if(v2parts.length===i){return 1}if(v1parts[i]===v2parts[i]){continue}else if(v1parts[i]>v2parts[i]){return 1}else{return-1}}if(v1parts.length!=v2parts.length){return-1}return 0};var ElemMock=function(elemName){this.name=elemName;this.textContent="";this.innerHTML="";this.style={};this.classes={};this.children=[];this.attrs={};var self=this;this.classList={add:function(){for(var i=0;i<arguments.length;i++){self.classes[arguments[i]]=true}},remove:function(className){for(var i=0;i<arguments.length;i++){self.classes[arguments[i]]=null}}};this.appendChild=function(child){self.children.push(child)};this.setAttribute=function(name,value){this.attrs[name]=value};this.getAttribute=function(name){return this.attrs[name]};this.onclick=function(){};this.serialize=function(){return JSON.parse(JSON.stringify(this))}};var JQueryMock=function(){var res={balloon:function(){},click:function(){},css:function(){}};return res};JQueryMock.balloon={defaults:{}};JQueryMock.isMock=true;var DocumentMock={createElement:function(name){return new ElemMock(name)},isMock:true};res.getDocumentMock=function(){return DocumentMock};res.getJQueryMock=function(){return JQueryMock};res.colorbrewer={schemeGroups:{sequential:["BuGn","BuPu","GnBu","OrRd","PuBu","PuBuGn","PuRd","RdPu","YlGn","YlGnBu","YlOrBr","YlOrRd"],singlehue:["Blues","Greens","Greys","Oranges","Purples","Reds"],diverging:["BrBG","PiYG","PRGn","PuOr","RdBu","RdGy","RdYlBu","RdYlGn","Spectral"],qualitative:["Accent","Dark2","Paired","Pastel1","Pastel2","Set1","Set2","Set3"]},YlGn:{1:["#f7fcb9"],2:["#f7fcb9","#31a354"],3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],10:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#005a32","#004529"]},YlGnBu:{1:["#edf8b1"],2:["#edf8b1","#2c7fb8"],3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],10:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#0c2c84","#081d58"]},GnBu:{1:["#e0f3db"],2:["#e0f3db","#43a2ca"],3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],10:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#08589e","#084081"]},BuGn:{1:["#e5f5f9"],2:["#e5f5f9","#2ca25f"],3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],10:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#005824","#00441b"]},PuBuGn:{1:["#ece2f0"],2:["#ece2f0","#1c9099"],3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],10:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#016450","#014636"]},PuBu:{1:["#ece7f2"],2:["#ece7f2","#2b8cbe"],3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],10:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#034e7b","#023858"]},BuPu:{1:["#e0ecf4"],2:["#e0ecf4","#8856a7"],3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],10:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#6e016b","#4d004b"]},RdPu:{1:["#fde0dd"],2:["#fde0dd","#c51b8a"],3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],10:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#c51b8a","#ae017e","#7a0177","#49006a"]},PuRd:{1:["#e7e1ef"],2:["#e7e1ef","#dd1c77"],3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],10:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#91003f","#67001f"]},OrRd:{1:["#fee8c8"],2:["#fee8c8","#e34a33"],3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],10:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#990000","#7f0000"]},YlOrRd:{1:["#ffeda0"],2:["#ffeda0","#f03b20"],3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],10:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#b10026","#800026"]},YlOrBr:{1:["#fff7bc"],2:["#fff7bc","#d95f0e"],3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],10:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#8c2d04","#662506"]},Purples:{1:["#756bb1"],2:["#bcbddc","#756bb1"],3:["#cbc9e2","#9e9ac8","#6a51a3"],4:["#cbc9e2","#9e9ac8","#756bb1","#54278f"],5:["#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],6:["#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],7:["#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],8:["#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"],9:["#dadaeb","#c5c5e0","#b1afd4","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"],10:["#dadaeb","#cacae3","#bbbada","#acaad1","#9e9ac8","#807dba","#6a51a3","#54278f","#4a1486","#3f007d"]},Blues:{1:["#3182bd"],2:["#c6dbef","#3182bd"],3:["#c6dbef","#9ecae1","#3182bd"],4:["#c6dbef","#6baed6","#3182bd","#08519c"],5:["#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],6:["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],7:["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],8:["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"],9:["#c6dbef","#a7cde5","#8abddd","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"],10:["#c6dbef","#afd0e7","#98c5e1","#82badb","#6baed6","#4292c6","#2171b5","#08519c","#084594","#08306b"]},Greens:{1:["#31a354"],2:["#a1d99b","#31a354"],3:["#bae4b3","#74c476","#238b45"],4:["#bae4b3","#74c476","#31a354","#006d2c"],5:["#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],6:["#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],7:["#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],8:["#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"],9:["#c7e9c0","#abdda6","#90d18d","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"],10:["#c7e9c0","#b2e0ac","#9ed799","#89ce87","#74c476","#41ab5d","#238b45","#006d2c","#005a32","#00441b"]},Oranges:{1:["#e6550d"],2:["#fdae6b","#e6550d"],3:["#fdbe85","#fd8d3c","#d94701"],4:["#fdbe85","#fd8d3c","#e6550d","#a63603"],5:["#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],6:["#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],7:["#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],8:["#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"],9:["#fdd0a2","#febb80","#fea45e","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"],10:["#fdd0a2","#fec088","#feb06f","#fe9f56","#fd8d3c","#f16913","#d94801","#a63603","#8c2d04","#7f2704"]},Reds:{1:["#de2d26"],2:["#fc9272","#de2d26"],3:["#fcae91","#fb6a4a","#cb181d"],4:["#fcae91","#fb6a4a","#de2d26","#a50f15"],5:["#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],6:["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],7:["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],8:["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"],9:["#fcbba1","#fda284","#fd8767","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"],10:["#fcbba1","#fda88b","#fd9575","#fc8060","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#99000d","#67000d"]},Greys:{1:["#636363"],2:["#bdbdbd","#636363"],3:["#cccccc","#969696","#525252"],4:["#cccccc","#969696","#636363","#252525"],5:["#d9d9d9","#bdbdbd","#969696","#636363","#252525"],6:["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],7:["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],8:["#d9d9d9","#cccccc","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],9:["#d9d9d9","#d0d0d0","#c6c6c6","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],10:["#d9d9d9","#d2d2d2","#cbcbcb","#c4c4c4","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{1:["#f1a340"],2:["#f1a340","#998ec3"],3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{1:["#d8b365"],2:["#d8b365","#5ab4ac"],3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{1:["#af8dc3"],2:["#af8dc3","#7fbf7b"],3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{1:["#e9a3c9"],2:["#e9a3c9","#a1d76a"],3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{
1:["#ef8a62"],2:["#ef8a62","#67a9cf"],3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{1:["#ef8a62"],2:["#ef8a62","#999999"],3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{1:["#fc8d59"],2:["#fc8d59","#91bfdb"],3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{1:["#fc8d59"],2:["#fc8d59","#99d594"],3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{1:["#fc8d59"],2:["#fc8d59","#91cf60"],3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{1:["#7fc97f"],2:["#7fc97f","#fdc086"],3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{1:["#1b9e77"],2:["#1b9e77","#7570b3"],3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{1:["#a6cee3"],2:["#a6cee3","#b2df8a"],3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{1:["#fbb4ae"],2:["#fbb4ae","#ccebc5"],3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{1:["#b3e2cd"],2:["#b3e2cd","#cbd5e8"],3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{1:["#e41a1c"],2:["#e41a1c","#4daf4a"],3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{1:["#66c2a5"],2:["#66c2a5","#8da0cb"],3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{1:["#8dd3c7"],2:["#8dd3c7","#bebada"],3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]},Viridis:{1:["#FDE725"],2:["#FDE725","#440154"],3:["#FDE725","#21908C","#440154"],4:["#FDE725","#35B779","#31688E","#440154"],5:["#FDE725","#5DC863","#21908C","#3B528B","#440154"],6:["#FDE725","#7AD151","#22A884","#2A788E","#414487","#440154"],7:["#FDE725","#8FD744","#35B779","#21908C","#31688E","#443A83","#440154"],8:["#FDE725","#9FDA3A","#4AC16D","#1FA187","#277F8E","#365C8D","#46337E","#440154"],9:["#FDE725","#AADC32","#5DC863","#27AD81","#21908C","#2C728E","#3B528B","#472D7B","#440154"],10:["#FDE725","#B4DE2C","#6DCD59","#35B779","#1F9E89","#26828E","#31688E","#3E4A89","#482878","#440154"],11:["#FDE725","#BBDF27","#7AD151","#43BF71","#22A884","#21908C","#2A788E","#35608D","#414487","#482576","#440154"],12:["#FDE725","#C2DF23","#85D54A","#51C56A","#2BB07F","#1E9B8A","#25858E","#2D708E","#38598C","#433E85","#482173","#440154"]}};return res}();if(typeof module==="object"&&module.exports)module.exports=VizUtil;var PivotTableGenerator=function(){};var _sortIdx=0;var _SORT_NONE=0;var _SORT_DESC=1;var _SORT_ASC=2;var SCROLL_BAR_WIDTH=25;var SHOW_BALLOON_THRESHOLD=15;var COL_INDEX_THRESHOLD_FOR_THUMB=15;var ROW_INDEX_THRESHOLD_FOR_THUMB=20;var _getNextSortDir=function(current){return(current+1)%3};var _sortDir=_SORT_NONE;var NROW_OPTIONS=[{label:"50",value:50},{label:"100",value:100},{label:"200",value:200},{label:"500",value:500},{label:"1000",value:1e3}];var COLOR_CLASS_MAP={"#EC5D57":"light-red","#F39019":"light-orange","#F5D328":"light-yellow","#70BF41":"light-green","#51A7F9":"light-blue","#B36AE2":"light-purple","#DCDEE0":"light-gray","#C82506":"red","#DE6A10":"orange","#DCBD23":"yellow","#00882B":"green","#0365C0":"blue","#773F9B":"purple","#FFFFFF":"white","#A6AAA9":"gray","#53585F":"dark-gray","#000000":"black","#4D4D4D":"default"};PivotTableGenerator.getSortIndex=function(){return _sortIdx};PivotTableGenerator.setSortIndex=function(idx){_sortIdx=idx};PivotTableGenerator.getSortDirection=function(){return _sortDir};PivotTableGenerator.setSortDirection=function(dir){_sortDir=dir};var isNumberCol=function(col){if(!col){return false}return col.isNumeric||/(difftime|Period|duration|hms|interval)/i.test(col.type)};PivotTableGenerator.applyConditionalFormatting=function(cfs,coldef,val){if(!cfs){return null}var res=null,i=0,cf=null,cond,op,start,end;for(i=cfs.length-1;i>=0;i--){cf=cfs[i];cond=cf.value;op=cf.operator||"eq";switch(op){case"gt":cond=coldef.isNumeric?parseFloat(cond):coldef.isDate?new Date(cond):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(cond!==null&&cond<val){res=cf.color}break;case"gte":cond=coldef.isNumeric?parseFloat(cond):coldef.isDate?new Date(cond):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(cond!==null&&cond<=val){res=cf.color}break;case"lt":cond=coldef.isNumeric?parseFloat(cond):coldef.isDate?new Date(cond):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(cond!==null&&cond>val){res=cf.color}break;case"lte":cond=coldef.isNumeric?parseFloat(cond):coldef.isDate?new Date(cond):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(cond!==null&&cond>=val){res=cf.color}break;case"eq":if(cond===val.toString()){res=cf.color}break;case"ne":if(cond!==val.toString()){res=cf.color}break;case"in":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.indexOf(val.toString())>-1){res=cf.color}break;case"ni":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.indexOf(val.toString())===-1){res=cf.color}break;case"sw":if(val.toString().startsWith(cond)){res=cf.color}break;case"nsw":if(!val.toString().startsWith(cond)){res=cf.color}break;case"ew":if(val.toString().endsWith(cond)){res=cf.color}break;case"new":if(!val.toString().endsWith(cond)){res=cf.color}break;case"contains":if(val.toString().indexOf(cond)>-1){res=cf.color}break;case"not-contains":if(val.toString().indexOf(cond)===-1){res=cf.color}break;case"between":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.length>1){start=coldef.isNumeric?parseFloat(cond[0]):coldef.isDate?new Date(cond[0]):null;end=coldef.isNumeric?parseFloat(cond[1]):coldef.isDate?new Date(cond[1]):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(start!==null&&end!==null&&start<=val&&end>=val){res=cf.color}}break;case"not-between":if(cond&&typeof cond==="string"){cond=cond.split(",").map(function(c){return c.trim()})}if(Array.isArray(cond)&&cond.length>1){start=coldef.isNumeric?parseFloat(cond[0]):coldef.isDate?new Date(cond[0]):null;end=coldef.isNumeric?parseFloat(cond[1]):coldef.isDate?new Date(cond[1]):null;val=coldef.isNumeric?parseFloat(val):coldef.isDate?new Date(val):null;if(start!==null&&end!==null&&(start>val||end<val)){res=cf.color}}break}}return res};PivotTableGenerator.render=function(viz,data,elTarget,prevState,headerSyncDelay,lang,onLoadCallback,onErrorCallback,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback){if(lang){PivotTableGenerator._lang=lang}try{PivotTableGenerator._render(viz,data,elTarget,prevState,headerSyncDelay,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,"Graph rendering failed.")}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};PivotTableGenerator._render=function(viz,data,elTarget,prevState,headerSyncDelay,onBeforeRenderingCallback,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback){data=VizUtil.translateColumnData(data,viz,PivotTableGenerator._lang);while(elTarget&&elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}var isHeadless=!elTarget;var _document=typeof document==="undefined"?null:document,_$=typeof $==="undefined"?null:$;if(isHeadless){_document=VizUtil.getDocumentMock();_$=VizUtil.getJQueryMock();elTarget=_document.createElement("div")}var translateColumn=function(text){if(viz.translate==="on"){return VizUtil.getMessage(PivotTableGenerator._lang,text)}else{return text}};if(viz.marker==="singlevalue"){PivotTableGenerator.renderSingleValue(viz,data,elTarget,isHeadless,onBeforeRenderingCallback);return}var _syncHeader=function(elTarget){var i,l;var headerCells=elTarget.querySelectorAll(".pivot-view .pivot-col-header-view .pivot-cell.header");var bodyCells=elTarget.querySelectorAll(".pivot-view .pivot-body-view .pivot-cell.header");for(i=0,l=bodyCells.length;i<l;i++){headerCells.item(i).style.minWidth=bodyCells.item(i).offsetWidth+"px";headerCells.item(i).style.maxWidth=bodyCells.item(i).offsetWidth+"px"}var colTitle=elTarget.querySelector(".pivot-col-title");if(colTitle){var rowHeaders=elTarget.querySelectorAll(".pivot-view .pivot-body-view .pivot-cell.header.row-header");if(rowHeaders.length>0){var p=0;for(i=0,l=rowHeaders.length;i<l;i++){if(bodyCells[i]){p+=bodyCells[i].clientWidth}}colTitle.style.paddingLeft=p+"px"}else{colTitle.style.paddingLeft="10px"}}};var _syncTitle=function(elTarget){var pivotTitle=elTarget.querySelector(".pivot-title");var pivotTable=elTarget.querySelector(".pivot-view .pivot-body-view .pivot-table-frame");var pivotTitleWidth=_$(pivotTitle).width();var pivotTableWidth=_$(pivotTable).width();if(pivotTitleWidth>pivotTableWidth){_$(pivotTitle).width(pivotTableWidth)}};var PIXEL_STEP=10;var LINE_HEIGHT=40;var PAGE_HEIGHT=800;var normalizeWheel=function(event){var sX=0,sY=0,pX=0,pY=0;if("detail"in event){sY=event.detail}if("wheelDelta"in event){sY=-event.wheelDelta/120}if("wheelDeltaY"in event){sY=-event.wheelDeltaY/120}if("wheelDeltaX"in event){sX=-event.wheelDeltaX/120}if("axis"in event&&event.axis===event.HORIZONTAL_AXIS){sX=sY;sY=0}pX=sX*PIXEL_STEP;pY=sY*PIXEL_STEP;if("deltaY"in event){pY=event.deltaY}if("deltaX"in event){pX=event.deltaX}if((pX||pY)&&event.deltaMode){if(event.deltaMode==1){pX*=LINE_HEIGHT;pY*=LINE_HEIGHT}else{pX*=PAGE_HEIGHT;pY*=PAGE_HEIGHT}}if(pX&&!sX){sX=pX<1?-1:1}if(pY&&!sY){sY=pY<1?-1:1}return{spinX:sX,spinY:sY,pixelX:pX,pixelY:pY}};var _scroll;var _onScrollHandler=function(ev){var left=ev.target.scrollLeft;_scroll.left=left;_scroll.headerElem.parentNode.scrollLeft=_scroll.left};var _onWheelHandler=function(ev){ev.preventDefault();var normEv=normalizeWheel(ev);if(Math.abs(normEv.pixelX)>Math.abs(normEv.pixelY)){if(_scroll.bodyElem.clientWidth>_scroll.bodyElem.parentNode.clientWidth){_scroll.left=Math.max(_scroll.left+normEv.pixelX,0);_scroll.left=Math.min(_scroll.left,_scroll.bodyElem.clientWidth-_scroll.bodyElem.parentNode.clientWidth);_scroll.headerElem.parentNode.scrollLeft=_scroll.left;_scroll.bodyElem.parentNode.scrollLeft=_scroll.left}}else{if(_scroll.bodyElem.clientHeight>_scroll.bodyElem.parentNode.clientHeight){_scroll.top=Math.max(_scroll.top+normEv.pixelY,0);_scroll.top=Math.min(_scroll.top,_scroll.bodyElem.clientHeight-_scroll.bodyElem.parentNode.clientHeight-5);_scroll.bodyElem.parentNode.scrollTop=_scroll.top}}};var _initScrollHandler=function(elTarget,prevState){var tableElem=elTarget.querySelector(".pivot-view");var bodyElem=tableElem.querySelector(".pivot-table-body-frame");var headerElem=tableElem.querySelector(".pivot-table-col-header-frame");var scroll={left:0,top:0,tableElem:tableElem,headerElem:headerElem,bodyElem:bodyElem};_scroll=scroll;if(prevState){_scroll.left=prevState.left;_scroll.headerElem.parentNode.scrollLeft=_scroll.left;_scroll.bodyElem.parentNode.scrollLeft=_scroll.left}tableElem.addEventListener("wheel",_onWheelHandler);bodyElem.parentNode.addEventListener("scroll",_onScrollHandler)};_$(".pivot-balloon-style").css("display","none");if(!prevState){_sortIdx=0;_sortDir=_SORT_NONE;if(viz.marker==="summarytable"){VizUtil.getOptions(viz,"meas").filter(function(m){return!!m}).some(function(m,idx){if(m.sortOrder){_sortIdx=idx;_sortDir=m.sortOrder==="desc"?_SORT_DESC:_SORT_ASC;return true}return false})}if(_sortDir===_SORT_NONE&&!VizUtil.isEmpty(viz.pivotClientSortIndex)&&!VizUtil.isEmpty(viz.pivotClientSortDirection)&&viz.pivotClientSortDirection!==_SORT_NONE){_sortIdx=viz.pivotClientSortIndex;_sortDir=viz.pivotClientSortDirection}}if(!data||data.length===0||!data[0]||data[0].length===0){VizUtil.renderNoData(elTarget,null,null,"Try assigning a column again. ");return}var pdata=PivotTableGenerator.constructPivotData(viz,data,_sortIdx,_sortDir);var isPivot=viz.marker==="pivot";var isTable=viz.marker==="table";var isSummaryTable=viz.marker==="summarytable";SHOW_BALLOON_THRESHOLD=isPivot||isSummaryTable?15:25;var textWrap=viz.pivotTextWrap||"none";var hideDataCells=viz.pivotHideDataCells==="on";var masterFontSize=viz.pivotMasterFontSize||null;var colh0FontSize=masterFontSize||viz.colh0FontSize;var meas0FontSize=masterFontSize||viz.meas0FontSize;var rowh0TotalFontSize=masterFontSize||viz.rowh0TotalFontSize;var meas0TotalFontSize=masterFontSize||viz.meas0TotalFontSize;var colh0ShowFuncName=viz.colh0ShowFuncName==="on";var fullWidthMode=viz.pivotFullWidthMode==="on";var NUMROWS_COL_LABEL=VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.NUMROWS_COL_LABEL);var measOps=VizUtil.getOptions(viz,"meas");measOps=measOps.filter(function(m){return!!m});var masterColAlign=null;var colAligns=[];if(isTable){data[1].forEach(function(col,idx){colAligns.push(isNumberCol(viz["tcol"+idx])?"num-col":"text-col")})}else if(measOps.length>1||isSummaryTable){measOps.forEach(function(col,idx){colAligns.push(VizUtil.returnsNumericValue(col)?"num-col":"text-col")})}else{masterColAlign=measOps[0]&&VizUtil.returnsNumericValue(measOps[0])?"num-col":"text-col"}var bgcolorScale,fgcolorScale;var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";var colorarr;if(isPivot&&!!viz.pivotColor&&viz.pivotColor!=="none"&&measOps.filter(function(m){return VizUtil.returnsNumericValue(m)}).length===0){var pname=viz.categColorPalette||"default";if(pname==="custom"&&!!viz.customCategColorPalette&&viz.customCategColorPalette.length>0){colorarr=viz.customCategColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice();colorarr=colorarr.map(function(x){return VizUtil.hexToRgb(x)===null?"#CCCCCC":x});if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}bgcolorScale=d3.scale.ordinal().range(colorarr);fgcolorScale=d3.scale.ordinal().range(["#ffffff"])}else{var colors=VizUtil.CATEG_COLOR_PALETTES_HASH[pname].color.slice();if(reverseColorPaletteOrderOp==="on"){colors.reverse()}bgcolorScale=d3.scale.ordinal().range(colors);fgcolorScale=d3.scale.ordinal().range(VizUtil.CATEG_COLOR_PALETTES_HASH[pname].textColor)}if(measOps[0].type=="logical"){bgcolorScale("TRUE");bgcolorScale("FALSE");fgcolorScale("TRUE");fgcolorScale("TRUE")}}var getColAlign=function(idx){return masterColAlign?masterColAlign:colAligns[idx]};_$.balloon.defaults.classname="pivot-balloon-style";_$.balloon.defaults.css=null;_$.balloon.defaults.minLifetime=0;_$.balloon.defaults.showDuration=0;_$.balloon.defaults.hideDuration=0;_$.balloon.defaults.tipSize=5;var colorPaletteOp=viz.quantColorPalette||viz.colorPallete||"Blues";if(!VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp]){colorPaletteOp="Blues"}var bgcolorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp].color.slice();var fgcolorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[colorPaletteOp].textColor.slice();if(viz.customQuantColorPalette&&viz.customQuantColorPalette.length>0&&viz.quantColorPalette==="custom"){colorarr=viz.customQuantColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice();colorarr=colorarr.map(function(x){return VizUtil.hexToRgb(x)===null?"#CCCCCC":x});while(colorarr.length<6){colorarr=colorarr.concat(colorarr)}bgcolorPalette=colorarr;fgcolorPalette["#ffffff"]}if(reverseColorPaletteOrderOp==="on"){bgcolorPalette.reverse();fgcolorPalette.reverse()}bgcolorPalette.unshift("#ffffff");fgcolorPalette.unshift("#4d4d4d");var elMetainfo=_document.createElement("div");elMetainfo.classList.add("pivot-metainfo");elTarget.appendChild(elMetainfo);var elToolbar=_document.createElement("div");elToolbar.classList.add("pivot-toolbar");elTarget.appendChild(elToolbar);var elTitle=_document.createElement("div");elTitle.classList.add("pivot-title");elTarget.appendChild(elTitle);var elColTitle=_document.createElement("div");elColTitle.classList.add("pivot-col-title");elColTitle.textContent="Column Title";elTarget.appendChild(elColTitle);var elPivotView=_document.createElement("div");elPivotView.classList.add("pivot-view");elPivotView.classList.add(isPivot||isSummaryTable?"type-pivot":"type-table");if(onTableColumnConfigClickCallback){elPivotView.classList.add("with-column-config-icons")}if(isTable&&viz.tableTextWrap==="on"){elPivotView.classList.add("allow-multiple-lines")}elTarget.appendChild(elPivotView);var elPivotColHeaderView=_document.createElement("div");elPivotColHeaderView.classList.add("pivot-col-header-view");var elPivotColHeader=_document.createElement("div");elPivotColHeader.classList.add("pivot-table-frame");elPivotColHeader.classList.add("pivot-table-col-header-frame");elPivotColHeaderView.appendChild(elPivotColHeader);var elPivotBodyView=_document.createElement("div");elPivotBodyView.classList.add("pivot-body-view");var elPivot=_document.createElement("div");elPivot.classList.add("pivot-table-frame");elPivot.classList.add("pivot-table-body-frame");if(fullWidthMode){elPivot.style.width="100%"}elPivotBodyView.appendChild(elPivot);elPivotView.appendChild(elPivotBodyView);elPivotView.appendChild(elPivotColHeaderView);var voffset=0;var onToolbarWidgetChange=function(ev){var $toolbar=_$(ev.target.parentNode);if($toolbar.find(".nrows-to-show-dropdown").length>0){var nrowsToShow=$toolbar.find(".nrows-to-show-dropdown").val();if(onPropUpdateCallback){onPropUpdateCallback("tableNRowsToShow",nrowsToShow)}viz.tableNRowsToShow=nrowsToShow}PivotTableGenerator.render(viz,data,elTarget,{top:_scroll.top,left:_scroll.left},null,PivotTableGenerator._lang,null,null,null,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback)};var renderToolbar=function(viz,_document,pdata){if(viz.marker!=="table"||viz.showNRowsToShowOptionInToolbar!=="on"){return null}var showNumRowLov=pdata.originalRowSize>NROW_OPTIONS[0].value;var nrowsToShow=viz.tableNRowsToShow?parseInt(viz.tableNRowsToShow):NROW_OPTIONS[0].value;var op,section1,section2,section3,section4,section5,section6,section7,section8,section9,section10,fmtr=d3.format(","),toolbar=_document.createElement("div"),loc=PivotTableGenerator._lang;section1=_document.createElement("span");section1.textContent=VizUtil.getMessage(loc,"table.toolbar.section1");section1.style.marginRight="3px";section1.style.verticalAlign="baseline";section1.style.display="inline-block";section1.style.fontSize="12px";if(showNumRowLov){section2=_document.createElement("select");section2.style.width="60px";section2.style.backgroundColor="white";section2.style.border="1px solid #ccc";section2.style.borderRadius="5px";section2.style.outline="none";section2.style.margin="0 6px 0 6px";section2.style.verticalAlign="baseline";section2.style.display="inline-block";section2.style.padding="0px 0 0px 5px";section2.style.fontSize="12px";section2.onchange=onToolbarWidgetChange;section2.classList.add("nrows-to-show-dropdown");var isAllAdded=false,text;NROW_OPTIONS.forEach(function(x){text=VizUtil.getMessage(PivotTableGenerator._lang,x.label);if(pdata.rowsFetched<=x.value){if(isAllAdded){return}else{text=fmtr(pdata.rowsFetched);if(pdata.rowsFetched<nrowsToShow){nrowsToShow=x.value}isAllAdded=true}}op=_document.createElement("option");op.textContent=text;op.setAttribute("value",x.value);if(x.value===nrowsToShow){op.setAttribute("selected","selected")}section2.appendChild(op)})}else{section2=_document.createElement("span");section2.textContent=fmtr(pdata.rowsFetched);if(loc!=="ja"){section2.style.marginRight="3px"}section2.style.verticalAlign="baseline";section2.style.display="inline-block";section2.style.fontSize="12px"}section3=_document.createElement("span");section3.textContent=VizUtil.getMessage(loc,"table.toolbar.section3");section3.style.marginRight="3px";section3.style.verticalAlign="baseline";section3.style.display="inline-block";section3.style.fontSize="12px";section4=_document.createElement("span");section4.textContent=fmtr(pdata.originalRowSize);if(loc!=="ja"){section4.style.marginRight="3px"}section4.style.verticalAlign="baseline";section4.style.display="inline-block";section4.style.fontSize="12px";section5=_document.createElement("span");section5.textContent=VizUtil.getMessage(loc,"table.toolbar.section5");section5.style.marginRight="3px";section5.style.verticalAlign="baseline";section5.style.display="inline-block";section5.style.fontSize="12px";section6=_document.createElement("span");section6.textContent=fmtr(pdata.colh.length);if(loc!=="ja"){section6.style.marginRight="3px"}section6.style.verticalAlign="baseline";section6.style.display="inline-block";section6.style.fontSize="12px";section7=_document.createElement("span");section7.textContent=VizUtil.getMessage(loc,"table.toolbar.section7");if(loc!=="ja"){section7.style.marginRight="3px"}section7.style.verticalAlign="baseline";section7.style.display="inline-block";section7.style.fontSize="12px";section8=_document.createElement("span");section8.textContent=fmtr(pdata.originalColSize);if(loc!=="ja"){section8.style.marginRight="3px"}section8.style.verticalAlign="baseline";section8.style.display="inline-block";section8.style.fontSize="12px";section9=_document.createElement("span");section9.textContent=VizUtil.getMessage(loc,"table.toolbar.section9");section9.style.marginRight="3px";section9.style.verticalAlign="baseline";section9.style.display="inline-block";section9.style.fontSize="12px";section10=_document.createElement("span");section10.textContent=VizUtil.getMessage(loc,"table.toolbar.section10");section10.style.marginRight="3px";section10.style.verticalAlign="baseline";section10.style.display="inline-block";section10.style.fontSize="12px";if(loc==="ja"){toolbar.appendChild(section1);if(showNumRowLov){toolbar.appendChild(section4);toolbar.appendChild(section5)}toolbar.appendChild(section2);toolbar.appendChild(section3);if(pdata.colh.length<pdata.originalColSize){toolbar.appendChild(section8);toolbar.appendChild(section9)}toolbar.appendChild(section6);toolbar.appendChild(section7);toolbar.appendChild(section10)}else{toolbar.appendChild(section1);toolbar.appendChild(section2);if(showNumRowLov){toolbar.appendChild(section3);toolbar.appendChild(section4)}toolbar.appendChild(section5);toolbar.appendChild(section6);if(pdata.colh.length<pdata.originalColSize){toolbar.appendChild(section7);toolbar.appendChild(section8)}toolbar.appendChild(section9);toolbar.appendChild(section10)}return toolbar};var elToolbarContent=renderToolbar(viz,_document,pdata);if(elToolbarContent){elToolbar.appendChild(elToolbarContent);elToolbar.classList.remove("hidden")}else{elToolbar.textContent="";elToolbar.classList.add("hidden")}voffset+=elToolbar.clientHeight;var infoMsgArr=[];var tFmtr=d3.format(",");if(viz.marker!=="table"||viz.showNRowsToShowOptionInToolbar!=="on"){if(pdata.data.length<pdata.originalRowSize){infoMsgArr.push(tFmtr(pdata.data.length)+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.rows.of")+tFmtr(pdata.originalRowSize)+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.total.rows"))}if(pdata.colh.length<pdata.originalColSize){infoMsgArr.push(tFmtr(pdata.colh.length+pdata.numRowh)+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.cols.of")+tFmtr(pdata.originalColSize+pdata.numRowh)+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.total.cols"))}}var isShowDetails=viz.dataCacheId&&viz.dataCacheId===".detail.table";if(isShowDetails&&viz){var _numOfRows=viz._numOfRows;if(!_numOfRows){_numOfRows=d3.format(",")(pdata.data.length)}infoMsgArr=[];elMetainfo.textContent=_numOfRows+" "+VizUtil.getMessage(PivotTableGenerator._lang,_numOfRows==="1"?"row":"rows");elMetainfo.style.fontSize="13px";elMetainfo.style.color="#4d4d4d";elMetainfo.style.transform="translateY(-2px)"}else if(!(isPivot||isSummaryTable)&&pdata.data.length>=pdata.originalRowSize&&pdata.colh.length>=pdata.originalColSize){infoMsgArr=[]}if(elToolbarContent){infoMsgArr=[]}if(infoMsgArr.length>0){elMetainfo.textContent=VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.prefix")+infoMsgArr.join(", ")+VizUtil.getMessage(PivotTableGenerator._lang,"pivot.metrics.suffix")}else{elPivotView.style.marginTop="0px";if(!isShowDetails){elMetainfo.classList.add("hidden")}}voffset+=elMetainfo.clientHeight;if(viz.title){elTitle.textContent=viz.title;if(viz.titleFontSize){elTitle.style.fontSize=viz.titleFontSize+"px"}elTitle.classList.remove("hidden");voffset+=45}else{elTitle.textContent="";elTitle.classList.add("hidden")}if(viz.colh0&&!hideDataCells){elColTitle.textContent=translateColumn(viz.colh0Title||viz.colh0.name);var colh0TitleFontSize=masterFontSize||viz.colh0TitleFontSize;if(colh0TitleFontSize){elColTitle.style.fontSize=colh0TitleFontSize+"px"}elColTitle.classList.remove("hidden");voffset+=20}else{elColTitle.textContent="";elColTitle.classList.add("hidden")}if(voffset>0){elPivotView.style.height=" calc( 100% - "+voffset+"px )"}var elRow,elCell,elCellText,elLink;var getMeasureStr=function(coldef){if(!coldef){return""}else if(coldef.title){return coldef.title}else{var s=!coldef.column?NUMROWS_COL_LABEL:coldef.column.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:translateColumn(coldef.column.name);if(colh0ShowFuncName&&s!==NUMROWS_COL_LABEL&&coldef.column.type!==VizUtil.TYPE_CUSTOM){s+=" ("+VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[coldef.column.func]||coldef.column.func)+")"}return s}};var onColumnHeaderClickHandler=function(idx){if(_sortIdx===idx){_sortDir=_getNextSortDir(_sortDir)}else{_sortIdx=idx;_sortDir=_SORT_DESC}if(onPivotSortCallback){onPivotSortCallback(_sortIdx,_sortDir)}PivotTableGenerator.render(viz,data,elTarget,{top:_scroll.top,left:_scroll.left
},null,PivotTableGenerator._lang,null,null,null,onPivotSortCallback,onTableColumnConfigClickCallback,onPropUpdateCallback)};var renderColHeader=function(targetElem,addRightPaddingForScollbar){elRow=_document.createElement("div");elRow.classList.add("pivot-row");targetElem.appendChild(elRow);var style=null,color=null,bgcolor=null;pdata.rowhCols.forEach(function(c,cidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","row-header");if(viz["rowh"+cidx+"HideCells"]){elCell.style.display="none"}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}if(isSummaryTable){style=pdata.rowhColDefs[cidx].column.headerFontStyle;if(style){if(!/bold/.test(style)){elCell.style.fontWeight="normal"}if(/italic/.test(style)){elCell.style.fontStyle="italic"}}color=pdata.rowhColDefs[cidx].column.headerFontColor;if(color){elCell.style.color=color}bgcolor=pdata.rowhColDefs[cidx].column.headerBackgroundColor;if(bgcolor){elCell.style.backgroundColor=bgcolor}}elCellText=_document.createElement("div");elCellText.classList.add("pivot-cell-text");elCell.appendChild(elCellText);elCellText.textContent=translateColumn(pdata.rowhColDefs[cidx].title||c);elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){_$(elCell).balloon({contents:elCell.textContent})}});if(!hideDataCells){pdata.colh.forEach(function(c,idx){var sortEnabled=_sortDir!==_SORT_NONE&&idx===_sortIdx;elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");if(idx>COL_INDEX_THRESHOLD_FOR_THUMB){elCell.setAttribute("data-html2canvas-ignore","true")}if(sortEnabled){elCell.classList.add("with-sort")}elCell.classList.add(getColAlign(idx));var w=viz.meas0CellWidth;if(isSummaryTable){w=pdata.measColDefs[idx].cellWidth}if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}if(isSummaryTable){style=pdata.measColDefs[idx].column.headerFontStyle;color=pdata.measColDefs[idx].column.headerFontColor;bgcolor=pdata.measColDefs[idx].column.headerBackgroundColor}else if(isTable){style=pdata.tcolColDefs[idx].column.headerFontStyle;color=pdata.tcolColDefs[idx].column.headerFontColor;bgcolor=pdata.tcolColDefs[idx].column.headerBackgroundColor}else{style=null;color=null}if(style){if(!/bold/.test(style)){elCell.style.fontWeight="normal"}if(/italic/.test(style)){elCell.style.fontStyle="italic"}}if(color){elCell.style.color=color}if(bgcolor){elCell.style.backgroundColor=bgcolor}elCellText=_document.createElement("div");elCell.appendChild(elCellText);elCellText.classList.add("pivot-cell-text");if(isPivot||isSummaryTable){elCellText.textContent=viz.colh0?VizUtil.isEmpty(c)?"":pdata.colhColDefs&&pdata.colhColDefs.length>0&&pdata.colhColDefs[0].column&&pdata.colhColDefs[0].column.isDate&&c==="NA"?"(NA)":c:getMeasureStr(pdata.measColDefs[idx])}else{elCellText.textContent=VizUtil.isEmpty(c)?"":c}if(sortEnabled){var filterClass=color?"filter-"+COLOR_CLASS_MAP[color]:"filter-default";elCellText.innerHTML=elCellText.innerHTML+(_sortDir===_SORT_DESC?' <i class="icon-sort-direction-desc '+filterClass+'"></i>':' <i class="icon-sort-direction-asc '+filterClass+'"></i>')}if(onTableColumnConfigClickCallback&&!(viz["tcol"+idx]&&viz["tcol"+idx].hideEditIcon===true)){var elConfigIcon=_document.createElement("i");elConfigIcon.style.paddingLeft="5px";elConfigIcon.style.cursor="pointer";elConfigIcon.style.verticalAlign="top";elConfigIcon.classList.add("fal","fa-edit","column-header-config");elConfigIcon.onclick=onTableColumnConfigClickCallback.bind(null,viz["tcol"+idx]);elCell.style.textOverflow="unset";elCellText.style.display="inline-block";elCellText.style.width="unset";elCellText.style.maxWidth="calc( 100% - 20px )";elCell.appendChild(elConfigIcon)}elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){_$(elCell).balloon({contents:elCell.textContent})}if(!onTableColumnConfigClickCallback){_$(elCell).click(onColumnHeaderClickHandler.bind(this,idx))}else{elCell.style.cursor="unset"}});if((isPivot||isSummaryTable)&&pdata.rowTotals&&pdata.rowTotals.length>0){var rowTotalIdx=pdata.colh.length;elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");elCell.classList.add(getColAlign());if(pdata.colh.length>COL_INDEX_THRESHOLD_FOR_THUMB){elCell.setAttribute("data-html2canvas-ignore","true")}var w=viz.meas0CellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}elCellText=_document.createElement("div");elCell.appendChild(elCellText);elCellText.classList.add("pivot-cell-text");elCellText.textContent=viz.pivotTotalTitle||VizUtil.getMessage(PivotTableGenerator._lang,"Total");if(_sortDir!==_SORT_NONE&&rowTotalIdx===_sortIdx){elCellText.innerHTML=elCellText.innerHTML+(_sortDir===_SORT_DESC?' <i class="icon-sort-direction-desc"></i>':' <i class="icon-sort-direction-asc"></i>')}elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){_$(elCell).balloon({contents:elCell.textContent})}_$(elCell).click(onColumnHeaderClickHandler.bind(this,rowTotalIdx))}}if(addRightPaddingForScollbar){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","header","col-header");elCell.style.minWidth=SCROLL_BAR_WIDTH+"px";elCell.style.width=SCROLL_BAR_WIDTH+"px";elCell.style.padding="0px";elCell.style.border="0px";elRow.appendChild(elCell)}};renderColHeader(elPivot);renderColHeader(elPivotColHeader,true);var disableDecimalFormatting=!!viz.disableDecimalFormatting;var numDecimalDigits=viz.numDecimalDigits;var useThousandSeparator=viz.useThousandSeparator!=="off";var numFormatter=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(numDecimalDigits,true)?2:numDecimalDigits,useThousandSeparator,VizUtil.isEmpty(numDecimalDigits,true));var customNumFormatter=null;var formatValue=function(v,prefix,suffix){if(!numFormatter&&!customNumFormatter){return v}if(v==="Inf"||v==="-Inf"){return v}else if(VizUtil.isEmpty(v)||v===""){return""}var s=customNumFormatter?customNumFormatter(v):numFormatter(v);if(s.startsWith("-")){return"-"+prefix+s.replace(/^-/,"")+suffix}else{return prefix+s+suffix}};var formatRowHeaderValue=function(v,prefix,suffix){if(customNumFormatter){if(/ - /.test(v)){return v.split(" - ").map(function(x){return formatValue(x,prefix,suffix)}).join(" - ")}else{return formatValue(v,prefix,suffix)}}return v};var setupColumnFormat=function(col,idx){if(col){var isNumeric=VizUtil.returnsNumericValue(col.column);var useGradientPalette=isNumeric&&!col.option.startsWith("rowh");if(isNumeric){col.column.prefix=VizUtil.getValuePrefix(col.column.numberFormatting,col.column.currencySymbol,viz.marker)||"";col.column.suffix=VizUtil.getValueSuffix(col.option.startsWith("meas")?viz["meas"+idx+"WindowFunc"]:null,col.column.func,col.column.numberFormatting,viz.marker)||""}if(!VizUtil.isEmpty(col.column.numDecimalDigits,true)||col.column.useThousandSeparator){col.column.customNumFormatter=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(col.column.numDecimalDigits,true)?2:col.column.numDecimalDigits,col.column.useThousandSeparator!=="off",VizUtil.isEmpty(col.column.numDecimalDigits,true))}if(col.column.formattingType==="bar"&&pdata.extents[idx]){col.column.posColor=col.column.positiveColor?chroma(col.column.positiveColor).alpha(parseFloat(col.column.opacity||"1")):"rgba(153, 228, 245, 0.6)";col.column.negColor=col.column.negativeColor?chroma(col.column.negativeColor).alpha(parseFloat(col.column.opacity||"1")):"rgba(247, 160, 153, 0.6)"}else if(col.column.formattingType==="color"){var name=col.column.colorPalette||(useGradientPalette?"Blues":"default");var cpl=VizUtil.QUANT_COLOR_PALETTES_HASH[name].color.slice();if(col.column.colorPalette==="custom"&&col.column.customColorPalette){cpl=col.column.customColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice()}if(col.column.reverseColorPalette==="on"){cpl.reverse()}if(!VizUtil.isCategoricalColorPalette(name)&&useGradientPalette){col.column.scale=chroma.scale(cpl).correctLightness().domain(pdata.extents[idx])}else{col.column.scale=d3.scale.ordinal().range(cpl)}}}};if(isTable){pdata.tcolColDefs.forEach(setupColumnFormat)}else if(isSummaryTable){pdata.measColDefs.forEach(setupColumnFormat);pdata.rowhColDefs.forEach(setupColumnFormat)}var canOmitLabel=function(rowhdata,ridx,rhcidx){var v=true;for(var i=0;i<=rhcidx;i++){v=v&&rowhdata[ridx-1][i]===rowhdata[ridx][i]}return v};var isEndOfGroup=function(rowhdata,ridx,rhcidx){if(rowhdata.length-1<=ridx){return true}var v=true;for(var i=0;i<=rhcidx;i++){v=v&&rowhdata[ridx+1][i]===rowhdata[ridx][i]}return!v};pdata.data.forEach(function(row,ridx){elRow=_document.createElement("div");elRow.classList.add("pivot-row","banded");if(ridx>ROW_INDEX_THRESHOLD_FOR_THUMB){elRow.setAttribute("data-html2canvas-ignore","true")}elRow.onclick=PivotTableGenerator.onRowClick;elPivot.appendChild(elRow);var rowclass="";if(pdata.rowh[ridx]){pdata.rowh[ridx].forEach(function(rhc,rhcidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","row-header");if(viz["rowh"+rhcidx+"HideCells"]){elCell.style.display="none"}switch(textWrap){case"auto":elCell.classList.add("wrap-responsive-width");break;case"fixed":elCell.classList.add("wrap");break;default:break}var w=pdata.rowhColDefs[rhcidx].cellWidth;if(w&&textWrap!=="auto"){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}var rowhFontSize=masterFontSize||pdata.rowhColDefs[rhcidx].fontSize;if(rowhFontSize){elCell.style.fontSize=rowhFontSize+"px"}if(pdata.rowhColDefs[rhcidx].fontStyle){elCell.style.fontWeight=/bold/.test(pdata.rowhColDefs[rhcidx].fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(pdata.rowhColDefs[rhcidx].fontStyle)?"italic":"normal"}if(rhcidx<pdata.numRowh-1){elCell.classList.add("grouped","thick")}if(pdata.numRowh===1){elCell.classList.add("thick")}if(ridx<pdata.rowh.length-1&&rhcidx<pdata.numRowh-1){if(pdata.rowh[ridx+1][rhcidx]!==rhc&&!pdata.subTotals){rowclass="bottom-border"}}if(rowclass){elCell.classList.add(rowclass)}var elCellText;var rcol=pdata.rowhColDefs[rhcidx].column;var isRcolNumeric=VizUtil.returnsNumericValue(rcol);prefix=rcol.prefix||"";suffix=rcol.suffix||"";customNumFormatter=rcol.customNumFormatter;if(ridx>0&&rhcidx<pdata.numRowh-1&&canOmitLabel(pdata.rowh,ridx,rhcidx)){elCellText=_document.createElement("span");elCellText.textContent=""}else{if(!VizUtil.isEmpty(rhc)&&rhc.length>0&&typeof rhc==="string"&&/^(http:\/\/|https:\/\/)/.test(rhc)){elCellText=_document.createElement("a");elCellText.setAttribute("href",rhc);elCellText.setAttribute("target","_blank");elCellText.textContent=rhc;elCellText.onclick=PivotTableGenerator.onLinkClick}else{elCellText=_document.createElement("span");elCellText.textContent=VizUtil.isEmpty(rhc)?"":rcol.isDate&&rhc==="NA"?"(NA)":isRcolNumeric?formatRowHeaderValue(rhc,prefix,suffix):rhc;var urlt,urltp;if(isSummaryTable){urlt=rcol.url;urltp=rcol.urlEncodeParameters==="on"}var url=PivotTableGenerator.bindUrlData(urlt,urltp,ridx,null,pdata.rowh,pdata.rowhCols,row,pdata.colh,pdata.colhCols,rhc,pdata.measCols,pdata.extraData,pdata.extraCols,isPivot,isSummaryTable);if(url){elLink=_document.createElement("a");elLink.setAttribute("href",url);elLink.setAttribute("target","_blank");elLink.onclick=PivotTableGenerator.onLinkClick;if(elCellText.textContent===""){elLink.classList.add("no-text-deco")}elLink.appendChild(elCellText);elCellText=elLink}}if(rhc&&rhc.length>10){elCellText.setAttribute("title",isRcolNumeric?formatRowHeaderValue(rhc,prefix,suffix):rhc)}}if(isSummaryTable){if(VizUtil.isEmpty(rhc)){}else{var _color;if(rcol.formattingType==="cf"){_color=PivotTableGenerator.applyConditionalFormatting(rcol.conditionalFormattings,rcol,rhc)}else if(rcol.formattingType==="color"&&rcol.scale){_color=rcol.scale(rhc)}if(_color){elCell.style[rcol.formattingTarget==="bgcolor"?"backgroundColor":"color"]=_color;if(rcol.formattingTarget==="bgcolor"&&chroma.contrast(_color,"#ffffff")>chroma.contrast(_color,"#4d4d4d")){elCell.style.color="#ffffff"}}}}elCell.appendChild(elCellText);elRow.appendChild(elCell);if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){_$(elCell).balloon({contents:elCell.textContent})}})}if(!hideDataCells){row.forEach(function(c,cidx){var tcol={};if(isTable&&pdata.tcolColDefs&&cidx<pdata.tcolColDefs.length){tcol=pdata.tcolColDefs[cidx].column||{}}else if(isSummaryTable&&pdata.measColDefs&&cidx<pdata.measColDefs.length){tcol=pdata.measColDefs[cidx].column||{}}elCell=_document.createElement("div");elCell.classList.add("pivot-cell");if(cidx>COL_INDEX_THRESHOLD_FOR_THUMB){elCell.setAttribute("data-html2canvas-ignore","true")}if(rowclass){elCell.classList.add(rowclass)}elCell.classList.add(getColAlign(cidx));var w=viz.meas0CellWidth;if(isSummaryTable||isTable){w=tcol.cellWidth}if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}var measFontSize=tcol.fontSize||meas0FontSize;if(measFontSize){elCell.style.fontSize=measFontSize+"px"}if(tcol&&tcol.fontStyle){elCell.style.fontWeight=/bold/.test(tcol.fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(tcol.fontStyle)?"italic":"normal"}if(c.length>1&&c[1]){elCell.style.backgroundColor=bgcolorPalette[c[1]];elCell.style.color=fgcolorPalette[c[1]]}if(bgcolorScale&&fgcolorScale&&!!c[0]){elCell.style.backgroundColor=bgcolorScale(c[0]);elCell.style.color=fgcolorScale(c[0])}if(isTable&&!VizUtil.isEmpty(c)&&c.length>0&&typeof c[0]==="string"&&/^(http:\/\/|https:\/\/)/.test(c[0])){elCellText=_document.createElement("a");elCellText.setAttribute("href",c[0]);elCellText.setAttribute("target","_blank");elCellText.textContent=c[0];elCellText.onclick=PivotTableGenerator.onLinkClick}else{elCellText=_document.createElement("span");var prefix="",suffix="";if(isPivot){if(measOps.length>1){if(viz["meas"+cidx]){prefix=VizUtil.getValuePrefix(viz["meas"+cidx+"NumberFormatting"],viz["meas"+cidx+"CurrencySymbol"],viz.marker)||"";suffix=VizUtil.getValueSuffix(viz["meas"+cidx+"WindowFunc"],viz["meas"+cidx].func,viz["meas"+cidx+"NumberFormatting"],viz.marker)||""}}else if(viz.meas0){prefix=VizUtil.getValuePrefix(viz.meas0NumberFormatting,viz.meas0CurrencySymbol,viz.marker)||"";suffix=VizUtil.getValueSuffix(viz.meas0WindowFunc,viz.meas0.func,viz.meas0NumberFormatting,viz.marker)||""}}else{prefix=tcol.prefix||"";suffix=tcol.suffix||"";customNumFormatter=tcol.customNumFormatter}if(VizUtil.isEmpty(c)||c.length===0){elCellText.textContent=""}else{elCellText.textContent=getColAlign(cidx)==="num-col"?formatValue(c[0],prefix,suffix):c[0];var urlt,urltp;if(isPivot){urlt=measOps.length>1?viz["meas"+cidx+"UrlTemplate"]:viz["meas0UrlTemplate"];urltp=measOps.length>1?viz["meas"+cidx+"UrlEncodeParameters"]==="on":viz["meas0UrlEncodeParameters"]==="on"}else if(isSummaryTable&&viz["meas"+cidx]){urlt=viz["meas"+cidx].url;urltp=viz["meas"+cidx].urlEncodeParameters==="on"}else{urlt=viz["tcol"+cidx+"UrlTemplate"];urltp=viz["tcol"+cidx+"urlEncodeParameters"]==="on"}var url=PivotTableGenerator.bindUrlData(urlt,urltp,ridx,cidx,pdata.rowh,pdata.rowhCols,row,pdata.colh,pdata.colhCols,c[0],pdata.measCols,pdata.extraData,pdata.extraCols,isPivot,isSummaryTable);if(url){elLink=_document.createElement("a");elLink.setAttribute("href",url);elLink.setAttribute("target","_blank");elLink.onclick=PivotTableGenerator.onLinkClick;if(elCellText.textContent===""){elLink.classList.add("no-text-deco")}elLink.appendChild(elCellText);elCellText=elLink}}}if(isTable||isSummaryTable){if(VizUtil.isEmpty(c)||c.length===0){}else{var _color;if(tcol.formattingType==="cf"){_color=PivotTableGenerator.applyConditionalFormatting(tcol.conditionalFormattings,tcol,c[0])}else if(tcol.formattingType==="color"&&tcol.scale){_color=tcol.scale(c[0])}if(_color){elCell.style[tcol.formattingTarget==="bgcolor"?"backgroundColor":"color"]=_color;if(tcol.formattingTarget==="bgcolor"&&chroma.contrast(_color,"#ffffff")>chroma.contrast(_color,"#4d4d4d")){elCell.style.color="#ffffff"}}}}if(pdata.barExtents&&pdata.barExtents[cidx]&&pdata.data.length>1&&tcol&&(tcol.formattingType==="bar"||viz.tableFormattingType==="bar"&&!tcol.formattingType||viz.tableShowBarsOnSort==="on"&&_sortDir!==_SORT_NONE&&_sortIdx===cidx)){elCellText.style.position="relative";var extent=pdata.barExtents[cidx];var scaleFunc=d3.scale.linear().domain(extent).range([10,90]);var zeroPoint=scaleFunc(0);var dataPoint=scaleFunc(c[0]);var left=c[0]<0?dataPoint+"%":zeroPoint+"%";var width=Math.abs(zeroPoint-dataPoint)+"%";var posColor=tcol.posColor||viz.tableBarPositiveColor||"rgba(153, 228, 245, 0.6)";var negColor=tcol.negColor||viz.tableBarNegativeColor||"rgba(247, 160, 153, 0.6)";var color=c[0]<0?negColor:posColor;elCell.style.position="relative";var elCellBg=_document.createElement("div");elCellBg.style.position="absolute";elCellBg.style.width=width;elCellBg.style.height="80%";elCellBg.style.top="10%";elCellBg.style.left=left;elCellBg.style.backgroundColor=color;elCellBg.style.padding="0";elCell.appendChild(elCellBg)}elCell.appendChild(elCellText);elRow.appendChild(elCell);var htmlarr=[];if(isPivot||isSummaryTable){if(elCell.textContent!==""){htmlarr.push('<div class="pivot-table-frame pivot-data-popover">');pdata.rowhCols.forEach(function(_row,_ridx){htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(translateColumn(_row));htmlarr.push(":</div>");htmlarr.push('<div class="pivot-cell value-cell">');htmlarr.push(pdata.rowh[ridx][_ridx]);htmlarr.push("</div>");htmlarr.push("</div>")});pdata.colhCols.forEach(function(_col){htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(translateColumn(_col));htmlarr.push(":</div>");htmlarr.push('<div class="pivot-cell value-cell">');htmlarr.push(pdata.colh[cidx]);htmlarr.push("</div>");htmlarr.push("</div>")});htmlarr.push('<div class="pivot-row">');htmlarr.push('<div class="pivot-cell">');htmlarr.push(pdata.numMeas===0?"(count)":translateColumn(pdata.measCols[pdata.colhCols.length===0?cidx:0]));htmlarr.push(":</div>");htmlarr.push('<div class="pivot-cell value-cell">');htmlarr.push(elCell.textContent);htmlarr.push("</div>");htmlarr.push("</div>");htmlarr.push("</div>");_$(elCell).balloon({contents:htmlarr.join(""),html:true})}}else{if(elCell.textContent.length>SHOW_BALLOON_THRESHOLD){if(elCellText.nodeName==="A"&&typeof module!=="object"){elCellText.setAttribute("title",elCellText.getAttribute("href"))}else{htmlarr.push('<div class="pivot-table-frame pivot-data-popover" style="max-width:600px">');htmlarr.push(elCell.textContent);htmlarr.push("</div>");_$(elCell).balloon({contents:htmlarr.join(""),html:true})}}}});if(isPivot&&pdata.rowTotals){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","row-total");elCell.classList.add(getColAlign());if(rowclass){elCell.classList.add(rowclass)}var w=viz.meas0CellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(meas0FontSize){elCell.style.fontSize=meas0FontSize+"px"}elCellText=_document.createElement("span");var prefix="",suffix="";if(viz.meas0){prefix=VizUtil.getValuePrefix(viz.meas0NumberFormatting,viz.meas0CurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(viz.meas0WindowFunc,viz.meas0.func,viz.meas0NumberFormatting,viz.marker)}var c=pdata.rowTotals[ridx];elCellText.textContent=VizUtil.isEmpty(c)||c.length===0||c[0]==="NA"?"":formatValue(c[0],prefix,suffix);elCell.appendChild(elCellText);elRow.appendChild(elCell)}}if(pdata.subTotals&&pdata.rowh[ridx]&&!hideDataCells){var elSubTotalRow,endOfGroupIdxs=[];pdata.rowh[ridx].forEach(function(rhc,rhcidx){if(isEndOfGroup(pdata.rowh,ridx,rhcidx)&&rhcidx!==pdata.numRowh-1){endOfGroupIdxs.push(rhcidx)}});endOfGroupIdxs.reverse();endOfGroupIdxs.forEach(function(endOfGroupIdx){elSubTotalRow=_document.createElement("div");elSubTotalRow.classList.add("pivot-row");elPivot.appendChild(elSubTotalRow);if(ridx>ROW_INDEX_THRESHOLD_FOR_THUMB){elSubTotalRow.setAttribute("data-html2canvas-ignore","true")}pdata.rowh[ridx].forEach(function(rhc,rhcidx){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","row-header","subtotal","text-col");if(rhcidx>=endOfGroupIdx){elCell.classList.add("bottom-border")}if(viz.pivotSubtotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotSubtotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotSubtotalFontStyle)?"italic":"normal"}if(rhcidx<pdata.numRowh-1){elCell.classList.add("grouped","thick")}if(pdata.numRowh===1){elCell.classList.add("thick")}if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}elSubTotalRow.appendChild(elCell);elCellText=_document.createElement("span");elCell.appendChild(elCellText);if(rhcidx===endOfGroupIdx+1){elCellText.textContent=viz.pivotSubtotalTitle||VizUtil.getMessage(PivotTableGenerator._lang,"Subtotal")}else{elCellText.textContent=""}});var subTotalValue=pdata.subTotals.find(function(st){var res=true;pdata.rowh[ridx].forEach(function(rhc,rhcidx){if(rhcidx===pdata.rowh[ridx].length-1){return}if(rhcidx>endOfGroupIdx){res=res&&st[rhcidx]===null}else{res=res&&rhc===st[rhcidx]}});return res});if(subTotalValue){var stv=subTotalValue.slice();for(var i=0;i<pdata.numRowh-1;i++){stv.shift()}stv.forEach(function(st,stidx){elCell=_document.createElement("div");elSubTotalRow.appendChild(elCell);elCell.classList.add("pivot-cell","subtotal","bottom-border");elCellText=_document.createElement("span");elCell.appendChild(elCellText);elCell.classList.add(getColAlign(stidx));if(colh0FontSize){elCell.style.fontSize=colh0FontSize+"px"}var tcol=pdata.measColDefs[stidx].column||{};prefix=tcol.prefix||"";suffix=tcol.suffix||"";customNumFormatter=tcol.customNumFormatter;if(tcol&&tcol.fontStyle){elCell.style.fontWeight=/bold/.test(tcol.fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(tcol.fontStyle)?"italic":"normal"}if(viz.pivotSubtotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotSubtotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotSubtotalFontStyle)?"italic":"normal"}elCellText.textContent=getColAlign(stidx)==="num-col"?formatValue(st,prefix,suffix):st})}})}});if(viz.pivotShowTotals==="on"&&pdata.colTotals&&pdata.data.length>0&&!hideDataCells&&(isPivot||isSummaryTable)){var v,i;if(pdata.data.length<pdata.originalRowSize){elRow=_document.createElement("div");elRow.classList.add("pivot-row");elPivot.appendChild(elRow);for(i=0;i<pdata.numRowh;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elRow.appendChild(elCell)}if(isSummaryTable||pdata.numMeas>1){for(i=0;i<pdata.numMeas;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elCell.classList.add(getColAlign(i));elCell.textContent="";elRow.appendChild(elCell)}}else{for(i=0;i<pdata.colh.length;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell");elCell.classList.add(getColAlign(i));elCell.textContent="";elRow.appendChild(elCell)}}}elRow=_document.createElement("div");elRow.classList.add("pivot-row");if(pdata.data.length>ROW_INDEX_THRESHOLD_FOR_THUMB){elRow.setAttribute("data-html2canvas-ignore","true")}elPivot.appendChild(elRow);var totals=pdata.colTotals.slice();for(i=0;i<pdata.numRowh;i++){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total","text-col");if(rowh0TotalFontSize){elCell.style.fontSize=rowh0TotalFontSize+"px"}if(viz["rowh"+i+"HideCells"]){elCell.style.display="none"}if(viz.pivotTotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotTotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotTotalFontStyle)?"italic":"normal"}elCell.textContent=i===0?viz.pivotTotalTitle||VizUtil.getMessage(PivotTableGenerator._lang,"Total"):"";elRow.appendChild(elCell)}var prefix,suffix;totals.forEach(function(total,totalidx){if(pdata.numMeas>1||isSummaryTable){v=total;for(i=0;i<pdata.numMeas;i++){if(i<pdata.measColDefs.length&&pdata.measColDefs[i]&&pdata.measColDefs[i].column){customNumFormatter=pdata.measColDefs[i].column.customNumFormatter}else{customNumFormatter=null}prefix="";suffix="";var meas=viz["meas"+i];if(meas){if(isSummaryTable){prefix=pdata.measColDefs[i].column.prefix;suffix=pdata.measColDefs[i].column.suffix}else if(isPivot){prefix=VizUtil.getValuePrefix(viz["meas"+i+"NumberFormatting"],viz["meas"+i+"CurrencySymbol"],viz.marker);suffix=VizUtil.getValueSuffix(viz["meas"+i+"WindowFunc"],meas.func,viz["meas"+i+"NumberFormatting"],viz.marker)}}elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");elCell.classList.add(getColAlign(i));if(meas0TotalFontSize){elCell.style.fontSize=meas0TotalFontSize+"px"}if(meas&&meas.fontStyle){elCell.style.fontWeight=/bold/.test(meas.fontStyle)?"bold":"normal";elCell.style.fontStyle=/italic/.test(meas.fontStyle)?"italic":"normal"}if(viz.pivotTotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotTotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotTotalFontStyle)?"italic":"normal"}if(pdata.numMeas===v.length){elCell.textContent=getColAlign(i)==="num-col"?formatValue(v.length>=i?v[i]:"",prefix,suffix):v[i]}else{elCell.textContent=getColAlign(i)==="num-col"?formatValue(v.length>=i*2?v[i*2]:"",prefix,suffix):v[i*2]}elRow.appendChild(elCell)}}else{if(totalidx<pdata.colh.length){prefix="";suffix="";if(viz.meas0){prefix=VizUtil.getValuePrefix(viz.meas0NumberFormatting,viz.meas0CurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(viz.meas0WindowFunc,viz.meas0.func,viz.meas0NumberFormatting,viz.marker)}v=total.shift();elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");elCell.classList.add(getColAlign(totalidx));if(totalidx>COL_INDEX_THRESHOLD_FOR_THUMB){elCell.setAttribute("data-html2canvas-ignore","true")}if(meas0TotalFontSize){elCell.style.fontSize=meas0TotalFontSize+"px"}if(viz.pivotTotalFontStyle){elCell.style.fontWeight=!/bold/.test(viz.pivotTotalFontStyle)?"normal":"bold";elCell.style.fontStyle=/italic/.test(viz.pivotTotalFontStyle)?"italic":"normal"}elCell.textContent=formatValue(v,prefix,suffix);elRow.appendChild(elCell)}}});if((isPivot||isSummaryTable)&&pdata.grandTotal){elCell=_document.createElement("div");elCell.classList.add("pivot-cell","total");elCell.classList.add(getColAlign());var w=viz.meas0CellWidth;if(w){elCell.style.maxWidth=w+"px";elCell.style.minWidth=w+"px";elCell.style.width=w+"px"}if(meas0FontSize){elCell.style.fontSize=meas0FontSize+"px"}elCellText=_document.createElement("span");prefix="";suffix="";if(viz.meas0){prefix=VizUtil.getValuePrefix(viz.meas0NumberFormatting,viz.meas0CurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(viz.meas0WindowFunc,viz.meas0.func,viz.meas0NumberFormatting,viz.marker)}var c=pdata.grandTotal;elCellText.textContent=VizUtil.isEmpty(c)||c.length===0||c[0]==="NA"?"":formatValue(c[0],prefix,suffix);elCell.appendChild(elCellText);elRow.appendChild(elCell)}}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:pdata,dom:elTarget.serialize()})}if(isHeadless){return}if(headerSyncDelay){setTimeout(function(){_syncHeader(elTarget);_syncTitle(elTarget);_initScrollHandler(elTarget,prevState)},headerSyncDelay)}else{_syncHeader(elTarget);_syncTitle(elTarget);_initScrollHandler(elTarget,prevState)}};PivotTableGenerator.renderSingleValue=function(viz,data,elTarget,isHeadless,onBeforeRenderingCallback){var numDecimalDigits=viz.numDecimalDigits;var useThousandSeparator=viz.useThousandSeparator!=="off";var numFormat=viz.svNumberFormatting||"number";var showInPercentage=numFormat==="percentage";var prefix="",suffix="";if(VizUtil.returnsNumericValue(viz.meas0)){prefix=VizUtil.getValuePrefix(viz.svNumberFormatting,viz.svCurrencySymbol,viz.marker);suffix=VizUtil.getValueSuffix(null,viz.meas0.func,viz.svNumberFormatting,viz.marker)}var formatValue=VizUtil.valueFormatterGenerator(viz.disableDecimalFormatting==="on"?null:VizUtil.isEmpty(numDecimalDigits,true)?2:numDecimalDigits,useThousandSeparator,VizUtil.isEmpty(numDecimalDigits,true));var value=viz.dataDefaultValue||VizUtil.getDefaultSingleValueValue(viz.meas0);var noValueFound=true;var pdata=null,v=null;if(data&&data.length>0){pdata=PivotTableGenerator.constructPivotData(viz,data);if(pdata.data.length>0&&pdata.data[0].length>0&&pdata.data[0][0].length>0){v=pdata.data[0][0][0];if(!isNaN(v)){v=parseFloat(v)}value=prefix+formatValue(v)+suffix;noValueFound=false}}var defaultFgColor="#4d4d4d";var defaultCaptionFgColor="#4d4d4d";if(noValueFound){defaultFgColor="#999999"}var iconClass=viz.singlevalueIconClass||"";var fgColor=viz.singlevalueColor||defaultFgColor;var captionFgColor=viz.singlevalueColor||defaultCaptionFgColor;var bgColor=viz.singlevalueBgColor||"#ffffff";var border=viz.singlevalueBorder||"1px solid #d7d7d7";var padding=viz.singlevaluePadding||"0px 9px 0px 0px";var innerPadding=viz.singlevalueInnerPadding||"22px";var caption=viz.displayName||viz.title||(viz.meas0.type===VizUtil.TYPE_NUMROWS?VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.NUMROWS_COL_LABEL):viz.meas0.name);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:pdata,value:value,iconClass:iconClass,fgColor:fgColor,captionFgColor:captionFgColor,bgColor:bgColor,border:border,padding:padding,innerPadding:innerPadding,caption:caption})}if(isHeadless){return}var $elBox=$(document.createElement("div"));$elBox.css({padding:padding}).attr("data-viz-type","singlevalue").addClass("single-value-box");var $elBoxInner=$(document.createElement("div"));$elBoxInner.css({padding:innerPadding,"background-color":bgColor,color:fgColor,border:border}).addClass("single-value-innerbox");var $elValue=$(document.createElement("div"));$elValue.text(value).addClass("single-value-text");if(noValueFound){$elValue.text(value).addClass("no-value")}var $elCaption=$(document.createElement("div"));$elCaption.text(caption).addClass("single-value-caption").css("color",captionFgColor);var $elIconDiv=$(document.createElement("div"));if(iconClass){var $elIcon=$(document.createElement("i"));$elIcon.addClass("fal "+iconClass+" single-value-icon").appendTo($elIconDiv)}$elBox.append($elBoxInner.append($elValue).append($elCaption));$elBox.append($elIconDiv);$elBox.appendTo(elTarget)};PivotTableGenerator.onRowClick=function(event){if(this.classList.contains("selected")){this.classList.remove("selected")}else{this.classList.add("selected")}};PivotTableGenerator.onLinkClick=function(event){if(typeof module==="object"&&module.exports){if(event){event.preventDefault();event.stopPropagation()}global._guiShell.openExternal(this.getAttribute("href"));return false}else{return true}};PivotTableGenerator.bindUrlData=function(urlTemplate,urlEncodeParameters,ridx,cidx,rowh,rowhCols,rowData,colh,colhCols,meas,measCols,extraData,extraCols,isPivot,isSummaryTable){if(!urlTemplate){return null}var ht={};if(isPivot||isSummaryTable){if(rowh&&rowhCols&&ridx<rowh.length){var v=rowh[ridx];rowhCols.forEach(function(rhc,rhcidx){ht[rhc]=v[rhcidx]})}if(measCols&&measCols.length>1&&cidx!==null){if(measCols&&measCols.length>0&&cidx<measCols.length){ht[measCols[cidx]]=meas}}else{if(colh&&colhCols&&colhCols.length>0&&cidx<colh.length){ht[colhCols[0]]=colh[cidx]}if(measCols&&measCols.length>0){ht[measCols[0]]=meas}}}else{if(colh&&rowData){colh.forEach(function(c,idx){if(idx<rowData.length){ht[c]=rowData[idx][0]}})}if(extraData&&extraData.length>ridx&&extraCols){var extraRowData=extraData[ridx];extraCols.forEach(function(c,idx){ht[c]=extraRowData[idx]})}}var res=urlTemplate.replace(/\$\{([^\}]+)\}/g,function(match,p1){return ht[p1]?urlEncodeParameters?encodeURIComponent(ht[p1]):ht[p1]:""});return res};PivotTableGenerator.constructPivotData=function(viz,data,sortIdx,sortDir){var isPivot=viz.marker==="pivot";var isTable=viz.marker==="table"
;var isSummaryTable=viz.marker==="summarytable";var _t=new Date;var rowh=[];var colh=data[1].slice();var cells=[];var extraCells=[];var extraColh=data.length>7?data[7].slice():null;var rowhCols=[];var rowhColDefs=[];var colhCols=[];var colhColDefs=[];var tcolColDefs=[];var measCols=[];var measColDefs=[];var rowhIdx=0,colhIdx=0,measIdx=0,c,i,l;var colTotals=(isPivot||isSummaryTable)&&data.length>4&&!(data[4].length===1&&data[4][0]===null)?data[4]:null;var rowTotals=(isPivot||isSummaryTable)&&data.length>5&&!(data[5].length===1&&data[5][0]===null)?data[5]:null;var grandTotal=null;var subTotals=isSummaryTable&&data.length>8&&!(data[8].length===1&&data[8][0]===null)?data[8]:null;var sortAcrossGroup=viz.pivotSortWithinGroup==="off";var measValueSeparator=viz._pivotValueSeparator||",";if(colTotals){colTotals=colTotals.map(function(d){return typeof d==="string"&&(isPivot||isSummaryTable)?d.split(measValueSeparator):[d]})}if(rowTotals){rowTotals=rowTotals.map(function(d){return typeof d==="string"&&(isPivot||isSummaryTable)?d.split(measValueSeparator):[d]});grandTotal=rowTotals.pop()}data[0].forEach(function(dataRow){cells.push(dataRow.slice())});if(data.length>6){data[6].forEach(function(dataRow){if(dataRow){extraCells.push(dataRow.slice())}})}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.rowh;i<l;i++){c=viz["rowh"+i];if(c){rowhCols.push(c.balloonDisplayName||c.name);rowhColDefs.push({option:"rowh"+i,column:JSON.parse(JSON.stringify(c)),title:c.displayName||viz["rowh"+i+"Title"],cellWidth:isSummaryTable?viz["rowh"+i].cellWidth:viz["rowh"+i+"CellWidth"],fontSize:viz["rowh"+i].fontSize||viz["rowh"+i+"FontSize"],fontStyle:viz["rowh"+i].fontStyle});rowhIdx++}}var numRowh=rowhCols.length;colh.splice(0,numRowh);if(numRowh>0){var rh;cells.forEach(function(r){rh=r.splice(0,numRowh);rowh.push(rh)})}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.colh;i<l;i++){c=viz["colh"+i];if(c){colhCols.push(c.balloonDisplayName||c.name);colhColDefs.push({option:"colh"+i,column:JSON.parse(JSON.stringify(c)),title:viz["colh"+i+"Title"]});colhIdx++}}var tableMaxNumCol=viz.tableMaxNumCol?parseInt(viz.tableMaxNumCol):VizUtil.MAX_NUMBER_OF_CONTROLS.tcol;for(i=0;i<tableMaxNumCol;i++){c=viz["tcol"+i];if(c){colhCols.push(c.name);tcolColDefs.push({option:"tcol"+i,column:JSON.parse(JSON.stringify(c))});colhIdx++}}for(i=0,l=VizUtil.MAX_NUMBER_OF_CONTROLS.meas;i<l;i++){c=viz["meas"+i];if(c){measCols.push(c.balloonDisplayName||(c.type===VizUtil.TYPE_NUMROWS?VizUtil.getMessage(PivotTableGenerator._lang,VizUtil.NUMROWS_COL_LABEL):c.name));measColDefs.push({option:"meas"+i,column:JSON.parse(JSON.stringify(c)),title:c.displayName||viz["meas"+i+"Title"],cellWidth:isSummaryTable?viz["meas"+i].cellWidth:viz.meas0CellWidth,fontSize:c.fontSize,fontStyle:c.fontStyle});measIdx++}}var numMeas=measCols.length;cells.forEach(function(dataRow){dataRow.forEach(function(d,didx){if(d===null||d===undefined){dataRow[didx]=[]}else{dataRow[didx]=typeof d==="string"&&(isPivot||isSummaryTable)?d.split(measValueSeparator):[d]}})});if((isPivot||isSummaryTable)&&measIdx>1){colh=[];for(i=0;i<measIdx;i++){colh.push("measure"+i)}cells.forEach(function(dataRow){var measArr=dataRow.pop();if(measArr.length===measIdx){for(i=0,l=measArr.length;i<l;i++){dataRow.push([measArr[i]])}}else{for(i=0,l=measArr.length;i<l;i+=2){dataRow.push([measArr[i],measArr[i+1]])}}})}var sortCol=null;if(isPivot||isSummaryTable){if(numMeas>1&&measColDefs.length>sortIdx){sortCol=measColDefs[sortIdx].column}else if(measColDefs.length>0){sortCol=measColDefs[0].column}}else if(tcolColDefs.length>sortIdx){sortCol=tcolColDefs[sortIdx].column}var sorted=PivotTableGenerator.sortPivotData(rowh,cells,rowTotals,sortIdx,sortCol,sortDir,sortAcrossGroup,extraCells);rowh=sorted.rowh;cells=sorted.cells;rowTotals=sorted.rowTotals;if(extraCells&&extraCells.length>0){extraCells=sorted.extraCells}var extents=null,barExtents=null;if(isTable){extents=[];barExtents=[];colhCols.forEach(function(colname,idx){if(!!viz["tcol"+idx]&&viz["tcol"+idx].isNumeric){var arr=[];cells.forEach(function(row){if(row[idx]&&row[idx].length>0&&!isNaN(row[idx][0])){arr.push(row[idx][0])}});extents.push(d3.extent(arr));arr.push(0);barExtents.push(d3.extent(arr))}else{extents.push(false);barExtents.push(false)}})}else if(isSummaryTable){extents=[];barExtents=[];measCols.forEach(function(colname,idx){if(viz["meas"+idx]&&VizUtil.returnsNumericValue(viz["meas"+idx])){var arr=[];cells.forEach(function(row){if(row[idx]&&row[idx].length>0&&!isNaN(row[idx][0])){arr.push(parseFloat(row[idx][0]))}});extents.push(d3.extent(arr));arr.push(0);barExtents.push(d3.extent(arr))}else{extents.push(false);barExtents.push(false)}})}if(numRowh<2||!isSummaryTable){subTotals=null}var rowsFetched=null;if(isTable&&viz.tableNRowsToShow&&viz.showNRowsToShowOptionInToolbar==="on"){rowsFetched=cells.length;var nrowsToShow=parseInt(viz.tableNRowsToShow);if(cells.length>nrowsToShow){cells=cells.filter(function(x,idx){return idx<nrowsToShow})}}console.log("Time Elapsed for pivoting data (ms): "+((new Date).getTime()-_t.getTime()));var res={colh:colh,colhCols:colhCols,colhColDefs:colhColDefs,tcolColDefs:tcolColDefs,rowh:rowh,rowhCols:rowhCols,numRowh:numRowh,rowhColDefs:rowhColDefs,measCols:measCols,measColDefs:measColDefs,numMeas:numMeas,data:cells,extraData:extraCells.length>0?extraCells:null,extraCols:extraColh,colTotals:colTotals,rowTotals:rowTotals,subTotals:subTotals,grandTotal:grandTotal,originalRowSize:data[2][0],originalColSize:data[3][0]-numRowh,extents:extents,barExtents:barExtents};if(rowsFetched){res.rowsFetched=rowsFetched}return res};PivotTableGenerator._sortDescending=function(a,b){a=a==="Inf"?Number.MAX_SAFE_INTEGER:a==="-Inf"?Number.MIN_SAFE_INTEGER+1:a;b=b==="Inf"?Number.MAX_SAFE_INTEGER:b==="-Inf"?Number.MIN_SAFE_INTEGER+1:b;return d3.descending(a,b)};PivotTableGenerator._sortAscending=function(a,b){a=a==="Inf"?Number.MAX_SAFE_INTEGER:a==="-Inf"?Number.MIN_SAFE_INTEGER+1:a;b=b==="Inf"?Number.MAX_SAFE_INTEGER:b==="-Inf"?Number.MIN_SAFE_INTEGER+1:b;return d3.ascending(a,b)};PivotTableGenerator.sortPivotData=function(rowh,cells,rowTotals,sortIdx,sortCol,sortDir,sortAcrossGroup,extraCells){if(sortDir===_SORT_NONE){return{rowh:rowh,cells:cells,rowTotals:rowTotals,extraCells:extraCells}}var newrowh=[];var newrowTotals=null;if(rowTotals){newrowTotals=[];cells.forEach(function(cellrow,idx){cellrow.push(rowTotals[idx])})}cells.forEach(function(cellrow,idx){cellrow.push(rowh[idx]);if(extraCells){cellrow._extraCells=extraCells[idx]}});var sortfunc=sortDir===_SORT_DESC?PivotTableGenerator._sortDescending:PivotTableGenerator._sortAscending;var nestedData=null,v;if(rowh.length>0&&rowh[0].length>1&&!sortAcrossGroup){nestedData=d3.nest().key(function(d){v=d[d.length-1].slice();v.pop();return v.join("::")}).entries(cells)}else{nestedData=[{key:rowh[0],values:cells}]}var isNumericColumn=sortCol?VizUtil.returnsNumericValue(sortCol):true;nestedData.forEach(function(group){group.values.sort(function(a,b){if(isNumericColumn){return sortfunc(a.length<=sortIdx||VizUtil.isEmpty(a[sortIdx])||VizUtil.isEmpty(a[sortIdx][0])||a[sortIdx][0]===""?Number.MIN_SAFE_INTEGER:isNaN(a[sortIdx][0])?a[sortIdx][0]:parseFloat(a[sortIdx][0]),b.length<=sortIdx||VizUtil.isEmpty(b[sortIdx])||VizUtil.isEmpty(b[sortIdx][0])||b[sortIdx][0]===""?Number.MIN_SAFE_INTEGER:isNaN(b[sortIdx][0])?b[sortIdx][0]:parseFloat(b[sortIdx][0]))}else{return sortfunc(a.length<=sortIdx||VizUtil.isEmpty(a[sortIdx])||VizUtil.isEmpty(a[sortIdx][0])?"":a[sortIdx][0],b.length<=sortIdx||VizUtil.isEmpty(b[sortIdx])||VizUtil.isEmpty(b[sortIdx][0])?"":b[sortIdx][0])}})});var newcells=[],newExtraCells=[];nestedData.forEach(function(group){newcells=newcells.concat(group.values)});newcells.forEach(function(cellrow){newrowh.push(cellrow.pop());newExtraCells.push(cellrow._extraCells);if(rowTotals){newrowTotals.push(cellrow.pop())}});return{rowh:newrowh,cells:newcells,rowTotals:newrowTotals,extraCells:extraCells?newExtraCells:null}};PivotTableGenerator.getRenderFunction=function(viz,data,headerSyncDelay,onLoadCallback,onErrorCallback){var func=function(props){viz.width=props.width;viz.height=props.height;var elTarget=props.elem;PivotTableGenerator.render(viz,data,elTarget,false,headerSyncDelay,null,onLoadCallback,onErrorCallback)};return func};if(typeof module==="object"&&module.exports)module.exports=PivotTableGenerator;var ROutputGenerator=function(){};ROutputGenerator.render=function(viz,data,elTarget,onLoadCallback,onErrorCallback,onBeforeRenderingCallback){try{ROutputGenerator._render(viz,data,elTarget,onBeforeRenderingCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,"Graph rendering failed.")}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};ROutputGenerator._render=function(viz,data,elTarget,onBeforeRenderingCallback){if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:data})}if(!elTarget){return}while(elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}if(data&&data.length===0){VizUtil.renderNoData(elTarget);return}var outputFile=null;if(data.outputFile&&data.outputFile.length>0){outputFile=data.outputFile[0];if(!/^data:/.test(outputFile)){if(/^[\/\\]/.test(outputFile)||/^[a-zA-Z]:/.test(outputFile)){outputFile="file://"+outputFile}outputFile=outputFile+"?cb="+Date.now()}}var elContent=document.createElement("div");elContent.style.width="100%";elContent.style.height="100%";elTarget.appendChild(elContent);var elImage=document.createElement("img");elImage.classList.add("r-output");elImage.src=outputFile;elImage.style.maxWidth="99%";elImage.style.maxHeight="99%";elImage.style.transform="translate(-50%, -50%)";elImage.style.position="relative";elImage.style.top="50%";elImage.style.left="50%";elContent.appendChild(elImage)};if(typeof module==="object"&&module.exports)module.exports=ROutputGenerator;"use strict";var PlotlyGraphGenerator=function(){this._isFacetFilterEnabled=false;this._isFacetLayoutToolEnabled=false;this._isToolbarEnabled=false;this._isToolbarHidden=false};var NA_LABEL="(NA)";var _adjustColor=function(str,ratio){var p=typeof ratio==="string"?parseFloat(ratio):ratio;var code=_getRGBACode(str);var r=parseInt(Math.max(0,Math.min(255,code.r*p)));var g=parseInt(Math.max(0,Math.min(255,code.g*p)));var b=parseInt(Math.max(0,Math.min(255,code.b*p)));var a=code.a;return"rgba("+r+","+g+","+b+","+a+")"};var _setOpacity=function(str,opacity){var p=typeof ratio==="string"?parseFloat(opacity):opacity;var code=_getRGBACode(str);return"rgba("+code.r+","+code.g+","+code.b+","+p+")"};var _getRGBACode=function(str){var s,r,g,b,a;if(/rgb/.test(str)){s=str.replace(/(rgb\(|rgba\(|\))/g,"");s=s.split(",");r=parseInt(s[0]);g=parseInt(s[1]);b=parseInt(s[2]);a=s.length>3?s[3]:1}else{s=str.replace("#","");r=parseInt(s.substring(0,2),16);g=parseInt(s.substring(2,4),16);b=parseInt(s.substring(4,6),16);a=1}return{r:r,g:g,b:b,a:a}};function calculateStackedYValue(traces){var i;for(i=0;i<traces.length;i++){traces[i]["stacky"]=traces[i]["y"].slice()}for(i=1;i<traces.length;i++){for(var j=0;j<Math.min(traces[i]["stacky"].length,traces[i-1]["stacky"].length);j++){traces[i]["stacky"][j]+=traces[i-1]["stacky"][j]}}return traces}function convertToStackedYValue(traces){calculateStackedYValue(traces);traces.forEach(function(trace){trace.origy=trace.y;trace.y=trace.stacky});return traces}var isGroupedBar=function(xCol,colorCol,layoutBarmode,traceType,numY){var isGroupedBar=!/(stack|overlay)/.test(layoutBarmode)&&traceType==="bar";if(!isGroupedBar){return false}return colorCol&&!(xCol&&xCol.name===colorCol.name)||numY>1};var constructAnnotations=function(gData,marker,xCol,colorCol,facetCol,barStyle,layoutBarmode,numY,yValueOnPlot,y1ValuePrefix,y1ValueSuffix,y2ValuePrefix,y2ValueSuffix,yValueOnPlotFontSize,yValueOnPlotThreshold,colMap){var annotationContext=null;var threshold=yValueOnPlotThreshold?parseFloat(yValueOnPlotThreshold):null;if(yValueOnPlot!=="none"){annotationContext=[];var numOfTraces=gData.length;var numOfFacets=1;if(facetCol){var _ht={};gData.forEach(function(g){_ht[g.facet]=true});numOfFacets=Object.keys(_ht).length;numOfTraces=numOfTraces/numOfFacets}var pivot=Math.floor(numOfTraces/2);var delta=.8/numOfTraces;var dateX,offset;const isGroupByMeasuresEnabled=facetCol&&facetCol.type===VizUtil.TYPE_GROUP_BY_MEASURES;gData.forEach(function(group,gidx){var isForY2Axis=group.yaxis&&/[02468]$/.test(group.yaxis);var yValuePrefix=isForY2Axis?y2ValuePrefix:y1ValuePrefix;var yValueSuffix=isForY2Axis?y2ValueSuffix:y1ValueSuffix;if(isGroupByMeasuresEnabled&&colMap[group.facet]){yValuePrefix=colMap[group.facet].valuePrefix;yValueSuffix=colMap[group.facet].valueSuffix}if(isGroupedBar(xCol,colorCol,layoutBarmode,group.type,numY)){var traceIdx=numOfFacets===1?gidx:Math.floor(gidx/numOfFacets);if(xCol){var allUnique=isAllUnique(group.x);var xidx=-1;annotationContext=annotationContext.concat(group.x.map(function(xval,idx){if(group._orderRow&&group._orderRow[idx]){return null}else{xidx++}offset=traceIdx-pivot;if(numOfTraces%2===0){offset+=.5}var xValue=xidx+offset*delta;if(VizUtil.returnsNumericValue(xCol)&&xCol.func!=="ascategory"){xValue=xval+offset*delta}else if(VizUtil.returnsDateValue(xCol)){dateX=Date.parse(xval.indexOf(" ")===-1?xval+" 00:00:00":xval);var datefunc=allUnique?"":xCol.func;switch(datefunc){case"rtoyear":xValue=dateX+offset*delta*31536e6;break;case"rtoq":xValue=dateX+offset*delta*7776e6;break;case"rtomon":xValue=dateX+offset*delta*2592e6;break;case"rtoweek":xValue=dateX+offset*delta*6048e5;break;case"rtoday":xValue=dateX+offset*delta*864e5;break;case"rtohour":xValue=dateX+offset*delta*36e5;break;case"rtomin":xValue=dateX+offset*delta*6e5;break;case"rtosec":xValue=dateX+offset*delta*1e3;break;default:xValue=dateX+offset*delta;break}}var yValue=group.stacky?group.stacky[idx]:group.y[idx];return{x:xValue,y:yValue,origy:group.y[idx],text:yValuePrefix+formatValue(group.y[idx])+yValueSuffix,xanchor:"center",yanchor:yValueOnPlot,xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",showarrow:false}}).filter(function(ctx){if(ctx===null||VizUtil.isEmpty(ctx.origy)){return false}if(VizUtil.isEmpty(threshold)){return true}if(typeof ctx.origy!=="number"){return true}return ctx.origy>=threshold}))}else{offset=traceIdx-pivot;if(numOfTraces%2===0){offset+=.5}var xValue=0+offset*delta;if(!VizUtil.isEmpty(group.y[0])&&(!threshold||typeof group.y[0]!=="number"||group.y[0]>=threshold)){annotationContext=annotationContext.concat([{x:xValue,y:group.stacky?group.stacky[0]:group.y[0],text:group.y[0]===0?"":yValuePrefix+formatValue(group.y[0])+yValueSuffix,xanchor:"center",yanchor:yValueOnPlot,xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",showarrow:false}])}}}else{if(xCol){annotationContext=annotationContext.concat(group.x.map(function(xval,idx){if(group._orderRow&&group._orderRow[idx]){return null}return{x:xval,y:group.stacky?group.stacky[idx]:group.y[idx],origy:group.y[idx],text:group.y[idx]===0?"":yValuePrefix+formatValue(group.y[idx])+yValueSuffix,xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",xanchor:"center",yanchor:yValueOnPlot,showarrow:false}}).filter(function(ctx){if(ctx===null||VizUtil.isEmpty(ctx.origy)){return false}if(VizUtil.isEmpty(threshold)){return true}if(typeof ctx.origy!=="number"){return true}return ctx.origy>=threshold}))}else if(group.y&&group.y.length>0){if(!VizUtil.isEmpty(group.y[0])&&(!threshold||typeof group.y[0]!=="number"||group.y[0]>=threshold)){annotationContext=annotationContext.concat([{x:0,y:group.stacky?group.stacky[0]:group.y[0],text:group.y[0]===0?"":yValuePrefix+formatValue(group.y[0])+yValueSuffix,xanchor:"center",yanchor:yValueOnPlot,xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",showarrow:false}])}}}});annotationContext=annotationContext.filter(function(x){return!!x});if(yValueOnPlotFontSize){annotationContext.forEach(function(ctx){ctx.font={size:yValueOnPlotFontSize}})}}return annotationContext};var isAllUnique=function(arr){var i=0,l=0,v=arr[0];for(i=0,l=arr.length;i<l;i++){if(v!==arr[i]){return false}}return true};var countNumberOfBars=function(gData){if(!gData){return 0}var o={};gData.forEach(function(g){if(g.x){g.x.forEach(function(x){o[x]=true})}});return Object.keys(o).length};var makeArrayUnique=function(arr){var h={},res=[];arr.forEach(function(i){if(!h[i]){res.push(i);h[i]=true}});return res};var isAllNull=function(arr){var i=0,l=0,isAllNull=true;for(i=0,l=arr.length;i<l;i++){if(arr[i]!==null){isAllNull=false;break}}return isAllNull};var isAllEmpty=function(arr){var i=0,l=0,isAllEmpty=true;for(i=0,l=arr.length;i<l;i++){if(arr[i]!==null&&arr[i]!==undefined){isAllEmpty=false;break}}return isAllEmpty};var isAllNaN=function(arr){var i=0,l=0,isAllNaN=true;for(i=0,l=arr.length;i<l;i++){if(!isNaN(arr[i])){isAllNaN=false;break}}return isAllNaN};var isArray=function(o){return Object.prototype.toString.call(o)==="[object Array]"};var REFLINE_DATA_POINT=30;var consolidateRefLines=function(gReflineLayerData){var hash={},id=null,d=null;gReflineLayerData.forEach(function(g){id=g.yaxis||"y";d=hash[id];if(!d){hash[id]=g}else{if(g.x&&isArray(g.x)&&d.x){d.x=d.x.concat(g.x)}if(g.y&&isArray(g.y)&&d.y){d.y=d.y.concat(g.y)}if(g.z&&isArray(g.z)&&d.z){d.z=d.z.concat(g.z)}if(g.text&&isArray(g.text)&&d.text){d.text=d.text.concat(g.text)}}});var gData=Object.keys(hash).map(function(key){var g=hash[key];g.visible=true;if(!g.text||g.skipRecalc){return g}if(g.customdata){g.customdata.text=g.text}var text="";g.text.forEach(function(t){if(t&&t.length>text.length){text=t}});g.text=text;return g});return gData};var recalculateRefLineData=function(viz,gRefLineLayerData,layout,formatRefLineValueHash){if(!viz.x){return}if(!VizUtil.returnsNumericValue(viz.x)||viz.x.func==="ascategory"){gRefLineLayerData.forEach(function(g){if(!g||!g.x||g.x.length===0||g.skipRecalc){return}var hash={},newx=[],newy=[],newtext=[];g.x.forEach(function(xval,idx){if(!VizUtil.isEmpty(xval)){if(!hash[xval]){newx.push(xval);hash[xval]=[]}hash[xval].push({y:g.y[idx],text:g.customdata.text&&g.customdata.text.length>idx?g.customdata.text[idx]:null})}});var yvals,tvals;g.x=newx;g.y=newx.map(function(xval){yvals=hash[xval].filter(function(v){return!VizUtil.isEmpty(v.y)}).map(function(v){return v.y});if(yvals.length>0){return yvals[0]}else{return null}});g.text=newx.map(function(xval){tvals=hash[xval].filter(function(v){return!VizUtil.isEmpty(v.y)}).map(function(v){return v.text});if(tvals.length>0){return tvals[0]}else{return null}});var reflineGroup=viz[(g.customdata?g.customdata.yOp||"y":"y")+"ReflineGroup"];if(viz.facet&&(viz.facetSyncXAxis||VizUtil.getDefaultSyncXAxis(viz.marker))==="off"||/^(xaxis|xaxis\+facet)$/.test(reflineGroup)){newx=[],newy=[],newtext=[];g.x.forEach(function(v,idx){if(!VizUtil.isEmpty(g.y[idx])){newx.push(v);newy.push(g.y[idx]);newtext.push(g.text[idx])}});g.x=newx;g.y=newy;g.text=newtext}if(!/xaxis/.test(reflineGroup)){yvals=g.y.filter(function(v){return!VizUtil.isEmpty(v)});tvals=g.text.filter(function(v){return!VizUtil.isEmpty(v)});if(yvals.length>0){g.y=g.y.map(function(){return yvals[0]});g.text=g.text.map(function(){return tvals[0]})}}})}else{gRefLineLayerData.forEach(function(g){if(!g||!g.x||g.x.length===0||g.skipRecalc){return}if(/xaxis/.test(viz[(g.customdata?g.customdata.yOp||"y":"y")+"ReflineGroup"])){return}var isDiagonal=g.customdata&&g.customdata.type==="diagonal";var range;if(g.xaxis&&layout[g.xaxis.replace(/^x/,"xaxis")].range){range=layout[g.xaxis.replace(/^x/,"xaxis")].range}else{range=d3.extent(g.x);range[0]=range[0]-Math.abs(range[1]-range[0])*.04;range[1]=range[1]+Math.abs(range[1]-range[0])*.04}var step=Math.abs(range[1]-range[0])/100;var x=[],y=[],text=[],yval=null,tval=null,i;for(i=0;i<g.x.length;i++){if(g.x[i]!==null&&g.y[i]!==null){yval=g.y[i];tval=g.customdata.text&&g.customdata.text.length>i?g.customdata.text[i]:null;break}}for(i=0;i<100;i++){x.push(range[0]+step*i);y.push(isDiagonal?range[0]+step*i:yval);if(!isDiagonal){text.push(tval)}}g.x=x;g.y=y;if(!isDiagonal){g.text=text}})}gRefLineLayerData.forEach(function(g){delete g.customdata.text;if(g.skipRecalc){return}var isDiagonal=g.customdata&&g.customdata.type==="diagonal";if(!isDiagonal){return}var yOp=g.customdata?g.customdata.yOp||"y":"y";var formatter=formatRefLineValueHash[yOp].formatter;var prefix=formatRefLineValueHash[yOp].prefix;var suffix=formatRefLineValueHash[yOp].suffix;var hideValueFromBalloon=formatRefLineValueHash[yOp].hideValueFromBalloon;g.text=g.y.map(function(v){if(hideValueFromBalloon){return g.name||""}return(g.name?g.name+": ":"")+prefix+formatter(v)+suffix})})};var recalculateVRefLineData=function(viz,gVRefLineLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis){if(!viz.y){return}if(!VizUtil.returnsNumericValue(viz.y)||viz.y.func==="ascategory"){gVRefLineLayerData.forEach(function(g){if(!g||!g.y||g.y.length===0||g.skipRecalc){return}var hash={},newx=[],newy=[],newtext=[];g.y.forEach(function(yval,idx){if(!VizUtil.isEmpty(yval)){if(!hash[yval]){newy.push(yval);hash[yval]=[]}hash[yval].push({x:g.x[idx],text:g.customdata.text&&g.customdata.text.length>idx?g.customdata.text[idx]:null})}});var xvals,tvals;g.y=newy;g.x=newy.map(function(yval){xvals=hash[yval].filter(function(v){return!VizUtil.isEmpty(v.x)}).map(function(v){return v.x});if(xvals.length>0){return xvals[0]}else{return null}});g.text=newy.map(function(yval){tvals=hash[yval].filter(function(v){return!VizUtil.isEmpty(v.x)}).map(function(v){return v.text});if(tvals.length>0){return tvals[0]}else{return null}});var isGroupByMeasuresEnabled=viz.facet&&viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES;if(viz.facet&&(viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(viz.marker,isGroupByMeasuresEnabled))==="off"){newx=[],newy=[],newtext=[];g.y.forEach(function(v,idx){if(!VizUtil.isEmpty(g.x[idx])){newx.push(g.x[idx]);newy.push(v);newtext.push(g.text[idx])}});g.x=newx;g.y=newy;g.text=newtext}if(!/yaxis/.test(viz.xReflineGroup)){xvals=g.x.filter(function(v){return!VizUtil.isEmpty(v)});tvals=g.text.filter(function(v){return!VizUtil.isEmpty(v)});if(xvals.length>0){g.x=g.x.map(function(){return xvals[0]});g.text=g.text.map(function(){return tvals[0]})}}})}else{gVRefLineLayerData.forEach(function(g){if(!g||!g.y||g.y.length===0||g.skipRecalc){return}if(/yaxis/.test(viz.xReflineGroup)){return}var range;var targetYProp=g.yaxis?g.yaxis.replace(/^y/,"yaxis"):"yaxis";if(g.yaxis&&layout[targetYProp].range){range=layout[targetYProp].range;var rext=d3.extent(g.y);if(/^(bar|errbar)$/.test(viz.marker)){if(rext[0]<=0&&rext[1]<=0){range[1]=0}else if(rext[0]>=0&&rext[1]>=0){range[0]=0}}}else{var includeZero=false;if(viz.yAxisIncludeZero){includeZero=viz.yAxisIncludeZero==="on"}else{includeZero=!/^(scatter|bubble)$/.test(viz.marker)}range=includeZero?d3.extent([0].concat(g.stackyExt||g.y)):d3.extent(g.stackyExt||g.y);range[1]=range[1]+Math.abs(range[1]-range[0])*.04}if(viz.marker==="hist"){range[0]=0;if(viz.histBarStyle==="stack"){range[1]=100}}var step=Math.abs(range[1]-range[0])/100;var x=[],y=[],text=[],xval=null,tval=null,i;for(i=0;i<g.y.length;i++){if(g.x[i]!==null&&g.y[i]!==null){xval=g.x[i];tval=g.customdata.text&&g.customdata.text.length>i?g.customdata.text[i]:null;break}}for(i=0;i<100;i++){x.push(xval);y.push(range[0]+step*i);text.push(tval)}g.x=x;g.y=y;g.text=text})}gVRefLineLayerData.forEach(function(g){delete g.customdata.text;if(Object.keys(g.customdata).length===0&&!Array.isArray(g.customdata)){delete g.customdata}})};var adjustYAxisRangeForVRefLine=function(viz,gVRefLineLayerData,layout,colsOn2ndAxis){if(!viz.y||!colsOn2ndAxis||colsOn2ndAxis.length===0||!VizUtil.returnsNumericValue(viz.y)||viz.y.func==="ascategory"||viz.marker!=="bar"){return}gVRefLineLayerData.forEach(function(g){var targetYProp=g.yaxis?g.yaxis.replace(/^y/,"yaxis"):"yaxis";if(!layout[targetYProp].range){layout[targetYProp].range=d3.extent(g.y)}})};var calculateStackBarRanges=function(viz,gData,gVRefLineLayerData){var _ht={},stacky,stackyExt;if(viz.facet){gData.forEach(function(g){if(!_ht[g.facet]){_ht[g.facet]=[]}_ht[g.facet].push(g)});Object.keys(_ht).forEach(function(key){var group=_ht[key];calculateStackedYValue(group);stacky=group.map(function(d){return d.stacky});stackyExt=d3.extent(d3.merge(stacky));group.stackyExt=stackyExt});gVRefLineLayerData.forEach(function(g){if(_ht[g.facet]&&_ht[g.facet].stackyExt){g.stackyExt=_ht[g.facet].stackyExt}})}else{calculateStackedYValue(gData);stacky=gData.map(function(d){return d.stacky});stackyExt=d3.extent(d3.merge(stacky));gVRefLineLayerData.forEach(function(d){d.stackyExt=stackyExt})}};var recalculateDiagonalRefLineData=function(reflineGroup){if(!reflineGroup||reflineGroup.customdata.type!=="diagonal"){return reflineGroup}var xrange=d3.extent(reflineGroup.x);var yrange=d3.extent(reflineGroup.y);xrange[0]=xrange[0]-Math.abs(xrange[1]-xrange[0])*.04;xrange[1]=xrange[1]+Math.abs(xrange[1]-xrange[0])*.04;var step=Math.abs(xrange[1]-xrange[0])/100;var x=[],y=[],v;for(var i=0;i<100;i++){v=xrange[0]+step*i;x.push(v);y.push(v)}reflineGroup.x=x;reflineGroup.y=y};var addRefLineAnnotations=function(option,viz,gRefLineLayerData,layout){gRefLineLayerData.forEach(function(g){if(g.x.length===0||isAllEmpty(g.y)||isAllNaN(g.y)){return}if(!g._annotationData&&option==="x"&&viz.xReflineType==="constant"&&viz.xReflineLabelOnPlotArea){var d={_constant:g.x[g.x.length-1],_position:g.y[g.y.length-1]};if(viz.xReflineLabelOnPlotArea==="label"){d.text=g.name}else{d.text=g.text[0]}g._annotationData=[d]}if(g._annotationData){if(!layout.annotations){layout.annotations=[]}var data=g._annotationData.map(function(x){if(option.startsWith("x")){x.x=x._constant;x.y=x._position;x.showarrow=false;x.xref=g.xaxis||"x";x.yref=g.yaxis||"y";x.yanchor="top";x.xanchor="right";x.font={color:g.line.color||null};x.xshift=-5;x._type="vrefline";if(viz.xReflineLabelOnPlotAreaFontSize){x.font.size=viz.xReflineLabelOnPlotAreaFontSize}return x}else{return null}}).filter(function(x){return!!x});layout.annotations=layout.annotations.concat(data)}})};PlotlyGraphGenerator._constructConstantReferenceLineData=function(option,viz,gData,formatRefLineValueHash){if(viz[option+"ReflineType"]!=="constant"){return null}var color=viz[option+"ReflineColor"]||"#A6AAA9",width=viz[option+"ReflineWidth"]||1,style=viz[option+"ReflineStyle"]||"solid",formatter=formatRefLineValueHash[option].formatter,prefix=formatRefLineValueHash[option].prefix,suffix=formatRefLineValueHash[option].suffix,hideValueFromBalloon=formatRefLineValueHash[option].hideValueFromBalloon,hideFromLegend=formatRefLineValueHash[option].hideFromLegend,constantValueFromColumn=viz[option+"ReflineConstantColumn"],showLabelOnPlotArea=viz[option+"ReflineLabelOnPlotArea"]||"",axisRange=option.startsWith("x")&&viz["yAxisRange"]?viz["yAxisRange"].split(",").map(function(x){return parseFloat(x)}):null,axisIncludeZero=viz[option+"AxisRange"]||VizUtil.getDefaultAxisIncludeZero(viz.marker),id,d,hash={},globalRange={x:[],y:[],z:[]},syncAxis,legendgroup,isNumeric;var isDateConstant=VizUtil.returnsDateValue(viz[option]);var constantValuesStr=isDateConstant?viz[option+"ReflineConstantDate"]:viz[option+"ReflineConstant"];if(!constantValueFromColumn&&(!constantValuesStr||constantValuesStr.indexOf(",")===-1)){return null}var constantLabelsStr="";if(viz[option+"ReflineLabel"]){constantLabelsStr=VizUtil.getMessage(PlotlyGraphGenerator._lang,viz[option+"ReflineLabel"])}if(!isDateConstant&&!VizUtil.isReferenceLineConstantValuesValid(constantValuesStr)){return[]}var constantValues=constantValuesStr.split(",").map(function(x){return x.trim()}).filter(function(x){return!!x});if(!isDateConstant){constantValues=constantValues.map(function(x){return parseFloat(x)}).filter(function(x){return!isNaN(x)})}var _constantLabels=constantLabelsStr.split(",").map(function(x){return x.trim()}).filter(function(x){return!!x});if(_constantLabels.length===0){_constantLabels.push("")}var constantLabels=constantValues.map(function(x,idx){if(_constantLabels.length>idx){return _constantLabels[idx]}else{return _constantLabels[0]}});if(option.startsWith("x")){syncAxis=viz.facetSyncYAxis!=="off";legendgroup="vrefline";isNumeric=/^(hist|densityplot)$/.test(viz.marker)||VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"}else{syncAxis=viz.facetSyncXAxis!=="off";legendgroup="refline";isNumeric=VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory"}gData.forEach(function(g){id=g.facet||"y";d=hash[id];if(!d){d={x:[],y:[],z:[]};hash[id]=d}if(g.use2ndAxis){return}if(g.x&&isArray(g.x)&&d.x){if(isNumeric){d.x=d.x.concat(g.x);globalRange.x=globalRange.x.concat(g.x)}else{d.x=g.x;globalRange.x=g.x}}if(g.y&&isArray(g.y)&&d.y){if(isNumeric){d.y=d.y.concat(g.stacky||g.y);globalRange.y=globalRange.y.concat(g.stacky||g.y)}else{d.y=g.y;globalRange.y=g.y}}if(g.z&&isArray(g.z)&&d.z){if(isNumeric){d.z=d.z.concat(g.z);globalRange.z=globalRange.z.concat(g.z)}else{d.z=g.z;globalRange.z=g.z}}});var gReflineData=gData.map(function(g){var id=g.facet||"y",value=hash[id],data,variableData=[],constantData=[],labelData=[],annotationData=[],_constantValues=viz[constantValueFromColumn]&&!VizUtil.isEmpty(g.constantValues)?g.constantValues:constantValues,emptyLayer={showlegend:false,visible:false,mode:"lines",skipRecalc:true,customdata:[],x:[],y:[],z:[]};hash[id]=null;if(!value){return emptyLayer}if(axisRange){data=axisRange}else{if(option.startsWith("x")){data=syncAxis?globalRange.y:value.y}else{data=syncAxis?globalRange.x:value.x}if(axisIncludeZero==="on"&&isNumeric){data.push(0)}}if(isAllEmpty(data)){return emptyLayer}if(isNumeric){var range=d3.extent(data);var rangeWidth=Math.abs(range[1]-range[0]);if(!axisRange){if(option.startsWith("y")){range[0]=range[0]-rangeWidth*.04}range[1]=range[1]+rangeWidth*.04}var step=Math.abs(range[1]-range[0])/REFLINE_DATA_POINT;_constantValues.forEach(function(constantValue,idx){for(var i=0;i<=REFLINE_DATA_POINT;i++){variableData.push(range[0]+step*i);constantData.push(constantValue);labelData.push(hideValueFromBalloon?constantLabels[idx]:(constantLabels[idx]?constantLabels[idx]+": ":"")+constantValue)}if(showLabelOnPlotArea){annotationData.push({text:showLabelOnPlotArea==="label"?constantLabels[idx]:(constantLabels[idx]?constantLabels[idx]+": ":"")+constantValue,_constant:constantValue,_position:range[1]})}variableData.push(null);constantData.push(null);labelData.push(null)})}else{var newData=makeArrayUnique(data);_constantValues.forEach(function(constantValue,idx){newData.forEach(function(x){variableData.push(x);constantData.push(constantValue);labelData.push(hideValueFromBalloon?constantLabels[idx]:(constantLabels[idx]?constantLabels[idx]+": ":"")+constantValue)});if(showLabelOnPlotArea){annotationData.push({text:showLabelOnPlotArea==="label"?constantLabels[idx]:(constantLabels[idx]?constantLabels[idx]+": ":"")+constantValue,_constant:constantValue,_position:variableData[variableData.length-1]})}variableData.push(null);constantData.push(null);labelData.push(null)})}var graphLayer={line:{color:color,width:width,dash:style},name:constantLabelsStr,legendgroup:legendgroup,visible:true,mode:"lines",hoverinfo:"text",text:labelData,customdata:[],_annotationData:annotationData,skipRecalc:true};if(option.startsWith("x")){graphLayer.x=constantData;graphLayer.y=variableData}else{graphLayer.x=variableData;graphLayer.y=constantData}if(hideFromLegend){graphLayer.showlegend=false}return graphLayer});return gReflineData};var getCorrespondingYAxis=function(yaxis,isFacet){var idx=!yaxis||yaxis==="y"?1:parseInt(yaxis.replace("y",""));if(idx===2&&!isFacet){return"y"}else{return"y"+(idx%2===0?idx-1:idx+1)}};var newPlot=function(elem,gData,layout,config){try{Plotly.newPlot(elem,gData,layout,config)}catch(e){e.graphData={data:gData,layout:layout,config:config};throw e}};PlotlyGraphGenerator._convertGraphDataForScatterLineGroupedByLabel=function(gData){gData.forEach(function(d){if(!d._label||!d.text||!/^lines/.test(d.mode)){return}
var hash={},i=0,label;for(i=0;i<d._label.length;i++){label=d._label[i];if(!hash[label]){hash[label]={x:[null],y:[null],z:[null],text:[null]}}hash[label].text.push(d.text[i]);if(d.x){hash[label].x.push(d.x[i])}if(d.y){hash[label].y.push(d.y[i])}if(d.z){hash[label].z.push(d.z[i])}}var x=[],y=[],z=[],text=[],hovertext=[];Object.keys(hash).forEach(function(key){x=x.concat(hash[key].x);y=y.concat(hash[key].y);z=z.concat(hash[key].z);if(d._multiYAndColor){text=text.concat(hash[key].text.map(function(d,idx,arr){return idx===arr.length-1?d:d===null?null:""}))}else{text=text.concat(hash[key].text)}});d.text=text;if(d.x){d.x=x}if(d.y){d.y=y}if(d.z){d.z=z}})};PlotlyGraphGenerator._removeNAValues=function(gData,viz){gData.forEach(function(g){if(!g.yOp){return}if(g.y&&viz[g.yOp+"RemoveNAValues"]){PlotlyGraphGenerator._removeNAValuesFromGraphData(g)}})};PlotlyGraphGenerator._removeNAValuesFromGraphData=function(g){var x=[],y=[],text=[],customdata=[],size=[],errhigh=[],errlow=[];g.y.forEach(function(v,idx){if(!VizUtil.isEmpty(v)||g._orderRow&&g._orderRow[idx]){if(g.x&&idx<g.x.length){x.push(g.x[idx])}if(g.y&&idx<g.y.length){y.push(g.y[idx])}if(g.text&&idx<g.text.length){text.push(g.text[idx])}if(g.customdata&&idx<g.customdata.length){customdata.push(g.customdata[idx])}if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)&&idx<g.marker.size.length){size.push(g.marker.size[idx])}if(g.error_y&&g.error_y.array&&idx<g.error_y.array.length){errhigh.push(g.g.error_y.array[idx])}if(g.error_y&&g.error_y.arrayminus&&idx<g.error_y.arrayminus.length){errlow.push(g.g.error_y.arrayminus[idx])}}});g.x=x;g.y=y;g.text=text;g.customdata=customdata;if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)){g.marker.size=size}if(g.error_y&&g.error_y.array){g.error_y.array=errhigh}if(g.error_y&&g.error_y.arrayminus){g.error_y.arrayminus=errlow}};PlotlyGraphGenerator._sortGraphDataByHighlight=function(gData,scale,isReversed,sortHighlightLast){if(!scale.isHighlightColorScale){return}gData.forEach(function(g,idx,orgArr){var v=scale.getOrderByColor(g.marker.color);g.__sortIdx=v===0?idx:sortHighlightLast?orgArr.length+v:-v});gData.sort(function(a,b){return isReversed?b.__sortIdx-a.__sortIdx:a.__sortIdx-b.__sortIdx})};PlotlyGraphGenerator._removeRowsForOrder=function(gData){gData.forEach(function(g){if(g._orderRow){var x=[],y=[],text=[],customdata=[],size=[],errhigh=[],errlow=[];g._orderRow.forEach(function(v,idx){if(!v){if(g.x&&idx<g.x.length){x.push(g.x[idx])}if(g.y&&idx<g.y.length){y.push(g.y[idx])}if(g.text&&idx<g.text.length){text.push(g.text[idx])}if(g.customdata&&idx<g.customdata.length){customdata.push(g.customdata[idx])}if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)&&idx<g.marker.size.length){size.push(g.marker.size[idx])}if(g.error_y&&g.error_y.array&&idx<g.error_y.array.length){errhigh.push(g.g.error_y.array[idx])}if(g.error_y&&g.error_y.arrayminus&&idx<g.error_y.arrayminus.length){errlow.push(g.g.error_y.arrayminus[idx])}}});g.x=x;g.y=y;g.text=text;g.customdata=customdata;if(g.marker&&g.marker.size&&Array.isArray(g.marker.size)){g.marker.size=size}if(g.error_y&&g.error_y.array){g.error_y.array=errhigh}if(g.error_y&&g.error_y.arrayminus){g.error_y.arrayminus=errlow}}})};PlotlyGraphGenerator._unsyncAxis=function(gData,axis,existOrderRowOnAxis){var vaxis=axis==="x"?"y":"x",i,facets={};gData.forEach(function(g){if(!facets[g.facet]){facets[g.facet]=[]}facets[g.facet].push(g)});Object.keys(facets).forEach(function(facetName){var groups=facets[facetName];var hash={};groups.forEach(function(g){if(g[axis]&&g[axis].length>0){g[axis].forEach(function(t,idx){if(!VizUtil.isEmpty(g[vaxis][idx])){hash[t]=true}})}});groups.forEach(function(g){i=0;if(g[axis]&&g[axis].length>0){while(i<g[axis].length){if(!hash[g[axis][i]]&&(existOrderRowOnAxis||(!g._orderRow||i<g._orderRow.length&&g._orderRow[i]===false))){g[axis].splice(i,1);if(g[vaxis]&&isArray(g[vaxis])&&i<g[vaxis].length){g[vaxis].splice(i,1)}if(g.text&&isArray(g.text)&&i<g.text.length){g.text.splice(i,1)}if(g.marker&&g.marker.size&&isArray(g.marker.size)&&i<g.marker.size.length){g.marker.size.splice(i,1)}if(g.customdata&&isArray(g.customdata)&&i<g.customdata.length){g.customdata.splice(i,1)}if(g.error_y&&g.error_y.array&&isArray(g.error_y.array)&&i<g.error_y.array.length){g.error_y.array.splice(i,1)}if(g.error_y&&g.error_y.arrayminus&&isArray(g.error_y.arrayminus)&&i<g.error_y.arrayminus.length){g.error_y.arrayminus.splice(i,1)}}else{i++}}}})})};PlotlyGraphGenerator._createOrderControlLayer=function(data,viz){var res=[];var xarr=[],yarr=[],farr=[];data.forEach(function(d){xarr.push(d[viz.x.validLabel]);yarr.push(d[viz.y.validLabel]);if(viz.facet){farr.push(d[viz.facet.validLabel])}});xarr=makeArrayUnique(xarr);yarr=makeArrayUnique(yarr);farr=makeArrayUnique(farr);var xext=[],yext=[];xarr.forEach(function(xval){yarr.forEach(function(yval){xext.push(xval);yext.push(yval)})});var zeroext=xext.map(function(){return 0});var nullext=xext.map(function(){return null});if(farr.length===0){res.push({mode:"markers",name:"",showlegend:false,x:xext,y:yext,marker:{size:zeroext},hoverinfo:"skip"})}else{farr.forEach(function(facet,idx){res.push({mode:"markers",name:"",showlegend:false,x:xext,y:yext,xaxis:"x"+(idx*2+1),yaxis:"y"+(idx*2+1),marker:{size:zeroext},hoverinfo:"skip"})})}return res};var useOverlayMode=function(x,color,facet,marker){return!x&&!color||!x&&color&&marker==="violin"||x&&color&&x.name===color.name||x&&!color&&facet||color&&facet&&color.name===facet.name};var calculateRange=function(gData,targetProp,axisScale,showZero,isDate,marker,valueOnPlotProp,isFacet,barstyle,color,isMultiY,rangeTarget,topMarginRatio,bottomMarginRatio){if(targetProp==="x"&&/^(line|area|bar)$/.test(marker)){return null}rangeTarget=rangeTarget||"all";var dataArr=[];gData.forEach(function(d){if(rangeTarget==="y1"&&d.use2ndAxis){return}else if(rangeTarget==="y2"&&!d.use2ndAxis){return}if(d[targetProp]){dataArr=dataArr.concat(d[targetProp])}if(targetProp==="y"&&d.stacky&&Array.isArray(d.stacky)){dataArr=dataArr.concat(d.stacky)}if(targetProp==="y"&&d.error_y&&d.error_y.array&&d.error_y.array.length===d[targetProp].length){d[targetProp].forEach(function(v,idx){dataArr.push(v+d.error_y.array[idx]);if(d.error_y.arrayminus){dataArr.push(v-d.error_y.arrayminus[idx])}else{dataArr.push(v-d.error_y.array[idx])}})}});if(isDate){dataArr=dataArr.map(function(d){return Date.parse(d)})}if(showZero&&!isDate){dataArr.push(0)}var ext=d3.extent(dataArr);if(!ext||ext.length!==2||typeof ext[0]!=="number"||typeof ext[1]!=="number"){return null}var _topMarginRatio=.17;var _bottomMarginRatio=.17;if(targetProp!=="x"&&/^(bar|errbar)$/.test(marker)){_bottomMarginRatio=.04}if(targetProp!=="x"&&/^(hist)$/.test(marker)){_bottomMarginRatio=0}if(targetProp!=="x"&&/^(area|line)$/.test(marker)){_topMarginRatio=.04;_bottomMarginRatio=.04}if(targetProp!=="x"&&valueOnPlotProp==="bottom"){_topMarginRatio+=.01}if(topMarginRatio){_topMarginRatio=topMarginRatio}if(bottomMarginRatio){_bottomMarginRatio=bottomMarginRatio}var dataRange=Math.abs(ext[1]-ext[0]);ext[0]=ext[0]-dataRange*_bottomMarginRatio;ext[1]=ext[1]+dataRange*_topMarginRatio;if(axisScale==="log"){ext[0]=Math.log10(Math.max(0,ext[0]));ext[1]=Math.log10(Math.max(0,ext[1]))}return ext};PlotlyGraphGenerator._convertLinesMode=function(gData,layout,viz){var isCategory=layout.xaxis1?layout.xaxis1.type==="category":layout.xaxis.type==="category";if(!isCategory){return}var isLineMode=gData&&gData[0]&&gData[0].x&&gData[0].mode==="lines";if(!isLineMode){return}gData.forEach(function(g){g.x=g.x.map(function(v){if(VizUtil.isEmpty(v,true)){return v}return" "+v+" "})});if(layout.annotations){layout.annotations.forEach(function(v){if(!VizUtil.isEmpty(v.x,true)){v.x=" "+v.x+" "}})}};PlotlyGraphGenerator._flattenData=function(nestData,key){var flattened=d3.nest().key(function(d){return d[key]===null?NA_LABEL:d[key]}).entries(nestData);var orderedKeys=VizUtil.distinct(nestData.map(function(d){return d[key]===null?NA_LABEL:d[key]}));var hash={};flattened.forEach(function(d){hash[d.key]=d});var sorted=[];orderedKeys.forEach(function(d){if(hash[d]){sorted.push(hash[d])}});return sorted};PlotlyGraphGenerator._flattenDataByFacet=function(viz,nestData){if(viz.facet){var newData=[];nestData.forEach(function(g){var n=PlotlyGraphGenerator._flattenData(g.values,viz.facet.label);n.forEach(function(t){t.facet=t.key;t.key=g.key;if(g.ycolname){t.ycolname=g.ycolname}if(g.winfunc){t.winfunc=g.winfunc}if(g.yOp){t.yOp=g.yOp}if(g.use2ndAxis){t.use2ndAxis=g.use2ndAxis}});newData=newData.concat(n)});return newData}else{return nestData}};var convertCoefByTimeUnit=function(coef,aggfunc,type){if(type==="Date"||type.indexOf("POSIXct")>-1){if(type.indexOf("POSIXct")>-1){coef=coef*(24*60*60)}switch(aggfunc){case"rtoyear":case"year":coef=coef*365.25;break;case"rtohalfyear":case"halfyear":coef=coef*(365.25/2);break;case"rtoq":case"quarter":coef=coef*(365.25/4);break;case"rtobimon":case"bimon":coef=coef*(365.25/6);break;case"rtomon":case"mon":case"monname":coef=coef*(365.25/12);break;case"rtoweek":case"week":coef=coef*7;break;case"rtohour":case"hour":coef=coef/24;break;case"rtomin":case"minute":coef=coef/(24*60);break;case"rtosec":case"second":coef=coef/(24*60*60)}}return coef};PlotlyGraphGenerator._convertCoefByTimeUnit=convertCoefByTimeUnit;var convertToStackedAreas=function(gData){var facets={};gData.forEach(function(g){if(!facets[g.facet]){facets[g.facet]=[];g.fill="tozeroy"}else{g.fill="tonexty"}facets[g.facet].push(g)});Object.keys(facets).forEach(function(key){convertToStackedYValue(facets[key])})};PlotlyGraphGenerator._generateLineFillLayerData=function(viz,data,gData,layout){var res=[];if(!viz.yLineFillColumn||!viz[viz.yLineFillColumn]||!viz.x||!viz.y||viz.marker!=="line"){return res}var fillcol=viz[viz.yLineFillColumn].validLabel,g=null,fill=false,prev=false,color=gData&&gData.marker&&gData.marker.color?gData.marker.color+"44":"#1f77b444",curr=null;data.values.forEach(function(v,idx,arr){curr=v[fillcol];if(!VizUtil.isEmpty(curr)){if(curr){if(!g){g={x:[],y:[],type:"scatter",fill:"tozeroy",fillcolor:color,hoverinfo:"skip",mode:"none",showlegend:false,marker:{color:color},facet:gData.facet}}g.x.push(v[viz.x.validLabel]);g.y.push(v[viz.y.validLabel])}else{if(g){res.push(g);g=null}}prev=curr}if(idx===arr.length-1&&g){res.push(g)}});return res};PlotlyGraphGenerator._generateCumulativeDistLayerData=function(viz,gData,layout,translateColumn,defaultFormatter,defaultUseThousandSeparator){var syncYAxis=viz.facetSyncYAxis!=="off";var useRatio=viz.histCumDistType==="cumsum-ratio";var title=useRatio?"Cumulative Sum Ratio":"Cumulative Sum";if(viz.histCumDistLabel){title=viz.histCumDistLabel}title=VizUtil.getMessage(PlotlyGraphGenerator._lang,title);var formatter=!viz.histCumDistNumDecimalDigits?defaultFormatter:VizUtil.valueFormatterGenerator(viz.histCumDistNumDecimalDigits,defaultUseThousandSeparator,false);var maxUpperRange=0,maxUpperRangePerFacet={},axisSettings=[];var res=gData.map(function(g){var overlaying="y";var axisId=1;var dualYAxisId=2;var isRepeatBy=!!g.yaxis;if(isRepeatBy){overlaying=g.yaxis;axisId=parseInt(g.yaxis.replace("y",""));dualYAxisId=axisId+1}var axisSetting={side:"right",ticksuffix:useRatio?"%":"",overlaying:overlaying,showgrid:false,zeroline:false,automargin:true};axisSettings.push(axisSetting);if(isRepeatBy){axisSetting.anchor="x"+axisId;axisSetting.titlefont={size:13};axisSetting.tickfont={size:10};if(syncYAxis||useRatio){if(layout["xaxis"+axisId]&&layout["xaxis"+axisId].domain){axisSetting.showticklabels=layout["xaxis"+axisId].domain[1]>.99}}else{axisSetting.showticklabels=true}}else{axisSetting.showticklabels=true}if(!layout["yaxis"+dualYAxisId]){layout["yaxis"+dualYAxisId]=axisSetting}var datum={x:g.x.slice(),y:g.y.slice(),line:{color:g.marker.color,width:viz.histCumDistWidth||2,dash:viz.histCumDistStyle||"solid"},name:"cumdist",showlegend:false,visible:true,mode:"lines",hoverinfo:"text",yaxis:"y"+dualYAxisId,xaxis:"x"+axisId,legendgroup:g.name,marker:{color:g.marker.color}};if(!g.legendgroup){g.legendgroup=g.name}axisSetting=layout["yaxis"+dualYAxisId];var cumsum=0;datum.y=datum.y.map(function(y){if(!VizUtil.isEmpty(y)){cumsum+=y}return cumsum});if(useRatio){datum.y=datum.y.map(function(y){return 100*y/cumsum});axisSetting.range=[0,103]}else{var upperRange=cumsum*1.03;axisSetting.range=[0,upperRange];if(maxUpperRange<upperRange){maxUpperRange=upperRange}if(maxUpperRangePerFacet["yaxis"+dualYAxisId]===undefined||maxUpperRangePerFacet["yaxis"+dualYAxisId]<upperRange){maxUpperRangePerFacet["yaxis"+dualYAxisId]=upperRange}}datum.text=datum.x.map(function(x,idx){return title+": "+formatter(datum.y[idx])+(useRatio?"%":"")+"<br>"+"("+translateColumn(viz.x.balloonDisplayName||viz.x.name)+": "+defaultFormatter(datum.x[idx]-g.histRange)+" - "+defaultFormatter(datum.x[idx]+g.histRange)+")"});return datum});if(!useRatio){if(syncYAxis){axisSettings.forEach(function(x){x.range=[0,maxUpperRange]})}else{axisSettings.forEach(function(x){x.range=[0,maxUpperRangePerFacet[x.yaxis]]})}}return res};var formatValue=VizUtil.valueFormatterGenerator(2,true,true);var formatNumrowValue=VizUtil.valueFormatterGenerator(0,true);var constructFacetData=function(viz,gData,layout,colMap,defaultColor,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineUpperRangeLayerData,gVRefLineLowerRangeLayerData,gLineFillLayerData){if(viz.facet){var translateColumn=function(text){return viz.translate==="on"?VizUtil.getMessage(PlotlyGraphGenerator._lang,text):text};var marker=viz.marker;var ys=VizUtil.getOptions(viz,"y");var isMultiY=ys.length>1;var numY=0;var isGroupByMeasuresEnabled=viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES;ys.forEach(function(_y){if(_y){numY++}});var xAxisShowTitle=viz.xAxisShowTitle!=="off";if(viz.facetHideSingleLabel==="on"){var facetNames=gData.map(function(x){return x.facet});facetNames=makeArrayUnique(facetNames);if(facetNames.length===1){xAxisShowTitle=false}}var yAxisShowTitle=viz.yAxisShowTitle!=="off";if(isGroupByMeasuresEnabled){yAxisShowTitle=false}var y2AxisShowTitle=viz.y2AxisShowTitle!=="off";var isColorContinuous=viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color");var userXAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.xAxisRange);var userYAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.yAxisRange);var userY2AxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.y2AxisRange);var alwaysShowTickLabel=viz.facetAlwaysShowTickLabel==="on";var NUMROWS_COL_LABEL=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.NUMROWS_COL_LABEL);var layY1OverY2=viz.layY1OverY2==="on";var xValuePrefix="",y1ValuePrefix="",y2ValuePrefix="",xValueSuffix="",y1ValueSuffix="",y2ValueSuffix="";if(viz.x){xValuePrefix=VizUtil.getValuePrefix(viz.xAxisNumberFormatting,viz.xAxisCurrencySymbol,viz.marker);xValueSuffix=VizUtil.getValueSuffix(null,viz.x.func,viz.xAxisNumberFormatting,viz.marker)}if(viz.y){y1ValuePrefix=VizUtil.getValuePrefix(viz.yAxisNumberFormatting,viz.yAxisCurrencySymbol,viz.marker,viz.errbarCalcType,viz.errbarDirection);y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,viz.y.func,viz.yAxisNumberFormatting,viz.marker,viz.errbarCalcType,viz.errbarDirection)}if(marker==="hist"){y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,null,viz.yAxisNumberFormatting,viz.marker)}y2ValuePrefix=VizUtil.getValuePrefix(viz.y2AxisNumberFormatting,viz.y2AxisCurrencySymbol,viz.marker,viz.errbarCalcType,viz.errbarDirection);if(colsOn2ndAxis&&colsOn2ndAxis.length>0){ys.forEach(function(y,idx){if(y2ValueSuffix){return}if(viz["y"+idx+"Use2ndAxis"]){y2ValueSuffix=y&&VizUtil.getValueSuffix(viz["y"+idx+"WindowFunc"],y.func,viz.y2AxisNumberFormatting,viz.marker,viz.errbarCalcType,viz.errbarDirection)}})}xValuePrefix=viz.xAxisValuePrefix||xValuePrefix;xValueSuffix=viz.xAxisValueSuffix||xValueSuffix;y1ValuePrefix=viz.y1AxisValuePrefix||y1ValuePrefix;y1ValueSuffix=viz.y1AxisValueSuffix||y1ValueSuffix;y2ValuePrefix=viz.y2AxisValuePrefix||y2ValuePrefix;y2ValueSuffix=viz.y2AxisValueSuffix||y2ValueSuffix;var xTickFormat=viz.xAxisTickFormat||(viz.xAxisNumDecimalDigits?",."+viz.xAxisNumDecimalDigits+"f":null);var yTickFormat=viz.yAxisTickFormat||(viz.y1AxisNumDecimalDigits?",."+viz.y1AxisNumDecimalDigits+"f":null);var y2TickFormat=viz.y2AxisTickFormat||(viz.y2AxisNumDecimalDigits?",."+viz.y2AxisNumDecimalDigits+"f":null);if(!xTickFormat&&viz.xAxisUseSIPrefix==="off"){xTickFormat=","}if(!yTickFormat&&viz.y1AxisUseSIPrefix==="off"){yTickFormat=","}if(!y2TickFormat&&viz.y2AxisUseSIPrefix==="off"){y2TickFormat=","}var fvalues0=gData.map(function(g){return g.facet});var fvalues=[];fvalues0.forEach(function(v,idx){if(fvalues0.indexOf(v)===idx){fvalues.push(v)}});var ncols=viz.numFacetColumns||"auto";if(ncols==="auto"){if(viz._canvasWidth){var _facetWidth=viz._canvasWidth;ncols=1;while(_facetWidth>VizUtil.MAX_FACET_WIDTH){ncols++;_facetWidth=viz._canvasWidth/ncols}}else{ncols=VizUtil.DEFAULT_FACET_SIZE}if(fvalues.length<ncols){ncols=fvalues.length}}var nrows=Math.ceil(fvalues.length/ncols);var X_AXIS_AREA_HEIGHT=viz.facetVerticalPadding?parseInt(viz.facetVerticalPadding):80;var X_AXIS_AREA_HEIGHT_PLUS_MARGIN=X_AXIS_AREA_HEIGHT+10;var Y_AXIS_AREA_WIDTH=viz.facetHorizontalPadding?parseInt(viz.facetHorizontalPadding):40;if((viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(viz.marker,isGroupByMeasuresEnabled))==="off"&&gData.filter(function(g){return g.use2ndAxis}).length>0){Y_AXIS_AREA_WIDTH*=2}var facetW=(layout.width-layout.margin.l)/ncols;if(viz.facetSqueezePlots!=="on"&&nrows>2){if(ncols>2){layout.height=Math.max(layout.height,(facetW+X_AXIS_AREA_HEIGHT)*nrows+layout.margin.t)}else{layout.height=layout.height*nrows+layout.margin.t}}var facetY=(layout.height-layout.margin.t)/nrows;var xdomain=[],ydomain=[],i;for(i=0;i<ncols;i++){xdomain.push(i)}for(i=0;i<nrows;i++){ydomain.push(i)}var paddingRatio=Y_AXIS_AREA_WIDTH/facetW;var xscale=d3.scale.ordinal().domain(xdomain).rangeBands([0,100],paddingRatio,0);var xrange=xscale.range();var xrangeBand=xscale.rangeBand();xrangeBand=Math.max(xrangeBand,1);paddingRatio=X_AXIS_AREA_HEIGHT_PLUS_MARGIN/facetY;var yscale=d3.scale.ordinal().domain(ydomain).rangeBands([0,100],paddingRatio,0);var yrange=yscale.range().reverse();var yrangeBand=yscale.rangeBand();yrangeBand=Math.max(yrangeBand,1);delete layout.xaxis;delete layout.yaxis;delete layout.yaxis2;delete layout.zaxis;if(marker==="area"){convertToStackedAreas(gData)}var syncXAxis=(viz.facetSyncXAxis||VizUtil.getDefaultSyncXAxis(viz.marker))!=="off";if(!viz.facetSyncXAxis&&viz.facetEnableDataCompletion==="off"){syncXAxis=false}var syncYAxis=(viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(viz.marker,isGroupByMeasuresEnabled))!=="off";if(!viz.facetSyncYAxis&&viz.facetEnableDataCompletion==="off"){syncYAxis=false}if(!syncXAxis){userXAxisRange=null}if(!syncYAxis){userYAxisRange=null;userY2AxisRange=null}if(viz.yValueOnPlot!=="none"&&marker==="bar"&&viz.barstyle==="stack"){var _ht={};gData.forEach(function(g){if(!_ht[g.facet]){_ht[g.facet]=[]}_ht[g.facet].push(g)});Object.keys(_ht).forEach(function(key){var group=_ht[key];calculateStackedYValue(group)})}var gd=gData;if(gRangeLayerData){gd=gd.concat(gRangeLayerData)}if(gTrendLineLayerData){gd=gd.concat(gTrendLineLayerData)}if(gTrendLineRangeLayerData){gd=gd.concat(gTrendLineRangeLayerData)}if(gRefLineUpperRangeLayerData){gd=gd.concat(gRefLineUpperRangeLayerData)}if(gRefLineLowerRangeLayerData){gd=gd.concat(gRefLineLowerRangeLayerData)}if(gRefLineLayerData){gd=gd.concat(gRefLineLayerData)}if(gVRefLineUpperRangeLayerData){gd=gd.concat(gVRefLineUpperRangeLayerData)}if(gVRefLineLowerRangeLayerData){gd=gd.concat(gVRefLineLowerRangeLayerData)}if(gVRefLineLayerData){gd=gd.concat(gVRefLineLayerData)}var includeZeroOnXAxis=/^(scatter|bubble)$/.test(marker)&&viz.xAxisIncludeZero==="on";var xAxisRange=syncXAxis?calculateRange(gData,"x",viz.xAxisScale,includeZeroOnXAxis,viz.x&&VizUtil.returnsDateValue(viz.x),marker,viz.yValueOnPlot,true,viz.barstyle,viz.color,isMultiY):null;var includeZeroOnYAxis=/^(scatter|bubble)$/.test(marker)&&viz.yAxisIncludeZero==="on"||/^(bar|line|area)$/.test(marker)&&viz.yAxisIncludeZero!=="off"||marker==="errbar"&&viz.errbarGraph!=="marker"&&viz.yAxisIncludeZero!=="off";var yAxisRange=syncYAxis?calculateRange(gd,"y",viz.yAxisScale,includeZeroOnYAxis,false,marker,viz.yValueOnPlot,null,null,null,null,"y1"):null;var includeZeroOnY2Axis=/^(scatter|bubble)$/.test(marker)&&viz.y2AxisIncludeZero==="on"||/^(bar|line|area)$/.test(marker)&&viz.y2AxisIncludeZero!=="off";var y2AxisRange=syncYAxis?calculateRange(gd,"y",viz.y2AxisScale,includeZeroOnY2Axis,false,marker,viz.yValueOnPlot,null,null,null,null,"y2"):null;var xAxisTitleFontSize=viz.facetTitleFontSize||viz.xAxisTitleFontSize||(marker!=="pie"&&ncols>6||marker==="pie"&&ncols>2?12:13);var yAxisTitleFontSize=viz.yAxisTitleFontSize||13;var y2AxisTitleFontSize=viz.y2AxisTitleFontSize||13;var yAxisTitle=viz.yAxisTitle?translateColumn(viz.yAxisTitle):null;if(!yAxisTitle){if(marker==="hist"){yAxisTitle=VizUtil.FREQ_COL_LABEL}else if(viz.y){yAxisTitle=viz.y.name===VizUtil.NUMROWS_COL_NAME?NUMROWS_COL_LABEL:translateColumn(viz.y.name)}else{yAxisTitle=""}if(viz.y&&viz.yColumnName&&isMultiY){yAxisTitle=viz.yColumnName}}var y2AxisTitle=viz.y2AxisTitle?translateColumn(viz.y2AxisTitle):null;if(!y2AxisTitle){if(marker==="hist"){y2AxisTitle=VizUtil.FREQ_COL_LABEL}else if(colsOn2ndAxis&&colsOn2ndAxis.length>0){y2AxisTitle=colsOn2ndAxis[0].name===VizUtil.NUMROWS_COL_NAME?NUMROWS_COL_LABEL:colsOn2ndAxis[0].name}else{y2AxisTitle=""}if(colsOn2ndAxis&&colsOn2ndAxis.length>0&&colsOn2ndAxis[0]._columnDisplayName){y2AxisTitle=colsOn2ndAxis[0]._columnDisplayName}}var xAxisTickFontSize=viz.xAxisTickFontSize||10;var yAxisTickFontSize=viz.yAxisTickFontSize||10;var y2AxisTickFontSize=viz.y2AxisTickFontSize||10;var facetShowZeroLine=viz.facetShowZeroLine!=="off";var arr=[],reflineHash={},vreflineHash={},axisRangeHash={};gData.forEach(function(g,gidx){var idx=fvalues.indexOf(g.facet);var xidx=idx%ncols;var yidx=Math.floor(idx/ncols);var x=xrange[xidx];var y=yrange[yidx];var axisIdx=idx*2+1;var xaxisIdx=axisIdx;var yaxisIdx=axisIdx+(g.use2ndAxis?1:0);var legendgroup=g.name+(g.yOp||"");g.legendgroup=legendgroup;if(arr.indexOf(legendgroup)===-1){arr.push(legendgroup)}else{g.showlegend=false}layout["xaxis"+xaxisIdx]={domain:[x/100,(x+xrangeBand)/100],anchor:"y"+yaxisIdx,title:xAxisShowTitle?isGroupByMeasuresEnabled?colMap[g.facet].name:g.facet:"",titlefont:{size:xAxisTitleFontSize},tickfont:{size:xAxisTickFontSize},tickprefix:xValuePrefix,ticksuffix:xValueSuffix,zeroline:facetShowZeroLine,showticklabels:true,zerolinecolor:VizUtil.ZERO_LINE_COLOR};if(viz.marker==="bar"&&viz.orientation==="horizontal"){layout["xaxis"+xaxisIdx].xaxistitle=xAxisShowTitle&&viz.x?translateColumn(viz.x.name):""}if(xTickFormat){layout["xaxis"+xaxisIdx].tickformat=xTickFormat}if(viz.axisAutoMargin!=="off"){layout["xaxis"+xaxisIdx].automargin=true}if(marker==="heatmap"){layout["xaxis"+xaxisIdx].type="category";if(viz.xAxisPosition==="top"){layout["xaxis"+xaxisIdx].side="top"}}if(viz.xAxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){layout["xaxis"+xaxisIdx].autorange=viz.xAxisDirection}if(/^(bar|errbar|bubble)$/.test(marker)&&viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout["xaxis"+xaxisIdx].type="category"}if(/^(scatter|bubble)$/.test(marker)&&viz.xAxisScale){layout["xaxis"+xaxisIdx].type=viz.xAxisScale}if(viz.x&&VizUtil.returnsDateValue(viz.x)){layout["xaxis"+xaxisIdx].type="date"}if(viz.x&&!VizUtil.returnsNumericValue(viz.x)&&VizUtil.isPostFilterSupported(viz,"x")&&viz.xPostFilterType){layout["xaxis"+xaxisIdx].type="category"}if(xAxisRange){layout["xaxis"+xaxisIdx].range=xAxisRange;if(viz.xAxisTickStep&&viz.x&&VizUtil.returnsNumericValue(viz.x)){layout["xaxis"+xaxisIdx].dtick=viz.xAxisTickStep}}if(userXAxisRange){layout["xaxis"+xaxisIdx].range=userXAxisRange}if(viz.showXGridLines&&viz.showXGridLines!=="default"){layout["xaxis"+xaxisIdx].showgrid=viz.showXGridLines==="on"}if(!viz.x){layout["xaxis"+xaxisIdx].zeroline=false}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"){layout["xaxis"+xaxisIdx].zeroline=viz.showXZeroLine==="on"}if(!viz.x){layout["xaxis"+xaxisIdx].showticklabels=false}else if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout["xaxis"+xaxisIdx].type="category"}if(g.use2ndAxis){layout["yaxis"+yaxisIdx]={domain:[y/100,(y+yrangeBand)/100],anchor:"x"+xaxisIdx,title:xidx===ncols-1&&yidx===0&&y2AxisShowTitle?y2AxisTitle:null,titlefont:{size:y2AxisTitleFontSize||13},tickfont:{size:y2AxisTickFontSize},showticklabels:xidx===ncols-1||!syncYAxis||alwaysShowTickLabel,zeroline:facetShowZeroLine,zerolinecolor:VizUtil.ZERO_LINE_COLOR,tickprefix:y2ValuePrefix,ticksuffix:y2ValueSuffix,side:"right"};if(y2TickFormat){layout["yaxis"+yaxisIdx].tickformat=y2TickFormat}if(layY1OverY2){layout["yaxis"+(yaxisIdx-1)].overlaying="y"+yaxisIdx}else{layout["yaxis"+yaxisIdx].overlaying="y"+(yaxisIdx-1)}if(viz.axisAutoMargin!=="off"){layout["yaxis"+yaxisIdx].automargin=true}if(y2TickFormat){layout["yaxis"+yaxisIdx].tickformat=y2TickFormat}if(y2AxisRange){layout["yaxis"+yaxisIdx].range=y2AxisRange}if(userY2AxisRange){layout["yaxis"+yaxisIdx].range=userY2AxisRange}if(viz.y2AxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout["yaxis"+yaxisIdx].dtick=viz.y2AxisTickStep}layout["yaxis"+yaxisIdx].showgrid=viz.showY2GridLines==="on";layout["yaxis"+yaxisIdx].zeroline=viz.showY2ZeroLine==="on";if(/^(bar|errbar|bubble)$/.test(marker)&&viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout["yaxis"+yaxisIdx].type="category"}if(VizUtil.returnsDateValue(colsOn2ndAxis[0])){layout["yaxis"+yaxisIdx].type="date"}if(viz.y2AxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){layout["yaxis"+yaxisIdx].autorange=viz.y2AxisDirection}}else{layout["yaxis"+yaxisIdx]={domain:[y/100,(y+yrangeBand)/100],anchor:"x"+xaxisIdx,title:xidx===0&&yidx===0&&yAxisShowTitle?yAxisTitle:null,titlefont:{size:yAxisTitleFontSize},tickfont:{size:yAxisTickFontSize},showticklabels:xidx===0||!syncYAxis||alwaysShowTickLabel,zeroline:facetShowZeroLine,zerolinecolor:VizUtil.ZERO_LINE_COLOR,tickprefix:isGroupByMeasuresEnabled&&colMap[g.facet]?colMap[g.facet].valuePrefix:y1ValuePrefix,ticksuffix:isGroupByMeasuresEnabled&&colMap[g.facet]?colMap[g.facet].valueSuffix:y1ValueSuffix};if(yTickFormat){layout["yaxis"+yaxisIdx].tickformat=yTickFormat}if(viz.axisAutoMargin!=="off"){layout["yaxis"+yaxisIdx].automargin=true}if(yTickFormat){layout["yaxis"+yaxisIdx].tickformat=yTickFormat}if(yAxisRange){layout["yaxis"+yaxisIdx].range=yAxisRange}if(userYAxisRange){layout["yaxis"+yaxisIdx].range=userYAxisRange}if(viz.yAxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout["yaxis"+yaxisIdx].dtick=viz.yAxisTickStep}if(viz.showYGridLines&&viz.showYGridLines!=="default"){layout["yaxis"+yaxisIdx].showgrid=viz.showYGridLines==="on"}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){layout["yaxis"+yaxisIdx].zeroline=viz.showYZeroLine==="on"}if(marker==="heatmap"){if(xidx!==0){layout["yaxis"+yaxisIdx].ticklen=0}layout["yaxis"+yaxisIdx].type="category"}if(/^(bar|errbar|bubble)$/.test(marker)&&viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout["yaxis"+yaxisIdx].type="category"}if(viz.yAxisDirection&&VizUtil.isAxisDirectionEnabled(marker)){layout["yaxis"+yaxisIdx].autorange=viz.yAxisDirection}}if(/^(scatter|bar|errbar|hist|bubble|line|area)$/.test(marker)&&viz.yAxisScale){layout["yaxis"+yaxisIdx].type=viz.yAxisScale}if(viz.y&&VizUtil.returnsDateValue(viz.y)){layout["yaxis"+yaxisIdx].type="date"}g.xaxis="x"+xaxisIdx;g.yaxis="y"+yaxisIdx;if(!viz.color&&!isMultiY){if(!g.marker){g.marker={}}g.marker.color=defaultColor||"rgb(31, 119, 180)"}if(gRangeLayerData&&gRangeLayerData.length>0){gRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRangeLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if(!g.x||g.x.length===0){gRangeLayerData[gidx].x=[];gRangeLayerData[gidx].y=[]}}if(gTrendLineLayerData&&gTrendLineLayerData.length>0){gTrendLineLayerData[gidx].xaxis="x"+xaxisIdx;gTrendLineLayerData[gidx].yaxis="y"+yaxisIdx;gTrendLineLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if((!g.x||g.x.length===0)&&!isColorContinuous){gTrendLineLayerData[gidx].x=[];gTrendLineLayerData[gidx].y=[]}}if(gTrendLineRangeLayerData&&gTrendLineRangeLayerData.length>0){gTrendLineRangeLayerData[gidx].xaxis="x"+xaxisIdx;gTrendLineRangeLayerData[gidx].yaxis="y"+yaxisIdx;gTrendLineRangeLayerData[gidx].legendgroup="lg"+g.name;g.legendgroup="lg"+g.name;if((!g.x||g.x.length===0)&&!isColorContinuous){gTrendLineRangeLayerData[gidx].x=[];gTrendLineRangeLayerData[gidx].y=[]}}if(gRefLineUpperRangeLayerData&&gRefLineUpperRangeLayerData.length>0&&gRefLineUpperRangeLayerData[gidx]){gRefLineUpperRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineUpperRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineUpperRangeLayerData[gidx].legendgroup="refline"+g.name;gRefLineUpperRangeLayerData[gidx].visible=!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+(gRefLineUpperRangeLayerData[gidx].customdata.yOp||"")];if(!g.x||g.x.length===0){gRefLineUpperRangeLayerData[gidx].x=[];gRefLineUpperRangeLayerData[gidx].y=[]}}if(gRefLineLowerRangeLayerData&&gRefLineLowerRangeLayerData.length>0&&gRefLineLowerRangeLayerData[gidx]){gRefLineLowerRangeLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineLowerRangeLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineLowerRangeLayerData[gidx].legendgroup="refline"+g.name;gRefLineLowerRangeLayerData[gidx].visible=!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+(gRefLineLowerRangeLayerData[gidx].customdata.yOp||"")];if(!g.x||g.x.length===0){gRefLineLowerRangeLayerData[gidx].x=[];gRefLineLowerRangeLayerData[gidx].y=[]}}if(gRefLineLayerData&&gRefLineLayerData.length>0&&gRefLineLayerData[gidx]){gRefLineLayerData[gidx].xaxis="x"+xaxisIdx;gRefLineLayerData[gidx].yaxis="y"+yaxisIdx;gRefLineLayerData[gidx].legendgroup="refline"+g.name;if(!g.x||g.x.length===0){gRefLineLayerData[gidx].x=[];gRefLineLayerData[gidx].y=[]}if(isAllNull(gRefLineLayerData[gidx].y)){gRefLineLayerData[gidx].visible=false}else{gRefLineLayerData[gidx].visible=!reflineHash["x"+xaxisIdx+"y"+yaxisIdx+(gRefLineLayerData[gidx].customdata.yOp||"")];reflineHash["x"+xaxisIdx+"y"+yaxisIdx+(gRefLineLayerData[gidx].customdata.yOp||"")]=true}}if(gVRefLineLayerData&&gVRefLineLayerData.length>0){gVRefLineLayerData[gidx].xaxis="x"+xaxisIdx;gVRefLineLayerData[gidx].yaxis="y"+yaxisIdx;if(!g.x||g.x.length===0){gVRefLineLayerData[gidx].x=[];gVRefLineLayerData[gidx].y=[]}if(isAllNull(gVRefLineLayerData[gidx].x)){gVRefLineLayerData[gidx].visible=false}else{gVRefLineLayerData[gidx].visible=!vreflineHash["x"+xaxisIdx+"y"+yaxisIdx];vreflineHash["x"+xaxisIdx+"y"+yaxisIdx]=true}}if(gVRefLineUpperRangeLayerData&&gVRefLineUpperRangeLayerData.length>0){gVRefLineUpperRangeLayerData[gidx].xaxis="x"+xaxisIdx;gVRefLineUpperRangeLayerData[gidx].yaxis="y"+yaxisIdx;if(!g.x||g.x.length===0){gVRefLineUpperRangeLayerData[gidx].x=[];gVRefLineUpperRangeLayerData[gidx].y=[]}}if(gVRefLineLowerRangeLayerData&&gVRefLineLowerRangeLayerData.length>0){gVRefLineLowerRangeLayerData[gidx].xaxis="x"+xaxisIdx;gVRefLineLowerRangeLayerData[gidx].yaxis="y"+yaxisIdx;if(!g.x||g.x.length===0){gVRefLineLowerRangeLayerData[gidx].x=[];gVRefLineLowerRangeLayerData[gidx].y=[]}}if(gLineFillLayerData&&gLineFillLayerData.length>gidx&&gLineFillLayerData[gidx]){gLineFillLayerData[gidx].forEach(function(layer){layer.xaxis="x"+xaxisIdx;layer.yaxis="y"+yaxisIdx})}if(!syncYAxis&&viz["yAxisRangeIgnoreRefline"]==="on"){var layers=[g];if(gRangeLayerData&&gRangeLayerData.length>0){layers.push(gRangeLayerData[gidx])}var range=calculateRange(layers,"y",viz.yAxisScale,includeZeroOnYAxis,false,marker,viz.yValueOnPlot,null,null,null,null,"y1");if(range){if(axisRangeHash["yaxis"+yaxisIdx]){range[0]=Math.min(axisRangeHash["yaxis"+yaxisIdx][0],range[0])
;range[1]=Math.max(axisRangeHash["yaxis"+yaxisIdx][1],range[1])}axisRangeHash["yaxis"+yaxisIdx]=range}}});Object.keys(axisRangeHash).forEach(function(key){layout[key].range=axisRangeHash[key]});if(/^(bar|line|area|errbar)$/.test(viz.marker)&&viz.facet&&!syncXAxis){var h={};gData.forEach(function(g){if(!h[g.facet]){h[g.facet]=[]}h[g.facet].push(g)});Object.keys(h).forEach(function(key){var i=0,group=h[key];while(i<group[0].y.length){var allzero=true,allnull=true,isOrderRow=group[0]._orderRow&&i<group[0]._orderRow.length&&group[0]._orderRow[i]===true;group.forEach(function(d){allzero=d.y[i]===0&&allzero;allnull=d.y[i]===null&&allnull});if(allzero||allnull){if(isOrderRow&&viz.marker==="line"){group.forEach(function(d){d.x[i]=null});i++;return}group.forEach(function(d){d.y.splice(i,1);if(d.x&&isArray(d.x)&&i<d.x.length){d.x.splice(i,1)}if(d.text&&isArray(d.text)&&i<d.text.length){d.text.splice(i,1)}if(d.marker.size&&isArray(d.marker.size)&&i<d.marker.size.length){d.marker.size.splice(i,1)}if(d.customdata&&isArray(d.customdata)&&i<d.customdata.length){d.customdata.splice(i,1)}if(d.error_y&&d.error_y.array&&isArray(d.error_y.array)&&i<d.error_y.array.length){d.error_y.array.splice(i,1)}if(d.error_y&&d.error_y.arrayminus&&isArray(d.error_y.arrayminus)&&i<d.error_y.arrayminus.length){d.error_y.arrayminus.splice(i,1)}if(d.stacky&&isArray(d.stacky)&&i<d.stacky.length){d.stacky.splice(i,1)}if(d._orderRow&&isArray(d._orderRow)&&i<d._orderRow.length){d._orderRow.splice(i,1)}})}else{i++}}})}if(/^(scatter)$/.test(viz.marker)&&viz.facet){var scatterLineGroupedByLabel=viz.yMarkerShape==="line"&&!!viz.label;var xAxisDataTypeDetection=viz.xAxisDataTypeDetection==="on";if(!syncXAxis){PlotlyGraphGenerator._unsyncAxis(gData,"x",VizUtil.returnsCharacterValue(viz.x)&&!scatterLineGroupedByLabel&&!xAxisDataTypeDetection)}if(!syncYAxis&&viz.y){PlotlyGraphGenerator._unsyncAxis(gData,"y",VizUtil.returnsCharacterValue(viz.y)&&!scatterLineGroupedByLabel)}}if(/^(bubble)$/.test(viz.marker)&&!!viz.facet&&!!viz["xPostFilterType"]){if(!syncXAxis){PlotlyGraphGenerator._unsyncAxis(gData,"x",VizUtil.returnsCharacterValue(viz.x))}}if(layout.showlegend!==false){layout.showlegend=numY>1||!!viz.color}}return{layout:layout,gData:gData}};PlotlyGraphGenerator._constructFacetData=constructFacetData;PlotlyGraphGenerator.reverseColorOrder=function(gData){var len=gData.length,i;var colors=gData.map(function(g){return g.fillcolor?g.fillcolor:g.marker.color});var colorBuckets=[];var lastc=null;for(i=0;i<len;i++){if(lastc!==colors[i]){colorBuckets.push(colors[i]);lastc=colors[i]}}lastc=null;var newc=null;for(i=0;i<len;i++){if(lastc!==colors[i]){newc=colorBuckets.pop();lastc=colors[i]}if(gData[i].fillcolor){gData[i].fillcolor=newc}else{gData[i].marker.color=newc}}return gData};var _flipProperties=function(a,propNameA,b,propNameB){var x=a[propNameA];a[propNameA]=b[propNameB];b[propNameB]=x};PlotlyGraphGenerator._switchOrientation=function(gData,layout,syncXAxis,isXAxisAssigned,alwaysShowTickLabel){var x;gData.forEach(function(data){_flipProperties(data,"x",data,"y");_flipProperties(data,"xaxis",data,"yaxis");_flipProperties(data,"error_x",data,"error_y");if(data.xaxis){data.xaxis=data.xaxis.replace("y","x")}else{delete data.xaxis}if(data.yaxis){data.yaxis=data.yaxis.replace("x","y")}else{delete data.yaxis}if(data.orientation&&data.orientation==="h"){delete data.orientation}else{data.orientation="h"}});if(layout.xaxis&&layout.yaxis){_flipProperties(layout,"xaxis",layout,"yaxis");layout.yaxis.autorange=layout.yaxis.autorange==="reversed"?null:"reversed";layout.yaxis.ticksuffix=" ";if(layout.yaxis2){layout.xaxis2=layout.yaxis2;layout.xaxis2.overlaying="x";layout.xaxis2.side="top";delete layout.yaxis2}}else{var i=1;while(layout["xaxis"+i]&&layout["yaxis"+i]){_flipProperties(layout,"xaxis"+i,layout,"yaxis"+i);_flipProperties(layout["xaxis"+i],"anchor",layout["yaxis"+i],"anchor");_flipProperties(layout["xaxis"+i],"domain",layout["yaxis"+i],"domain");_flipProperties(layout["xaxis"+i],"title",layout["yaxis"+i],"title");_flipProperties(layout["xaxis"+i],"showticklabels",layout["yaxis"+i],"showticklabels");layout["xaxis"+i].showticklabels=true;if(alwaysShowTickLabel){layout["yaxis"+i].showticklabels=isXAxisAssigned;layout["yaxis"+i].ticksuffix=" "}else{if(!syncXAxis){layout["yaxis"+i].showticklabels=isXAxisAssigned;layout["yaxis"+i].ticksuffix=" "}else{layout["yaxis"+i].showticklabels=isXAxisAssigned&&layout["xaxis"+i].domain[0]<1e-5;layout["yaxis"+i].ticksuffix=" "}}if(layout["yaxis"+i].title&&layout["yaxis"+i].xaxistitle){_flipProperties(layout["yaxis"+i],"title",layout["yaxis"+i],"xaxistitle")}layout["yaxis"+i].autorange=layout["yaxis"+i].autorange==="reversed"?null:"reversed";i++;if(layout["yaxis"+i]){layout["xaxis"+i]=layout["yaxis"+i];delete layout["yaxis"+i];layout["xaxis"+i].overlaying=layout["xaxis"+i].overlaying.replace("y","x");layout["xaxis"+i].anchor=layout["xaxis"+i].anchor.replace("x","y");layout["xaxis"+(i-1)].anchor=layout["xaxis"+i].anchor;layout["xaxis"+i].side="top";layout["xaxis"+i].showticklabels=true;layout["xaxis"+i].title=null}i++}}if(layout.annotations){layout.annotations.forEach(function(data){_flipProperties(data,"x",data,"y");_flipProperties(data,"xref",data,"yref");if(data.xref){data.xref=data.xref.replace("y","x")}else{delete data.xref}if(data.yref){data.yref=data.yref.replace("x","y")}else{delete data.yref}data.xanchor=data.yanchor==="top"?"right":"left";data.yanchor="middle"})}};PlotlyGraphGenerator._switchReferenceLineOrientation=function(gReflineData){var x;gReflineData.forEach(function(data){_flipProperties(data,"x",data,"y");_flipProperties(data,"xaxis",data,"yaxis");_flipProperties(data,"error_x",data,"error_y");if(data.xaxis){data.xaxis=data.xaxis.replace("y","x")}else{delete data.xaxis}if(data.yaxis){data.yaxis=data.yaxis.replace("x","y")}else{delete data.yaxis}if(data.orientation&&data.orientation==="h"){delete data.orientation}else{data.orientation="h"}})};PlotlyGraphGenerator._addCustomBalloon=function(elem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback){if(!onShowDetailCallback&&!onKeepThisCallback&&!onExcludeCallback){return}var traces={};var handler=function(data){var $balloon=$("#viz-balloon");if($balloon.length===0){$balloon=$('<div id="viz-balloon"/>');$(elem).append($balloon)}else{$balloon.empty()}var isMultiSelect=data.event.ctrlKey||data.event.metaKey;var cdata;var $row;var $head=$('<div class="balloon-header"></div>');$balloon.append($head);var $htable=$('<div class="balloon-header-table"></div>');$head.append($htable);var $hrow=$('<div class="balloon-header-table-row"></div>');$htable.append($hrow);var $body=$('<div class="balloon-body"></div>');var $table=$('<div class="balloon-body-table"></div>');$body.append($table);$balloon.append($body);if(data.points&&data.points.length>0){var isPie=false,isBoxplot=false,isLine=false,isArea=false,isHeatmap=false,v,colors;cdata=data.points[0].customdata;if(data.points&&data.points[0]&&data.points[0].data&&data.points[0].data.type==="pie"){var idx=data.points[0].data.labels.indexOf(data.points[0].label);cdata=data.points[0].data.customdata[idx];colors=data.points[0].data.marker.colors;isPie=true}if(cdata){isBoxplot=data.points[0].data&&data.points[0].data.type==="box";isHeatmap=data.points[0].data&&/^(heatmap|contour)$/.test(data.points[0].data.type);isLine=data.points[0].data&&/^lines/.test(data.points[0].data.mode);isArea=data.points[0].data&&/^(tonexty|tozeroy)$/.test(data.points[0].data.fill);isLine=isArea?false:isLine;var t,tIndex,tColor,tSize,tData,dIndex,isSelectedItemClicked=false;dIndex=isHeatmap?data.points[0].pointNumber.toString():data.points[0].pointNumber;tIndex=data.points[0].fullData.index;var resetSelection=function(){Object.keys(traces).forEach(function(key){t=traces[key];isSelectedItemClicked=!!t.data[dIndex];if(t.isLine){Plotly.restyle(elem,{mode:"lines",marker:{color:t.color,size:0}},t.traceIndex)}else if(t.isArea){Plotly.restyle(elem,{mode:"none",marker:{size:0}},t.traceIndex)}else{var v={marker:{color:t.color,line:{width:0},size:t.size}};if(isPie&&colors){v.marker.colors=colors}Plotly.restyle(elem,v,t.traceIndex)}})};if(!isMultiSelect){resetSelection();traces={}}t=traces[tIndex];if(t){t.data[dIndex]=!t.data[dIndex]?cdata:false}else{tColor=isPie?data.points[0].color:isLine?data.points[0].fullData.line.color:isArea?data.points[0].data.fillcolor:data.points[0].data.marker?data.points[0].data.marker.color:null;tSize=data&&data.points&&data.points[0].data&&data.points[0].data.marker?data.points[0].data.marker.size:null;tData=isPie?data.points[0].data.values:data.points[0].data.y;tData=tData.map(function(d,idx){return idx===dIndex&&!isSelectedItemClicked?cdata:false});if(isHeatmap){tData[dIndex]=!isSelectedItemClicked?cdata:false}t={traceIndex:tIndex,data:tData,color:tColor,isLine:isLine,isArea:isArea,isBoxplot:isBoxplot,isHeatmap:isHeatmap,size:tSize};traces[t.traceIndex]=t}var cdatalist=[];Object.keys(traces).forEach(function(key){t=traces[key];if(isHeatmap){cdatalist=cdatalist.concat(Object.keys(t.data).map(function(k){return t.data[k]}).filter(function(d){return!!d}))}else{cdatalist=cdatalist.concat(t.data.filter(function(d){return!!d}))}if(isBoxplot){}else if(isLine){Plotly.restyle(elem,{mode:"lines+markers",marker:{color:t.color,size:t.data.map(function(d){return d?10:0})}},t.traceIndex)}else if(isArea){Plotly.restyle(elem,{mode:"lines+markers",marker:{color:t.color,size:t.data.map(function(d){return d?10:0})}},t.traceIndex)}else if(isHeatmap){}else{v={marker:{line:{color:"#000000",width:t.data.map(function(d){return d?3:0})}}};if(t.color){v.marker.color=t.color}if(t.size){v.marker.size=t.size}if(isPie&&colors){v.marker.colors=colors}Plotly.restyle(elem,v,t.traceIndex)}});var _hash={};cdata.forEach(function(d){if(!_hash[d.name+d.value]){$row=$('<div class="balloon-body-table-row"></div>');$row.append('<div class="balloon-body-table-cell label-cell">'+d.name+"</div>");$row.append('<div class="balloon-body-table-cell value-cell">'+d.value+"</div>");$table.append($row);_hash[d.name+d.value]=true}});$balloon.css({position:"absolute",left:data.event.offsetX+"px",top:data.event.offsetY-Object.keys(_hash).length*20+"px"});$balloon.on("click",function(){resetSelection();traces={};$balloon.hide();return});if(isSelectedItemClicked){$balloon.hide();return}else{$balloon.show();$balloon.focus()}if(onKeepThisCallback){var $keepOnly=$('<div class="balloon-header-item"><i class="fal fa-check"/> '+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Keep Only")+"</div>");$keepOnly.on("click",function(){onKeepThisCallback(cdatalist)});$hrow.append($keepOnly)}if(onExcludeCallback){var $exclude=$('<div class="balloon-header-item"><i class="fal fa-times"/> '+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Exclude")+"</div>");$exclude.on("click",function(){onExcludeCallback(cdatalist)});$hrow.append($exclude)}if(onShowDetailCallback){var $showDetail=$('<div class="balloon-header-item"><i class="fal fa-table" style="padding-right:3px"/>'+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Show Detail")+"</div>");$showDetail.on("click",function(){onShowDetailCallback(cdatalist)});$hrow.append($showDetail)}$hrow.append($('<div class="balloon-header-close-btn"><i class="fal fa-times"/></div>'));if(cdatalist.length>1){$head.append($('<div style="padding:0px 10px 3px"><b>'+cdatalist.length+"</b> "+VizUtil.getMessage(PlotlyGraphGenerator._lang,"items selected")+"</div>"))}}else{$balloon.hide()}}};var cancelHandler=function(){var $balloon=$("#viz-balloon");$balloon.hide();var t;Object.keys(traces).forEach(function(key){t=traces[key];if(t.isLine){Plotly.restyle(elem,{mode:"lines",marker:{color:t.color,size:0}},t.traceIndex)}else if(t.isArea){Plotly.restyle(elem,{mode:"none",marker:{size:0}},t.traceIndex)}else{Plotly.restyle(elem,{marker:{color:t.color,line:{width:0},size:t.size}},t.traceIndex)}});traces={}};elem.on("plotly_click",handler);elem.on("plotly_doubleclick",cancelHandler)};PlotlyGraphGenerator.getRangeFromRangeString=function(rangeString){if(!rangeString){return null}var arr=rangeString.split(",");if(arr.length!==2){return null}arr[0]=parseFloat(arr[0].replace(/[\(\)\[\]\{\}]/g,""));arr[1]=parseFloat(arr[1].replace(/[\(\)\[\]\{\}]/g,""));if(isNaN(arr[0]||isNaN(arr[1]))){return null}return arr};PlotlyGraphGenerator.getRangeFromRangeRatio=function(targetAxis,axisRatio,gData){if(!axisRatio){return null}axisRatio=parseFloat(axisRatio);var dataArr=[];gData.forEach(function(g){dataArr=dataArr.concat(g[targetAxis])});var ext=d3.extent(dataArr);if(!ext||ext.length!==2||typeof ext[0]!=="number"||typeof ext[1]!=="number"){return null}var r=(ext[1]-ext[0])/2;var center=(ext[1]+ext[0])/2;var min=center-r*axisRatio;var max=center+r*axisRatio;return[min,max]};PlotlyGraphGenerator._lang="en";PlotlyGraphGenerator._generateDensityPlotViz=function(viz){viz=JSON.parse(JSON.stringify(viz));viz.x={func:"none",isDate:false,isNumeric:true,label:viz.x.label,name:viz.x.name,type:"numeric",validLabel:viz.x.validLabel,balloonDisplayName:viz.x.balloonDisplayName};viz.y={func:"none",isDate:false,isNumeric:true,label:".density",name:"Density",type:"numeric",validLabel:".density"};return viz};PlotlyGraphGenerator._generateScatterMatrixViz=function(viz){if(!viz.scatterMatrixColumns){return viz}viz=JSON.parse(JSON.stringify(viz));var colnames=null;try{colnames=JSON.parse(viz.scatterMatrixColumns)}catch(e){colnames=viz.scatterMatrixColumns.split(",")}colnames=colnames.map(function(col){return col.name||col});colnames.sort(function(a,b){return a.localeCompare(b)});colnames.forEach(function(colname,idx){colname=colname.trim();var opId="y"+(idx===0?"":idx);viz[opId]={func:"none",isDate:false,isNumeric:true,label:"sm"+idx,name:colname,type:"numeric",validLabel:"sm"+idx}});return viz};PlotlyGraphGenerator._generateGroupByMeasuresViz=function(viz,data){const colMap={};const useThousandSeparator=viz.useThousandSeparator!=="off";Object.keys(viz).forEach(function(key){if(/^y\d*$/.test(key)&&viz[key]){var o=JSON.parse(JSON.stringify(viz[key]));o.opId=key;if(o.type===VizUtil.TYPE_NUMROWS){o.name=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.NUMROWS_COL_LABEL)}if(viz[key+"ColumnName"]){o.name=viz[key+"ColumnName"]}o.valuePrefix=VizUtil.getValuePrefix(viz[key+"AxisNumberFormatting"],viz[key+"AxisCurrencySymbol"],viz.marker,viz.errbarCalcType,viz.errbarDirection);o.valueSuffix=VizUtil.getValueSuffix(viz[key+"WindowFunc"],viz[key].func,viz[key+"AxisNumberFormatting"],viz.marker,viz.errbarCalcType,viz.errbarDirection);o.trendLine=viz[key+"TrendLine"];o.trendLineWithRange=viz[key+"TrendLineWithRange"];o.trendLineWidth=viz[key+"TrendLineWidth"];o.trendLineType=viz[key+"TrendLineType"];o.formatTrendLineValue=VizUtil.valueFormatterGenerator(VizUtil.isEmpty(viz[key+"TrendLineNumDecimalDigits"],true)?null:viz[key+"TrendLineNumDecimalDigits"],useThousandSeparator,false);o.reflineType=viz[key+"ReflineType"];o.reflineRangeType=viz[key+"ReflineRangeType"];o.reflineGroup=viz[key+"ReflineGroup"]||"all";o.reflineColor=viz[key+"ReflineColor"]&&viz[key+"ReflineColor"]!=="default"?viz[key+"ReflineColor"]:"#A6AAA9";o.reflineWidth=viz[key+"ReflineWidth"]||1;o.reflineLength=viz[key+"ReflineLength"]||12;o.reflineStyle=viz[key+"ReflineStyle"]||"solid";o.reflineHideFromLegend=viz[key+"ReflineHideFromLegend"]===true||viz[key+"ReflineShowInLegend"]!=="on";o.markerShape=viz[key+"MarkerShape"];o.markerSize=viz[key+"MarkerSize"];o.markerStyle=viz[key+"MarkerLineStyle"];o.markerOpacity=viz[key+"FillOpacity"];o.markerShape=viz[key+"MarkerShape"];o.markerCircleSize=viz[key+"MarkerCircleSize"];o.winfunc=viz[key+"WindowFunc"];colMap[viz[key].label]=o}if(/^y\d+$/.test(key)&&viz[key]){delete viz[key]}});return colMap};var TOOLBAR_HEIGHT=26;var TOOLBAR_PADDING_TOP=2;var FACET_NUMBER_OF_COLS_LOV=["Auto","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"];PlotlyGraphGenerator.prototype._initToolbarAvailability=function(targetElem,viz,data,onPropUpdateCallback){this._isFacetFilterEnabled=targetElem&&viz.showFacetFilter==="on"&&viz.xAxisDataTypeDetection==="on"&&!!viz.facet&&!!viz.label2;this._isFacetLayoutToolEnabled=targetElem&&viz.showFacetLayoutTool==="on"&&!!viz.facet;if(this._isFacetLayoutToolEnabled&&data){var facetData=data.map(function(row){return row[viz.facet.validLabel]});facetData=makeArrayUnique(facetData);if(facetData.length===1){this._isFacetLayoutToolEnabled=false}}this._isRangeOptionEnabled=viz.showRangeOptionInToolbar==="on";this._isShowLabel2OptionEnabled=viz.showLabel2OptionInToolbar==="on";this._isYAxisAutoScaleOptionEnabled=viz.showYAxisAutoScaleOptionInToolbar==="on"&&!this._isFacetLayoutToolEnabled;this._isToolbarEnabled=this._isFacetLayoutToolEnabled||this._isFacetFilterEnabled||this._isRangeOptionEnabled||this._isShowLabel2OptionEnabled||this._isYAxisAutoScaleOptionEnabled;this._isToolbarHidden=!onPropUpdateCallback};PlotlyGraphGenerator.prototype._renderToolbar=function(targetElem,viz,data){var selectedFacetFilterValue=viz.facetFilter;var filteredData=data;var toolbarElem=document.createElement("div");var isGroupByMeasuresEnabled=viz.facet&&viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES;targetElem.appendChild(toolbarElem);toolbarElem.style.fontSize="12px";toolbarElem.style.marginLeft="12px";toolbarElem.style.paddingTop=TOOLBAR_PADDING_TOP+"px";toolbarElem.style.height=TOOLBAR_HEIGHT+"px";toolbarElem.style.boxSizing="border-box";if(this._isToolbarHidden){toolbarElem.style.display="none"}if(this._isFacetFilterEnabled){var lov=PlotlyGraphGenerator._populateFacetFilterLov(viz,data);if(!selectedFacetFilterValue||lov.indexOf(selectedFacetFilterValue)===-1){selectedFacetFilterValue=lov[0]}filteredData=data.filter(function(d){return d[viz.label2.label]===selectedFacetFilterValue});this._renderFacetFilterDropdown(toolbarElem,lov,selectedFacetFilterValue)}if(this._isFacetLayoutToolEnabled){var syncXAxis=null,syncYAxis=null;if(VizUtil.isSyncAxisSupported(viz.marker)){syncXAxis=viz.facetSyncXAxis||VizUtil.getDefaultSyncXAxis(viz.marker);syncYAxis=viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(viz.marker,isGroupByMeasuresEnabled)}if(viz.xAxisDataTypeDetection==="on"){syncXAxis=null}this._renderFacetLayoutToolDropdown(toolbarElem,viz.numFacetColumns,viz.facetSqueezePlots,syncXAxis,syncYAxis)}if(this._isRangeOptionEnabled){this._renderShowRangeOption(toolbarElem,viz.yErrHighLowEnabledOnUI==="off"?"off":"on")}if(this._isShowLabel2OptionEnabled){this._renderShowLabel2Option(toolbarElem,viz.label2OnPlot)}if(this._isYAxisAutoScaleOptionEnabled){var yAxisIncludeZero=viz.yAxisIncludeZero||VizUtil.getDefaultAxisIncludeZero(viz.marker);this._renderYAxisAutoScaleOption(toolbarElem,yAxisIncludeZero==="off"?"on":"off")}return filteredData};PlotlyGraphGenerator.prototype._renderFacetLayoutToolDropdown=function(toolbarElem,numOfCols,fitInScreen,syncXAxis,syncYAxis){var label=document.createElement("span");label.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"# of Columns")+":";label.style.margin="0 4px 0 0";label.style.verticalAlign="top";label.style.display="inline-block";label.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";label.style.transform="translateY(3px)";toolbarElem.appendChild(label);var select=document.createElement("select");select.classList.add("viz-facet-numcol-dropdown");select.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";select.style.width="60px";select.style.backgroundColor="white";select.style.border="1px solid #ccc";select.style.borderRadius="5px";select.style.outline="none";select.style.margin="0 14px 0 0";select.style.verticalAlign="top";select.style.display="inline-block";select.style.transform="translateY(1px)";select.style.padding="0 0 0 5px";select.onchange=this._onToolbarWidgetChange.bind(this);var op;FACET_NUMBER_OF_COLS_LOV.forEach(function(val){op=document.createElement("option");op.value=val;op.innerText=VizUtil.getMessage(PlotlyGraphGenerator._lang,val);if(val===numOfCols){op.selected="selected"}else if(val==="Auto"&&!numOfCols){op.selected="selected"}select.appendChild(op)});toolbarElem.appendChild(select);var cb=document.createElement("input");cb.type="checkbox";if(fitInScreen==="on"){cb.checked="checked"}cb.classList.add("viz-facet-fit-in-screen-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Fit");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.marginRight="14px";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel);if(syncXAxis){cb=document.createElement("input");cb.type="checkbox";if(syncXAxis==="on"){cb.checked="checked"}cb.classList.add("viz-facet-sync-xaxis-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Sync X Axis");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.marginRight="14px";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)}if(syncYAxis){cb=document.createElement("input");cb.type="checkbox";if(syncYAxis==="on"){cb.checked="checked"}cb.classList.add("viz-facet-sync-yaxis-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Sync Y Axis");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.marginRight="14px";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)}};PlotlyGraphGenerator.prototype._renderShowRangeOption=function(toolbarElem,showRange){var cb=document.createElement("input");cb.type="checkbox";if(showRange==="on"){cb.checked="checked"}cb.classList.add("viz-show-range-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Confidence Interval (95%)");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)};PlotlyGraphGenerator.prototype._renderShowLabel2Option=function(toolbarElem,label2OnPlot){var cb=document.createElement("input");cb.type="checkbox";if(label2OnPlot==="on"){cb.checked="checked"}cb.classList.add("viz-show-label2-on-plot-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Show Label Values on Chart");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)};PlotlyGraphGenerator.prototype._renderYAxisAutoScaleOption=function(toolbarElem,autoScale){var cb=document.createElement("input");cb.type="checkbox";if(autoScale==="on"){cb.checked="checked"}cb.classList.add("viz-yaxis-autoscale-cb");cb.style.margin="0 4px 0 0";cb.onchange=this._onToolbarWidgetChange.bind(this);cb.style.verticalAlign="top";cb.style.display="inline-block";cb.style.transform="translateY(5px)";toolbarElem.appendChild(cb);var cblabel=document.createElement("span");cblabel.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Autoscale Y Axis");cblabel.style.verticalAlign="top";cblabel.style.display="inline-block";cblabel.style.transform="translateY(3px)";cblabel.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(cblabel)};PlotlyGraphGenerator.prototype._renderFacetFilterDropdown=function(toolbarElem,lov,selectedFacetFilterValue){var label=document.createElement("span");label.textContent=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Repeat By Group")+":";label.style.margin="0 4px 0 0";label.style.verticalAlign="top";label.style.display="inline-block";label.style.transform="translateY(3px)";label.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";toolbarElem.appendChild(label);var select=document.createElement("select");select.classList.add("viz-facet-filter-dropdown");select.style.height=TOOLBAR_HEIGHT-TOOLBAR_PADDING_TOP-2+"px";select.style.minWidth="130px";select.style.maxWidth="300px";select.style.backgroundColor="white";select.style.border="1px solid #ccc";select.style.borderRadius="5px";select.style.outline="none";select.style.margin="0 14px 0 0";select.style.verticalAlign="top";select.style.transform="translateY(1px)";select.style.padding="0 0 0 5px";select.style.display="inline-block";select.onchange=this._onToolbarWidgetChange.bind(this);var op;lov.forEach(function(val){op=document.createElement("option");op.value=val;op.innerText=val;if(val===selectedFacetFilterValue){op.selected="selected"}select.appendChild(op)});toolbarElem.appendChild(select)};PlotlyGraphGenerator._populateFacetFilterLov=function(viz,data){var lov=data.map(function(x){return x[viz.label2.label]}).filter(function(x){return!!x});var res=makeArrayUnique(lov);return res};PlotlyGraphGenerator.prototype._onToolbarWidgetChange=function(ev){var vars=this._initVariables;var $toolbar=$(ev.target.parentNode);var selectedFacetFilterValue=$toolbar.find(".viz-facet-filter-dropdown").val();var selectedNumFacetCols=$toolbar.find(".viz-facet-numcol-dropdown").val();var fitInScreen=$toolbar.find(".viz-facet-fit-in-screen-cb").prop("checked");if(selectedFacetFilterValue){if(selectedNumFacetCols==="Auto"){selectedNumFacetCols=null}vars.viz.facetFilter=selectedFacetFilterValue;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("facetFilter",selectedFacetFilterValue)}}if(selectedNumFacetCols){if(selectedNumFacetCols==="Auto"){selectedNumFacetCols=null}vars.viz.numFacetColumns=selectedNumFacetCols;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("numFacetColumns",selectedNumFacetCols)}}fitInScreen=!fitInScreen?"":"on";vars.viz.facetSqueezePlots=fitInScreen;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("facetSqueezePlots",fitInScreen)}if($toolbar.find(".viz-facet-sync-xaxis-cb").length>0){var syncXAxis=$toolbar.find(".viz-facet-sync-xaxis-cb").prop("checked")?"on":"off";vars.viz.facetSyncXAxis=syncXAxis;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("facetSyncXAxis",syncXAxis)}}if($toolbar.find(".viz-facet-sync-yaxis-cb").length>0){var syncYAxis=$toolbar.find(".viz-facet-sync-yaxis-cb").prop("checked")?"on":"off";vars.viz.facetSyncYAxis=syncYAxis;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("facetSyncYAxis",syncYAxis)}}var $showRange=$toolbar.find(".viz-show-range-cb");if($showRange.length>0){var showRange=$showRange.prop("checked");showRange=!showRange?"off":"on";vars.viz.yErrHighLowEnabledOnUI=showRange;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("yErrHighLowEnabledOnUI",showRange)}}var $showLabel=$toolbar.find(".viz-show-label2-on-plot-cb");if($showLabel.length>0){var showLabel=$showLabel.prop("checked");showLabel=!showLabel?"off":"on";vars.viz.label2OnPlot=showLabel;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("label2OnPlot",showLabel)}}var $autoScale=$toolbar.find(".viz-yaxis-autoscale-cb");if($autoScale.length>0){var autoScale=$autoScale.prop("checked");var includeZero=autoScale?"off":"on";vars.viz.yAxisIncludeZero=includeZero;vars.viz.y2AxisIncludeZero=includeZero;if(vars.onPropUpdateCallback){vars.onPropUpdateCallback("yAxisIncludeZero",includeZero);vars.onPropUpdateCallback("y2AxisIncludeZero",includeZero)}}this._render(vars.viz,vars.data,vars.targetElem,vars.renderType,vars.onLoadCallback,vars.onShowDetailCallback,vars.onKeepThisCallback,vars.onExcludeCallback,vars.onBeforeRenderingCallback,vars.onPropUpdateCallback,vars.lang,vars.configProps,true)};PlotlyGraphGenerator.render=function(viz,data,targetElem,renderType,onLoadCallback,onErrorCallback,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onBeforeRenderingCallback,onPropUpdateCallback,lang,configProps,isRerender){if(lang){PlotlyGraphGenerator._lang=lang}try{var renderer=new PlotlyGraphGenerator;renderer._render(viz,data,targetElem,renderType,onLoadCallback,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onBeforeRenderingCallback,onPropUpdateCallback,lang,configProps,isRerender)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(targetElem){VizUtil.renderNoData(targetElem,"Graph rendering failed.")}console.error(e)}finally{if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}}};PlotlyGraphGenerator.prototype._render=function(viz,data,targetElem,renderType,onLoadCallback,onShowDetailCallback,onKeepThisCallback,onExcludeCallback,onBeforeRenderingCallback,onPropUpdateCallback,lang,configProps,isRerender){data=VizUtil.convertColumnarData(data);data=VizUtil.translateColumnData(data,viz,lang,true);this._initToolbarAvailability(targetElem,viz,data,onPropUpdateCallback);if(!isRerender&&this._isToolbarEnabled){this._initVariables={viz:viz,data:data,targetElem:targetElem,renderType:renderType,onLoadCallback:onLoadCallback,onErrorCallback:onShowDetailCallback,onKeepThisCallback:onExcludeCallback,onBeforeRenderingCallback:onBeforeRenderingCallback,onPropUpdateCallback:onPropUpdateCallback,lang:lang,configProps:configProps}}if(targetElem){if(targetElem.childNodes.length>0){d3.select(targetElem.querySelector("svg")).remove();$(targetElem).empty()}if(!data||data.length===0){VizUtil.renderNoData(targetElem);return}if(this._isToolbarEnabled){data=this._renderToolbar(targetElem,viz,data)}}if(viz.marker==="densityplot"){viz=PlotlyGraphGenerator._generateDensityPlotViz(viz)}else if(viz.marker==="scattermatrix"){viz=PlotlyGraphGenerator._generateScatterMatrixViz(viz)}var translateColumn=function(text){return viz.translate==="on"?VizUtil.getMessage(PlotlyGraphGenerator._lang,text,true):text};var marker=viz.marker?viz.marker:null;var isHistogram=marker==="hist",isBoxplot=marker==="boxplot",isHeatmap=/^(heatmap|contour)$/.test(marker)
;var x=viz.x?viz.x.label:null,y=viz.y?viz.y.label:null,z=viz.z?viz.z.label:null,size=viz.size?viz.size.label:null,color=viz.color?viz.color.label:null,isColorContinuous=viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color"),colorbucket=viz.colorbucket?viz.colorbucket.label:null,groupby=viz.groupby?viz.groupby.label:null,label=viz.label?viz.label.label:null,label2=viz.label2?viz.label2.label:null,label3=viz.label3?viz.label3.label:null,label4=viz.label4?viz.label4.label:null,label5=viz.label5?viz.label5.label:null,enableLabel2=!!viz.enableLabel2,facet=viz.facet?viz.facet.label:null,orderRow="..is.order.row",orientation=viz.orientation?viz.orientation:"vertical",barstyle=viz.barstyle?viz.barstyle:"stack",pieHole=!isNaN(viz.pieHole)?parseInt(viz.pieHole)/100:0,barPadding=viz.barPadding||(marker==="hist"?"0":null),opacity=viz.fillOpacity||VizUtil.getDefaultOpacity(viz)||null,sortTarget=viz.sortTarget?viz.sortTarget:"",sortOrder=viz.sortOrder?viz.sortOrder:"desc",labelOnPlot=viz.labelOnPlotOnUI==="off"?"off":viz.labelOnPlot?viz.labelOnPlot:"off",labelOnPlotHAlign=viz.labelOnPlotHAlign||"right",labelOnPlotVAlign=viz.labelOnPlotVAlign||"middle",errbarGraph=viz.errbarGraph||"bar",mapmode=viz.mapmode?viz.mapmode:"USA-states",marginLeft=viz.marginLeft,marginRight=viz.marginRight,marginTop=viz.marginTop,marginBottom=viz.marginBottom,title=viz.title,xAxisTitle=viz.xAxisTitle?translateColumn(viz.xAxisTitle):null,yAxisTitle=viz.yAxisTitle?translateColumn(viz.yAxisTitle):null,y2AxisTitle=viz.y2AxisTitle?translateColumn(viz.y2AxisTitle):null,zAxisTitle=viz.zAxisTitle?translateColumn(viz.zAxisTitle):null,xAxisPosition=viz.xAxisPosition||"bottom",xAxisShowTitle=viz.xAxisShowTitle!=="off",yAxisShowTitle=viz.yAxisShowTitle!=="off",y2AxisShowTitle=viz.y2AxisShowTitle!=="off",zAxisShowTitle=viz.zAxisShowTitle!=="off",circleMaxSize=viz.circleMaxSize||VizUtil.DEFAULT_MAX_CIRCLE_DIAMETER[marker],circleMinSize=viz.circleMinSize||VizUtil.DEFAULT_MIN_CIRCLE_DIAMETER[marker],legendShowFuncName=viz.legendShowFuncName==="on",legendShowAxisName=viz.legendShowAxisName!=="off",yValueOnPlot=viz.yValueOnPlot||"none",disableDecimalFormatting=!!viz.disableDecimalFormatting,numDecimalDigits=!viz.numDecimalDigits?null:parseInt(viz.numDecimalDigits),numDecimalDigitsForFilter=numDecimalDigits===null?2:numDecimalDigits,useThousandSeparator=viz.useThousandSeparator!=="off",userXAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.xAxisRange),userYAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.yAxisRange),userY2AxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.y2AxisRange),userZAxisRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.zAxisRange),formatXValue=null,formatY1Value=null,formatY2Value=null,formatZValue=null,xAxisDataTypeDetection=viz.xAxisDataTypeDetection==="on",layY1OverY2=viz.layY1OverY2==="on",NUMROWS_COL_LABEL=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.NUMROWS_COL_LABEL),isGroupByMeasuresEnabled=viz.facet&&viz.facet.type===VizUtil.TYPE_GROUP_BY_MEASURES,colMap={},yLineFillColumn=viz.yLineFillColumn,xReflineConstantColumn=viz.xReflineConstantColumn,i,l;if(isGroupByMeasuresEnabled){viz=JSON.parse(JSON.stringify(viz));colMap=PlotlyGraphGenerator._generateGroupByMeasuresViz(viz,data)}if(isNaN(pieHole)){pieHole=0}var ys=VizUtil.getOptions(viz,"y");var isMultiY=ys.length>1;var numY=0;ys.forEach(function(_y){if(_y){numY++}});var colsOn2ndAxis=[];var allowMultiYAndColor=viz.allowMultiYAndColor==="on";if(isHistogram){y=VizUtil.FREQ_COL_LABEL;if(!color&&!viz.histCumDistType){opacity=viz.fillOpacity||null}}formatValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(numDecimalDigits,true)?2:numDecimalDigits,useThousandSeparator,VizUtil.isEmpty(numDecimalDigits,true));formatXValue=!viz.xAxisNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.xAxisNumDecimalDigits,useThousandSeparator,false);formatY1Value=!viz.y1AxisNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.y1AxisNumDecimalDigits,useThousandSeparator,false);formatY2Value=!viz.y2AxisNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.y2AxisNumDecimalDigits,useThousandSeparator,false);formatZValue=!viz.zAxisNumDecimalDigits?formatValue:VizUtil.valueFormatterGenerator(viz.zAxisNumDecimalDigits,useThousandSeparator,false);if(isHeatmap){if(viz.x&&viz.y&&!viz.color){color='"count(*)"'}}else if(marker==="choropleth"&&!viz.color){color='"count(*)"'}else if(/^(bar|line|area)$/.test(marker)){if(viz.x&&!viz.y||viz.color&&!viz.y){y='"count(*)"'}}var nestData;var gData=[];var gRangeLayerData=[];var gTrendLineLayerData=[];var gTrendLineRangeLayerData=[];var gRefLineLayerData=[];var gRefLineUpperRangeLayerData=[];var gRefLineLowerRangeLayerData=[];var gVRefLineLayerData=[];var gVRefLineUpperRangeLayerData=[];var gVRefLineLowerRangeLayerData=[];var gLineFillLayerData=[];var sortTargetCol=viz[sortTarget]?viz[sortTarget].label:"";var sortTargetGbysumCol=sortTargetCol?sortTargetCol+".gbysum":"";var direction=sortOrder==="desc"?1:-1;var valueSortFunc=function(a,b){if(a[sortTargetGbysumCol]!==undefined&&b[sortTargetGbysumCol]!==undefined){return(b[sortTargetGbysumCol]-a[sortTargetGbysumCol])*direction}else{return(b[sortTargetCol]-a[sortTargetCol])*direction}};if(colorbucket){VizUtil.formatColorBucketData(data,VizUtil.applyColorBucketAfterSummarize(marker)?colorbucket:color,formatValue)}var xDataRange=null;if(/^(scatter|line|bubble)$/.test(marker)&&viz.x&&VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory"){var _xval=[];var _ycol=null;ys.forEach(function(d){if(!!d&&!_ycol){_ycol=d}});data.forEach(function(d){if(!VizUtil.isEmpty(d[viz.x.label])&&!VizUtil.isEmpty(d[_ycol.label])){_xval.push(d[viz.x.label])}});xDataRange=d3.extent(_xval);var _rangeMargin=Math.abs(xDataRange[1]-xDataRange[0])*.1;xDataRange[0]-=_rangeMargin;xDataRange[1]+=_rangeMargin}var colorScale=null;var numberOfItemsInColor=-1;var useHighlightScale=viz.enableHighlight==="on"&&color&&!isColorContinuous;if(/^(heatmap|contour)$/.test(marker)){if(facet){nestData=d3.nest().key(function(d){return VizUtil.isEmpty(d[facet])?NA_LABEL:d[facet]}).key(function(d){return(VizUtil.isEmpty(d[y])?NA_LABEL:d[y])+(marker==="heatmap"?"\n":"")}).key(function(d){return(VizUtil.isEmpty(d[x])?NA_LABEL:d[x])+(marker==="heatmap"?"\n":"")}).entries(data);var orderedKeys=VizUtil.distinct(data.map(function(d){return VizUtil.isEmpty(d[facet])?NA_LABEL:d[facet]}));var hash={};nestData.forEach(function(d){hash[d.key]=d});var sorted=[];orderedKeys.forEach(function(d){if(hash[d]){sorted.push(hash[d])}});nestData=sorted}else{nestData=[{key:"",values:d3.nest().key(function(d){return(VizUtil.isEmpty(d[y])?NA_LABEL:d[y])+(marker==="heatmap"?"\n":"")}).key(function(d){return(VizUtil.isEmpty(d[x])?NA_LABEL:d[x])+(marker==="heatmap"?"\n":"")}).entries(data)}]}}else if(viz.color){var colorcol=color,colors,sindex,opValue;if(colorbucket&&VizUtil.applyColorBucketAfterSummarize(marker)){colorcol=colorbucket}nestData=PlotlyGraphGenerator._flattenData(data,colorcol);if(viz.y){nestData.forEach(function(d){d.winfunc=viz.yWindowFunc})}if(isMultiY&&allowMultiYAndColor){ys.forEach(function(_y,_idx){if(_y&&_idx>0){var winfunc=viz["y"+(_idx===0?"":_idx)+"WindowFunc"];var funcLabel=!winfunc||winfunc==="none"?null:VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[winfunc]);if(!funcLabel){funcLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[_y.func])}var yOp="y"+(_idx===0?"":_idx);nestData.unshift({key:_y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:_y.name+(funcLabel&&legendShowFuncName?" ("+funcLabel+")":""),ycolname:_y.label,winfunc:winfunc,yOp:yOp,values:data.filter(function(d){return!(d[".resp"]&&d[".resp"]!==_y.label)})})}})}colorScale=nestData.length<=10?d3.scale.category10():d3.scale.category20();numberOfItemsInColor=nestData.length;if(viz&&viz.reverseColorPaletteOrder==="on"){colors=colorScale.range().slice();colors.reverse();colorScale=d3.scale.ordinal().range(colors)}if(viz.partialColorOpacityStartingIndex){sindex=parseInt(viz.partialColorOpacityStartingIndex);opValue=parseFloat(viz.partialColorOpacity);colors=colorScale.range().map(function(c,idx){if(idx<sindex){return c}return _setOpacity(c,opValue)});colorScale=d3.scale.ordinal().range(colors)}nestData=PlotlyGraphGenerator._flattenDataByFacet(viz,nestData)}else{if(isMultiY){nestData=[];ys.forEach(function(_y,_idx){if(_y){var yOp="y"+(_idx===0?"":_idx);var winfunc=viz[yOp+"WindowFunc"];var colLabel=viz[yOp+"ColumnName"];_y._columnDisplayName=colLabel;var funcLabel=!winfunc||winfunc==="none"?null:VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[winfunc]);if(!funcLabel){funcLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[_y.func])}var use2ndAxis=viz[yOp+"Use2ndAxis"]==="on"&&VizUtil.isDualYSupported(marker,viz.barstyle);if(use2ndAxis){colsOn2ndAxis.push(_y)}var key=colLabel?colLabel:_y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:_y.name;key=translateColumn(key);nestData.push({key:key+(funcLabel&&legendShowFuncName&&_y.type!==VizUtil.TYPE_NUMROWS?" ("+funcLabel+")":""),ycolname:_y.label,winfunc:winfunc,use2ndAxis:use2ndAxis,yOp:yOp,values:data.filter(function(d){return!(d[".resp"]&&d[".resp"]!==_y.label)})})}});if(allowMultiYAndColor){nestData.reverse()}if(legendShowAxisName&&colsOn2ndAxis&&colsOn2ndAxis.length>0){nestData.forEach(function(d){d.key+=" ("+(d.use2ndAxis?"Y2":"Y1")+")"})}}else{nestData=[{key:y,winfunc:viz.yWindowFunc,values:data}]}colorScale=nestData.length<10?d3.scale.category10():d3.scale.category20();numberOfItemsInColor=nestData.length;nestData=PlotlyGraphGenerator._flattenDataByFacet(viz,nestData)}var xValuePrefix="",y1ValuePrefix="",y2ValuePrefix="",zValuePrefix="",xValueSuffix="",y1ValueSuffix="",y2ValueSuffix="",zValueSuffix="",sizeValuePrefix="",sizeValueSuffix="",label1ValuePrefix="",label1ValueSuffix="",label2ValuePrefix="",label2ValueSuffix="",label3ValuePrefix="",label3ValueSuffix="",label4ValuePrefix="",label4ValueSuffix="",label5ValuePrefix="",label5ValueSuffix="",colorValuePrefix="",colorValueSuffix="";if(viz.x){xValuePrefix=VizUtil.getValuePrefix(viz.xAxisNumberFormatting,viz.xAxisCurrencySymbol,viz.marker);xValueSuffix=VizUtil.getValueSuffix(null,viz.x.func,viz.xAxisNumberFormatting,viz.marker)}if(viz.y){y1ValuePrefix=VizUtil.getValuePrefix(viz.yAxisNumberFormatting,viz.yAxisCurrencySymbol,viz.marker,viz.errbarCalcType,viz.errbarDirection);y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,viz.y.func,viz.yAxisNumberFormatting,viz.marker,viz.errbarCalcType,viz.errbarDirection)}if(marker==="hist"){y1ValueSuffix=VizUtil.getValueSuffix(viz.yWindowFunc,null,viz.yAxisNumberFormatting,viz.marker)}y2ValuePrefix=VizUtil.getValuePrefix(viz.y2AxisNumberFormatting,viz.y2AxisCurrencySymbol,viz.marker,viz.errbarCalcType,viz.errbarDirection);if(colsOn2ndAxis&&colsOn2ndAxis.length>0){ys.forEach(function(y,idx){if(y2ValueSuffix){return}if(viz["y"+idx+"Use2ndAxis"]&&y){y2ValueSuffix=VizUtil.getValueSuffix(viz["y"+idx+"WindowFunc"],y.func,viz.y2AxisNumberFormatting,viz.marker,viz.errbarCalcType,viz.errbarDirection)}})}if(viz.z){zValuePrefix=VizUtil.getValuePrefix(viz.zAxisNumberFormatting,viz.zAxisCurrencySymbol,viz.marker);zValueSuffix=VizUtil.getValueSuffix(null,null,viz.zAxisNumberFormatting,viz.marker)}if(viz.color){colorValuePrefix=VizUtil.getValuePrefix(viz.colorNumberFormatting,viz.colorCurrencySymbol,viz.marker);colorValueSuffix=VizUtil.getValueSuffix(viz.colorWindowFunc,viz.color.func,viz.colorNumberFormatting,viz.marker)}if(viz.size){sizeValuePrefix=VizUtil.getValuePrefix(viz.sizeNumberFormatting,viz.sizeCurrencySymbol,viz.marker);sizeValueSuffix=VizUtil.getValueSuffix(viz.sizeWindowFunc,viz.size.func,viz.sizeNumberFormatting,viz.marker)}if(viz.label){label1ValuePrefix=VizUtil.getValuePrefix(viz.label1NumberFormatting,viz.label1CurrencySymbol,viz.marker);label1ValueSuffix=VizUtil.getValueSuffix(viz.label1WindowFunc,viz.label.func,viz.label1NumberFormatting,viz.marker)}if(viz.label2){label2ValuePrefix=VizUtil.getValuePrefix(viz.label2NumberFormatting,viz.label2CurrencySymbol,viz.marker);label2ValueSuffix=VizUtil.getValueSuffix(viz.label2WindowFunc,viz.label2.func,viz.label2NumberFormatting,viz.marker)}if(viz.label3){label3ValuePrefix=VizUtil.getValuePrefix(viz.label3NumberFormatting,viz.label3CurrencySymbol,viz.marker);label3ValueSuffix=VizUtil.getValueSuffix(viz.label3WindowFunc,viz.label3.func,viz.label3NumberFormatting,viz.marker)}if(viz.label4){label4ValuePrefix=VizUtil.getValuePrefix(viz.label4NumberFormatting,viz.label4CurrencySymbol,viz.marker);label4ValueSuffix=VizUtil.getValueSuffix(viz.label4WindowFunc,viz.label4.func,viz.label4NumberFormatting,viz.marker)}if(viz.label5){label5ValuePrefix=VizUtil.getValuePrefix(viz.label5NumberFormatting,viz.label5CurrencySymbol,viz.marker);label5ValueSuffix=VizUtil.getValueSuffix(viz.label5WindowFunc,viz.label5.func,viz.label5NumberFormatting,viz.marker)}xValuePrefix=viz.xAxisValuePrefix||xValuePrefix;xValueSuffix=viz.xAxisValueSuffix||xValueSuffix;y1ValuePrefix=viz.y1AxisValuePrefix||y1ValuePrefix;y1ValueSuffix=viz.y1AxisValueSuffix||y1ValueSuffix;y2ValuePrefix=viz.y2AxisValuePrefix||y2ValuePrefix;y2ValueSuffix=viz.y2AxisValueSuffix||y2ValueSuffix;colorValuePrefix=viz.colorAxisValuePrefix||colorValuePrefix;colorValueSuffix=viz.colorAxisValueSuffix||colorValueSuffix;sizeValuePrefix=viz.sizeAxisValuePrefix||sizeValuePrefix;sizeValueSuffix=viz.sizeAxisValueSuffix||sizeValueSuffix;label1ValuePrefix=viz.label1AxisValuePrefix||label1ValuePrefix;label1ValueSuffix=viz.label1AxisValueSuffix||label1ValueSuffix;label2ValuePrefix=viz.label2AxisValuePrefix||label2ValuePrefix;label2ValueSuffix=viz.label2AxisValueSuffix||label2ValueSuffix;label3ValuePrefix=viz.label3AxisValuePrefix||label3ValuePrefix;label3ValueSuffix=viz.label3AxisValueSuffix||label3ValueSuffix;label4ValuePrefix=viz.label4AxisValuePrefix||label4ValuePrefix;label4ValueSuffix=viz.label4AxisValueSuffix||label4ValueSuffix;label5ValuePrefix=viz.label5AxisValuePrefix||label5ValuePrefix;label5ValueSuffix=viz.label5AxisValueSuffix||label5ValueSuffix;var formatTrendLineValueHash={};var formatRefLineValueHash={};var formatVRefLineValueHash={};ys.forEach(function(y,idx){var yOp="y"+(idx===0?"":idx);var use2ndAxis=viz[yOp+"Use2ndAxis"]==="on"&&VizUtil.isDualYSupported(marker,viz.barstyle);formatTrendLineValueHash[yOp]=VizUtil.valueFormatterGenerator(VizUtil.isEmpty(viz[yOp+"TrendLineNumDecimalDigits"],true)?null:viz[yOp+"TrendLineNumDecimalDigits"],useThousandSeparator,false);formatRefLineValueHash[yOp]={formatter:!viz[yOp+"RefLineNumDecimalDigits"]?use2ndAxis?formatY2Value:formatY1Value:VizUtil.valueFormatterGenerator(viz[yOp+"RefLineNumDecimalDigits"],useThousandSeparator,false),prefix:use2ndAxis?y2ValuePrefix:y1ValuePrefix,suffix:use2ndAxis?y2ValueSuffix:y1ValueSuffix,hideFromLegend:viz[yOp+"ReflineHideFromLegend"]===true||viz[yOp+"ReflineShowInLegend"]!=="on",hideValueFromBalloon:viz[yOp+"ReflineHideValueFromBalloon"],showLabelOnPlotArea:viz[yOp+"ReflineLabelOnPlotArea"]||""}});formatVRefLineValueHash.x={formatter:!viz["xRefLineNumDecimalDigits"]?formatXValue:VizUtil.valueFormatterGenerator(viz["xRefLineNumDecimalDigits"],useThousandSeparator,false),prefix:xValuePrefix,suffix:xValueSuffix,hideFromLegend:viz["xReflineHideFromLegend"]===true||viz["xReflineShowInLegend"]!=="on",hideValueFromBalloon:viz["xReflineHideValueFromBalloon"],showLabelOnPlotArea:viz["xReflineLabelOnPlotArea"]||""};var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";var colorarr,categColorPalette=viz.categColorPalette||viz.categColorPaletteDefault||VizUtil.getDefaultColorPalette(VizUtil.getBucketType("color",viz))||viz.colorPallete10,customCategColorPaletteOp=viz.customCategColorPalette||viz.customColorPallete10;if(VizUtil.isNumericAsDiscreteValueOnColor(viz)&&!(viz.categColorPalette||viz.categColorPaletteDefault)){categColorPalette="Blues"}if(customCategColorPaletteOp&&customCategColorPaletteOp.length>0&&categColorPalette==="custom"){colorarr=customCategColorPaletteOp.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else if(categColorPalette&&categColorPalette!=="default"&&VizUtil.CATEG_COLOR_PALETTES_HASH[categColorPalette]){var ncolors=numberOfItemsInColor?Math.min(numberOfItemsInColor,10):-1;if(numberOfItemsInColor>0&&VizUtil.colorbrewer[categColorPalette]&&VizUtil.colorbrewer[categColorPalette][ncolors]){colorarr=VizUtil.colorbrewer[categColorPalette][ncolors].slice()}else{colorarr=VizUtil.CATEG_COLOR_PALETTES_HASH[categColorPalette].color.slice()}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}if(viz.partialColorOpacityStartingIndex){sindex=parseInt(viz.partialColorOpacityStartingIndex);opValue=parseFloat(viz.partialColorOpacity);colorarr=colorarr.map(function(c,idx){if(idx<sindex){return c}return _setOpacity(c,opValue)})}colorScale=d3.scale.ordinal().range(colorarr)}if(useHighlightScale){colorScale=VizUtil.generateHighlightColorScale(viz.highlightDefaultColor||"#DCDEE0",viz.highlightValues||[])}var quantColorPaletteOp=viz.quantColorPalette||viz.colorPallete||(/^(heatmap|contour)$/.test(marker)?"RdBu":VizUtil.getDefaultColorPalette(VizUtil.getBucketType("color",viz))||"Blues");if(!VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp]){quantColorPaletteOp=/^(heatmap|contour)$/.test(marker)?"RdBu":"Blues"}var quantColorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp].color.slice();if(viz.customQuantColorPalette&&viz.customQuantColorPalette.length>0&&viz.quantColorPalette==="custom"){colorarr=viz.customQuantColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}quantColorPalette=colorarr}if(!/^(heatmap|contour)$/.test(marker)){var bucketType=VizUtil.getBucketType("color",viz);if(/^(bucket_kmeans|bucket_equal_width|bucket_equal_freq|bucket_custom)$/.test(bucketType)){var numBuckets=bucketType==="bucket_kmeans"?viz.colorBucketKmeansNumOfBuckets:viz.colorBucketNumOfBuckets;if(bucketType==="bucket_custom"){var customBucketAttrs=VizUtil.constructCustomBucketAttributes(viz.colorBucketCuttingPoints,viz.colorBucketLabels,viz.colorBucketIncludeOutsideRange!=="off",viz.colorBucketIncludeRightEdge!=="off",viz.colorBucketIncludeLowest!=="off",10);numBuckets=customBucketAttrs.expectedNumberOfLabels}if(numBuckets&&VizUtil.colorbrewer[quantColorPaletteOp]&&VizUtil.colorbrewer[quantColorPaletteOp][numBuckets]){quantColorPalette=VizUtil.colorbrewer[quantColorPaletteOp][numBuckets].slice()}}}if(reverseColorPaletteOrderOp==="on"){quantColorPalette.reverse()}if(colorbucket){colorScale=d3.scale.ordinal().range(quantColorPalette)}if(viz.categColorSeqValueMode==="on"&&colorScale){colorScale.range().forEach(function(x,idx){colorScale(idx+1+"")})}var _text;var _data;if(isBoxplot){nestData.forEach(function(d){var datum={x:[],y:[],text:[],customdata:[],marker:{}};if(opacity){datum.opacity=opacity}if(facet){datum.facet=d.facet}d.values.forEach(function(v){_data=new VizUtil.BalloonItemList;var xval=x?v[x]:d.key;datum.x=datum.x.concat(xval,xval,xval,xval,xval,xval,xval);if(x){_data.add({type:"x",name:translateColumn(viz.x.balloonDisplayName||viz.x.name),validName:viz.x.validName,rawValue:xval,value:xval,func:viz.x.func,datatype:viz.x.type,filter:true},marker,"x",false,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(xval))}datum.name=viz.y.name;if(color){datum.name=v[color];if(facet){datum.offsetgroup=v[color]}if(VizUtil.isEmpty(datum.name)){datum.name=NA_LABEL}datum.marker.color=colorScale(v[color]);_data.add({type:"color",name:translateColumn(viz.color.balloonDisplayName||viz.color.name),validName:viz.color.validName,rawValue:v[color],value:v[color],func:viz.color.func,datatype:viz.color.type,filter:true},marker,"color",false,viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]))}if(facet){_data.add({type:"facet",name:translateColumn(viz.facet.balloonDisplayName||viz.facet.name),validName:viz.facet.validName,rawValue:v[facet],value:v[facet],func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(v[facet]))}datum.y=datum.y.concat([v[1],v[2],v[2],v[3],v[4],v[4],v[5]]);_data.add({type:"y",name:translateColumn(viz.y.balloonDisplayName||viz.y.name),validName:viz.y.validName,rawValue:[v[1],v[2],v[3],v[4],v[5]],value:["Min: "+v[1],"1Q: "+v[2],"Median: "+v[3],"3Q: "+v[4],"Max: "+v[5]].join(", "),func:viz.y.func,datatype:viz.y.type,filter:false},marker,"y",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v));datum.customdata.push(_data.toArray())});if(!datum.marker.color){datum.marker.color=colorScale("a")}gData.push(datum)})}else if(/^(scattermatrix)$/.test(marker)){var datum={type:"splom",dimensions:[],text:[],customdata:[],hovermode:"text",hoverlabel:{bgcolor:[]},marker:{size:circleMinSize,color:[]}};if(opacity){datum.marker.opacity=opacity}if(color){datum.marker.color=[]}ys.forEach(function(y){if(y){datum.dimensions.push({label:y.name,values:[],_validLabel:y.validLabel})}});var _range,_colorRange,_scaleFunc,_colorScale=[];if(color){_range=colorScale.range();_colorRange=_range.map(function(x,idx){return idx*.01});_scaleFunc=d3.scale.ordinal().range(_colorRange);_range.forEach(function(x,idx){_colorScale.push([idx*.01,x]);_colorScale.push([(idx+1)*.01,x])});var _lastItem=_colorScale[_colorScale.length-1];_colorScale.push([_lastItem[0],_lastItem[1]]);_colorScale.push([1,_lastItem[1]])}else{_range=colorScale.range();_colorScale=[[0,_range[0]],[1,_range[0]]]}datum.marker.colorscale=_colorScale;data[data.length-1].forEach(function(x){_text=new VizUtil.BalloonItemList;if(color){datum.marker.color.push(_scaleFunc(x[viz.color.validLabel]));_text.add(translateColumn(viz.color.balloonDisplayName||viz.color.name)+": "+formatValue(x[viz.color.validLabel]),marker,"color",false,viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(x[viz.color.validLabel]));datum.hoverlabel.bgcolor.push(colorScale(x[viz.color.validLabel]))}else{datum.marker.color.push(0);datum.hoverlabel.bgcolor.push(colorScale("a"))}datum.dimensions.forEach(function(d){d.values.push(x[d._validLabel]);_text.add(translateColumn(d.balloonDisplayName||d.label)+": "+formatValue(x[d._validLabel]),marker,"dimension",false,d.balloonPosition,d.balloonPositionIndex,d.balloonAddBrackets,d.balloonInvisible||d.balloonHideIfEmpty&&VizUtil.isEmpty(x[d._validLabel]))});datum.text.push(_text.toArray().join("<br>"))});datum.marker.color.push(1);if(viz.facetShowDiagonalPlots!=="on"){datum.diagonal={visible:false}}if(viz.facetShowLowerHalfPlots==="off"){datum.showlowerhalf=false}if(viz.facetShowUpperHalfPlots==="off"){datum.showupperhalf=false}gData.push(datum)}else if(/^(heatmap|contour)$/.test(marker)){if(!color){if(targetElem){VizUtil.renderNoData(targetElem,"Color is not assigned.")}else{console.log("Color column is not defined in heatmap. Exiting.")}return}nestData.forEach(function(item){var groupData=item.values;var group={x:[],y:[],z:[],text:[],customdata:[],marker:{}};if(opacity){group.opacity=opacity}if(facet){group.facet=item.key}group.x=groupData[0].values.map(function(d){return d.key});group.y=groupData.map(function(d){return d.key});group.z=groupData.map(function(d){return d.values.map(function(d2){return d2.values[0][color]})});group.text=groupData.map(function(datax){return datax.values.map(function(datay){_text=new VizUtil.BalloonItemList;_text.add(translateColumn(viz.x.balloonDisplayName||viz.x.name)+": "+formatValue(datay.values[0][x]),marker,"x",viz.x.isNumeric,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][x]));if(viz.y){_text.add(translateColumn(viz.y.balloonDisplayName||viz.y.name)+": "+formatValue(datay.values[0][y]),marker,"y",viz.y.isNumeric,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][y]))}_text.add(translateColumn(viz.color.balloonDisplayName||(viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name))+": "+(VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:formatValue(datay.values[0][color])),marker,"color",viz.color.isNumeric,viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][color]));if(datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME]&&viz.showNumberOfRowsInBalloon==="on"){_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"(Number of Rows)")+": "+formatNumrowValue(datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME]),marker,"nrow",true,"bottom",null,null,null)}return _text.toArray().join("<br>")})});group.customdata=groupData.map(function(datax){return datax.values.map(function(datay){_data=new VizUtil.BalloonItemList;if(datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME]){_data.add({type:"nrow",name:NUMROWS_COL_LABEL,validName:VizUtil.NUMROWS_COL_NAME,rawValue:datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME],value:formatNumrowValue(datay.values[0][VizUtil.NROW_INTERNAL_COL_NAME]),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null)}_data.add({type:"x",name:translateColumn(viz.x.balloonDisplayName||viz.x.name),validName:viz.x.validName,rawValue:datay.values[0][x],value:formatValue(datay.values[0][x]),func:viz.x.func,datatype:viz.x.type,filter:true},marker,"x",viz.x.isNumeric,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][x]));if(viz.y){_data.add({type:"y",name:translateColumn(viz.y.balloonDisplayName||viz.y.name),validName:viz.y.validName,rawValue:datay.values[0][y],value:formatValue(datay.values[0][y]),func:viz.y.func,datatype:viz.y.type,filter:true},marker,"y",viz.y.isNumeric,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][y]))}_data.add({type:"color",name:translateColumn(viz.color.balloonDisplayName||(viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name)),validName:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.color.validName,rawValue:VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:datay.values[0][color],value:VizUtil.isEmpty(datay.values[0][color])?NA_LABEL:formatValue(datay.values[0][color]),func:viz.color.func,datatype:viz.color.type,filter:false},marker,"color",viz.color.isNumeric,viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][color]));if(viz.facet){_data.add({type:"facet",name:translateColumn(viz.facet.balloonDisplayName||viz.facet.name),validName:viz.facet.validName,rawValue:datay.values[0][facet],value:formatValue(datay.values[0][facet]),func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(datay.values[0][facet]))}return _data.toArray()})});if(!group.y||group.y[0]==="undefined"){group.y=[""]}while(quantColorPalette.length<5){quantColorPalette=quantColorPalette.concat(quantColorPalette)}group.colorscale=[[0,quantColorPalette[0]],[.25,quantColorPalette[1]],[.5,quantColorPalette[2]],[.75,quantColorPalette[3]],[1,quantColorPalette[4]]];gData.push(group)})}else{var FITTED_COLUMN="predicted_value";var CONF_HIGH_COLUMN="conf_high";var CONF_LOW_COLUMN="conf_low";var REFLINE_COLUMN="refline";var REFLINE_RANGE_COLUMN="refrange";var _color=color;var rangeLegendgroup=1;var trendLineLegendgroup=1;var trendLineRangeLegendgroup=1;var reflineHash={};var vreflineHash={};nestData.forEach(function(d){var group={name:d.key,marker:{line:{width:0}},line:{},customdata:[]};if(color&&facet&&marker==="violin"){group.offsetgroup=group.name}if(d.yOp){group.yOp=d.yOp}var range={x:[],hi:[],low:[]};var trendLineRange={x:[],hi:[],low:[]};var trendLineGroup={x:[],y:[],text:[],hoverinfo:"text",mode:"lines",showlegend:false};if(!color&&y&&!isMultiY){if(marker==="bubble"){group.name=viz.groupby?viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name:viz.y?viz.y.name:""}else if(marker==="hist"){group.name=viz.x?viz.x.name:""}else{group.name=viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.y.name}}if(group.name==="null"){group.name=NA_LABEL}if(allowMultiYAndColor){group.name=VizUtil.getMessage(PlotlyGraphGenerator._lang,group.name)}if(facet){group.facet=d.facet}if(/^(bar|errbar)$/.test(marker)&&viz.x&&!VizUtil.returnsNumericValue(viz.x)&&!VizUtil.returnsDateValue(viz.x)&&sortTarget&&sortTargetCol&&(!viz._desktopVersion||VizUtil.compareVersionStr(viz._desktopVersion,"5.3.2.1")<0)){d.values.sort(valueSortFunc)}var yop=d.yOp||"y",xop="x";var reflineEnabled=!!viz[yop+"ReflineType"]&&viz[yop+"ReflineType"]!=="none"&&VizUtil.isHorizontalReferenceLineSupported(marker);var reflineRangeEnabled=!!viz[yop+"ReflineRangeType"]&&viz[yop+"ReflineRangeType"]!=="none"&&VizUtil.isHorizontalReferenceLineSupported(marker);var vReflineEnabled=!!viz[xop+"ReflineType"]&&viz[xop+"ReflineType"]!=="none"&&VizUtil.isVerticalReferenceLineSupported(marker);var vReflineRangeEnabled=!!viz[xop+"ReflineRangeType"]&&viz[xop+"ReflineRangeType"]!=="none"&&VizUtil.isVerticalReferenceLineSupported(marker);trendLineGroup.line={width:viz[yop+"TrendLineWidth"]||1,dash:viz[yop+"TrendLineType"]||"dot"};var markerShape=viz[yop+"MarkerShape"];var markerSize=viz[yop+"MarkerSize"];var markerStyle=viz[yop+"MarkerLineStyle"];var markerOpacity=viz[yop+"FillOpacity"];var markerCircleSize=viz[yop+"MarkerCircleSize"];if(isGroupByMeasuresEnabled){reflineEnabled=!!colMap[group.facet].reflineType&&colMap[group.facet].reflineType!=="none"&&/^(bar|line|scatter|bubble|errbar)$/.test(marker);reflineRangeEnabled=!!colMap[group.facet].reflineRangeType&&colMap[group.facet].reflineRangeType!=="none"&&/^(bar|line|scatter|bubble|errbar)$/.test(marker);trendLineGroup.line.width=colMap[group.facet].trendLineWidth||1,trendLineGroup.line.dash=colMap[group.facet].trendLineType||"dot";markerShape=colMap[group.facet].markerShape;markerSize=colMap[group.facet].markerSize;markerStyle=colMap[group.facet].markerStyle;markerOpacity=colMap[group.facet].markerOpacity;markerCircleSize=colMap[group.facet].markerCircleSize}if(/^(scatter|line|bar)$/.test(marker)&&markerShape){switch(markerShape){case"circle":group.type="scatter";group.mode="markers";if(/^(bar|line)$/.test(marker)&&markerSize){group.marker.size=markerSize}if(allowMultiYAndColor&&viz.multiYAndColorOpacity){group.marker.opacity=parseFloat(viz.multiYAndColorOpacity)}if(!VizUtil.isEmpty(markerOpacity)){group.marker.opacity=parseFloat(markerOpacity)}break;case"bar":group.type="bar";group.mode=null;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"line":group.type="scatter";group.mode="lines";if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}
group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"line+circle":group.type="scatter";group.mode="lines+markers";if(/^(bar|line)$/.test(marker)&&markerCircleSize){group.marker.size=markerCircleSize}if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}break;case"default":if(marker==="line"){if(markerSize){group.line.width=markerSize}if(markerStyle){group.line.dash=markerStyle}group.opacity=opacity;if(!VizUtil.isEmpty(markerOpacity)){group.opacity=parseFloat(markerOpacity)}}else{if(!VizUtil.isEmpty(markerOpacity)){group.marker.opacity=parseFloat(markerOpacity)}}break}}if(marker==="line"&&!markerShape&&markerSize){group.line.width=markerSize}if(marker==="bubble"){group.type="scatter";group.mode="markers"}if(d.use2ndAxis){group.use2ndAxis=d.use2ndAxis;group.yaxis="y2"}var histRange=null;if(marker==="hist"&&d.values&&d.values.length>1){histRange=Math.abs(d.values[d.values.length-1][x]-d.values[d.values.length-2][x])/2;group.histRange=histRange}var _y=isMultiY?d.ycolname:y;var _xDateParser=null,_xDateFormatter=null,xHoverFormatter=null;if(viz.x&&VizUtil.returnsDateValue(viz.x)&&viz.xHoverFormat){_xDateParser=d3.time.format("%Y-%m-%d").parse;_xDateFormatter=d3.time.format(viz.xHoverFormat);xHoverFormatter=function(datestr){if(!datestr){return null}return _xDateFormatter(_xDateParser(datestr))}}var isLineGroup=xAxisDataTypeDetection&&label&&d.values.some(function(v){return v[label]==="line"});var prefix,suffix,formatfunc;d.values.forEach(function(v){_text=new VizUtil.BalloonItemList;_data=new VizUtil.BalloonItemList;if(marker==="scatter"&&allowMultiYAndColor){if(VizUtil.isUndefined(v[_y])&&!VizUtil.isUndefined(v[y])){_y=y}}if(marker!=="scatter"||!VizUtil.isUndefined(v[x])&&!VizUtil.isUndefined(v[_y])){var nrow=null;if(v[VizUtil.NROW_INTERNAL_COL_NAME]){nrow=v[VizUtil.NROW_INTERNAL_COL_NAME]}else if(marker==="hist"){nrow=v[y]}if(viz.y&&viz.y.type===VizUtil.TYPE_NUMROWS&&viz.yWindowFunc&&viz.yWindowFunc==="none"){nrow=null}if(viz.marker==="errbar"&&viz.errbarCalcType==="ratio"&&viz.y&&VizUtil.isEmpty(v[VizUtil.ERRBAR_NUMERATOR_INTERNAL_COL_NAME])){nrow=null}if(nrow){_data.add({type:"nrow",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,"(Number of Rows)"),validName:VizUtil.NUMROWS_COL_NAME,rawValue:nrow,value:formatNumrowValue(nrow),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null);if(viz.marker!=="errbar"&&viz.showNumberOfRowsInBalloon==="on"||viz.marker==="errbar"&&viz.errbarCalcType!=="ratio"){_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"(Number of Rows)")+": "+formatNumrowValue(nrow),marker,"nrow",true,"bottom",null,null,null)}}if(groupby){_text.add(translateColumn(viz.groupby.balloonDisplayName||(viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name))+": "+formatValue(v[groupby]),marker,"groupby",false,viz.groupby.balloonPosition,viz.groupby.balloonPositionIndex,viz.groupby.balloonAddBrackets,viz.groupby.balloonInvisible||viz.groupby.balloonHideIfEmpty&&VizUtil.isEmpty(v[groupby]));_data.add({type:"groupby",name:translateColumn(viz.groupby.balloonDisplayName||(viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_LABEL:viz.groupby.name)),validName:viz.groupby.type===VizUtil.TYPE_ROWID?VizUtil.ROWID_COL_NAME:viz.groupby.validName,rawValue:v[groupby],value:formatValue(v[groupby]),func:viz.groupby.func,datatype:viz.groupby.type,filter:viz.groupby.type!==VizUtil.TYPE_ROWID},marker,"groupby",false,viz.groupby.balloonPosition,viz.groupby.balloonPositionIndex,viz.groupby.balloonAddBrackets,viz.groupby.balloonInvisible||viz.groupby.balloonHideIfEmpty&&VizUtil.isEmpty(v[groupby]))}if(facet&&!isGroupByMeasuresEnabled){_data.add({type:"facet",name:translateColumn(viz.facet.balloonDisplayName||viz.facet.name),validName:viz.facet.validName,rawValue:v[facet],value:formatValue(v[facet]),func:viz.facet.func,datatype:viz.facet.type,filter:true},marker,"facet",false,viz.facet.balloonPosition,viz.facet.balloonPositionIndex,viz.facet.balloonAddBrackets,viz.facet.balloonInvisible||viz.facet.balloonHideIfEmpty&&VizUtil.isEmpty(v[facet]))}if(color){_text.add(translateColumn(viz.color.balloonDisplayName||(viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name))+": "+(marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:colorValuePrefix+formatValue(v[color])+colorValueSuffix),marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]));_data.add({type:"color",name:translateColumn(viz.color.balloonDisplayName||(viz.color.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.color.name)),validName:viz.color&&viz.color.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.color.validName,rawValue:marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:v[color],value:marker==="scatter"&&VizUtil.isEmpty(v[color])?NA_LABEL:colorValuePrefix+formatValue(v[color])+colorValueSuffix,func:viz.color.func,datatype:viz.color.type,filter:!(/^(scatter|bubble)$/.test(marker)&&VizUtil.returnsNumericValue(viz.color))},marker,"color",VizUtil.returnsNumericValue(viz.color)&&viz.color.func!=="ascategory",viz.color.balloonPosition,viz.color.balloonPositionIndex,viz.color.balloonAddBrackets,viz.color.balloonInvisible||viz.color.balloonHideIfEmpty&&VizUtil.isEmpty(v[color]))}if(size){if(!group.marker.size)group.marker.size=[];group.marker.size.push(v[size]);_text.add(translateColumn(viz.size.balloonDisplayName||(viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.size.name))+": "+sizeValuePrefix+formatValue(v[size])+sizeValueSuffix,marker,"size",true,viz.size.balloonPosition,viz.size.balloonPositionIndex,viz.size.balloonAddBrackets,viz.size.balloonInvisible||viz.size.balloonHideIfEmpty&&VizUtil.isEmpty(v[size]));_data.add({type:"size",name:translateColumn(viz.size.balloonDisplayName||(viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.size.name)),validName:viz.size&&viz.size.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.size.validName,rawValue:v[size],value:sizeValuePrefix+formatValue(v[size])+sizeValueSuffix,func:viz.size.func,datatype:viz.size.type,filter:false},marker,"size",true,viz.size.balloonPosition,viz.size.balloonPositionIndex,viz.size.balloonAddBrackets,viz.size.balloonInvisible||viz.size.balloonHideIfEmpty&&VizUtil.isEmpty(v[size]))}else if(/^(scatter)$/.test(marker)){if(Object.prototype.hasOwnProperty.call(v,"..size")){if(!group.marker.size)group.marker.size=[];group.marker.size.push(v["..size"]?1:null)}}else if(marker==="bubble"){if(Object.prototype.hasOwnProperty.call(v,"..is.order.row")){if(!group.marker.size)group.marker.size=[];group.marker.size.push(v["..is.order.row"]==="TRUE"?null:1)}}if(label){if(!group._label)group._label=[];group._label.push(v[label]);if(!viz.hideLabel&&!allowMultiYAndColor&&!xAxisDataTypeDetection&&yLineFillColumn!=="label"&&xReflineConstantColumn!=="label"){_text.add(translateColumn(viz.label.balloonDisplayName||(viz.label&&viz.label.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label.name))+": "+label1ValuePrefix+formatValue(v[label])+label1ValueSuffix,marker,"label",false,viz.label.balloonPosition,viz.label.balloonPositionIndex,viz.label.balloonAddBrackets,viz.label.balloonInvisible||viz.label.balloonHideIfEmpty&&VizUtil.isEmpty(v[label]));_data.add({type:"x",name:translateColumn(viz.label.balloonDisplayName||(viz.label&&viz.label.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label.name)),validName:viz.label&&viz.label.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label.validName,rawValue:v[label],value:label1ValuePrefix+formatValue(v[label])+label1ValueSuffix,func:viz.label.func,datatype:viz.label.type,filter:false},marker,"label",false,viz.label.balloonPosition,viz.label.balloonPositionIndex,viz.label.balloonAddBrackets,viz.label.balloonInvisible||viz.label.balloonHideIfEmpty&&VizUtil.isEmpty(v[label]))}}if(label2&&(allowMultiYAndColor||enableLabel2)&&yLineFillColumn!=="label2"&&xReflineConstantColumn!=="label2"){if(!(viz.hideLabel2||viz.hideEmptyLabel2&&VizUtil.isEmpty(v[label2]))){_text.add(translateColumn(viz.label2.balloonDisplayName||(viz.label2&&viz.label2.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label2.name))+": "+label2ValuePrefix+formatValue(v[label2])+label2ValueSuffix,marker,"label2",false,viz.label2.balloonPosition,viz.label2.balloonPositionIndex,viz.label2.balloonAddBrackets,viz.label2.balloonInvisible||viz.label2.balloonHideIfEmpty&&VizUtil.isEmpty(v[label2]));_data.add({type:"x",name:translateColumn(viz.label2.balloonDisplayName||(viz.label2&&viz.label2.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label2.name)),validName:viz.label2&&viz.label2.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label2.validName,rawValue:v[label2],value:label2ValuePrefix+formatValue(v[label2])+label2ValueSuffix,func:viz.label2.func,datatype:viz.label2.type,filter:false},marker,"label2",false,viz.label2.balloonPosition,viz.label2.balloonPositionIndex,viz.label2.balloonAddBrackets,viz.label2.balloonInvisible||viz.label2.balloonHideIfEmpty&&VizUtil.isEmpty(v[label2]))}}if(label3&&yLineFillColumn!=="label3"&&xReflineConstantColumn!=="label3"){_text.add(translateColumn(viz.label3.balloonDisplayName||(viz.label3&&viz.label3.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label3.name))+": "+label3ValuePrefix+formatValue(v[label3])+label3ValueSuffix,marker,"label3",false,viz.label3.balloonPosition,viz.label3.balloonPositionIndex,viz.label3.balloonAddBrackets,viz.label3.balloonInvisible||viz.label3.balloonHideIfEmpty&&VizUtil.isEmpty(v[label3]));_data.add({type:"x",name:translateColumn(viz.label3.balloonDisplayName||(viz.label3&&viz.label3.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label3.name)),validName:viz.label3&&viz.label3.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label3.validName,rawValue:v[label3],value:label3ValuePrefix+formatValue(v[label3])+label3ValueSuffix,func:viz.label3.func,datatype:viz.label3.type,filter:false},marker,"label3",false,viz.label3.balloonPosition,viz.label3.balloonPositionIndex,viz.label3.balloonAddBrackets,viz.label3.balloonInvisible||viz.label3.balloonHideIfEmpty&&VizUtil.isEmpty(v[label3]))}if(label4&&yLineFillColumn!=="label4"&&xReflineConstantColumn!=="label4"){_text.add(translateColumn(viz.label4.balloonDisplayName||(viz.label4&&viz.label4.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label4.name))+": "+label4ValuePrefix+formatValue(v[label4])+label4ValueSuffix,marker,"label4",false,viz.label4.balloonPosition,viz.label4.balloonPositionIndex,viz.label4.balloonAddBrackets,viz.label4.balloonInvisible||viz.label4.balloonHideIfEmpty&&VizUtil.isEmpty(v[label4]));_data.add({type:"x",name:translateColumn(viz.label4.balloonDisplayName||(viz.label4&&viz.label4.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label4.name)),validName:viz.label4&&viz.label4.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label4.validName,rawValue:v[label4],value:label4ValuePrefix+formatValue(v[label4])+label4ValueSuffix,func:viz.label4.func,datatype:viz.label4.type,filter:false},marker,"label4",false,viz.label4.balloonPosition,viz.label4.balloonPositionIndex,viz.label4.balloonAddBrackets,viz.label4.balloonInvisible||viz.label4.balloonHideIfEmpty&&VizUtil.isEmpty(v[label4]))}if(label5&&yLineFillColumn!=="label5"&&xReflineConstantColumn!=="label5"){_text.add(translateColumn(viz.label5.balloonDisplayName||(viz.label5&&viz.label5.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label5.name))+": "+label5ValuePrefix+formatValue(v[label5])+label5ValueSuffix,marker,"label5",false,viz.label5.balloonPosition,viz.label5.balloonPositionIndex,viz.label5.balloonAddBrackets,viz.label5.balloonInvisible||viz.label5.balloonHideIfEmpty&&VizUtil.isEmpty(v[label5]));_data.add({type:"x",name:translateColumn(viz.label5.balloonDisplayName||(viz.label5&&viz.label5.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.label5.name)),validName:viz.label5&&viz.label5.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.label5.validName,rawValue:v[label5],value:label5ValuePrefix+formatValue(v[label5])+label5ValueSuffix,func:viz.label5.func,datatype:viz.label5.type,filter:false},marker,"label5",false,viz.label5.balloonPosition,viz.label5.balloonPositionIndex,viz.label5.balloonAddBrackets,viz.label5.balloonInvisible||viz.label5.balloonHideIfEmpty&&VizUtil.isEmpty(v[label5]))}if(x){if(!group.x)group.x=[];group.x.push(v[x]);if(histRange){_text.add(translateColumn(viz.x.balloonDisplayName||viz.x.name)+": "+formatValue(v[x]-histRange)+" - "+formatValue(v[x]+histRange),marker,"x",true,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(v[x]));_data.add({type:"x",name:translateColumn(viz.x.balloonDisplayName||viz.x.name),validName:viz.x.validName,rawValue:v[x],value:formatValue(v[x]-histRange)+" - "+formatValue(v[x]+histRange),func:viz.x.func,datatype:viz.x.type,filter:true,histRange:histRange},marker,"x",true,viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(v[x]))}else{var _val=!xHoverFormatter?xValuePrefix+formatXValue(v[x])+xValueSuffix:xHoverFormatter(v[x]);_text.add(translateColumn(viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.x.name))+": "+_val,marker,"x",VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory",viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(v[x]));_data.add({type:"x",name:translateColumn(viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.x.name)),validName:viz.x&&viz.x.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.x.validName,rawValue:v[x],value:_val,func:marker==="scatter"&&viz.x.isNumeric?"round":viz.x.func,datatype:viz.x.type,filter:!(marker==="bubble"&&VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"x",VizUtil.returnsNumericValue(viz.x)&&viz.x.func!=="ascategory",viz.x.balloonPosition,viz.x.balloonPositionIndex,viz.x.balloonAddBrackets,viz.x.balloonInvisible||viz.x.balloonHideIfEmpty&&VizUtil.isEmpty(v[x]))}}if(_y){if(!group.y)group.y=[];if(!group.ygbysum)group.ygbysum=[];var ycol="y";var errLow=viz.yErrLow||viz.errLow;var errHigh=viz.yErrHigh||viz.errHigh;var errHighLowEnabled=viz.yErrHighLowEnabled||viz.errHighLowEnabled;var errHighLowRangeFunc=viz.yErrHighLowRangeFunc;var errBarWidth=viz.yErrBarWidth||viz.errBarWidth;if(viz.yErrHighLowEnabledOnUI==="off"){errHighLowEnabled="off"}if(isMultiY){if(!viz.color)_color=d.ycolname;ycol=d.yOp;errLow=viz[d.yOp+"ErrLow"];errHigh=viz[d.yOp+"ErrHigh"];errHighLowEnabled=viz[d.yOp+"ErrHighLowEnabled"];errHighLowRangeFunc=viz[d.yOp+"ErrHighLowRangeFunc"];errBarWidth=viz[d.yOp+"ErrBarWidth"];if(viz[d.yOp+"ErrHighLowEnabledOnUI"]==="off"){errHighLowEnabled="off"}}group.y.push(v[_y]);if(!VizUtil.isUndefined(v[_y+".gbysum"])){group.ygbysum.push(v[_y+".gbysum"])}var lineDistRangeEnabled=_y&&errHighLowEnabled==="func"&&!VizUtil.isUndefined(v[_y+"eb"])&&marker==="line";if(!VizUtil.isUndefined(v[_y])){var winfunc=d.winfunc&&d.winfunc!=="none"?" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[d.winfunc])+")":"";prefix=d.use2ndAxis?y2ValuePrefix:y1ValuePrefix;suffix=d.use2ndAxis?y2ValueSuffix:y1ValueSuffix;if(isGroupByMeasuresEnabled&&colMap[v[facet]]){prefix=colMap[v[facet]].valuePrefix;suffix=colMap[v[facet]].valueSuffix;winfunc=colMap[v[facet]].winfunc&&colMap[v[facet]].winfunc!=="none"?" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[colMap[v[facet]].winfunc])+")":""}if(marker==="errbar"){winfunc=" ("+(viz.errbarCalcType==="ratio"?VizUtil.getMessage(PlotlyGraphGenerator._lang,"Ratio"):VizUtil.getMessage(PlotlyGraphGenerator._lang,"Mean"))+")"}formatfunc=d.use2ndAxis?formatY2Value:formatY1Value;if(isMultiY){var _dispname=null,_coldef=null;if(!ycol){_coldef=viz.y;_dispname=translateColumn(_coldef.balloonDisplayName||(_coldef.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:_coldef.name))}else{_coldef=viz[ycol];_dispname=translateColumn(_coldef.balloonDisplayName||group.name)}_text.add(_dispname+(legendShowFuncName?"":winfunc)+": "+prefix+formatfunc(v[_y])+suffix,marker,"y",VizUtil.returnsNumericValue(_coldef)&&_coldef.func!=="ascategory",_coldef.balloonPosition,_coldef.balloonPositionIndex,_coldef.balloonAddBrackets,_coldef.balloonInvisible||_coldef.balloonHideIfEmpty&&VizUtil.isEmpty(v[_y]));_data.add({type:"y",name:_dispname+(legendShowFuncName?"":winfunc),validName:_coldef.validName,rawValue:v[_y],value:prefix+formatfunc(v[_y])+suffix,func:marker==="scatter"&&_coldef.isNumeric?"round":_coldef.func,datatype:null,filter:marker==="scatter"||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",VizUtil.returnsNumericValue(_coldef)&&_coldef.func!=="ascategory",_coldef.balloonPosition,_coldef.balloonPositionIndex,_coldef.balloonAddBrackets,_coldef.balloonInvisible||_coldef.balloonHideIfEmpty&&VizUtil.isEmpty(v[_y]));if(lineDistRangeEnabled&&!VizUtil.isUndefined(v[_y+"eb"])){_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range")+": "+prefix+formatfunc(v[_y+"eb"])+suffix+" ("+prefix+formatfunc(v[_y]-v[_y+"eb"])+suffix+" - "+prefix+formatfunc(v[_y]+v[_y+"eb"])+suffix+")",marker,"eb",true,_coldef.balloonPosition,_coldef.balloonPositionIndex,_coldef.balloonAddBrackets,_coldef.balloonInvisible||_coldef.balloonHideIfEmpty&&VizUtil.isEmpty(v[_y+"eb"]));_data.add({type:"y",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range"),validName:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range"),rawValue:v[_y],value:""+prefix+formatfunc(v[_y+"eb"])+suffix+" ("+prefix+formatfunc(v[_y]-v[_y+"eb"])+suffix+" - "+prefix+formatfunc(v[_y]+v[_y+"eb"])+suffix+")",func:null,datatype:null,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,_coldef.balloonPosition,_coldef.balloonPositionIndex,_coldef.balloonAddBrackets,_coldef.balloonInvisible||_coldef.balloonHideIfEmpty&&VizUtil.isEmpty(v[_y+"eb"]))}}else{if(viz.y){if(!VizUtil.isUndefined(v[y+"eb"])){var yval=prefix+formatfunc(v[y])+suffix;_text.add(translateColumn(viz.y.balloonDisplayName||(viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.y.name))+winfunc+": "+yval,marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y]));_data.add({type:"y",name:translateColumn(viz.y.balloonDisplayName||(viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.y.name))+winfunc,validName:viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.y.validName,rawValue:v[y],value:yval,func:marker==="scatter"&&viz.y.isNumeric?"round":viz[ycol].func,datatype:null,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y]));if(viz.errbarCalcType==="ratio"&&!VizUtil.isEmpty(v[VizUtil.ERRBAR_NUMERATOR_INTERNAL_COL_NAME])){var num=v[VizUtil.ERRBAR_NUMERATOR_INTERNAL_COL_NAME];var den=num/v[y]*100;if(!isNaN(den)){if(/^(truecount|falsecount|nacount|nnacount)$/.test(viz.y.func)){den=Math.round(den)}var ratioBy=viz.errbarDirection==="color"?VizUtil.getMessage(PlotlyGraphGenerator._lang,"X Axis"):viz.errbarDirection==="x"?VizUtil.getMessage(PlotlyGraphGenerator._lang,"Color"):VizUtil.getMessage(PlotlyGraphGenerator._lang,"All");var denLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Total Number")+" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,ratioBy)+")";_data.add({type:"nrow",name:denLabel,validName:VizUtil.NUMROWS_COL_NAME,rawValue:den,value:formatfunc(den),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null);_text.add(denLabel+": "+formatfunc(den),marker,"nrow",true,"bottom",null,null,null);var numLabel=NUMROWS_COL_LABEL;if(viz.y.type!==VizUtil.TYPE_NUMROWS){numLabel=viz.y.name+" ("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.AGGREGATION_FUNCTION_OPTIONS_HASH[viz.y.func])+")"}_data.add({type:"nrow",name:numLabel,validName:VizUtil.NUMROWS_COL_NAME,rawValue:num,value:formatfunc(num),func:"count",datatype:"numeric",filter:false},marker,"nrow",true,"bottom",null,null,null);_text.add(numLabel+": "+formatfunc(num),marker,"nrow",true,"bottom",null,null,null)}}_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range")+": "+prefix+formatfunc(v[y+"eb"])+suffix+" ("+prefix+formatfunc(v[y]-v[y+"eb"])+suffix+" - "+prefix+formatfunc(v[y]+v[y+"eb"])+suffix+")",marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y+"eb"]));_data.add({type:"y",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range"),validName:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range"),rawValue:v[y],value:""+prefix+formatfunc(v[y+"eb"])+suffix+" ("+prefix+formatfunc(v[y]-v[y+"eb"])+suffix+" - "+prefix+formatfunc(v[y]+v[y+"eb"])+suffix+")",func:null,datatype:null,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y+"eb"]))}else{_text.add(translateColumn(viz.y.balloonDisplayName||(isGroupByMeasuresEnabled?colMap[v[facet]].name:viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.y.name))+winfunc+": "+prefix+formatfunc(v[y])+suffix,marker,"y",VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory",viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y]));_data.add({type:"y",name:translateColumn(viz.y.balloonDisplayName||(isGroupByMeasuresEnabled?colMap[v[facet]].name:viz.y.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.y.name))+winfunc,validName:viz.y.type===VizUtil.TYPE_NUMROWS?VizUtil.NUMROWS_COL_NAME:viz.y.validName,rawValue:v[y],value:prefix+formatfunc(v[y])+suffix,func:/^(scatter|violin)$/.test(marker)&&viz.y.isNumeric?"round":viz[ycol].func,datatype:null,filter:/^(scatter|violin)$/.test(marker)||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory",viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible||viz.y.balloonHideIfEmpty&&VizUtil.isEmpty(v[y]))}}else{_text.add((marker==="hist"&&y===VizUtil.NUMROWS_COL_LABEL?NUMROWS_COL_LABEL:translateColumn(y))+winfunc+": "+prefix+formatfunc(v[y])+suffix,marker,"y",true,null,null,null,null);_data.add({type:"y",name:(marker==="hist"&&y===VizUtil.NUMROWS_COL_LABEL?NUMROWS_COL_LABEL:translateColumn(y))+winfunc,validName:VizUtil.NUMROWS_COL_NAME,rawValue:v[y],value:prefix+formatfunc(v[y])+suffix,func:"sum",datatype:null,filter:marker==="scatter"||marker==="bubble"&&!(VizUtil.returnsNumericValue(viz.y)&&viz.y.func!=="ascategory"),numDecimalDigits:numDecimalDigitsForFilter},marker,"y",true,null,null,null,null)}}}if(reflineEnabled){if(!group.refline)group.refline={x:[],y:[]};group.refline.x.push(VizUtil.isEmpty(v[x])?null:v[x]);group.refline.y.push(VizUtil.isEmpty(v[_y+REFLINE_COLUMN])?null:v[_y+REFLINE_COLUMN]);if(reflineRangeEnabled){if(!group.refrange)group.refrange={x:[],y:[]};group.refrange.x.push(VizUtil.isEmpty(v[x])?null:v[x]);group.refrange.y.push(VizUtil.isEmpty(v[_y+REFLINE_RANGE_COLUMN])?null:v[_y+REFLINE_RANGE_COLUMN])}}if(vReflineEnabled){if(!group.vrefline)group.vrefline={x:[],y:[]};group.vrefline.x.push(VizUtil.isEmpty(v[x+REFLINE_COLUMN])?null:v[x+REFLINE_COLUMN]);group.vrefline.y.push(VizUtil.isEmpty(v[_y])?null:v[_y]);if(!group.vrefrange)group.vrefrange={x:[],y:[]};group.vrefrange.x.push(VizUtil.isEmpty(v[x+REFLINE_RANGE_COLUMN])?null:v[x+REFLINE_RANGE_COLUMN]);group.vrefrange.y.push(VizUtil.isEmpty(v[_y])?null:v[_y])}if(lineDistRangeEnabled){if(v[_y]===null){}else{range.x.push(v[x]);range.hi.push(v[_y]+v[_y+"eb"]);range.low.push(v[_y]-v[_y+"eb"])}}else if(marker==="errbar"&&!VizUtil.isUndefined(v[y+"eb"])){if(!group.error_y){group.error_y={type:"data",array:[],visible:true,width:errBarWidth?errBarWidth:4}}group.error_y.array.push(v[y+"eb"])}else if(errHigh&&errLow&&viz[ycol].isNumeric&&errHighLowEnabled==="on"&&marker==="scatter"&&!isLineGroup){if(!group.error_y){group.error_y={type:"data",symmetric:false,array:[],arrayminus:[],visible:true,width:errBarWidth?errBarWidth:4}}if(!VizUtil.isUndefined(v[errHigh.label])&&!VizUtil.isUndefined(v[errLow.label])){group.error_y.array.push(v[errHigh.label]===null?0:Math.abs(v[viz[ycol].label]-v[errHigh.label]));group.error_y.arrayminus.push(v[errLow.label]===null?0:Math.abs(v[viz[ycol].label]-v[errLow.label]));if(!xAxisDataTypeDetection||!VizUtil.isEmpty(v[errHigh.label])){_text.add(translateColumn(errHigh.balloonDisplayName||errHigh.name)+": "+prefix+formatValue(v[errHigh.label])+suffix,marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex,errHigh.balloonAddBrackets,errHigh.balloonInvisible||errHigh.balloonHideIfEmpty&&VizUtil.isEmpty(v[errHigh.label]));_data.add({type:"errh",name:translateColumn(errHigh.balloonDisplayName||errHigh.name),validName:errHigh.validName,rawValue:v[errHigh.label],value:prefix+formatValue(v[errHigh.label])+suffix,func:null,datatype:null,filter:false},marker,"y",true,errHigh.balloonPosition,errHigh.balloonPositionIndex,errHigh.balloonAddBrackets,errHigh.balloonInvisible||errHigh.balloonHideIfEmpty&&VizUtil.isEmpty(v[errHigh.label]))}if(!xAxisDataTypeDetection||!VizUtil.isEmpty(v[errLow.label])){_text.add(translateColumn(errLow.balloonDisplayName||errLow.name)+": "+prefix+formatValue(v[errLow.label])+suffix,marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex,errLow.balloonAddBrackets,errLow.balloonInvisible||errLow.balloonHideIfEmpty&&VizUtil.isEmpty(v[errLow.label]));_data.add({type:"errl",name:translateColumn(errLow.balloonDisplayName||errLow.name),validName:errLow.validName,rawValue:v[errLow.label],value:prefix+formatValue(v[errLow.label])+suffix,func:null,datatype:null,filter:false},marker,"y",true,errLow.balloonPosition,errLow.balloonPositionIndex,errLow.balloonAddBrackets,errLow.balloonInvisible||errLow.balloonHideIfEmpty&&VizUtil.isEmpty(v[errLow.label]))}}}else if(y&&errHigh&&errLow&&errHighLowEnabled==="on"&&viz[ycol].isNumeric&&(marker==="line"||isLineGroup)){if(!VizUtil.isUndefined(v[errHigh.label])&&!VizUtil.isUndefined(v[errLow.label])){if(v[_y]===null){}else{range.x.push(v[x]);range.hi.push(v[errHigh.label]===null?v[_y]:v[errHigh.label]);range.low.push(v[errLow.label]===null?v[_y]:v[errLow.label]);if(!VizUtil.isEmpty(v[errHigh.label])){_text.add(translateColumn(errHigh.balloonDisplayName||errHigh.name)+": "+prefix+formatValue(v[errHigh.label])+suffix,marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex,errHigh.balloonAddBrackets,errHigh.balloonInvisible||errHigh.balloonHideIfEmpty&&VizUtil.isEmpty(v[errHigh.label]));_data.add({type:"errh",name:translateColumn(errHigh.balloonDisplayName||errHigh.name),validName:errHigh.validName,rawValue:v[errHigh.label],value:prefix+formatValue(v[errHigh.label])+suffix,func:null,datatype:null,filter:false},marker,"errh",true,errHigh.balloonPosition,errHigh.balloonPositionIndex,errHigh.balloonAddBrackets,errHigh.balloonInvisible||errHigh.balloonHideIfEmpty&&VizUtil.isEmpty(v[errHigh.label]))}if(!VizUtil.isEmpty(v[errLow.label])){_text.add(translateColumn(errLow.balloonDisplayName||errLow.name)+": "+prefix+formatValue(v[errLow.label])+suffix,marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex,errLow.balloonAddBrackets,errLow.balloonInvisible||errLow.balloonHideIfEmpty&&VizUtil.isEmpty(v[errLow.label]));_data.add({type:"errl",name:translateColumn(errLow.balloonDisplayName||errLow.name),validName:errLow.validName,rawValue:v[errLow.label],value:prefix+formatValue(v[errLow.label])+suffix,func:null,datatype:null,filter:false},marker,"errl",true,errLow.balloonPosition,errLow.balloonPositionIndex,errLow.balloonAddBrackets,errLow.balloonInvisible||errLow.balloonHideIfEmpty&&VizUtil.isEmpty(v[errLow.label]))}}}}}if(z){if(!group.z)group.z=[];group.z.push(v[z]);_text.add(translateColumn(viz.z.balloonDisplayName||viz.z.name)+": "+zValuePrefix+formatZValue(v[z])+zValueSuffix,marker,"z",VizUtil.returnsNumericValue(viz.z)&&viz.z.func!=="ascategory",viz.z.balloonPosition,viz.z.balloonPositionIndex,viz.z.balloonAddBrackets,viz.z.balloonInvisible||viz.z.balloonHideIfEmpty&&VizUtil.isEmpty(v[z]));_data.add({type:"z",name:translateColumn(viz.z.balloonDisplayName||viz.z.name),validName:viz.z.validName,rawValue:v[z],value:zValuePrefix+formatZValue(v[z])+zValueSuffix,func:viz.z.func,datatype:viz.z.type,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"z",VizUtil.returnsNumericValue(viz.z)&&viz.z.func!=="ascategory",viz.z.balloonPosition,viz.z.balloonPositionIndex,viz.z.balloonAddBrackets,viz.z.balloonInvisible||viz.z.balloonHideIfEmpty&&VizUtil.isEmpty(v[z]))}if(v[orderRow]!==undefined){if(!group._orderRow)group._orderRow=[];group._orderRow.push(!!v[orderRow])}if(marker==="errbar"||lineDistRangeEnabled){var fnc=marker==="errbar"?viz.errbarType:errHighLowRangeFunc;if(!fnc){fnc="confint"}_text.add(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type")+": "+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.ERROR_BAR_TYPE_OPTIONS_HASH[fnc]),marker,"stderr",true,null,null,null,null);_data.add({type:"y",name:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type"),validName:VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type"),rawValue:viz.errbarType,value:VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.ERROR_BAR_TYPE_OPTIONS_HASH[fnc]),func:null,datatype:null,filter:false,numDecimalDigits:numDecimalDigitsForFilter},marker,"eb",true,viz.y.balloonPosition,viz.y.balloonPositionIndex,viz.y.balloonAddBrackets,viz.y.balloonInvisible)}if(!group.text)group.text=[];if(v[orderRow]==="TRUE"){group.text.push("")}else if(allowMultiYAndColor&&marker==="scatter"&&group.mode==="markers"){if(viz.label2OnPlot==="on"&&!!label2&&group.type==="scatter"){group.text.push(v[label2])}else{group.text.push(_text.toArray().join("<br>"))}}else if(labelOnPlot==="on"&&label){group.text.push(v[label])}else if(_text.toArray().length>0){group.text.push(_text.toArray().join("<br>"))}group.customdata.push(v[orderRow]==="TRUE"?(new VizUtil.BalloonItemList).toArray():_data.toArray());if(marker==="scatter"){if(!group.marker.opacity){group.marker.opacity=opacity}else if(viz.fillOpacity){group.marker.opacity=viz.fillOpacity}}else if(marker==="bubble"){group.marker.opacity=opacity}else{group.opacity=opacity}if(_color){if(!group.marker.color){group.marker.color=[]}if(isMultiY&&!viz.color){group.marker.color=colorScale(_color)}else{if(viz.color&&VizUtil.applyColorBucketAfterSummarize(marker)&&colorbucket){group.marker.color.push(colorScale(v[colorbucket]))}else{if(isMultiY&&allowMultiYAndColor&&viz.color&&d.ycolname){group.marker.color=colorScale(_color)}else{group.marker.color=colorScale(v[_color])}}}}}var yOp=d.yOp||"y";var trendLineOp=d.yOp?viz[d.yOp+"TrendLine"]:viz.yTrendLine||viz.trendLine;var formatTrendLineValue=formatTrendLineValueHash[d.yOp||"y"];prefix=d.use2ndAxis?y2ValuePrefix:y1ValuePrefix;suffix=d.use2ndAxis?y2ValueSuffix:y1ValueSuffix;formatfunc=d.use2ndAxis?formatY2Value:formatY1Value
;var withRange=d.yOp?viz[d.yOp+"TrendLineWithRange"]:viz.yTrendLineWithRange||viz.trendLineWithRange;if(isGroupByMeasuresEnabled){trendLineOp=colMap[v[facet]].trendLine;formatTrendLineValue=colMap[v[facet]].formatTrendLineValue;prefix=colMap[v[facet]].valuePrefix;suffix=colMap[v[facet]].valueSuffix;withRange=colMap[v[facet]].trendLineWithRange||viz.yTrendLineWithRange}if(isGroupByMeasuresEnabled){trendLineOp=colMap[v[facet]].trendLine}if(x&&trendLineOp&&trendLineOp!=="none"&&/^(scatter|line|bubble)$/.test(marker)){if(!VizUtil.isEmpty(v[FITTED_COLUMN])&&(!xDataRange||v[x]>=xDataRange[0]&&v[x]<=xDataRange[1])){trendLineGroup.x.push(v[x]);trendLineGroup.y.push(v[FITTED_COLUMN]);var xValue=translateColumn(viz.x.balloonDisplayName||(viz.x.type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz.x.name))+": "+formatfunc(v[x]);var yValue=translateColumn(viz[yOp].balloonDisplayName||(viz[yOp].type===VizUtil.TYPE_NUMROWS?NUMROWS_COL_LABEL:viz[yOp].name))+": "+prefix+formatfunc(v[FITTED_COLUMN])+suffix;switch(trendLineOp){case"lmfit":var t="";if(v["cor.value"]){t+=VizUtil.getMessage(PlotlyGraphGenerator._lang,"Correlation")+": "+formatTrendLineValue(v["cor.value"])+"<br>"}t+=VizUtil.getMessage(PlotlyGraphGenerator._lang,"R Squared")+": "+formatTrendLineValue(v.r_squared);if(v.coef){var coef=convertCoefByTimeUnit(v.coef,viz.x.func,viz.x.type);t+="<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Coefficient")+": "+formatTrendLineValue(coef)}t+="<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"P-Value")+": "+formatTrendLineValue(v.p_value);t+="<br>("+xValue+")";t+="<br>("+yValue+")";trendLineGroup.text.push(t);break;case"gamfit":trendLineGroup.text.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"R Squared")+": "+formatTrendLineValue(v.r_squared)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Deviance Explained")+": "+formatTrendLineValue(v.deviance_explained)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"GCV")+": "+formatTrendLineValue(v.gcv)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Scale Est.")+": "+formatTrendLineValue(v.scale_est)+"<br>("+xValue+")"+"<br>("+yValue+")");break;case"loessfit":trendLineGroup.text.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Equivalent Number of Parameters")+": "+formatTrendLineValue(v.enp)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Residual Standard Error")+": "+formatTrendLineValue(v.residual_std_error)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Trace of Smoother Matrix")+": "+formatTrendLineValue(v.trace_of_smoother_matrix)+"<br>("+xValue+")"+"<br>("+yValue+")");break;case"logistic-fit":trendLineGroup.text.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"AUC")+": "+formatTrendLineValue(v.auc)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Odds Ratio")+": "+formatTrendLineValue(v.odds_ratio)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"P-Value")+": "+formatTrendLineValue(v.p_value)+"<br>("+xValue+")"+"<br>("+yValue+")");break;case"poisson-fit":trendLineGroup.text.push(VizUtil.getMessage(PlotlyGraphGenerator._lang,"Incidence Rate Ratio")+": "+formatTrendLineValue(v.incident_rate_ratio)+"<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"P-Value")+": "+formatTrendLineValue(v.p_value)+"<br>("+xValue+")"+"<br>("+yValue+")");break}}if(withRange!=="off"){if(!VizUtil.isEmpty(v[CONF_HIGH_COLUMN])&&!VizUtil.isEmpty(v[CONF_LOW_COLUMN])&&(!xDataRange||v[x]>=xDataRange[0]&&v[x]<=xDataRange[1])){trendLineRange.x.push(v[x]);trendLineRange.hi.push(v[CONF_HIGH_COLUMN]);trendLineRange.low.push(v[CONF_LOW_COLUMN])}}}});if(group.marker.color&&Array.isArray(group.marker.color)&&marker==="choropleth"){group.marker.colorscale=[[0,quantColorPalette[0]],[.25,quantColorPalette[1]],[.5,quantColorPalette[2]],[.75,quantColorPalette[3]],[1,quantColorPalette[4]]]}if(!group.marker.color){group.marker.color=colorScale("a")}if(marker==="errbar"&&group.error_y){if(errbarGraph==="bar"){group.error_y.color="#4d4d4d"}else if(errbarGraph==="marker"){group.error_y.color=group.marker.color}}else if(marker==="scatter"&&group.error_y){markerShape=viz[yop+"MarkerShape"];if(isGroupByMeasuresEnabled){markerShape=colMap[group.facet].markerShape}if(!markerShape||/^(circle|default)$/.test(markerShape)){group.error_y.color=group.marker.color}else{group.error_y.color="#4d4d4d"}}if(viz.hideNullFromLegend==="on"&&group.name==="null"){group.showlegend=false}if(!group.textfont){group.textfont={}}if(viz[yop+"SyncTextColor"]==="on"&&group.marker.color&&typeof group.marker.color==="string"){group.textfont.color=group.marker.color}if(viz[yop+"LabelFontSize"]){group.textfont.size=viz[yop+"LabelFontSize"]}if(viz.allowMultiYAndColor&&group.name===NA_LABEL&&isAllNull(group.y)){group.showlegend=false}if(xReflineConstantColumn&&viz[xReflineConstantColumn]){var colname=viz[xReflineConstantColumn].validLabel;var vs=[];d.values.forEach(function(v){if(v[colname]){vs.push(v[x])}});if(vs.length>0){group.constantValues=vs}}gData.push(group);gLineFillLayerData.push(PlotlyGraphGenerator._generateLineFillLayerData(viz,d,group,layout));if(reflineEnabled&&group.x&&!VizUtil.isUndefined(group.refline)){var reflineType=viz[yop+"ReflineType"];var reflineLabel="("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_OPTIONS_HASH[viz[yop+"ReflineType"]]||VizUtil.REFERENCE_LINE_OPTIONS[0].label)+")";if(reflineType==="constant"){reflineLabel=""}if(viz[yop+"ReflineLabel"]){reflineLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,viz[yop+"ReflineLabel"])}var reflineRangeType=viz[yop+"ReflineRangeType"];var reflineRangeLabel=reflineRangeType?VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH[reflineRangeType]):"";var reflineGroup=viz[yop+"ReflineGroup"]||"all";var reflineColor=viz[yop+"ReflineColor"]&&viz[yop+"ReflineColor"]!=="default"?viz[yop+"ReflineColor"]:isMultiY?group.marker.color:"#A6AAA9";var reflineWidth=viz[yop+"ReflineWidth"]||1;var reflineLength=viz[yop+"ReflineLength"]||12;var reflineStyle=viz[yop+"ReflineStyle"]||"solid";var reflineHideFromLegend=viz[yop+"ReflineHideFromLegend"]===true||viz[yop+"ReflineShowInLegend"]!=="on";if(isGroupByMeasuresEnabled){reflineType=colMap[group.facet].reflineType;reflineRangeType=colMap[group.facet].reflineRangeType;reflineRangeLabel=reflineRangeType?VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH[reflineRangeType]):"";reflineGroup=colMap[group.facet].reflineGroup||"all";reflineColor=colMap[group.facet].reflineColor&&colMap[group.facet].reflineColor!=="default"?colMap[group.facet].reflineColor:group.marker.color||"#A6AAA9";reflineWidth=colMap[group.facet].reflineWidth||1;reflineLength=colMap[group.facet].reflineLength||12;reflineStyle=colMap[group.facet].reflineStyle||"solid";reflineHideFromLegend=colMap[group.facet].reflineHideFromLegend===true||colMap[group.facet].reflineShowInLegend!=="on"}var errorbarRange=group.refline.x.map(function(){return 0});var reflineOnEachXDataPoint=/^(xaxis|xaxis\+facet)$/.test(reflineGroup)&&marker==="scatter"&&!VizUtil.returnsNumericValue(viz.x);var formatRefLineValue=formatRefLineValueHash[yop].formatter;var refLineValuePrefix=formatRefLineValueHash[yop].prefix;var refLineValueSuffix=formatRefLineValueHash[yop].suffix;var hideRefLineValueFromBalloon=formatRefLineValueHash[yop].hideValueFromBalloon;if(reflineRangeEnabled){var upperYValues=group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v+group.refrange.y[idx]});var upperYLabels=upperYValues.map(function(v){return reflineRangeLabel+": "+refLineValuePrefix+formatRefLineValue(v)+refLineValueSuffix});var lowerYValues=group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v-group.refrange.y[idx]});var lowerYLabels=lowerYValues.map(function(v){return reflineRangeLabel+": "+refLineValuePrefix+formatRefLineValue(v)+refLineValueSuffix});var lowerRangeLayer=null,upperRangeLayer=null;if(reflineOnEachXDataPoint){upperRangeLayer={name:reflineRangeLabel,x:group.refline.x,y:group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v+group.refrange.y[idx]}),error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:_setOpacity(reflineColor,.4)},type:"scatter",mode:"markers",showlegend:false,marker:{size:1,color:_setOpacity(reflineColor,.4),symbol:"line-ew-open"},hoverinfo:"text",text:upperYLabels,use2ndAxis:group.use2ndAxis,customdata:{type:reflineType,yOp:yop,text:upperYLabels}};lowerRangeLayer={name:reflineRangeLabel,x:group.refline.x,y:group.refline.y.map(function(v,idx){return VizUtil.isEmpty(v)?null:v-group.refrange.y[idx]}),error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:_setOpacity(reflineColor,.4)},type:"scatter",mode:"markers",showlegend:false,marker:{size:1,color:_setOpacity(reflineColor,.4),symbol:"line-ew-open"},hoverinfo:"text",text:lowerYLabels,use2ndAxis:group.use2ndAxis,customdata:{type:reflineType,yOp:yop,text:lowerYLabels}}}else{upperRangeLayer={x:group.refline.x,y:upperYValues,line:{color:_setOpacity(reflineColor,.4),width:reflineWidth,dash:reflineStyle},name:reflineRangeLabel,legendgroup:"refline"+yop,showlegend:false,visible:!reflineHash[yop],mode:"lines",text:upperYLabels,hoverinfo:"text",use2ndAxis:group.use2ndAxis,customdata:{type:reflineType,yOp:yop,text:upperYLabels}};lowerRangeLayer={x:group.refline.x,y:lowerYValues,line:{color:_setOpacity(reflineColor,.4),width:reflineWidth,dash:reflineStyle},name:reflineRangeLabel,legendgroup:"refline"+yop,showlegend:false,visible:!reflineHash[yop],mode:"lines",text:lowerYLabels,hoverinfo:"text",use2ndAxis:group.use2ndAxis,customdata:{type:reflineType,yOp:yop,text:lowerYLabels}}}gRefLineUpperRangeLayerData.push(upperRangeLayer);gRefLineLowerRangeLayerData.push(lowerRangeLayer)}else{gRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}var reflineLineGroup=null;var constructLabelText=function(v,idx){if(hideRefLineValueFromBalloon){return reflineLabel||""}var txt=(reflineLabel?reflineLabel+": ":"")+refLineValuePrefix+formatRefLineValue(v)+refLineValueSuffix;var rng=group.refrange&&group.refrange.y&&group.refrange.y.length>idx?group.refrange.y[idx]:null;if(rng!==null){txt+="<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range")+": "+refLineValuePrefix+formatRefLineValue(rng)+refLineValueSuffix+" ("+refLineValuePrefix+formatRefLineValue(v-rng)+refLineValueSuffix+" - "+refLineValuePrefix+formatRefLineValue(v+rng)+refLineValueSuffix+")<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type")+": "+reflineRangeLabel}return txt};var hoverText=group.refline.y.map(constructLabelText);if(reflineOnEachXDataPoint){reflineLineGroup={name:reflineLabel,x:group.refline.x,y:group.refline.y,error_y:{type:"data",array:errorbarRange,visible:true,width:reflineLength,thickness:reflineWidth,color:reflineColor},type:"scatter",mode:"markers",legendgroup:"refline"+yop,showlegend:!reflineHash[yop],visible:!reflineHash[yop],marker:{size:12,color:reflineColor,symbol:"line-ew-open"},hoverinfo:"text",text:hoverText,customdata:{type:viz[yop+"ReflineType"],yOp:yop,text:hoverText}}}else{reflineLineGroup={x:group.refline.x,y:group.refline.y,line:{color:reflineColor,width:reflineWidth,dash:reflineStyle},name:reflineLabel,legendgroup:"refline"+yop,showlegend:!reflineHash[yop],visible:!reflineHash[yop],mode:"lines",hoverinfo:"text",text:hoverText,customdata:{type:viz[yop+"ReflineType"],yOp:yop,text:hoverText}}}if(group.use2ndAxis){reflineLineGroup.use2ndAxis=group.use2ndAxis;reflineLineGroup.yaxis=group.yaxis}if(reflineHideFromLegend){reflineLineGroup.showlegend=false}if(reflineType==="diagonal"){recalculateDiagonalRefLineData(reflineLineGroup)}reflineHash[yop]=true;gRefLineLayerData.push(reflineLineGroup)}else{gRefLineLayerData.push({x:[],y:[],customdata:{}});gRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}if(vReflineEnabled&&group.x&&!VizUtil.isUndefined(group.vrefline)){var vReflineLabel="("+VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_OPTIONS_HASH[viz[xop+"ReflineType"]]||VizUtil.REFERENCE_LINE_OPTIONS[0].label)+")";if(viz[xop+"ReflineType"]==="constant"){vReflineLabel=""}if(viz[xop+"ReflineLabel"]){vReflineLabel=VizUtil.getMessage(PlotlyGraphGenerator._lang,viz[xop+"ReflineLabel"])}var vReflineColor=viz[xop+"ReflineColor"]||"#A6AAA9";var vReflineWidth=viz[xop+"ReflineWidth"]||1;var vReflineStyle=viz[xop+"ReflineStyle"]||"solid";var vReflineHideFromLegend=viz[xop+"ReflineHideFromLegend"]===true||viz[xop+"ReflineShowInLegend"]!=="on";var formatVRefLineValue=formatVRefLineValueHash[xop].formatter;var vRefLineValuePrefix=formatVRefLineValueHash[xop].prefix;var vRefLineValueSuffix=formatVRefLineValueHash[xop].suffix;var hideVRefLineValueFromBalloon=formatVRefLineValueHash[xop].hideValueFromBalloon;if(vReflineRangeEnabled){var vReflineRangeType=viz[xop+"ReflineRangeType"];var vReflineRangeLabel=vReflineRangeType?VizUtil.getMessage(PlotlyGraphGenerator._lang,VizUtil.REFERENCE_LINE_RANGE_TYPE_OPTIONS_HASH[vReflineRangeType]):"";var upperXValues=group.vrefline.x.map(function(v,idx){return VizUtil.isEmpty(v)?null:v+group.vrefrange.x[idx]});var upperXLabels=upperXValues.map(function(v){return vReflineRangeLabel+": "+vRefLineValuePrefix+formatVRefLineValue(v)+vRefLineValueSuffix});var lowerXValues=group.vrefline.x.map(function(v,idx){return VizUtil.isEmpty(v)?null:v-group.vrefrange.x[idx]});var lowerXLabels=lowerXValues.map(function(v){return vReflineRangeLabel+": "+vRefLineValuePrefix+formatVRefLineValue(v)+vRefLineValueSuffix});var upperVRangeLayer={x:upperXValues,y:group.vrefline.y,line:{color:_setOpacity(vReflineColor,.4),width:vReflineWidth,dash:vReflineStyle},name:vReflineRangeLabel,legendgroup:"refline"+xop,showlegend:false,visible:true,mode:"lines",text:upperXLabels,hoverinfo:"text",customdata:{type:viz[xop+"ReflineType"],xOp:xop,text:upperXLabels}};var lowerVRangeLayer={x:lowerXValues,y:group.vrefline.y,line:{color:_setOpacity(vReflineColor,.4),width:vReflineWidth,dash:vReflineStyle},name:vReflineRangeLabel,legendgroup:"refline"+xop,showlegend:false,visible:true,mode:"lines",text:lowerXLabels,hoverinfo:"text",customdata:{type:viz[xop+"ReflineType"],xOp:xop,text:lowerXLabels}};gVRefLineUpperRangeLayerData.push(upperVRangeLayer);gVRefLineLowerRangeLayerData.push(lowerVRangeLayer)}else{gVRefLineUpperRangeLayerData.push({x:[],y:[],customdata:{}});gVRefLineLowerRangeLayerData.push({x:[],y:[],customdata:{}})}hoverText=group.vrefline.x.map(function(v,idx){if(hideVRefLineValueFromBalloon){return vReflineLabel||""}var txt=(vReflineLabel?vReflineLabel+": ":"")+vRefLineValuePrefix+formatVRefLineValue(v)+vRefLineValueSuffix;var rng=group.vrefrange&&group.vrefrange.x&&group.vrefrange.x.length>idx?group.vrefrange.x[idx]:null;if(rng!==null){txt+="<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range")+": "+vRefLineValuePrefix+formatVRefLineValue(rng)+vRefLineValueSuffix+" ("+vRefLineValuePrefix+formatVRefLineValue(v-rng)+vRefLineValueSuffix+" - "+vRefLineValuePrefix+formatVRefLineValue(v+rng)+vRefLineValueSuffix+")<br>"+VizUtil.getMessage(PlotlyGraphGenerator._lang,"Range Type")+": "+vReflineRangeLabel}return txt});var vReflineGroup={x:group.use2ndAxis?[]:group.vrefline.x,y:group.use2ndAxis?[]:group.vrefline.y,line:{color:vReflineColor,width:vReflineWidth,dash:vReflineStyle},name:vReflineLabel,legendgroup:"vrefline",showlegend:!vreflineHash[xop],visible:!vreflineHash[xop],mode:"lines",hoverinfo:"text",text:hoverText,customdata:{text:hoverText},facet:group.facet};vreflineHash[xop]=true;if(vReflineHideFromLegend){vReflineGroup.showlegend=false}gVRefLineLayerData.push(vReflineGroup)}var copyx,copyx2;if(/^(line|scatter)$/.test(marker)&&!z&&range){var rangeGroup={x:[],y:[],fill:"tozerox",fillcolor:VizUtil.hexToRgba(isArray(group.marker.color)?quantColorPalette[quantColorPalette.length-1]:group.marker.color,.2),line:{color:"transparent"},name:group.name,showlegend:false,type:"scatter",hoverinfo:"skip"};if(d.use2ndAxis){rangeGroup.use2ndAxis=d.use2ndAxis;rangeGroup.yaxis="y2"}copyx=range.x?range.x.slice():group.x.slice();copyx2=range.x?range.x.slice():group.x.slice();rangeGroup.x=copyx.concat(copyx2.reverse());rangeGroup.y=range.hi.concat(range.low.reverse());rangeGroup.x.push(copyx[0]);rangeGroup.y.push(range.hi[0]);gRangeLayerData.push(rangeGroup);rangeGroup.legendgroup="lg"+rangeLegendgroup;group.legendgroup="lg"+rangeLegendgroup;rangeLegendgroup++}if(/^(line|scatter|bubble)$/.test(marker)&&!z&&trendLineGroup){trendLineGroup.marker={color:isColorContinuous?quantColorPalette[quantColorPalette.length-1]:group.marker.color};if(d.use2ndAxis){trendLineGroup.use2ndAxis=d.use2ndAxis;trendLineGroup.yaxis="y2"}gTrendLineLayerData.push(trendLineGroup);trendLineGroup.legendgroup="lg"+trendLineLegendgroup;group.legendgroup="lg"+trendLineLegendgroup;trendLineLegendgroup++}if(/^(line|scatter|bubble)$/.test(marker)&&!z&&trendLineRange){var trendLineRangeGroup={x:[],y:[],fill:"tozerox",fillcolor:VizUtil.hexToRgba(isColorContinuous?quantColorPalette[quantColorPalette.length-1]:group.marker.color,.2),line:{color:"transparent"},name:group.name,showlegend:false,type:"scatter",hoverinfo:"none"};if(d.use2ndAxis){trendLineRangeGroup.use2ndAxis=d.use2ndAxis;trendLineRangeGroup.yaxis="y2"}copyx=trendLineRange.x?trendLineRange.x.slice():group.x.slice();copyx2=trendLineRange.x?trendLineRange.x.slice():group.x.slice();trendLineRangeGroup.x=copyx.concat(copyx2.reverse());trendLineRangeGroup.y=trendLineRange.hi.concat(trendLineRange.low.reverse());trendLineRangeGroup.x.push(copyx[0]);trendLineRangeGroup.y.push(trendLineRange.hi[0]);trendLineRangeGroup.hoverinfo="skip";gTrendLineRangeLayerData.push(trendLineRangeGroup);trendLineRangeGroup.legendgroup="lg"+trendLineRangeLegendgroup;trendLineRangeLegendgroup++}})}if(VizUtil.isHorizontalReferenceLineSupported(marker)){var reflineGraphData=PlotlyGraphGenerator._constructConstantReferenceLineData("y",viz,gData,formatRefLineValueHash);if(reflineGraphData){gRefLineLayerData=reflineGraphData}}if(marker==="bar"&&barstyle==="stack"&&color&&gVRefLineLayerData.length>0){calculateStackBarRanges(viz,gData,gVRefLineLayerData)}if(VizUtil.isVerticalReferenceLineSupported(marker)){var vReflineGraphData=PlotlyGraphGenerator._constructConstantReferenceLineData("x",viz,gData,formatVRefLineValueHash);if(vReflineGraphData){gVRefLineLayerData=vReflineGraphData}}var divElem=null;if(targetElem){divElem=document.createElement("div");divElem.style.width="100%";divElem.style.height="100%";if(this._isToolbarEnabled&&!this._isToolbarHidden){divElem.style.height="calc(100% - "+TOOLBAR_HEIGHT+"px)"}targetElem.appendChild(divElem);viz._canvasWidth=$(targetElem).width();viz._canvasHeight=$(targetElem).height()}var _bottom=VizUtil.MIN_MARGIN,_left=VizUtil.MIN_MARGIN,_top=title?40:10,_right=colsOn2ndAxis.length>0?VizUtil.MIN_MARGIN+10:15,_v;_v=parseInt(marginTop);if(!isNaN(_v)){_top=_v}_v=parseInt(marginBottom);if(!isNaN(_v)){_bottom=_v}_v=parseInt(marginLeft);if(!isNaN(_v)){_left=_v}_v=parseInt(marginRight);if(!isNaN(_v)){_right=_v}if(/^(scatter|bubble)$/.test(marker)&&gData.length>0&&gData[0].marker.size&&gData[0].marker.size.length>0){var _exts=gData.map(function(d){if(!d.marker.size){return[]}return d3.extent(d.marker.size)});var _ext=d3.extent(d3.merge(_exts));var _scale=d3.scale.linear().domain(_ext).range([circleMinSize,circleMaxSize]);gData.forEach(function(d){if(!d.marker.size){return}d.marker.size_org=d.marker.size;d.marker.size=d.marker.size_org.map(function(sz){return sz===null?null:_scale(sz)})})}var layout={font:{family:'"Helvetica Neue", Arial, Helvetica, " Pro W3", "Hiragino Kaku Gothic Pro", "","Hiragino Sans", "Hiragino Kaku Gothic", "Meiryo UI", "", Meiryo, " ", "MS PGothic", sans-serif'},margin:{t:_top,b:_bottom,l:_left,r:_right},legend:{traceorder:"normal",font:{}},title:{font:{}},hovermode:viz.hoverMode||VizUtil.getDefaultHoverMode(marker),hoverlabel:{align:"left"},xaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},yaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},zaxis:{zerolinecolor:VizUtil.ZERO_LINE_COLOR,titlefont:{},tickfont:{}},paper_bgcolor:viz.backgroundColor||"rgba(255,255,255,1)",plot_bgcolor:viz.backgroundColor||"rgba(255,255,255,1)",scene:{xaxis:{titlefont:{},tickfont:{}},yaxis:{titlefont:{},tickfont:{}},yaxis2:{titlefont:{},tickfont:{}},zaxis:{titlefont:{},tickfont:{}}}};if(viz.hoverDistance){layout.hoverdistance=viz.hoverDistance}var xTickFormat=viz.xAxisTickFormat||(viz.xAxisNumDecimalDigits?",."+viz.xAxisNumDecimalDigits+"f":null);var yTickFormat=viz.yAxisTickFormat||(viz.y1AxisNumDecimalDigits?",."+viz.y1AxisNumDecimalDigits+"f":null);var y2TickFormat=viz.y2AxisTickFormat||(viz.y2AxisNumDecimalDigits?",."+viz.y2AxisNumDecimalDigits+"f":null);var zTickFormat=viz.zAxisTickFormat||(viz.zAxisNumDecimalDigits?",."+viz.zAxisNumDecimalDigits+"f":null);if(!xTickFormat&&viz.xAxisUseSIPrefix==="off"){xTickFormat=","}if(!yTickFormat&&viz.y1AxisUseSIPrefix==="off"){yTickFormat=","}if(!y2TickFormat&&viz.y2AxisUseSIPrefix==="off"){y2TickFormat=","}if(!zTickFormat&&viz.zAxisUseSIPrefix==="off"){zTickFormat=","}if(xTickFormat){layout.xaxis.tickformat=layout.scene.xaxis.tickformat=xTickFormat}if(yTickFormat){layout.yaxis.tickformat=layout.scene.yaxis.tickformat=yTickFormat}if(y2TickFormat){if(!layout.yaxis2){layout.yaxis2={}}if(!layout.scene.yaxis2){layout.scene.yaxis2={}}layout.yaxis2.tickformat=layout.scene.yaxis2.tickformat=y2TickFormat}if(zTickFormat){layout.zaxis.tickformat=layout.scene.zaxis.tickformat=zTickFormat}if(marker==="heatmap"){if(xAxisPosition==="top"){layout.xaxis.side="top"}}if(VizUtil.isAxisDirectionEnabled(marker)){if(viz.xAxisDirection){layout.xaxis.autorange=viz.xAxisDirection}if(viz.yAxisDirection){layout.yaxis.autorange=viz.yAxisDirection}if(viz.y2AxisDirection){if(!layout.yaxis2){layout.yaxis2={}}layout.yaxis2.autorange=viz.y2AxisDirection}if(viz.zAxisDirection){layout.zaxis.autorange=viz.zAxisDirection}}if(viz.x){layout.xaxis.title=layout.scene.xaxis.title=translateColumn(viz.x.name)}if(viz.y){layout.yaxis.title=layout.scene.yaxis.title=translateColumn(viz.y.name)}if(viz.z){layout.zaxis.title=layout.scene.zaxis.title=translateColumn(viz.z.name)}if(y===VizUtil.FREQ_COL_LABEL){layout.yaxis.title=y}if(viz.x&&viz.x.type===VizUtil.TYPE_NUMROWS){layout.xaxis.title=NUMROWS_COL_LABEL}if(viz.y&&viz.y.type===VizUtil.TYPE_NUMROWS){layout.yaxis.title=NUMROWS_COL_LABEL}if(!isMultiY&&viz.yWindowFunc&&/^(bar|line|area)$/.test(marker)){var _funclabel=VizUtil.WINDOW_FUNCTION_OPTIONS_HASH[viz.yWindowFunc];if(_funclabel&&viz.yWindowFunc!=="none"&&legendShowFuncName){layout.yaxis.title+=" ("+_funclabel+")"}}layout.xaxis.tickprefix=layout.scene.xaxis.tickprefix=xValuePrefix;layout.xaxis.ticksuffix=layout.scene.xaxis.ticksuffix=xValueSuffix;layout.yaxis.tickprefix=layout.scene.yaxis.tickprefix=y1ValuePrefix;layout.yaxis.ticksuffix=layout.scene.yaxis.ticksuffix=y1ValueSuffix;layout.zaxis.tickprefix=layout.scene.zaxis.tickprefix=zValuePrefix;layout.zaxis.ticksuffix=layout.scene.zaxis.ticksuffix=zValueSuffix;if(/^(scatter|bubble)$/.test(marker)&&viz.xAxisScale){layout.xaxis.type=layout.scene.xaxis.type=viz.xAxisScale}if(viz.x&&VizUtil.returnsDateValue(viz.x)){layout.xaxis.type=layout.scene.xaxis.type="date"}if(/^(scatter|bar|errbar|hist|bubble|line|area)$/.test(marker)&&viz.yAxisScale){layout.yaxis.type=layout.scene.yaxis.type=viz.yAxisScale}if(viz.y&&VizUtil.returnsDateValue(viz.y)){layout.yaxis.type=layout.scene.yaxis.type="date"}if(/^(scatter)$/.test(marker)&&viz.zAxisScale){layout.zaxis.type=layout.scene.zaxis.type=viz.zAxisScale}if(viz.z&&VizUtil.returnsDateValue(viz.z)){layout.zaxis.type=layout.scene.zaxis.type="date"}if(viz.y&&viz.yColumnName&&isMultiY){yAxisTitle=viz.yColumnName}if(xAxisTitle){layout.xaxis.title=layout.scene.xaxis.title=xAxisTitle}if(yAxisTitle){layout.yaxis.title=layout.scene.yaxis.title=yAxisTitle}if(zAxisTitle){layout.zaxis.title=layout.scene.zaxis.title=zAxisTitle}if(!xAxisShowTitle){layout.xaxis.title=layout.scene.xaxis.title=""}if(!yAxisShowTitle){layout.yaxis.title=layout.scene.yaxis.title=""}if(!zAxisShowTitle){layout.zaxis.title=layout.scene.zaxis.title=""}layout.xaxis.titlefont.size=layout.scene.xaxis.titlefont.size=viz.xAxisTitleFontSize||13;layout.yaxis.titlefont.size=layout.scene.yaxis.titlefont.size=viz.yAxisTitleFontSize||13;layout.zaxis.titlefont.size=layout.scene.zaxis.titlefont.size=viz.zAxisTitleFontSize||13;if(viz.xAxisTickFontSize){layout.xaxis.tickfont.size=layout.scene.xaxis.tickfont.size=viz.xAxisTickFontSize}if(viz.yAxisTickFontSize){layout.yaxis.tickfont.size=layout.scene.yaxis.tickfont.size=viz.yAxisTickFontSize}if(viz.zAxisTickFontSize){layout.zaxis.tickfont.size=layout.scene.zaxis.tickfont.size=viz.zAxisTickFontSize}if(viz.axisAutoMargin!=="off"){layout.xaxis.automargin=true;layout.yaxis.automargin=true}if(viz.showXGridLines&&viz.showXGridLines!=="default"){layout.xaxis.showgrid=layout.scene.xaxis.showgrid=viz.showXGridLines==="on"}if(viz.showYGridLines&&viz.showYGridLines!=="default"){layout.yaxis.showgrid=layout.scene.yaxis.showgrid=viz.showYGridLines==="on"}if(viz.showZGridLines&&viz.showZGridLines!=="default"){layout.zaxis.showgrid=layout.scene.zaxis.showgrid=viz.showZGridLines==="on"}if(!viz.x){layout.xaxis.zeroline=layout.scene.xaxis.zeroline=false}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"){layout.xaxis.zeroline=layout.scene.xaxis.zeroline=viz.showXZeroLine==="on"}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){layout.yaxis.zeroline=layout.scene.yaxis.zeroline=viz.showYZeroLine==="on"}if(viz.showZZeroLine&&viz.showZZeroLine!=="default"){layout.zaxis.zeroline=layout.scene.zaxis.zeroline=viz.showZZeroLine==="on"}if(viz.xAxisTickStep&&viz.x&&VizUtil.returnsNumericValue(viz.x)){layout.xaxis.dtick=layout.scene.xaxis.dtick=viz.xAxisTickStep}if(userXAxisRange){layout.xaxis.range=layout.scene.xaxis.range=userXAxisRange}if(viz.yAxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.dtick=layout.scene.yaxis.dtick=viz.yAxisTickStep}if(userYAxisRange){layout.yaxis.range=layout.scene.yaxis.range=userYAxisRange}if(viz.zAxisTickStep&&viz.z&&VizUtil.returnsNumericValue(viz.z)){layout.zaxis.dtick=layout.scene.zaxis.dtick=viz.zAxisTickStep}if(userZAxisRange){layout.zaxis.range=layout.scene.zaxis.range=userZAxisRange}if(viz.x&&!VizUtil.returnsNumericValue(viz.x)&&VizUtil.isPostFilterSupported(viz,"x")&&viz.xPostFilterType){layout.xaxis.type="category"}if(colsOn2ndAxis.length>0){if(!layout.yaxis2){layout.yaxis2={}}layout.yaxis2.zerolinecolor=VizUtil.ZERO_LINE_COLOR;layout.yaxis2.titlefont={};layout.yaxis2.tickfont={};layout.yaxis2.side="right";if(layY1OverY2){layout.yaxis.overlaying="y2"}else{layout.yaxis2.overlaying="y"}if(viz.axisAutoMargin!=="off"){layout.yaxis2.automargin=true}var _col=colsOn2ndAxis[0];if(y2AxisTitle){layout.yaxis2.title=layout.scene.yaxis2.title=y2AxisTitle}else{layout.yaxis2.title=_col.name;if(_col.label===VizUtil.FREQ_COL_LABEL){layout.yaxis2.title=_col.label}if(_col.type===VizUtil.TYPE_NUMROWS){layout.yaxis2.title=NUMROWS_COL_LABEL}if(_col._columnDisplayName){layout.yaxis2.title=_col._columnDisplayName}}if(!y2AxisShowTitle){layout.yaxis2.title=""}layout.yaxis2.title=translateColumn(layout.yaxis2.title);if(/^(scatter|bar|errbar|hist|bubble|area|line)$/.test(marker)&&viz.y2AxisScale){layout.yaxis2.type=layout.scene.yaxis2.type=viz.y2AxisScale}if(VizUtil.returnsDateValue(_col)){layout.yaxis2.type=layout.scene.yaxis2.type="date"}layout.yaxis2.tickprefix=y2ValuePrefix;layout.yaxis2.ticksuffix=y2ValueSuffix;layout.yaxis2.titlefont.size=viz.y2AxisTitleFontSize||13;if(viz.y2AxisTickFontSize){layout.yaxis2.tickfont.size=viz.y2AxisTickFontSize}layout.yaxis2.showgrid=viz.showY2GridLines==="on";layout.yaxis2.zeroline=viz.showY2ZeroLine==="on";if(viz.y2AxisTickStep&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.dtick=viz.y2AxisTickStep}if(userY2AxisRange){layout.yaxis2.range=userY2AxisRange}}if(viz.legendFontSize){layout.legend.font.size=viz.legendFontSize}if(title){layout.title.text=title}if(viz.titleFontSize){layout.title.font.size=viz.titleFontSize}if(viz.titleLocation){switch(viz.titleLocation){case"left":layout.title.xanchor="left";layout.title.x=0;break;case"right":layout.title.xanchor="right";layout.title.x=1;break;default:layout.title.xanchor="center";delete layout.title.x;break}}if(viz.width){layout.width=viz.width}if(viz.height){layout.height=viz.height;if(this._isToolbarEnabled&&!this._isToolbarHidden){layout.height-=TOOLBAR_HEIGHT}}var config={displayModeBar:false};if(PlotlyGraphGenerator._lang&&PlotlyGraphGenerator._lang!=="en"){config.locale=PlotlyGraphGenerator._lang}if(configProps&&configProps.doubleClickDelay){config.doubleClickDelay=configProps.doubleClickDelay}switch(viz.legendLocation){case"top":layout.legend.orientation="h";layout.legend.y=viz.plotlyLegendPosY||1;layout.legend.x=viz.plotlyLegendPosX||.5;layout.legend.xanchor="center";layout.legend.yanchor="bottom";if(isMultiY||color){layout.margin.t+=18}break;case"bottom":layout.legend.orientation="h";layout.legend.y=viz.plotlyLegendPosY||-.12;layout.legend.x=viz.plotlyLegendPosX||.5;layout.legend.xanchor="center";break;case"left":layout.legend.orientation="v";layout.legend.y=viz.plotlyLegendPosY||1.04;layout.legend.x=viz.plotlyLegendPosX||-.2;break;case"none":layout.showlegend=false;break;default:if(viz.plotlyLegendPosX){layout.legend.x=viz.plotlyLegendPosX}if(viz.plotlyLegendPosY){layout.legend.y=viz.plotlyLegendPosY}break}if(viz._invalidLogicalizeCommandForColor){layout.showlegend=false}if(viz.hoverLabelBgColorBrightnessRatio){gData.forEach(function(g){if(!g.hoverlabel){g.hoverlabel={}}if(g.marker.color){g.hoverlabel.bgcolor=_adjustColor(g.marker.color,viz.hoverLabelBgColorBrightnessRatio)}})}var annotations,annotationContext=null,gDataFiltered,syncYAxis=(viz.facetSyncYAxis||VizUtil.getDefaultSyncYAxis(marker,isGroupByMeasuresEnabled))!=="off";switch(marker){case"scatter":layout.barmode="group";if(viz.scatterLayoutMode){layout.barmode=viz.scatterLayoutMode}if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout.yaxis.type="category"}if(allowMultiYAndColor){layout.legend.traceorder="reversed"}gData=gData.map(function(datum){datum.mode=datum.mode||"markers";datum.hoverinfo="text";if(allowMultiYAndColor){datum._multiYAndColor=true;if(viz.multiYAndColorHideNA&&datum.name===NA_LABEL){datum.showlegend=false}}if(allowMultiYAndColor&&datum.mode==="markers"&&datum.type==="scatter"){if(viz.label2OnPlot==="on"&&label2){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;if(datum.type==="bar"){datum.textposition="outside"}datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize){if(!datum.textfont){datum.textfont={}}datum.textfont.size=viz.yValueOnPlotFontSize}}}else{if(labelOnPlot==="on"&&label){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;if(datum.type==="bar"){datum.textposition="outside"}datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize){if(!datum.textfont){datum.textfont={}}datum.textfont.size=viz.yValueOnPlotFontSize}}}if(datum.marker){datum.marker.sizemode="diameter";datum.marker.sizemin=circleMinSize/2;if(!datum.marker.size){datum.marker.size=circleMinSize}}if(datum.z){datum.type="scatter3d"}if(datum.name==="null"){datum.visible=false;datum.showlegend=false}return datum});if(facet){constructFacetData(viz,gData,layout,colMap,colorarr&&colorarr.length>0?colorarr[0]:null,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineUpperRangeLayerData,gVRefLineLowerRangeLayerData)}else{if(viz.xAxisIncludeZero==="on"&&!layout.xaxis.range){
layout.xaxis.range=layout.scene.xaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"x")}if(viz.yAxisIncludeZero==="on"&&!layout.yaxis.range){layout.yaxis.range=layout.scene.yaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.yAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"y1")}if(viz.y2AxisIncludeZero==="on"&&!!layout.y2axis&&!layout.y2axis.range&&colsOn2ndAxis.length>0){if(!layout.y2axis){layout.y2axis={}}layout.y2axis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.y2AxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"y2")}if(viz.zAxisIncludeZero==="on"&&!layout.zaxis.range){layout.zaxis.range=layout.scene.zaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"z",viz.zAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"z")}}if(xAxisDataTypeDetection){gData.forEach(function(datum,idx){if(datum._label&&datum._label.length>0&&datum._label.indexOf("line")!==-1){delete datum.error_y;datum.mode="lines";if(datum.xaxis){delete layout[datum.xaxis.replace("x","xaxis")].type}else{delete layout.xaxis.type}if(!VizUtil.isEmpty(viz.xAxisDataTypeDetectionLineRefLineConst)||viz.xAxisDataTypeDetectionSupressLineRefLine==="on"){if(gRefLineLayerData&&gRefLineLayerData.length>idx&&gRefLineLayerData[idx].y){gRefLineLayerData[idx].y=gRefLineLayerData[idx].y.map(function(v){if(viz.xAxisDataTypeDetectionSupressLineRefLine==="on"){return null}else{return VizUtil.isEmpty(v)?v:viz.xAxisDataTypeDetectionLineRefLineConst}});gRefLineLayerData[idx].x.sort(function(a,b){return parseFloat(a)-parseFloat(b)})}}}})}if(viz.clusterCircles&&/^(line|fill)$/.test(viz.clusterCircles)){layout.shapes=[];gData.forEach(function(datum){var cx=[],cy=[];if(datum&&datum.y){datum.y.forEach(function(yval,index){if(!VizUtil.isEmpty(yval)){cy.push(yval);cx.push(datum.x[index])}})}if(cx.length>0){var xext=d3.extent(cx);var yext=d3.extent(cy);var shape={type:"circle",xref:datum.xaxis?datum.xaxis:"x",yref:datum.yaxis?datum.yaxis:"y",x0:xext[0],y0:yext[0],x1:xext[1],y1:yext[1]};var colorValue=datum.marker.color||"#0000FF";if(Array.isArray(colorValue)){colorValue=colorValue.length>0?colorValue[0]:"#0000FF"}if(viz.clusterCircles==="line"){shape.line={color:VizUtil.hexToRgba(colorValue,.8),width:1}}else if(viz.clusterCircles==="fill"){shape.fillcolor=VizUtil.hexToRgba(colorValue,.2);shape.line={color:VizUtil.hexToRgba(colorValue,.2),width:1}}layout.shapes.push(shape)}})}if(marker==="scatter"&&!isMultiY&&!xAxisDataTypeDetection){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData);gRefLineLayerData=consolidateRefLines(gRefLineLayerData);gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData)}gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);addRefLineAnnotations("x",viz,gVRefLineLayerData,layout);layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(viz.legendLocation==="none"||viz._invalidLogicalizeCommandForColor){layout.showlegend=false}if(label&&!xAxisDataTypeDetection&&viz.scatterSplitLineByLabel==="on"){PlotlyGraphGenerator._convertGraphDataForScatterLineGroupedByLabel(gData)}else{gData.forEach(function(g){if(g.mode==="lines"){var cx=[],cy=[],ctxt=[];if(g&&g.y){g.y.forEach(function(yval,index){if(!VizUtil.isEmpty(yval)&&!VizUtil.isEmpty(g.x[index])){cy.push(yval);cx.push(g.x[index]);if(g.text){ctxt.push(g.text[index])}}})}g.x=cx;g.y=cy;if(ctxt.length>0){g.text=ctxt}}})}if(useHighlightScale){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}if(viz.reverseGraphLayerOrder||allowMultiYAndColor){gData.reverse()}if(VizUtil.returnsCharacterValue(viz.x)&&viz.y&&VizUtil.returnsCharacterValue(viz.y)){PlotlyGraphGenerator._removeRowsForOrder(gData);gData=PlotlyGraphGenerator._createOrderControlLayer(data,viz).concat(gData)}if(xAxisDataTypeDetection){gData.forEach(function(g){if(g.x&&g.x.length===1&&g.x[0]===null&&g.y&&g.y.length===1&&g.y[0]===null){g.showlegend=false}})}if(viz.yAxisRangeRatio&&syncYAxis){var _yAxisRange=PlotlyGraphGenerator.getRangeFromRangeRatio("y",viz.yAxisRangeRatio,gData);Object.keys(layout).forEach(function(key){if(/^yaxis/.test(key)){layout[key].range=_yAxisRange}})}gDataFiltered=[].concat(gData).concat(gTrendLineRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gTrendLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0}));PlotlyGraphGenerator._convertLinesMode(gDataFiltered,layout,viz);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(divElem){newPlot(divElem,gDataFiltered,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}break;case"hist":case"bar":case"errbar":if(!viz.x){layout.xaxis.showticklabels=false}else{if(viz.x.func==="aschar"||!viz.x.isNumeric&&!viz.x.isDate){layout.xaxis.type="category"}else if(/^(bar|errbar)$/.test(marker)){if(viz.xAxisAutomaticNumOfTicks!=="off"){}else{layout.xaxis.nticks=countNumberOfBars(gData)+1}}}if(barPadding){layout.bargap=barPadding}if(marker==="hist"){barstyle=viz.histBarStyle==="stack"?"stack":"overlay"}if(marker==="errbar"){layout.barmode="group";if(viz.x&&viz.color&&viz.x.name===viz.color.name){layout.barmode="stack"}gData=gData.map(function(datum){datum.type=errbarGraph==="bar"?"bar":"scatter";datum.mode=errbarGraph==="bar"?null:"markers";datum.hoverinfo="text";return datum})}else{layout.barmode=barstyle;gData=gData.map(function(datum){if(!datum.type){datum.type="bar"}datum.hoverinfo="text";return datum})}if(facet){constructFacetData(viz,gData,layout,colMap,colorarr&&colorarr.length>0?colorarr[0]:null,null,null,null,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineUpperRangeLayerData,gVRefLineLowerRangeLayerData);if(!x){gData.forEach(function(g){if(!g.x){g.x=g.y.map(function(){return"x"})}})}if(!viz.facetSyncYAxis&&viz.facetEnableDataCompletion==="off"){syncYAxis=false}}else{if(yValueOnPlot!=="none"&&marker==="bar"&&barstyle==="stack"){gData=calculateStackedYValue(gData)}if(marker==="bar"){if(viz.yAxisIncludeZero!=="off"&&/^(circle|line)$/.test(viz.yMarkerShape)){if(layout.yaxis.range){layout.yaxis.range=d3.extent(layout.yaxis.range.concat([0]))}else{layout.yaxis.range=calculateRange(gData,"y",viz.yAxisScale,true,false,marker,null,null,null,null,null,"y1",.04,.04)}if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}}if(colsOn2ndAxis&&colsOn2ndAxis.length>0&&viz.y2AxisIncludeZero!=="off"&&/^(circle|line)$/.test(viz.y1MarkerShape)){if(layout.yaxis2.range){layout.yaxis2.range=d3.extent(layout.yaxis2.range.concat([0]))}else{layout.yaxis2.range=calculateRange(gData,"y",viz.yAxisScale,true,false,marker,null,null,null,null,null,"y2",.04,.04)}if(userY2AxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.range=userY2AxisRange}}}}annotations=constructAnnotations(gData,marker,viz.x,viz.color,viz.facet,viz.barstyle,layout.barmode,numY,yValueOnPlot,y1ValuePrefix,y1ValueSuffix,y2ValuePrefix,y2ValueSuffix,viz.yValueOnPlotFontSize,viz.yValueOnPlotThreshold,colMap);if(annotations){layout.annotations=annotations}if(marker==="bar"&&barstyle==="stack"&&viz.orientation!=="horizontal"&&color){layout.legend.traceorder="reversed";if(!useHighlightScale&&!(colorbucket&&viz.colorBucketType==="bucket_outlier"&&viz.colorStackDirection!=="normal")){PlotlyGraphGenerator.reverseColorOrder(gData)}}if(barstyle==="group"&&gData.filter(function(g){return g.use2ndAxis&&!/^(lines|markers)$/.test(g.mode)}).length>0){var gDualYedData=[];gData.forEach(function(g){if(g.use2ndAxis){gDualYedData.push({x:[g.x&&g.x.length>0?g.x[0]:0],y:[0],type:"bar",hoverinfo:"none",showlegend:false,yaxis:getCorrespondingYAxis(g.yaxis,!!facet),xaxis:g.xaxis});gDualYedData.push(g)}else{gDualYedData.push(g);gDualYedData.push({x:[g.x&&g.x.length>0?g.x[0]:0],y:[0],type:"bar",hoverinfo:"none",showlegend:false,yaxis:getCorrespondingYAxis(g.yaxis,!!facet),xaxis:g.xaxis})}});gData=gDualYedData}if(orientation==="horizontal"&&/^(bar|errbar)$/.test(marker)){PlotlyGraphGenerator._switchOrientation(gData,layout,viz.facetSyncXAxis!=="off",!!x,viz.facetAlwaysShowTickLabel==="on")}if(isGroupByMeasuresEnabled){gRefLineUpperRangeLayerData.forEach(function(g){return g.skipRecalc=true});gRefLineLowerRangeLayerData.forEach(function(g){return g.skipRecalc=true});gRefLineLayerData.forEach(function(g){return g.skipRecalc=true})}if(marker==="hist"){viz.y=VizUtil.NUMROWS_COL_TEMPLATE;gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData);gVRefLineUpperRangeLayerData=consolidateRefLines(gVRefLineUpperRangeLayerData);gVRefLineLowerRangeLayerData=consolidateRefLines(gVRefLineLowerRangeLayerData)}if(marker==="bar"&&!isMultiY||marker==="errbar"){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData);gRefLineLayerData=consolidateRefLines(gRefLineLayerData);gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData)}gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});gVRefLineUpperRangeLayerData=gVRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLowerRangeLayerData=gVRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);recalculateVRefLineData(viz,gVRefLineUpperRangeLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);recalculateVRefLineData(viz,gVRefLineLowerRangeLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);adjustYAxisRangeForVRefLine(viz,gVRefLineLayerData,layout,colsOn2ndAxis);adjustYAxisRangeForVRefLine(viz,gVRefLineUpperRangeLayerData,layout,colsOn2ndAxis);adjustYAxisRangeForVRefLine(viz,gVRefLineLowerRangeLayerData,layout,colsOn2ndAxis);addRefLineAnnotations("x",viz,gVRefLineLayerData,layout);if(orientation==="horizontal"&&/^(bar|errbar)$/.test(marker)){PlotlyGraphGenerator._switchReferenceLineOrientation(gRefLineLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gRefLineUpperRangeLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gRefLineLowerRangeLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gVRefLineLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gVRefLineUpperRangeLayerData);PlotlyGraphGenerator._switchReferenceLineOrientation(gVRefLineLowerRangeLayerData);if(layout.annotations){layout.annotations.forEach(function(aData){if(aData._type==="vrefline"){_flipProperties(aData,"x",aData,"y");aData.xanchor="right";aData.yanchor="top";delete aData.xshift;aData.yshift=-2}})}}layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(viz.legendLocation==="none"||viz._invalidLogicalizeCommandForColor){layout.showlegend=false}if(useHighlightScale){if(marker==="bar"&&barstyle==="stack"){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false,true)}else if(marker==="hist"){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}else{PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}}if(marker==="hist"){gData.forEach(function(g){if(g&&g.customdata){g.customdata.some(function(d){return d.some(function(op){if(op&&op.type==="x"&&!VizUtil.isEmpty(op.rawValue)&&!VizUtil.isEmpty(op.histRange)){op.includeEdge="both";return true}return false})})}})}if(marker==="hist"&&viz.histCumDistType&&viz.histType!=="ratio"){gRefLineLayerData=PlotlyGraphGenerator._generateCumulativeDistLayerData(viz,gData,layout,translateColumn,formatValue,useThousandSeparator)}gDataFiltered=[].concat(gData).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gVRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false}));PlotlyGraphGenerator._convertLinesMode(gDataFiltered,layout,viz);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(divElem){if(marker==="hist"&&gData.filter(function(g){return g&&g.x&&g.x.indexOf("NA")===-1}).length===0){VizUtil.renderNoData(divElem,"Histogram is not generated because all the values for the X-Axis column are NA.");return}newPlot(divElem,gDataFiltered,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}break;case"line":case"bubble":case"densityplot":if(marker==="line"&&viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(marker==="bubble"){if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}if(viz.y&&(VizUtil.returnsCharacterValue(viz.y)||viz.y.func==="ascategory")){layout.yaxis.type="category"}}gData=gData.map(function(datum){datum.type=datum.type||"scatter";datum.mode=datum.mode||"lines";datum.hoverinfo="text";if(marker==="densityplot"){if(viz.fillLine==="on"){datum.fill="tozeroy";datum.fillcolor=VizUtil.hexToRgba(isArray(datum.marker.color)?quantColorPalette[quantColorPalette.length-1]:datum.marker.color,opacity);datum.marker.opacity=null}datum.opacity=null;if(!datum.line){datum.line={}}datum.line.shape="spline";datum.line.smoothing=.5}if(marker==="bubble"&&labelOnPlot==="on"&&label){datum.mode+="+text";datum.textposition=labelOnPlotVAlign+" "+labelOnPlotHAlign;datum.hoverinfo="x+y+z";if(viz.yValueOnPlotFontSize){datum.textfont={size:viz.yValueOnPlotFontSize}}}if(marker==="bubble"){datum.marker.sizemode="diameter";datum.marker.sizemin=circleMinSize/2;if(!datum.marker.size){datum.marker.size=circleMinSize}}return datum});if(facet){constructFacetData(viz,gData,layout,colMap,colorarr&&colorarr.length>0?colorarr[0]:null,gRangeLayerData,gTrendLineLayerData,gTrendLineRangeLayerData,colsOn2ndAxis,gRefLineLayerData,gRefLineUpperRangeLayerData,gRefLineLowerRangeLayerData,gVRefLineLayerData,gVRefLineUpperRangeLayerData,gVRefLineLowerRangeLayerData,gLineFillLayerData)}else{if(/^(bubble)$/.test(marker)&&viz.xAxisIncludeZero==="on"){layout.xaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"x")}var _includeZeroOnYAxis=/^(bubble)$/.test(marker)&&viz.yAxisIncludeZero==="on"||marker==="line"&&viz.yAxisIncludeZero!=="off";layout.yaxis.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.yAxisScale,_includeZeroOnYAxis,false,marker,null,null,null,null,null,"y1");if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}if(colsOn2ndAxis&&colsOn2ndAxis.length>0){var _includeZeroOnY2Axis=/^(bubble)$/.test(marker)&&viz.y2AxisIncludeZero==="on"||marker==="line"&&viz.y2AxisIncludeZero!=="off";layout.yaxis2.range=calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"y",viz.y2AxisScale,_includeZeroOnY2Axis,false,marker,null,null,null,null,null,"y2");if(userY2AxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis2.range=userY2AxisRange}}if(marker==="line"&&viz.x&&!viz.facet&&VizUtil.returnsDateValue(viz.x)&&viz.xAxisShowRangeSlider==="on"){layout.xaxis.type="date";layout.xaxis.rangeslider={range:calculateRange(gData.concat(gRangeLayerData).concat(gTrendLineLayerData).concat(gTrendLineRangeLayerData).concat(gRefLineLayerData).concat(gRefLineUpperRangeLayerData).concat(gRefLineLowerRangeLayerData),"x",viz.xAxisScale,true,false,marker,yValueOnPlot,false,barstyle,color,isMultiY,"x")}}}annotations=constructAnnotations(gData,marker,viz.x,viz.color,viz.facet,viz.barstyle,layout.barmode,numY,yValueOnPlot,y1ValuePrefix,y1ValueSuffix,y2ValuePrefix,y2ValueSuffix,viz.yValueOnPlotFontSize,viz.yValueOnPlotThreshold,colMap);if(annotations){layout.annotations=annotations}if(isGroupByMeasuresEnabled){gRefLineUpperRangeLayerData.forEach(function(g){return g.skipRecalc=true});gRefLineLowerRangeLayerData.forEach(function(g){return g.skipRecalc=true});gRefLineLayerData.forEach(function(g){return g.skipRecalc=true})}if(/^(bubble|densityplot)$/.test(marker)){gRefLineUpperRangeLayerData=consolidateRefLines(gRefLineUpperRangeLayerData);gRefLineLowerRangeLayerData=consolidateRefLines(gRefLineLowerRangeLayerData);gRefLineLayerData=consolidateRefLines(gRefLineLayerData)}if(/^(line|bubble|densityplot)$/.test(marker)){gVRefLineUpperRangeLayerData=consolidateRefLines(gVRefLineUpperRangeLayerData);gVRefLineLowerRangeLayerData=consolidateRefLines(gVRefLineLowerRangeLayerData);gVRefLineLayerData=consolidateRefLines(gVRefLineLayerData)}gRefLineUpperRangeLayerData=gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLowerRangeLayerData=gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gRefLineLayerData=gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});gVRefLineUpperRangeLayerData=gVRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLowerRangeLayerData=gVRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0});gVRefLineLayerData=gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false});recalculateRefLineData(viz,gRefLineLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineUpperRangeLayerData,layout,formatRefLineValueHash);recalculateRefLineData(viz,gRefLineLowerRangeLayerData,layout,formatRefLineValueHash);recalculateVRefLineData(viz,gVRefLineLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);recalculateVRefLineData(viz,gVRefLineUpperRangeLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);recalculateVRefLineData(viz,gVRefLineLowerRangeLayerData,layout,formatVRefLineValueHash,colsOn2ndAxis);addRefLineAnnotations("x",viz,gVRefLineLayerData,layout);layout.showlegend=!(!viz.color&&numY<2&&gRefLineLayerData.filter(function(g){return g.showlegend}).length===0&&gVRefLineLayerData.filter(function(g){return g.showlegend}).length===0);if(viz.legendLocation==="none"||viz._invalidLogicalizeCommandForColor){layout.showlegend=false}PlotlyGraphGenerator._removeNAValues(gData,viz);if(marker==="line"&&viz.color&&(!viz.yCompleteInstruction||viz.yCompleteInstruction==="none")){gData.forEach(PlotlyGraphGenerator._removeNAValuesFromGraphData)}if(marker==="bubble"&&viz.color&&VizUtil.isContinuousValue(viz.color,marker,"color")){gData=gData.filter(function(g){return g.name!==NA_LABEL})}if(useHighlightScale){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,true);layout.legend.traceorder="reversed"}gDataFiltered=[].concat(gData).concat(gTrendLineRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gVRefLineUpperRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gVRefLineLowerRangeLayerData.filter(function(d){return d.x.length>0&&d.y.length>0})).concat(gVRefLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0&&d.visible!==false})).concat(gTrendLineLayerData.filter(function(d){return d.x.length>0&&d.y.length>0}).concat(d3.merge(gLineFillLayerData)));PlotlyGraphGenerator._convertLinesMode(gDataFiltered,layout,viz);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gDataFiltered,layout:layout,config:config})}if(marker==="bubble"){Object.keys(layout).forEach(function(key){if(/xaxis[1-9]/.test(key)&&layout[key].title===NA_LABEL){var name=key.replace("xaxis","x");gDataFiltered=gDataFiltered.filter(function(g){return!(g.xaxis===name&&(isAllNull(g.x)||isAllNull(g.y)))})}})}if(divElem){newPlot(divElem,gDataFiltered,layout,config);if(marker!=="densityplot"){PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}}break;case"area":if(viz.x&&(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory")){layout.xaxis.type="category"}gData=gData.map(function(datum,idx){datum.fill=idx===0?"tozeroy":"tonexty";datum.type="scatter";datum.mode="none";datum.hoverinfo="text";datum.fillcolor=VizUtil.hexToRgba(datum.marker.color||"#1f77b4",opacity||.68);if(datum.y&&isArray(datum.y)&&datum.text&&isArray(datum.text)){datum.y.forEach(function(yvalue,idx){if(yvalue===0){datum.text[idx]=null}})}return datum});if(facet){constructFacetData(viz,gData,layout,colMap,colorarr&&colorarr.length>0?colorarr[0]:null)}else{gData=convertToStackedYValue(gData);layout.yaxis.range=calculateRange(gData,"y",viz.yAxisScale,true,false,marker,null,null,null,null,null,"y1");if(userYAxisRange&&viz.y&&VizUtil.returnsNumericValue(viz.y)){layout.yaxis.range=userYAxisRange}}if(yValueOnPlot!=="none"){annotationContext=[];var yValueOnPlotThreshold=viz.yValueOnPlotThreshold?parseFloat(viz.yValueOnPlotThreshold):null;gData.forEach(function(group){if(!group.x||!Array.isArray(group.x)){return}annotationContext=annotationContext.concat(group.x.map(function(x,idx){return{x:x,y:group.y[idx],origy:group.origy[idx],xref:group.xaxis?group.xaxis:"x",yref:group.yaxis?group.yaxis:"y",text:group.origy[idx]===0?"":y1ValuePrefix+formatValue(group.origy[idx])+y1ValueSuffix,xanchor:"center",yanchor:yValueOnPlot,showarrow:false}}).filter(function(ctx){if(!ctx||VizUtil.isEmpty(ctx.y)||VizUtil.isEmpty(ctx.origy)){return false}if(VizUtil.isEmpty(yValueOnPlotThreshold)){return true}if(typeof ctx.origy!=="number"){return true}return ctx.origy>=yValueOnPlotThreshold}))});if(viz.yValueOnPlotFontSize){annotationContext.forEach(function(ctx){ctx.font={size:viz.yValueOnPlotFontSize}})}layout.annotations=annotationContext}if(color&&viz.orientation!=="horizontal"){layout.legend.traceorder="reversed";if(!useHighlightScale&&!(colorbucket&&viz.colorBucketType==="bucket_outlier"&&viz.colorStackDirection!=="normal")){PlotlyGraphGenerator.reverseColorOrder(gData)}}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}break;case"pie":var _pieDataHash={},_pieDataList=[],_xaxis,_yaxis;if(facet){constructFacetData(viz,gData,layout,colorarr&&colorarr.length>0?colorarr[0]:null)}gData.forEach(function(d){var hashkey=(d.xaxis||"")+(d.yaxis||"");var pieData=_pieDataHash[hashkey];if(!pieData){pieData={values:[],_realvalues:[],labels:[],text:[],hovertext:[],customdata:[],type:"pie",textinfo:"text",textposition:[],hoverinfo:"text",marker:{colors:[]},sort:false,textfont:{},hole:pieHole,direction:"clockwise"};if(viz.plotAreaFontSize){pieData.textfont.size=viz.plotAreaFontSize}_pieDataHash[hashkey]=pieData;_pieDataList.push(pieData)}if(d.xaxis&&d.yaxis){_xaxis=layout[d.xaxis.replace(/^x/,"xaxis")];_yaxis=layout[d.yaxis.replace(/^y/,"yaxis")];pieData.domain={x:_xaxis.domain,y:_yaxis.domain};pieData._xref=d.xaxis;pieData._yref=d.yaxis;pieData._titleText=_xaxis.title;pieData._titleFontSize=_xaxis.titlefont?_xaxis.titlefont.size:null}i=d.y[d.y.length-1]||0;pieData._realvalues.push(i);if(i<0){i=Math.abs(i)}pieData.values.push(i);pieData.hovertext.push(d.text[d.text.length-1]);pieData.customdata.push(d.customdata[d.customdata.length-1]);pieData.labels.push(d.name);pieData.marker.colors.push(VizUtil.hexToRgba(d.marker.color,opacity||.8))});_pieDataList.forEach(function(d){d._summary=d._realvalues.reduce(function(acc,cur){return acc+cur});var sum=d.values.reduce(function(acc,cur){return acc+cur});d.pcts=d.values.map(function(v){return v/sum*100});d.text=d._realvalues.map(function(v,idx){var textinfo=[];if(viz.pieShowPercentages!=="off"){textinfo.push(formatValue(d.pcts[idx])+"%")}if(viz.pieShowValues==="on"){textinfo.push(formatValue(v))}if(viz.pieShowLabels==="on"){textinfo.push(d.labels[idx])}return textinfo.join("<br>")});d.hovertext=d.hovertext.map(function(v,idx){if(!v||!v.split){console.log("Debug #14657: [typeof v]=["+typeof v+"], [v]=["+JSON.stringify(v)+"]");return""}var arr=v.split("<br>");arr[0]+=" ("+formatValue(d.pcts[idx])+"%)";return arr.join("<br>")});d.textposition=d.pcts.map(function(v){return v<5?"none":"auto"})});if(!color){layout.showlegend=false;_pieDataList.forEach(function(d){d.labels[0]=viz.y.name})}Object.keys(layout).forEach(function(key){if(/^(xaxis|yaxis)/.test(key)){layout[key].showticklabels=false;layout[key].showline=false;layout[key].showgrid=false;layout[key].zeroline=false;layout[key].showspikes=false;layout[key].fixedrange=true;layout[key].nticks=0;if(/^yaxis/.test(key)||/^xaxis/.test(key)&&pieHole!==0){layout[key].visible=false;layout[key].title=""}}});delete layout.scene;if(pieHole!==0){layout.annotations=_pieDataList.map(function(d){var _title=xAxisShowTitle?d._titleText||(viz.y.name===VizUtil.NUMROWS_COL_NAME?NUMROWS_COL_LABEL:viz.y.name):"";return{font:{size:d._titleFontSize||(d.domain?12:14)},showarrow:false,text:_title+"<br>"+formatValue(d._summary),x:d.domain?d3.mean(d.domain.x):.5,y:d.domain?d3.mean(d.domain.y):.5,xref:"paper",yref:"paper",xanchor:"center",yanchor:"middle",align:"center"}})}gDataFiltered=_pieDataList.filter(function(d){var res=false;for(i=0,l=d.values.length;i<l;i++){if(typeof d.values[i]!=="undefined"&&d.values[i]!==null&&d.values[i]!==0){res=true;break}}return res});if(gDataFiltered.length===0&&targetElem){VizUtil.renderNoData(targetElem)}else{if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:_pieDataList,layout:layout,config:config})}if(divElem){newPlot(divElem,_pieDataList,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}}break;case"boxplot":if(!viz.x){layout.yaxis.title=""}else{if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout.xaxis.type="category"}}gData=gData.map(function(datum,idx){datum.type="box";if(!viz.x){datum.x=datum.x.map(function(){return viz.y.name})}datum.boxpoints=false;return datum});if(useOverlayMode(viz.x,viz.color,viz.facet,viz.marker)){layout.boxmode="overlay"}else{layout.boxmode="group"}if(viz.boxplotLayoutMode){layout.boxmode=viz.boxplotLayoutMode}if(facet){constructFacetData(viz,gData,layout)}if(useHighlightScale){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config)}break;case"violin":if(!viz.x){layout.yaxis.title=""}else{if(VizUtil.returnsCharacterValue(viz.x)||viz.x.func==="ascategory"){layout.xaxis.type="category"}}layout.hovermode="closest";if(useOverlayMode(viz.x,viz.color,viz.facet,viz.marker)){layout.violinmode="overlay"}else{layout.violinmode="group"}if(viz.violinLayoutMode){layout.violinmode=viz.violinLayoutMode}var vPoints=viz.violinShowAllPoints==="on"?"all":viz.includeOutlier==="on"?"outliers":"none";if(vPoints!=="all"){layout.violingap=.1;layout.violingroupgap=.1}if(vPoints==="none"){vPoints=false}var vShowBoxplot=viz.violinShowBoxplot!=="off";var vShowMeanLine=viz.violinShowMeanLine!=="off";var vJitter=viz.violinJitter?parseFloat(viz.violinJitter):null;var vPointOpacity=viz.violinPointOpacity?parseFloat(viz.violinPointOpacity):VizUtil.DEFAULT_VIOLIN_POINT_OPACITY;gData=gData.map(function(datum,idx){datum.type="violin";datum.box={visible:vShowBoxplot};datum.meanline={visible:vShowMeanLine};datum.points=vPoints;if(vJitter!==null){datum.jitter=vJitter}if(!datum.marker){datum.marker={}}datum.marker.opacity=vPointOpacity;return datum});if(facet){constructFacetData(viz,gData,layout)}if(useHighlightScale){PlotlyGraphGenerator._sortGraphDataByHighlight(gData,colorScale,false)}
if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config)}break;case"scattermatrix":var xAxisTemplate={showline:false,zeroline:false,showgrid:true,titlefont:{size:layout.xaxis.titlefont.size},tickfont:{}};if(layout.xaxis.tickfont.size){xAxisTemplate.tickfont.size=layout.xaxis.tickfont.size}if(viz.showXGridLines&&viz.showXGridLines!=="default"){xAxisTemplate.showgrid=viz.showXGridLines==="on"}if(viz.showXZeroLine&&viz.showXZeroLine!=="default"){xAxisTemplate.zeroline=viz.showXZeroLine==="on"}var yAxisTemplate={showline:false,zeroline:false,showgrid:true,titlefont:{size:layout.yaxis.titlefont.size},tickfont:{}};if(layout.yaxis.tickfont.size){yAxisTemplate.tickfont.size=layout.yaxis.tickfont.size}if(viz.showYGridLines&&viz.showYGridLines!=="default"){yAxisTemplate.showgrid=viz.showYGridLines==="on"}if(viz.showYZeroLine&&viz.showYZeroLine!=="default"){yAxisTemplate.zeroline=viz.showYZeroLine==="on"}ys.forEach(function(y,idx){var axisName="axis"+(idx===0?"":idx+1);layout["x"+axisName]=JSON.parse(JSON.stringify(xAxisTemplate));layout["y"+axisName]=JSON.parse(JSON.stringify(yAxisTemplate))});layout.autosize=false;layout.hovermode="closest";layout.dragmode="select";if(viz.facetSqueezePlots==="off"){var facetWidth=viz.facetWidth?parseInt(viz.facetWidth):180;var facetHeight=viz.facetHeight?parseInt(viz.facetHeight):180;layout.width=facetWidth*ys.length;layout.height=facetHeight*ys.length}if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config)}break;case"heatmap":case"contour":layout.xaxis.zeroline=false;layout.xaxis.showgrid=false;layout.yaxis.zeroline=false;layout.yaxis.showgrid=false;if(marker==="heatmap"){layout.xaxis.type="category";layout.yaxis.type="category"}if(gData[0].y.length===1&&gData[0].y[0]===""){layout.yaxis.ticklen=0}var colorBarRange=PlotlyGraphGenerator.getRangeFromRangeString(viz.colorBarRange);var allDataRange=null;if(facet){constructFacetData(viz,gData,layout);allDataRange=[];data.forEach(function(d){allDataRange.push(d[color])});allDataRange=d3.extent(allDataRange)}else if(viz.colorSetZeroToCenter==="on"){allDataRange=[];data.forEach(function(d){allDataRange.push(d[color])});allDataRange=d3.extent(allDataRange)}if(viz.colorSetZeroToCenter==="on"){var absmin=Math.abs(allDataRange[0]);var absmax=Math.abs(allDataRange[1]);if(absmax>absmin){colorBarRange=[-absmax,absmax]}else{colorBarRange=[-absmin,absmin]}}gData=gData.map(function(datum,idx){datum.type=marker;datum.hoverinfo="text";datum.colorbar={len:viz.colorBarLength||.65};if(colorBarRange){datum.zmin=colorBarRange[0];datum.zmax=colorBarRange[1];datum.zauto=false}else if(facet){datum.zmin=allDataRange[0];datum.zmax=allDataRange[1];datum.zauto=false}if(facet){if(idx===0){datum.colorbar.len=layout.yaxis1.domain[1]-layout.yaxis1.domain[0];datum.colorbar.y=1;datum.colorbar.yanchor="top"}else{datum.showscale=false}}return datum});if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:marker,gData:gData,layout:layout,config:config})}if(divElem){newPlot(divElem,gData,layout,config);PlotlyGraphGenerator._addCustomBalloon(divElem,onShowDetailCallback,onKeepThisCallback,onExcludeCallback)}break;case"choropleth":gData=gData.map(function(datum){datum.type=marker;datum.hoverinfo="text";datum.z=datum.marker.color;datum.locations=datum.x;datum.locationmode=mapmode;datum.colorscale=datum.marker.colorscale;datum.showscale=false;datum.marker.line={color:"#ddd",width:.5};layout.margin={b:0,l:0,r:0,t:title?40:10,autoexpand:false,pad:0};switch(mapmode){case"USA-states":layout.geo={scope:"usa",showcoastlines:true,coastlinecolor:"#ccc",showcountries:true,countrycolor:"#ccc",showsubunits:true,subunitcolor:"#ccc",projection:{type:"albers usa"}};break;case"ISO-3":case"country names":layout.geo={showframe:false,showcoastlines:true,coastlinecolor:"#ccc",showcountries:true,countrycolor:"#ccc",projection:{type:"equirectangular"}};break}return datum});if(divElem){newPlot(divElem,gData,layout,config)}break;default:console.error("No such graph type supported: "+marker);break}};PlotlyGraphGenerator.getRenderSvgFunction=function(viz,data,onLoadCallback){var func=function(props){viz.width=props.width;viz.height=props.height;var targetElem=props.elem;PlotlyGraphGenerator.render(viz,data,targetElem,"svg",onLoadCallback)};return func};if(typeof module==="object"&&module.exports)module.exports=PlotlyGraphGenerator;var MapGenerator=function(){};var mapBoxConfig={id:"mapbox/light-v10",accessToken:"pk.eyJ1Ijoia3NvYnVlIiwiYSI6ImNpZjhra2MyaDIweWVyeWx6aTI4cnU1eHoifQ.tFW7BQvQXKjdhfWDA66IgQ"};var mapConfig={minCircleSize:VizUtil.DEFAULT_MIN_CIRCLE_DIAMETER.map,maxCircleSize:VizUtil.DEFAULT_MAX_CIRCLE_DIAMETER.map,lineWidth:3,selectedLineWidth:5,borderWidth:1,selectedBorderWidth:3,pointRadius:5,pointBorderWidth:0,selectedPointBorderWidth:3};var MAP_TYPE_MAPPING={"mapbox.light":"mapbox/light-v10","mapbox.dark":"mapbox/dark-v10","mapbox.streets":"mapbox/streets-v11","mapbox.streets-basic":"mapbox/outdoors-v11"};var getMapStyleId=function(mapType){return MAP_TYPE_MAPPING[mapType]||"mapbox/light-v10"};var formatValue=VizUtil.valueFormatterGenerator(2,true,true);var formatNumrowValue=VizUtil.valueFormatterGenerator(0,true);MapGenerator.createInfoBox=function(){var info=L.control();info.onAdd=function(){this._div=L.DomUtil.create("div","info info-box");this.update();return this._div};info.update=function(values){var html="";if(values){var boxstyle="";var title=null,labels=[],long,lat;values.forEach(function(v){switch(v.type){case"title":title=v;break;case"label":labels.push(v);break;case"long":long=v;break;case"lat":lat=v;break}});if(title){html+='<div class="info-box-title">'+title.value+"</div>"}html+='<div class="info-box-table">';labels=labels.filter(function(label){return!title||!(title.column.name===label.column.name&&title.column.func===label.column.func&&title.suffix===label.suffix)});var labelHash={};var filteredLabels=[];labels.forEach(function(label){if(!labelHash[label.column.name+"::"+label.column.func+"::"+(label.suffix||"")]){filteredLabels.push(label);labelHash[label.column.name+"::"+label.column.func+"::"+(label.suffix||"")]=true}});if(long){html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">'+VizUtil.getMessage(MapGenerator._lang,"Longitude")+":</div>"+'  <div class="value-col">'+long.value+"</div>"+"</div>"}if(lat){html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">'+VizUtil.getMessage(MapGenerator._lang,"Latitude")+":</div>"+'  <div class="value-col">'+lat.value+"</div>"+"</div>"}filteredLabels.forEach(function(label){var labelText=(label.column.name===VizUtil.NUMROWS_COL_NAME?VizUtil.getMessage(MapGenerator._lang,VizUtil.NUMROWS_COL_LABEL):label.column.name)+(label.suffix||"");if(labelText){labelText+=":"}html+='<div class="info-box-value '+boxstyle+'">'+'  <div class="label-col">'+labelText+"</div>"+'  <div class="value-col">'+label.value+"</div>"+"</div>"});html+="</div>"}else{html="Hover over or click an area."}this._div.innerHTML=html};return info};MapGenerator.createLegend=function(colorData,catColorScale,colorOpacity,legendType){var uniqs=VizUtil.distinct(colorData);var legend=L.control({position:"bottomright"});if(catColorScale.isHighlightColorScale){uniqs.sort(function(a,b){return catColorScale.getOrderByValue(b)-catColorScale.getOrderByValue(a)})}legend.onAdd=function(){var div=L.DomUtil.create("div","info legend "+legendType);for(var i=0;i<uniqs.length;i++){div.innerHTML+='<div class="legend-row"><i style="background:'+catColorScale(uniqs[i])+"; opacity:"+colorOpacity+' "></i> '+(uniqs[i]||"NA")+"</div>"}return div};return legend};MapGenerator.createCatColorScale=function(viz,numUniqsOnColor){if(viz.enableHighlight==="on"&&viz.color&&!VizUtil.isContinuousValue(viz.color,viz.marker,"color")){return VizUtil.generateHighlightColorScale(viz.highlightDefaultColor||"#DCDEE0",viz.highlightValues||[])}var colorScale=numUniqsOnColor&&numUniqsOnColor>10?d3.scale.category20():d3.scale.category10(),colorarr;var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||viz.reverseColorPalleteOrder||"off";if(viz.customCategColorPalette&&viz.customCategColorPalette.length>0&&viz.categColorPalette==="custom"){colorarr=viz.customCategColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(var i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else if(viz.categColorPalette&&viz.categColorPalette!=="default"&&VizUtil.CATEG_COLOR_PALETTES_HASH[viz.categColorPalette]){var ncolors=numUniqsOnColor?Math.min(numUniqsOnColor,10):-1;if(ncolors>0&&VizUtil.colorbrewer[viz.categColorPalette]&&VizUtil.colorbrewer[viz.categColorPalette][ncolors]){colorarr=VizUtil.colorbrewer[viz.categColorPalette][ncolors].slice()}else{colorarr=VizUtil.CATEG_COLOR_PALETTES_HASH[viz.categColorPalette].color.slice()}if(reverseColorPaletteOrderOp==="on"){colorarr.reverse()}colorScale=d3.scale.ordinal().range(colorarr)}else{if(reverseColorPaletteOrderOp==="on"){var colors=colorScale.range().slice();colors.reverse();return d3.scale.ordinal().range(colors)}}return colorScale};MapGenerator._moveHighlightedCirclesToBottom=function(circles,scale){if(!scale.isHighlightColorScale){return}circles.forEach(function(c,idx){var v=scale.getOrderByColor(c.options.fillColor);c.__sortIdx=v===0?idx:-v});circles.sort(function(a,b){return b.__sortIdx-a.__sortIdx})};MapGenerator.createQuantColorScale=function(viz){var bucketType=VizUtil.getBucketType("color",viz);var quantColorPaletteOp=viz.quantColorPalette||VizUtil.getDefaultColorPalette(bucketType)||"Blues";if(!VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp]){quantColorPaletteOp="Blues"}var reverseColorPaletteOrderOp=viz.reverseColorPaletteOrder||"off";var quantColorPalette=VizUtil.QUANT_COLOR_PALETTES_HASH[quantColorPaletteOp].color.slice();if(viz.customQuantColorPalette&&viz.customQuantColorPalette.length>0&&viz.quantColorPalette==="custom"){var colorarr=viz.customQuantColorPalette.match(VizUtil.COLOR_PALETTE_REGEX).slice();for(var i=0;i<colorarr.length;i++){if(VizUtil.hexToRgb(colorarr[i])===null){colorarr[i]="#CCCCCC"}}quantColorPalette=colorarr}if(viz.quantColorPalette!=="custom"&&/^(bucket_kmeans|bucket_equal_width|bucket_equal_freq|bucket_custom)$/.test(bucketType)){var numBuckets=bucketType==="bucket_kmeans"?viz.colorBucketKmeansNumOfBuckets:viz.colorBucketNumOfBuckets;if(bucketType==="bucket_custom"){var customBucketAttrs=VizUtil.constructCustomBucketAttributes(viz.colorBucketCuttingPoints,viz.colorBucketLabels,viz.colorBucketIncludeOutsideRange!=="off",viz.colorBucketIncludeRightEdge!=="off",viz.colorBucketIncludeLowest!=="off",10);numBuckets=customBucketAttrs.expectedNumberOfLabels}if(numBuckets&&VizUtil.colorbrewer[quantColorPaletteOp]&&VizUtil.colorbrewer[quantColorPaletteOp][numBuckets]){quantColorPalette=VizUtil.colorbrewer[quantColorPaletteOp][numBuckets].slice()}}if(reverseColorPaletteOrderOp==="on"){quantColorPalette.reverse()}return d3.scale.ordinal().range(quantColorPalette)};MapGenerator.noKeyMatch=function(data,keyCol,geojson,keyProp){var keycols=data.map(function(d){return d[keyCol]});var keyprops=geojson.features.map(function(feature){return feature.properties[keyProp]});var i,l;for(i=0,l=keycols.length;i<l;i++){if(keyprops.indexOf(keycols[i])!==-1){return false}}return true};MapGenerator.render=function(viz,data,elTarget,geoJSON,onLoadCallback,onErrorCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback,lang){if(lang){MapGenerator._lang=lang}try{MapGenerator._render(viz,data,elTarget,geoJSON,onLoadCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback)}catch(e){if(onErrorCallback&&typeof onErrorCallback==="function"){onErrorCallback(e,viz)}if(elTarget){VizUtil.renderNoData(elTarget,"Graph rendering failed.")}console.error(e)}};MapGenerator._render=function(viz,data,elTarget,geoJSON,onLoadCallback,onZoomEndCallback,onMoveEndCallback,noThumbnail,onBeforeRenderingCallback){data=VizUtil.convertColumnarData(data);if(!!onBeforeRenderingCallback&&typeof onBeforeRenderingCallback==="function"){onBeforeRenderingCallback({marker:viz.marker,data:data})}if(!elTarget){return}while(elTarget.childNodes.length>0){elTarget.removeChild(elTarget.firstChild)}if(!data&&!geoJSON||data&&data.length===0){VizUtil.renderNoData(elTarget);if(onLoadCallback&&typeof onLoadCallback==="function"){onLoadCallback()}return}var colorValuePrefix="",colorValueSuffix="",sizeValuePrefix="",sizeValueSuffix="",label1ValuePrefix="",label1ValueSuffix="",label2ValuePrefix="",label2ValueSuffix="",label3ValuePrefix="",label3ValueSuffix="";if(viz.color){colorValuePrefix=VizUtil.getValuePrefix(viz.colorNumberFormatting,viz.colorCurrencySymbol,viz.marker);colorValueSuffix=VizUtil.getValueSuffix(viz.colorWindowFunc,viz.color.func,viz.colorNumberFormatting,viz.marker)}if(viz.size){sizeValuePrefix=VizUtil.getValuePrefix(viz.sizeNumberFormatting,viz.sizeCurrencySymbol,viz.marker);sizeValueSuffix=VizUtil.getValueSuffix(viz.sizeWindowFunc,viz.size.func,viz.sizeNumberFormatting,viz.marker)}if(viz.label){label1ValuePrefix=VizUtil.getValuePrefix(viz.label1NumberFormatting,viz.label1CurrencySymbol,viz.marker);label1ValueSuffix=VizUtil.getValueSuffix(viz.label1WindowFunc,viz.label.func,viz.label1NumberFormatting,viz.marker)}if(viz.label2){label2ValuePrefix=VizUtil.getValuePrefix(viz.label2NumberFormatting,viz.label2CurrencySymbol,viz.marker);label2ValueSuffix=VizUtil.getValueSuffix(viz.label2WindowFunc,viz.label2.func,viz.label2NumberFormatting,viz.marker)}var labelNameMap={};if(viz.x){labelNameMap[viz.x.label]=viz.x.name}if(viz.y){labelNameMap[viz.y.label]=viz.y.name}if(viz.size){labelNameMap[viz.size.label]=viz.size.name}if(viz.color){labelNameMap[viz.color.label]=viz.color.name}if(viz.label){labelNameMap[viz.label.label]=viz.label.name}if(viz.label2){labelNameMap[viz.label2.label]=viz.label2.name}var showLegend=viz.showLegend||"on";var disableDecimalFormatting=!!viz.disableDecimalFormatting;var numDecimalDigits=viz.numDecimalDigits;var useThousandSeparator=viz.useThousandSeparator!=="off";formatValue=VizUtil.valueFormatterGenerator(disableDecimalFormatting?null:VizUtil.isEmpty(numDecimalDigits,true)?2:numDecimalDigits,useThousandSeparator,VizUtil.isEmpty(numDecimalDigits,true));var divElem=document.createElement("div");divElem.style.width="100%";divElem.style.height="100%";elTarget.appendChild(divElem);var map=L.map(divElem,{zoomControl:true,preferCanvas:true,zoomDelta:.5,zoomSnap:.5});if(onLoadCallback&&typeof onLoadCallback==="function"){map.on("load",onLoadCallback)}if(onZoomEndCallback&&typeof onZoomEndCallback==="function"){map.on("zoomend",onZoomEndCallback)}if(onMoveEndCallback&&typeof onMoveEndCallback==="function"){map.on("moveend",onMoveEndCallback)}var geoJSONLayer=null;L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}",{maxZoom:18,id:getMapStyleId(viz.mapType),accessToken:mapBoxConfig.accessToken,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, '+'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery &copy; <a href="http://mapbox.com">Mapbox</a>'}).addTo(map);var colorOpacity=viz.colorOpacity||VizUtil.getDefaultOpacity(viz);var quantColorScale=MapGenerator.createQuantColorScale(viz);var catColorScale=MapGenerator.createCatColorScale(viz);var legend=null,colorData=null,colorHash=null,infobox=null;var zoomLevel=null,bounds=null,center=null;if(viz.mapZoomStatus){var arr=viz.mapZoomStatus.split(",");zoomLevel=parseFloat(arr[0]);if(arr.length===5){bounds=L.latLngBounds(L.latLng(parseFloat(arr[2]),parseFloat(arr[1])),L.latLng(parseFloat(arr[4]),parseFloat(arr[3])));if(!bounds.isValid()){bounds=null;zoomLevel=null}}else if(arr.length===3){center=L.latLng(parseFloat(arr[1]),parseFloat(arr[2]))}}var marker=viz.marker;var isEasymap=viz.marker==="easymap";if(marker==="easymap"){if(viz.easymapType!=="area"){marker="map"}else{marker="geojson"}}var geoLayerBounds,_bounds;switch(marker){case"geojson":infobox=MapGenerator.createInfoBox();infobox.addTo(map);if(!geoJSON){map.setView([0,0],1);return}var nameHash=null;if(data){nameHash={};data.forEach(function(d){if(isEasymap){nameHash[d[VizUtil.KEYPROP_COL_NAME]]=d}else{nameHash[d[viz.x.label]]=d}})}var keyprop=isEasymap?viz.easymapKeyProp:viz.geojsonKeyProp;var keypropForDisplay=isEasymap?viz.easymapKeyPropForDisplay:viz.geojsonKeyProp;var featureFilter=function(feature){return true};var options={};options.filter=featureFilter;var highlightFeature=function(e){var layer=e.target;layer.setStyle({weight:/^(LineString|MultiLineString)$/.test(layer.feature.geometry.type)?mapConfig.selectedLineWidth:layer.feature.geometry.type==="Point"?mapConfig.selectedPointBorderWidth:mapConfig.selectedBorderWidth});if(!L.Browser.ie&&!L.Browser.opera&&!L.Browser.edge){layer.bringToFront()}var infoboxValues=[];var labelAsTitle=viz.labelAsCardTitle==="on";if(nameHash&&nameHash[layer.feature.properties[keyprop]]){if(viz.x&&!labelAsTitle){infoboxValues.push({type:labelAsTitle?"label":"title",column:viz.x,value:layer.feature.properties[keyprop]})}if(isEasymap&&!labelAsTitle){infoboxValues.push({type:labelAsTitle?"label":"title",column:{name:"Name",func:""},value:layer.feature.properties[keypropForDisplay]})}if(viz.label){infoboxValues.push({type:labelAsTitle?"title":"label",column:viz.label,value:label1ValuePrefix+formatValue(nameHash[layer.feature.properties[keyprop]][viz.label.label])+label1ValueSuffix})}if(viz.label2){infoboxValues.push({type:"label",column:viz.label2,value:label2ValuePrefix+formatValue(nameHash[layer.feature.properties[keyprop]][viz.label2.label])+label2ValueSuffix})}if(viz.color){infoboxValues.push({type:"label",suffix:" ("+VizUtil.getMessage(MapGenerator._lang,"Color")+")",column:viz.color,value:colorValuePrefix+formatValue(nameHash[layer.feature.properties[keyprop]][viz.color.label])+colorValueSuffix})}}if(infoboxValues.length===0){if(keypropForDisplay){infoboxValues.push({type:"label",column:{name:isEasymap?"":keypropForDisplay,func:""},value:formatValue(e.target.feature.properties[keypropForDisplay])})}else{var key=Object.keys(e.target.feature.properties);if(key.length>0){key=key[0];infoboxValues.push({type:"label",column:{name:"",func:""},value:formatValue(e.target.feature.properties[key])})}}}if(viz.showNumberOfRowsInBalloon==="on"&&nameHash[layer.feature.properties[keyprop]][VizUtil.NROW_INTERNAL_COL_NAME]&&infoboxValues.filter(function(v){return v.column.name===VizUtil.NUMROWS_COL_NAME}).length===0){infoboxValues.push({type:"label",column:{name:VizUtil.NUMROWS_COL_NAME,func:""},value:formatNumrowValue(nameHash[layer.feature.properties[keyprop]][VizUtil.NROW_INTERNAL_COL_NAME])})}infobox.update(infoboxValues)};var resetHighlight=function(e){var layer=e.target;e.target.setStyle({weight:/^(LineString|MultiLineString)$/.test(layer.feature.geometry.type)?mapConfig.lineWidth:layer.feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth});infobox.update()};var onEachFeature=function(feature,layer){layer.on({mouseover:highlightFeature,mouseout:resetHighlight,click:highlightFeature})};options.onEachFeature=onEachFeature;var pointStyles={radius:mapConfig.pointRadius,weight:0,opacity:1,fillOpacity:colorOpacity};options.pointToLayer=function(feature,latlng){return L.circleMarker(latlng,pointStyles)};geoJSONLayer=L.geoJSON(geoJSON,options);var hasZoomLevel=zoomLevel!==undefined&&zoomLevel!==null&&zoomLevel!=="";if(hasZoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(hasZoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{geoLayerBounds=geoJSONLayer.getBounds();if(L.latLngBounds(geoLayerBounds).isValid()){map.fitBounds(geoLayerBounds)}else{map.setView([0,0],1)}}if(data){var styleFunc;if(viz.colorbucket){colorData=VizUtil.distinct(data.map(function(datum){return datum[viz.colorbucket.label]}));colorData.forEach(function(x){quantColorScale(x)});styleFunc=function(feature){var styles={weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth};var v=nameHash[feature.properties[keyprop]];if(v){if(/^(LineString|MultiLineString)$/.test(feature.geometry.type)){styles.color=quantColorScale(v[viz.colorbucket.label])}else{styles.color=viz.polygonBorderColor||"#FFFFFF";styles.fillColor=quantColorScale(v[viz.colorbucket.label]);styles.fillOpacity=colorOpacity}}else{styles.color="transparent"}return styles};legend=MapGenerator.createLegend(colorData,quantColorScale,colorOpacity,"square")}else{styleFunc=function(feature){var styles={weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth};var v=nameHash[feature.properties[keyprop]];if(v){if(/^(LineString|MultiLineString)$/.test(feature.geometry.type)){styles.color=catColorScale(v[viz.color.label])}else{styles.color=viz.polygonBorderColor||"#FFFFFF";styles.fillColor=catColorScale(v[viz.color.label]);styles.fillOpacity=colorOpacity}}else{styles.color="transparent"}return styles};colorHash={};colorData=data.map(function(datum){colorHash[datum[viz.color.label]]=1;return datum[viz.color.label]});catColorScale=MapGenerator.createCatColorScale(viz,Object.keys(colorHash).length);catColorScale.domain(colorData);legend=MapGenerator.createLegend(colorData,catColorScale,colorOpacity,"square")}geoJSONLayer.setStyle(styleFunc);if(legend&&showLegend==="on"){legend.addTo(map)}}else{geoJSONLayer.setStyle(function(feature){return{weight:/^(LineString|MultiLineString)$/.test(feature.geometry.type)?mapConfig.lineWidth:feature.geometry.type==="Point"?mapConfig.pointBorderWidth:mapConfig.borderWidth}})}geoJSONLayer.addTo(map);break;case"map":var longCol=isEasymap?{name:"longitude",label:"longitude",func:""}:viz.x,latCol=isEasymap?{name:"latitude",label:"latitude",func:""}:viz.y,valueLabelHt;if(longCol&&latCol&&data){if(isEasymap){valueLabelHt={};var prop=viz.easymapKeyProp;var propForDisplay=viz.easymapKeyPropForDisplay;var _s=Date.now();geoJSON.features.map(function(feature){valueLabelHt[feature.properties[prop]]=feature.properties[propForDisplay]})}var showLines=viz.mapMarkerType&&!isEasymap?/line$/.test(viz.mapMarkerType):viz.mapShowLines==="on";var showDashedLines=viz.mapMarkerType?viz.mapMarkerType==="circle+dashedline":viz.mapDashedLines==="on";var normalizeSize=viz.size&&viz.mapNormalizeSizeByGroup==="on"&&showLines;var DEFAULT_GROUP_NAME="default";var CALCULATED_LONG="..lng";var CALCULATED_SIZE="..sz";infobox=MapGenerator.createInfoBox();infobox.addTo(map);if(viz.color){if(viz.colorbucket){colorData=VizUtil.distinct(data.map(function(datum){return datum[viz.colorbucket.label]}));colorData.forEach(function(x){quantColorScale(x)});legend=MapGenerator.createLegend(colorData,quantColorScale,colorOpacity,"circle")}else{colorHash={};colorData=data.map(function(datum){colorHash[datum[viz.color.label]]=1;return datum[viz.color.label]});catColorScale=MapGenerator.createCatColorScale(viz,Object.keys(colorHash).length);catColorScale.domain(colorData);legend=MapGenerator.createLegend(colorData,catColorScale,colorOpacity,"circle")}if(legend&&showLegend==="on"){legend.addTo(map)}}var minSize=parseFloat(viz.circleMinSize)||mapConfig.minCircleSize;var maxSize=parseFloat(viz.circleMaxSize)||mapConfig.maxCircleSize;var sizeScale=d3.scale.linear().domain([0,0]).rangeRound([minSize,maxSize]);if(viz.size){if(normalizeSize){sizeScale.domain([0,1])}else{var sizeData=data.map(function(datum){return datum[viz.size.label]});sizeScale.domain([d3.min(sizeData),d3.max(sizeData)])}}var polylines=[];if(showLines){var lineData=data.filter(function(d){return!VizUtil.isEmpty(d[latCol.label])&&!VizUtil.isEmpty(d[longCol.label])});var splitLinesByLabel=viz.mapSplitLinesByLabel==="on";var groupbyCol=viz.color?viz.color.label:null;if(splitLinesByLabel&&viz.label){groupbyCol=viz.label.label}var colorCol=viz.color?viz.color.label:null;lineData=groupbyCol?d3.nest().key(function(d){return d[groupbyCol]}).entries(lineData):[{key:DEFAULT_GROUP_NAME,values:data}];lineData.forEach(function(datum,idx){if(datum.values&&datum.values.length>1){if(!VizUtil.isEmpty(datum.values[0][VizUtil.ORIGINAL_ORDER_COL_NAME])){datum.values.sort(function(a,b){return b[VizUtil.ORIGINAL_ORDER_COL_NAME]-a[VizUtil.ORIGINAL_ORDER_COL_NAME]})}var colorValue=groupbyCol===colorCol?catColorScale(datum.key):colorCol&&datum.values[0][colorCol]?catColorScale(datum.values[0][colorCol]):catColorScale(DEFAULT_GROUP_NAME);if(viz.colorbucket){colorValue=quantColorScale(datum.values[0][viz.colorbucket.label])}var msg="";for(var key in datum.values[0]){if(labelNameMap[key]){var value=datum.values[0][key];msg+='<div class="popup-content-row"><div class="popup-content-cell">'+labelNameMap[key]+':</div><div class="popup-content-cell">'+formatValue(value)+"</div></div>"}}if(normalizeSize){var sizes=datum.values.map(function(v){return v[viz.size.label]});var sscale=d3.scale.linear().domain(d3.extent(sizes)).range([0,1]);datum.values.forEach(function(v){v[CALCULATED_SIZE]=sscale(v[viz.size.label])})}var lng=null,lat=null,prevlng=null;var latlngs=datum.values.map(function(v){lng=v[longCol.label];lat=v[latCol.label];if(prevlng!==null&&Math.abs(lng-prevlng)>180&&lng*prevlng<0){if(prevlng<0){lng=lng-360}else{lng=lng+360}}prevlng=lng;v[CALCULATED_LONG]=lng;return L.latLng(lat,lng)});var polyline=L.polyline(latlngs,{color:colorValue,opacity:colorOpacity,dashArray:showDashedLines?"5, 5":null,"data-line-id":idx});polyline.on("mouseover",function(evt){var dataidx=evt.target.options["data-line-id"];var dt=lineData[dataidx].values[0];var infoboxValues=[];if(viz.label){infoboxValues.push({type:"title",column:viz.label,value:label1ValuePrefix+formatValue(dt[viz.label.label])+label1ValueSuffix});if(viz.color){infoboxValues.push({type:"label",suffix:" ("+VizUtil.getMessage(MapGenerator._lang,"Color")+")",column:viz.color,value:colorValuePrefix+formatValue(dt[viz.color.label])+colorValueSuffix})}}else if(viz.color){infoboxValues.push({type:"title",column:viz.color,value:formatValue(dt[viz.color.label])})}infobox.update(infoboxValues);polyline.setStyle({weight:5})});polyline.on("mouseout",function(){infobox.update();polyline.setStyle({weight:3})});polylines.push(polyline)}})}var circles=[];if(!showLines&&viz.size){data=data.sort(function(a,b){return b[viz.size.label]-a[viz.size.label]})}data.forEach(function(datum,idx){if(VizUtil.isEmpty(datum[latCol.label])||VizUtil.isEmpty(datum[longCol.label])){return}var colorValue=catColorScale(viz.color?datum[viz.color.label]:DEFAULT_GROUP_NAME);if(viz.colorbucket){colorValue=quantColorScale(datum[viz.colorbucket.label])}var sizeValue=sizeScale(viz.size?normalizeSize?datum[CALCULATED_SIZE]||0:datum[viz.size.label]:null);var showBorder=viz.mapShowBorder!=="off";var borderColor=viz.mapBorderColor||"#ffffff";var msg="";for(var key in datum){if(labelNameMap[key]){var value=datum[key];msg+='<div class="popup-content-row"><div class="popup-content-cell">'+labelNameMap[key]+':</div><div class="popup-content-cell">'+formatValue(value)+"</div></div>"}}var circleMarker=L.circleMarker(L.latLng(datum[latCol.label],datum[CALCULATED_LONG]||datum[longCol.label]),{stroke:showBorder,color:colorValue,fillColor:colorValue,fillOpacity:colorOpacity,radius:sizeValue,weight:showBorder?1:0,"data-id":idx});circleMarker.on("mouseover",function(evt){var dataidx=evt.target.options["data-id"];var dt=data[dataidx];var infoboxValues=[];var labelAsTitle=viz.labelAsCardTitle==="on";if(viz.showLongLatValues==="on"){infoboxValues.push({type:"long",column:longCol,value:formatValue(dt[longCol.label])});infoboxValues.push({type:"lat",column:latCol,value:formatValue(dt[latCol.label])})}if(viz.groupby&&viz.showGroupByValueInBalloon!=="off"){if(viz.groupby.type===VizUtil.TYPE_ROWID){infoboxValues.push({type:"label",column:{name:VizUtil.getMessage(MapGenerator._lang,VizUtil.ROWID_COL_LABEL),func:"",type:VizUtil.TYPE_ROWID},value:formatValue(dt[viz.groupby.label])})}else{infoboxValues.push({type:labelAsTitle?"label":"title",column:viz.groupby,value:formatValue(dt[viz.groupby.label])})}}if(isEasymap){infoboxValues.push({type:viz.label&&labelAsTitle?"label":"title",column:{name:"Name",func:""},value:valueLabelHt[dt[VizUtil.KEYPROP_COL_NAME]]||""})}if(viz.label){infoboxValues.push({type:labelAsTitle?"title":"label",column:viz.label,value:label1ValuePrefix+formatValue(dt[viz.label.label])+label1ValueSuffix})}if(viz.label2){infoboxValues.push({type:"label",column:viz.label2,value:label2ValuePrefix+formatValue(dt[viz.label2.label])+label2ValueSuffix})}if(viz.color){infoboxValues.push({type:"label",suffix:" ("+VizUtil.getMessage(MapGenerator._lang,"Color")+")",column:viz.color,value:colorValuePrefix+formatValue(dt[viz.color.label])+colorValueSuffix})}if(viz.size){infoboxValues.push({type:"label",suffix:" ("+VizUtil.getMessage(MapGenerator._lang,"Size")+")",column:viz.size,value:sizeValuePrefix+formatValue(dt[viz.size.label])+sizeValueSuffix})}if(viz.showNumberOfRowsInBalloon==="on"&&(isEasymap||viz.groupby&&viz.groupby.name!==VizUtil.ROWID_COL_NAME)&&dt[VizUtil.NROW_INTERNAL_COL_NAME]&&infoboxValues.filter(function(v){return v.column.name===VizUtil.NUMROWS_COL_NAME}).length===0){infoboxValues.push({type:"label",column:{name:VizUtil.NUMROWS_COL_NAME,func:""},value:formatNumrowValue(dt[VizUtil.NROW_INTERNAL_COL_NAME])})}infobox.update(infoboxValues);circleMarker.setStyle({stroke:true,weight:3})});circleMarker.on("mouseout",function(){infobox.update();circleMarker.setStyle({stroke:showBorder,weight:showBorder?1:0})});circles.push(circleMarker)});if(viz.color&&!viz.colorbucket&&catColorScale.isHighlightColorScale){MapGenerator._moveHighlightedCirclesToBottom(circles,catColorScale)}var circleGroup=L.featureGroup(polylines.concat(circles));circleGroup.addTo(map);if(zoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(zoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{_bounds=circleGroup.getBounds();if(L.latLngBounds(_bounds).isValid()){map.fitBounds(_bounds)}else{map.setView([0,0],1)}}}else{if(isEasymap&&geoJSON){geoJSONLayer=L.geoJSON(geoJSON,options);geoLayerBounds=geoJSONLayer.getBounds();if(L.latLngBounds(geoLayerBounds).isValid()){map.fitBounds(geoLayerBounds)}else{map.setView([0,0],1)}}else{map.setView([0,0],1)}}break;case"maphmap":if(viz.x&&viz.y){var heatData=[],circleData=[];var mag=viz.maphmapMagnification?parseFloat(viz.maphmapMagnification):1;var rad=viz.maphmapRadius?parseFloat(viz.maphmapRadius):25;if(data.length>1&&Array.isArray(data[0])&&Array.isArray(data[1])){data=data[1]}data.forEach(function(datum){if(VizUtil.isEmpty(datum[viz.y.label])||VizUtil.isEmpty(datum[viz.x.label])){return}heatData.push([datum[viz.y.label],datum[viz.x.label],viz.color?datum[viz.color.label]*mag:mag]);circleData.push(L.circleMarker(L.latLng(datum[viz.y.label],datum[viz.x.label])))});var heatLayer=L.heatLayer(heatData,{radius:rad});heatLayer.addTo(map);if(zoomLevel&&bounds){try{map.setZoom(zoomLevel)}catch(e){console.log(e)}map.fitBounds(bounds)}else if(zoomLevel&&center){try{map.setView(center,zoomLevel)}catch(e){console.log(e)}}else{var _feat=L.featureGroup(circleData);_bounds=_feat.getBounds();if(L.latLngBounds(_bounds).isValid()){map.fitBounds(_bounds)}else{map.setView([0,0],1)}}}else{map.setView([0,0],1)}break;default:break}if(typeof module==="object"&&module.exports&&map&&!noThumbnail){global._leaflet_map_obj=map}
if(elTarget.classList.contains("markdown-viz-container")){if(!window._leaflet_map_objs)window._leaflet_map_objs={};window._leaflet_map_objs[elTarget.getAttribute("data-id").replace(/^div-/,"")]=map}};MapGenerator.getRenderFunction=function(viz,data,geojson,onLoadCallback,onErrorCallback,noThumbnail){var func=function(props){viz.width=props.width;viz.height=props.height;var elTarget=props.elem;MapGenerator.render(viz,data,elTarget,geojson,onLoadCallback,onErrorCallback,noThumbnail)};return func};if(typeof module==="object"&&module.exports)module.exports=MapGenerator;