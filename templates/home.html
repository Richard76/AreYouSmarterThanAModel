<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Titanic</title>
    <!-- Load plotly.js into the DOM -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
	<link rel="stylesheet" href="/static/css/styles.css">
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
</head>
<body>
    {% csrf_token %}
    <div id="app" class="container">


        <h1>Titanic Dashboard</h1>
        <hr>

        <div class="row row1">   
            <div class="col-6">
                <h3>Filters</h3>
            </div>

            <div class="col">
                <h3>Predicted Survival Rate</h3>
                <p class= "prediction" >50.0%</p>
            </div>

            <div class="col">
                <h3>Actual Survival Rate</h3>
                <p class = prediction>50.0%</p>
            </div>
        </div>


        <div class="row row2"> 
            <div class="col">
                <h2>Passenger Class</h2>
                <div id='byClass'><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>

            <div class="col">
                <h2>Sex</h2>
                <div id='bySex'><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>

            <div class="col">
                <h2>Age</h2>
                <div id='byAge'><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>

            <div class="col">
                <h2>Fare Paid</h2>
                <div id='byFare'><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>
        </div>

        <hr>

        <div class="row row3"> 
            <div class="col">
                <h2>Embarked</h2>
                <div id='byEmbarked'><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>

            <div class="col">
                <h2>Group Size</h2>
                <div id='byGroupSize'><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>

            <div class="col">
                <h2>Cabin Class</h2>
                <div id='byCabinClass'><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>

            <div class="col">
                <h2>Title</h2>
                <div id='byTitle'><!-- Plotly chart will be drawn inside this DIV --></div>
            </div>
        </div>



        <hr>
        <h3>Raw Data Dump</h3>
        <ul>
            <li v-for="passenger in passengers">
                <h3>id - [[ passenger.id ]]</h3>
                <p>Age - [[ passenger.Age ]]</p>
                <p>Sex - [[ passenger.Sex ]]</p>
            </li>
        </ul>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <script>
    const vm = new Vue({
        el: '#app',
        delimiters: ['[[',']]'],
        data: {
            passengers: [],
            csrf_token: "",
        },
        methods: {
            loadPassengers: function() {
                axios({
                    method: 'get',
                    url: '/apis/v1/'
                }).then(response => {
                    this.passengers = response.data
                    console.log(".")
                    this.drawCharts();
                })
            
            },
            drawCharts: function() {

                // 1. by passenger class
                var classLived = {
                x: ['First Class', 'Second Class', 'Third Class'],
                y: [this.passengers.filter(passenger=>passenger.Passenger_Class === "First")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Passenger_Class === "Second")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Passenger_Class === "Third")
                    .filter(passenger=>passenger.Survived === "Lived").length,
                    
                    ],
                name: 'Survived',
                type: 'bar'
                };

                var classPerished = {
                x: ['First Class', 'Second Class', 'Third Class'],
                y: [this.passengers.filter(passenger=>passenger.Passenger_Class === "First")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Passenger_Class === "Second")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Passenger_Class === "Third")
                    .filter(passenger=>passenger.Survived === "Perished").length,
                    
                    ],
                name: 'Perished',
                type: 'bar'
                };

                var data_class = [classLived, classPerished];
                var layout_class = {barmode: 'stack'};
                Plotly.newPlot('byClass', data_class, layout_class, {responsive: true});

                // 2. by sex
                var sexLived = {
                x: ['Female', 'Male'],
                y: [this.passengers.filter(passenger=>passenger.Sex === "female")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Sex === "male")
                    .filter(passenger=>passenger.Survived === "Lived").length, 
                    
                    ],
                name: 'Survived',
                type: 'bar'
                };

                var sexPerished = {
                x: ['Female', 'Male'],
                y: [this.passengers.filter(passenger=>passenger.Sex === "female")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Sex === "male")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    
                    ],
                name: 'Perished',
                type: 'bar'
                };

                var data_class = [sexLived, sexPerished];
                var layout_class = {barmode: 'stack'};
                Plotly.newPlot('bySex', data_class, layout_class, {responsive: true}); 

                // 3. by age
                var ageLived = {
                x: ['Under 15', '15 to 55', '55 & Over'],
                y: [this.passengers.filter(passenger=>passenger.Age < 15)
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Age >= 15 && passenger.Age < 55)
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Age >= 55)
                    .filter(passenger=>passenger.Survived === "Lived").length, 
                    
                    ],
                name: 'Survived',
                type: 'bar'
                };

                var agePerished = {
                x: ['Under 15', '15 to 55', '55 & Over'],
                y: [this.passengers.filter(passenger=>passenger.Age < 15)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Age >= 15 && passenger.Age < 55)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Age >= 55)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    
                    ],
                name: 'Perished',
                type: 'bar'
                };

                var data_age = [ageLived, agePerished];
                var layout_age = {barmode: 'stack'};
                Plotly.newPlot('byAge', data_age, layout_age, {responsive: true}); 



                // 4. by fare paid
                var fareLived = {
                x: ['Under 50', '50 to 100', 'Over 100'],
                y: [this.passengers.filter(passenger=>passenger.Fare_Paid < 50)
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Fare_Paid >= 50 && passenger.Fare_Paid <= 100)
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Fare_Paid > 100)
                    .filter(passenger=>passenger.Survived === "Lived").length,
                    
                    ],
                name: 'Survived',
                type: 'bar'
                };

                var farePerished = {
                x: ['Under 50', '50 to 100', 'Over 100'],
                y: [this.passengers.filter(passenger=>passenger.Fare_Paid < 50)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Fare_Paid >= 50 && passenger.Fare_Paid <= 100)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Fare_Paid > 100)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    
                    ],
                name: 'Perished',
                type: 'bar'
                };

                var data_fare = [fareLived, farePerished];
                var layout_fare = {barmode: 'stack'};
                Plotly.newPlot('byFare', data_fare, layout_fare, {responsive: true}); 

                // 5. by embarked
                var embarkedLived = {
                x: ['Cherbourg', 'Queenstown', 'Southampton'],
                y: [this.passengers.filter(passenger=>passenger.Embarked === "Cherbourg")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Embarked === "Queenstown")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Embarked === "Southampton")
                    .filter(passenger=>passenger.Survived === "Lived").length, 
                    
                    ],
                name: 'Survived',
                type: 'bar'
                };

                var embarkedPerished = {
                x: ['Cherbourg', 'Queenstown', 'Southampton'],
                y: [this.passengers.filter(passenger=>passenger.Embarked === "Cherbourg")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Embarked === "Queenstown")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Embarked === "Southampton")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    
                    ],
                name: 'Perished',
                type: 'bar'
                };

                var data_embarked = [embarkedLived, embarkedPerished];
                var layout_embarked = {barmode: 'stack'};
                Plotly.newPlot('byEmbarked', data_embarked, layout_embarked, {responsive: true}); 

                // 6. by group size
                var groupSizeLived = {
                x: ['1', '2', '3', '4', '5 or more'],
                y: [this.passengers.filter(passenger=>passenger.Size_of_Group === 1)
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Size_of_Group === 2)
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Size_of_Group === 3)
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Size_of_Group === 4)
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>
                        passenger.Size_of_Group != 1 && passenger.Size_of_Group != 2 && passenger.Size_of_Group != 3 && passenger.Size_of_Group != 4  
                    )
                    .filter(passenger=>passenger.Survived === "Perished").length,    
                    ],

                name: 'Survived',
                type: 'bar'
                };

                var groupSizePerished = {
                x: ['1', '2', '3', '4', '5 or more'],
                y: [this.passengers.filter(passenger=>passenger.Size_of_Group === 1)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Size_of_Group === 2)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Size_of_Group === 3)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Size_of_Group === 4)
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>
                        passenger.Size_of_Group != 1 && passenger.Size_of_Group != 2 && passenger.Size_of_Group != 3 && passenger.Size_of_Group != 4       
                    )
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    
                    ],
                name: 'Perished',
                type: 'bar'
                };

                var data_groupSize = [groupSizeLived, groupSizePerished];
                var layout_groupSize = {barmode: 'stack', xaxis: {type:"category"}};
                Plotly.newPlot('byGroupSize', data_groupSize, layout_groupSize, {responsive: true} ); 


                // 7. by cabin class
                var cabinClassLived = {
                x: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'T', 'U'],
                y: [this.passengers.filter(passenger=>passenger.Cabin_Class === "A")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "B")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "C")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "D")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "E")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "F")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "G")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "T")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "U")
                    .filter(passenger=>passenger.Survived === "Lived").length, 
                    
                    ],
                name: 'Survived',
                type: 'bar'
                };

                var cabinClassPerished = {
                x: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'T', 'U'],
                y: [this.passengers.filter(passenger=>passenger.Cabin_Class === "A")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "B")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "C")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "D")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "E")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "F")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "G")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "T")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Cabin_Class === "U")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    
                    ],
                name: 'Perished',
                type: 'bar'
                };

                var data_cabinClass = [cabinClassLived, cabinClassPerished];
                var layout_cabinClass = {barmode: 'stack'};
                Plotly.newPlot('byCabinClass', data_cabinClass, layout_cabinClass, {responsive: true}); 

                // 8. by Title
                var titleLived = {
                x: ['Mr', 'Mrs', 'Miss', 'Master', 'Other'],
                y: [this.passengers.filter(passenger=>passenger.Title === "Mr")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Title === "Mrs")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Title === "Miss")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(passenger=>passenger.Title === "Master")
                    .filter(passenger=>passenger.Survived === "Lived").length, 

                    this.passengers.filter(
                        passenger=>passenger.Title !== "Mr" && 
                        passenger.Title !== "Mrs" && 
                        passenger.Title !== "Miss" && 
                        passenger.Title !== "Master"      
                    )
                    .filter(passenger=>passenger.Survived === "Lived").length, 
                    
                    ],
                name: 'Survived',
                type: 'bar'
                };

                var titlePerished = {
                x: ['Mr', 'Mrs', 'Miss', 'Master', 'Other'],
                y: [this.passengers.filter(passenger=>passenger.Title === "Mr")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Title === "Mrs")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Title === "Miss")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(passenger=>passenger.Title === "Master")
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    this.passengers.filter(
                        passenger=>passenger.Title !== "Mr" && 
                        passenger.Title !== "Mrs" && 
                        passenger.Title !== "Miss" && 
                        passenger.Title !== "Master"      
                    )
                    .filter(passenger=>passenger.Survived === "Perished").length, 

                    
                    ],
                name: 'Perished',
                type: 'bar'
                };

                var data_title = [titleLived, titlePerished];
                var layout_title = {barmode: 'stack'};
                Plotly.newPlot('byTitle', data_title, layout_title, {responsive: true}); 


            }
        },
        watch: { 
            passengers: function() {
                this.drawCharts();
            }
        },

        created: function() {
            this.loadPassengers()
        },
        mounted: function() {
            this.csrf_token = document.querySelector('input[name="csrfmiddlewaretoken"]').value
            
        }
    })
 

        



    </script>
</body>
</html>